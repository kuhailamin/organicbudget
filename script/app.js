var GENERAL=new General();function General(){this.username="";this.currency="";this.dateFormat=1;this.timeFormat=1;this.numberFormat=1;this.orientation=0;this.lang="en";this.expense_categories=null;this.income_categories=null;this.orientation_page=0;this.currency_format_example={"1":"$1,234.56","6":"&pound;1,234.56","9":"&#65509;1,234.56","7":"1,234.56 JD","11":"&#8377;1,234.56","12":"&#8361;1,234.56","2":"&euro;1.234,56","8":"R$1.234,56","3":"1,234,56 &euro;","10":"1.234,56 DZD","4":"1 234,56 &euro;","5":"&yen;1,234"};this.date_format_example={"1":"12/15/2018","2":"15/12/2018","3":"12/15/18","4":"15/12/18","5":"2018/12/15","6":"12-15-2018","7":"15-12-2018","8":"12-15-18","9":"15-12-18","10":"2018-12-15","11":"12.15.2018","12":"15.12.2018","13":"12.15.18","14":"15.12.18","15":"2018.12.15"};this.time_format_example={"1":"8:15 am","2":"8:15 AM","3":"8:15","4":"08:15"};this.orientation_data=[];}
General.prototype.show_settings_window=function(){var window_template=$(constants.SETTINGS_WINDOW_TEMPLATE_ID).html();$(constants.WINDOW_ID).html(window_template);$(constants.SETTINGS_USERNAME_ID).text(GENERAL.username);$(constants.SETTINGS_DATE_FORMAT_ID).val(GENERAL.dateFormat);$(constants.SETTINGS_DATE_FORMAT_EXAMPLE_ID).text(GENERAL.date_format_example[GENERAL.dateFormat]);$(constants.SETTINGS_TIME_FORMAT_ID).val(GENERAL.timeFormat);$(constants.SETTINGS_TIME_FORMAT_EXAMPLE_ID).text(GENERAL.time_format_example[GENERAL.timeFormat]);$(constants.SETTINGS_NUMBER_FORMAT_ID).val(GENERAL.numberFormat);$(constants.SETTINGS_NUMBER_FORMAT_EXAMPLE_ID).html(GENERAL.currency_format_example[GENERAL.numberFormat]);var currencies_template=$(constants.CURRENCIES_TEMPLATE_ID).html();var html_maker=new htmlMaker(currencies_template);var currencies_html=html_maker.getHTML(ACCOUNT.currencies);$(constants.SETTING_DEFAULT_CURRENCY_ID).html(currencies_html);$(constants.SETTING_DEFAULT_CURRENCY_ID).val(GENERAL.currency);$(constants.SETTINGS_DATE_FORMAT_ID).on("change",function(){$(constants.SETTINGS_DATE_FORMAT_EXAMPLE_ID).text(GENERAL.date_format_example[$(constants.SETTINGS_DATE_FORMAT_ID).val()]);});$(constants.SETTINGS_TIME_FORMAT_ID).on("change",function(){$(constants.SETTINGS_TIME_FORMAT_EXAMPLE_ID).text(GENERAL.time_format_example[$(constants.SETTINGS_TIME_FORMAT_ID).val()]);});$(constants.SETTINGS_NUMBER_FORMAT_ID).on("change",function(){$(constants.SETTINGS_NUMBER_FORMAT_EXAMPLE_ID).html(GENERAL.currency_format_example[$(constants.SETTINGS_NUMBER_FORMAT_ID).val()]);});$(constants.EDIT_SETTINGS_BUTTON_ID).on("click",function(e){e.stopPropagation();var date_format=$(constants.SETTINGS_DATE_FORMAT_ID).val();var time_format=$(constants.SETTINGS_TIME_FORMAT_ID).val();var number_format=$(constants.SETTINGS_NUMBER_FORMAT_ID).val();var currency_id=$(constants.SETTING_DEFAULT_CURRENCY_ID).val();GENERAL.edit_settings_request(date_format,time_format,number_format,currency_id);});$(constants.CHANGE_PASSWORD_BUTTON_ID).on("click",function(e){e.stopPropagation();var window_template=$(constants.SETTINGS_CHANGE_PASSWORD_TEMPLATE_ID).html();$(constants.WINDOW_ID).html(window_template);$(constants.WINDOW_ID).show(constants.SHOWING_SPEED);GENERAL.regular_window_events();$(constants.SETTING_CHANGE_PASSWORD_REQUEST_BUTTON_ID).on("click",function(e){var old_password=$(constants.SETTINGS_OLD_PASSWORD_ID).val();var password=$(constants.SETTINGS_PASSWORD_ID).val();var confirmed_password=$(constants.SETTINGS_CONFIRMED_PASSWORD_ID).val();GENERAL.disable_button($(constants.SETTING_CHANGE_PASSWORD_REQUEST_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.SETTINGS_CHANGE_PASSWORD_REQUEST,password:password,confirmed_password:confirmed_password,old_password:old_password},success:function(data){GENERAL.check_session_expired(data);$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.SHOWING_SPEED);GENERAL.change_password_feedback(data);}});});});$(constants.DELETE_ACCOUNT_BUTTON).on("click",function(e){e.stopPropagation();var window_template=$(constants.SETTINGS_DELETE_MY_ACCOUNT_TEMPLATE_ID).html();$(constants.WINDOW_ID).html(window_template);$(constants.WINDOW_ID).show(constants.SHOWING_SPEED);GENERAL.delete_window_events();$(constants.SETTINGS_DELETE_USER_ACCOUNT).on("click",function(e){e.stopPropagation();GENERAL.disable_button($(constants.SETTINGS_DELETE_USER_ACCOUNT));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.SETTINGS_DELETE_USER_ACCOUNT_REQUEST},success:function(data){GENERAL.check_session_expired(data);$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.SHOWING_SPEED);GENERAL.delete_user_account_feedback(data);}});});});$(constants.WINDOW_ID).show(constants.SHOWING_SPEED);GENERAL.regular_window_events();};General.prototype.delete_user_account_feedback=function(data){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data["result"]==constants.SUCCESS_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("Your account has been deleted successfully!");LOGIN.logout();}
else if(data["result"]==constants.FAIL_RESPONSE){GENERAL.enable_button($(constants.SETTINGS_DELETE_USER_ACCOUNT));$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't delete your account");}};General.prototype.change_password_feedback=function(data){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data["result"]==constants.SUCCESS_RESPONSE){GENERAL.enable_button($(constants.SETTING_CHANGE_PASSWORD_REQUEST_BUTTON_ID));GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("The password been changed successfully!");}
else if(data["result"]==constants.FAIL_RESPONSE){GENERAL.enable_button($(constants.SETTING_CHANGE_PASSWORD_REQUEST_BUTTON_ID));$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't change the password");}};General.prototype.edit_settings_request=function(date_format,time_format,number_format,currency_id){GENERAL.disable_button($(constants.EDIT_SETTINGS_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.EDIT_SETTINGS_REQUEST,date_format:date_format,time_format:time_format,number_format:number_format,currency_id:currency_id},success:function(data){GENERAL.check_session_expired(data);$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.SHOWING_SPEED);GENERAL.edit_settings_feedback(data);}});};General.prototype.edit_settings_feedback=function(data){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data["result"]==constants.SUCCESS_RESPONSE){GENERAL.enable_button($(constants.EDIT_SETTINGS_BUTTON_ID));GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("The settings have been edited successfully!");GENERAL.reload_all();}
else if(data["result"]==constants.FAIL_RESPONSE){GENERAL.enable_button($(constants.ADD_ACCOUNT_BUTTON));$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't edit the settings");}};General.prototype.reload_all=function(){GENERAL.init();TRANSACTION.init();TRANSACTION.get_transactions();ACCOUNT.get_accounts();BUDGET.init();ANALYTICS.init();};General.prototype.set_help_tooltip_text=function(help_topic_names){for(var i=0;i<help_topic_names.length;++i){var tooltip_template_html=$(constants.HELP_TOOLTIP_TEMPLATE_ID+help_topic_names[i]).html();$(constants.HELP_TOOLTIP_ID+help_topic_names[i]).html(tooltip_template_html);}};General.prototype.set_multiple_help_tooltip_text=function(help_topic_names,indices){for(var j=0;j<indices.length;++j){for(var i=0;i<help_topic_names.length;++i){var tooltip_template_html=$(constants.HELP_TOOLTIP_TEMPLATE_ID+help_topic_names[i]).html();$(constants.HELP_TOOLTIP_ID+help_topic_names[i]+"-"+indices[j]).html(tooltip_template_html);}}};General.prototype.get_expense_category_name_from_id=function(category_id){for(var i=0;i<GENERAL.expense_categories.length;++i){if(GENERAL.expense_categories[i][constants.CATEGORY_ID_ATTR]==category_id)
return GENERAL.expense_categories[i][constants.CATEGORY_NAME_ATTR];}
return"";};General.prototype.max=function(data,attr){var max=0;for(var i=0;i<data.length;++i){if(data[attr]>max)
max=data[attr];}
return max;};General.prototype.min=function(data,attr){var min=0;for(var i=0;i<data.length;++i){if(data[attr]<min)
min=data[attr];}
return min;};General.prototype.init=function(){GENERAL.orientation_data=[{"title":"Welcome to Organic Budget!","content":"Organic Budget was designed to simplify budgeting. <br> In this short trip, we will show you how it works!<br> This will take about a minute.","phone_content":"","tooltips":[],"tab":["#transactions_tab"],"functions":[],"bottom":"70px","top":"auto","vscroll":0},{"title":"Settings","content":"At the top right you see the system settings","phone_content":"","tooltips":["#settings_tooltip"],"tab":["#transactions_tab"],"functions":[],"bottom":"70px","top":"auto","vscroll":0},{"title":"Main Navigation","content":"At the top you see the main navigation tabs: transactions, insights, categories, budgets, and accounts","phone_content":"At the top you see the main navigation menu: transactions, insights, categories, budgets, and accounts","tooltips":["#main_navigation_tooltip"],"tab":["#transactions_tab"],"functions":[],"bottom":"70px","top":"auto","vscroll":0},{"title":"Accounts","content":"In this page, you see your account(s).","phone_content":"","tooltips":["#new_account_tooltip_0"],"tab":["#accounts_tab"],"functions":[],"bottom":"70px","top":"auto","vscroll":0},{"title":"Account Management","content":"You can edit/delete an existing account or add a new one.","phone_content":"","tooltips":["#add_account_tooltip","#edit_account_tooltip_0"],"tab":["#accounts_tab"],"functions":[],"bottom":"70px","top":"auto","vscroll":0},{"title":"Account Summary","content":"The table at the bottom shows the summary of your accounts","phone_content":"","tooltips":["#account_summary_tooltip"],"tab":["#accounts_tab"],"functions":[],"bottom":"auto","top":"50px","vscroll":"#account_summary_table"},{"title":"Categories","content":"With category tabs, you can navigate between spending and income categories","phone_content":"","tooltips":["#category_tab_tooltip"],"tab":["#categories_tab","#expenses"],"functions":[],"bottom":"70px","top":"auto","vscroll":0},{"title":"Adding Categories","content":"You can add a new spending or income category","phone_content":"","tooltips":["#add_category_tooltip"],"tab":["#categories_tab","#expenses"],"functions":[],"bottom":"70px","top":"auto","vscroll":0},{"title":"Spending Categories","content":"We added some spending categories for you","phone_content":"","tooltips":["#new_spending_categories_tooltip"],"tab":["#categories_tab","#expenses"],"functions":[],"bottom":"70px","top":"auto","vscroll":0},{"title":"Income Categories","content":"We added some income categories for you","phone_content":"","tooltips":["#new_income_categories_tooltip"],"tab":["#categories_tab_tooltip","#income"],"functions":[],"bottom":"70px","top":"auto","vscroll":0},{"title":"Expanding/Collpasing Categories","content":"Clicking on a category can expand or collapse its items","phone_content":"","tooltips":["#expand_categories_tooltip"],"tab":["#categories_tab","#expenses"],"functions":[CATEGORY.show_first_category_items],"bottom":"70px","top":"auto","vscroll":0},{"title":"Category/Item Management","content":"You can add an item or edit or delete a category","phone_content":"","tooltips":["#edit_categories_tooltip"],"tab":["#categories_tab","#expenses"],"functions":[],"bottom":"70px","top":"auto","vscroll":0},{"title":"Item Management","content":"You can edit or delete an item","phone_content":"","tooltips":["#edit_items_tooltip"],"tab":["#categories_tab","#expenses"],"functions":[],"bottom":"70px","top":"auto","vscroll":0},{"title":"Budgets","content":"In this page, you see your budget(s)","phone_content":"","tooltips":["#budget_tooltip"],"tab":["#budgets_tab"],"functions":[],"bottom":"70px","top":"auto","vscroll":0},{"title":"Add Budget","content":"You can add a budget by clicking on the button at the top","phone_content":"","tooltips":["#add_budget_tooltip"],"tab":["#budgets_tab"],"functions":[],"bottom":"70px","top":"auto","vscroll":0},{"title":"Budget Management","content":"You can edit or delete a budget, edit or add targets","phone_content":"","tooltips":["#edit_budget_tooltip"],"tab":["#budgets_tab"],"functions":[],"bottom":"70px","top":"auto","vscroll":0},{"title":"Expanding/Collpasing Targets","content":"You can expand/collapse targets by clicking/tapping on a budget","phone_content":"","tooltips":["#expand_collapse_budget_tooltip"],"tab":["#budgets_tab"],"functions":[BUDGET.show_first_budget_targets],"bottom":"70px","top":"auto","vscroll":0},{"title":"Target Management","content":"You can edit/delete a target","phone_content":"","tooltips":["#edit_target_tooltip"],"tab":["#budgets_tab"],"functions":[BUDGET.show_first_budget_targets],"bottom":"70px","top":"auto","vscroll":0},{"title":"Transactions","content":"Manage your transactions here","phone_content":"","tooltips":[],"tab":["#transactions_tab"],"functions":[],"bottom":"70px","top":"auto","vscroll":0},{"title":"Add Transactions","content":"You can add a new transaction","phone_content":"","tooltips":["#add_transaction_tooltip"],"tab":["#transactions_tab"],"functions":[],"bottom":"70px","top":"auto","vscroll":0},{"title":"Transaction Filters","content":"You can filter your transactions using the filters at the top","phone_content":"","tooltips":["#transaction_filters_tooltip"],"tab":["#transactions_tab"],"functions":[],"bottom":"70px","top":"auto","vscroll":0},{"title":"Transactions","content":"In this page, you see your transaction(s)","phone_content":"","tooltips":["#new_transaction_tooltip"],"tab":["#transactions_tab"],"functions":[],"bottom":"70px","top":"auto","vscroll":0},{"title":"Edit Transactions","content":"You can edit a transaction","phone_content":"","tooltips":["#edit_transaction_tooltip"],"tab":["#transactions_tab"],"functions":[],"bottom":"70px","top":"auto","vscroll":0},{"title":"Expand Transactions","content":"Click on a transaction to expand or collapse a transaction","phone_content":"","tooltips":["#expand_transaction_tooltip"],"tab":["#transactions_tab"],"functions":[TRANSACTION.show_first_transaction],"bottom":"auto","top":"30px","vscroll":0},{"title":"Insights","content":"Welcome to the insights section. You can analyze your spending and savings with many effective and beautiful charts.","phone_content":"","tooltips":[],"tab":["#analytics_tab"],"functions":[],"bottom":"70px","top":"auto","vscroll":0},{"title":"Spending Insights","content":"Use spending insights filters to look at different periods of times, accounts, and to see your spending by category, payee, or item name","phone_content":"","tooltips":["#spending_analytics_tooltip"],"tab":["#analytics_tab"],"functions":[],"bottom":"70px","top":"auto","vscroll":0},{"title":"Total Spending Insights","content":"Use total spending insights filters to look at different periods of times, accounts, and categories","phone_content":"","tooltips":["#total_spending_analytics_tooltip"],"tab":["#analytics_tab"],"functions":[],"bottom":"auto","top":"0px","vscroll":0},{"title":"Budget Tracking Insights","content":"Use budget tracking insights filters to look at different periods of times, accounts, and scales","phone_content":"","tooltips":["#budget_analytics_tooltip"],"tab":["#analytics_tab"],"functions":[],"bottom":"50px","top":"auto","vscroll":"#budget_analytics_div"},{"title":"Total Savings Insights","content":"Use total savings insights filters to look at different periods of times and accounts","phone_content":"","tooltips":["#total_savings_analytics_tooltip"],"tab":["#analytics_tab"],"functions":[],"bottom":"50px","top":"auto","vscroll":"#total_savings_analytics_div"},{"title":"Income vs Spending Insights","content":"Use income vs spending insights filters to look at different periods of times and accounts, and to sort the results","phone_content":"","tooltips":["#income_spending_analytics_tooltip"],"tab":["#analytics_tab"],"functions":[],"bottom":"auto","top":"0px","vscroll":"#income_spending_analytics_div"},{"title":"Organic Budget","content":"Thanks for going through this trip! <br> Enjoy Organic Budget now!","phone_content":"","tooltips":[],"tab":["#transactions_tab"],"functions":[],"bottom":"70px","top":"auto","vscroll":0}];$.ajax({method:"POST",url:constants.CONTROLLER_PATH,data:{type:constants.GET_SETTINGS},dataType:"json",success:function(data){if(data[constants.RESULT_ATTR]==constants.SUCCESS_RESPONSE){GENERAL.dateFormat=parseInt(data[constants.DATE_FORMAT_ATTR]);GENERAL.timeFormat=parseInt(data[constants.TIME_FORMAT_ATTR]);GENERAL.numberFormat=parseInt(data[constants.NUMBER_FORMAT_ATTR]);GENERAL.username=data[constants.USERNAME_ATTR];$(constants.HEADING_USERNAME_ID).text(GENERAL.username);GENERAL.currency=data[constants.CURRENCY_ATTR];GENERAL.orientation=parseInt(data[constants.ORIENTATION_ATTR]);$(constants.LOGOUT_MENU_ITEM).text("Logout ("+GENERAL.username+")");GENERAL.show_hide_orientation();}
GENERAL.check_session_expired(data);}});General.prototype.check_session_expired=function(data){if(data!==null&&data instanceof Object&&data.hasOwnProperty(constants.RESULT_ATTR)&&data[constants.RESULT_ATTR]==constants.SESSION_INACTIVE_RESPONSE)
window.location.assign(constants.LOGIN_PATH);};GENERAL.init_categories();GENERAL.init_system_menu();General.prototype.end_orientation=function(){$.ajax({method:"POST",url:constants.CONTROLLER_PATH,data:{type:constants.EDIT_ORIENTATION,orientation:1},dataType:"json",success:function(data){if(data["result"]==constants.SUCCESS_RESPONSE){GENERAL.orientation=parseInt(data[constants.ORIENTATION_ATTR]);}
GENERAL.check_session_expired(data);}});};General.prototype.show_hide_orientation=function(){if(GENERAL.orientation==0){GENERAL.show_orientation();}
else
$(constants.ORIENTATION_BOX_ID).hide();};General.prototype.show_orientation=function(){GENERAL.orientation_page=0;$(constants.ORIENTATION_BOX_ID).show();$(constants.ORIENTATION_PREV_BUTTON_ID).off("click");$(constants.ORIENTATION_CLOSE_ID).off("click");$(constants.ORIENTATION_NEXT_BUTTON_ID).off("click");$(constants.ORIENTATION_PREV_BUTTON_ID).on("click",function(){if(GENERAL.orientation_page>0){GENERAL.orientation_page--;$(constants.ORIENTATION_NEXT_BUTTON_ID).text(constants.ORIENTATION_NEXT_TEXT);GENERAL.populate_orientation();}
if(GENERAL.orientation_page==0){$(constants.ORIENTATION_PREV_BUTTON_ID).hide();$(constants.ORIENTATION_NEXT_BUTTON_ID).text(constants.ORIENTATION_START_TRIP_TEXT);}});$(constants.ORIENTATION_CLOSE_ID).on("click",function(){GENERAL.end_orientation();$(constants.ORIENTATION_BOX_ID).hide();});$(constants.ORIENTATION_NEXT_BUTTON_ID).on("click",function(){if($(constants.ORIENTATION_NEXT_BUTTON_ID).text()==constants.ORIENTATION_END_TRIP_TEXT){GENERAL.end_orientation();$(constants.ORIENTATION_BOX_ID).hide();}
if(GENERAL.orientation_page<GENERAL.orientation_data.length-1){$(constants.ORIENTATION_NEXT_BUTTON_ID).text(constants.ORIENTATION_NEXT_TEXT);GENERAL.orientation_page++;GENERAL.populate_orientation();}
if(GENERAL.orientation_page>=GENERAL.orientation_data.length-1){$(constants.ORIENTATION_NEXT_BUTTON_ID).text(constants.ORIENTATION_END_TRIP_TEXT);}
if(GENERAL.orientation_page>0)
$(constants.ORIENTATION_PREV_BUTTON_ID).show();});GENERAL.populate_orientation();};General.prototype.populate_orientation=function(){if(GENERAL.orientation_page==0)
$(constants.ORIENTATION_PREV_BUTTON_ID).hide();if(GENERAL.orientation_page>=GENERAL.orientation_data.length-1)
$(constants.ORIENTATION_NEXT_BUTTON_ID).text(constants.ORIENTATION_END_TRIP_TEXT);$(constants.ORIENTATION_TOOLTIP_CLASS_NAME).hide();var title=GENERAL.orientation_data[GENERAL.orientation_page]["title"];var content=GENERAL.orientation_data[GENERAL.orientation_page]["content"];var phone_content=GENERAL.orientation_data[GENERAL.orientation_page]["phone_content"];var tooltips_ids=GENERAL.orientation_data[GENERAL.orientation_page]["tooltips"];var orientation_tab_ids=GENERAL.orientation_data[GENERAL.orientation_page]["tab"];var functions=GENERAL.orientation_data[GENERAL.orientation_page]["functions"];var vscroll=GENERAL.orientation_data[GENERAL.orientation_page]["vscroll"];$(constants.ORIENTATION_BOX_ID).css("bottom",GENERAL.orientation_data[GENERAL.orientation_page]["bottom"]);$(constants.ORIENTATION_BOX_ID).css("top",GENERAL.orientation_data[GENERAL.orientation_page]["top"]);$(constants.ORIENTATION_TITLE_ID).html(title);$(constants.ORIENTATION_CONTENT_ID).html(content);if(phone_content!="")
$(constants.ORIENTATION_PHONE_CONTENT_ID).html(phone_content);else
$(constants.ORIENTATION_PHONE_CONTENT_ID).html(content);for(var i=0;i<tooltips_ids.length;++i){$(tooltips_ids[i]).show();}
for(var j=0;j<orientation_tab_ids.length;++j){$(orientation_tab_ids[j]).trigger("click");}
for(var k=0;k<functions.length;++k){functions[k]();}
if(isNaN(vscroll)){vscroll=$(vscroll).position().top;}
$("html, body").animate({scrollTop:vscroll});};if(!String.prototype.startsWith){String.prototype.startsWith=function(searchString,position){position=position||0;return this.substr(position,searchString.length)===searchString;};}
if(!String.prototype.endsWith){String.prototype.endsWith=function(searchString,position){var subjectString=this.toString();if(typeof position!=='number'||!isFinite(position)||Math.floor(position)!==position||position>subjectString.length){position=subjectString.length;}
position-=searchString.length;var lastIndex=subjectString.lastIndexOf(searchString,position);return lastIndex!==-1&&lastIndex===position;};}
if(!String.prototype.includes){String.prototype.includes=function(search,start){'use strict';if(typeof start!=='number'){start=0;}
if(start+search.length>this.length){return false;}else{return this.indexOf(search,start)!==-1;}};}};General.prototype.hide_system_menu=function(){$(constants.SYSTEM_MENU).css("display","none");$(constants.SYSTEM_MENU_ICON).css("background-color","transparent");};General.prototype.show_system_menu=function(){$(constants.SYSTEM_MENU).css("display","block");$(constants.SYSTEM_MENU_ICON).css("background-color","lightgray");};General.prototype.init_system_menu=function(){$(constants.TRANSACTION_MAIN_TAB).on("click",function(e){e.stopPropagation();$(constants.SECTION_TITLE_ID).text(constants.TAB_TRANSACTION_TITLE);$(constants.SECTION_TITLE_ID).css("top","48px");});$(constants.ANALYTICS_MAIN_TAB).on("click",function(e){e.stopPropagation();$(constants.SECTION_TITLE_ID).text(constants.TAB_ANALYTICS_TITLE);$(constants.SECTION_TITLE_ID).css("top","45px");});$(constants.CATEGORIES_MAIN_TAB).on("click",function(e){e.stopPropagation();$(constants.SECTION_TITLE_ID).text(constants.TAB_CATEGORIES_TITLE);$(constants.SECTION_TITLE_ID).css("top","48px");});$(constants.BUDGETS_MAIN_TAB).on("click",function(e){e.stopPropagation();$(constants.SECTION_TITLE_ID).text(constants.TAB_BUDGETS_TITLE);$(constants.SECTION_TITLE_ID).css("top","65px");});$(constants.ACCOUNTS_MAIN_TAB).on("click",function(e){e.stopPropagation();$(constants.SECTION_TITLE_ID).text(constants.TAB_ACCOUNTS_TITLE);$(constants.SECTION_TITLE_ID).css("top","65px");});$(constants.SYSTEM_MENU_TRANSACTIONS_ITEM).on("click",function(e){e.stopPropagation();$(constants.TAB_DETAIL_VISIBLE).attr("class",constants.TAB_DETAIL_HIDDEN_CLASS);$(constants.TRANSACTION_TAB_DETAIL).attr("class",constants.TAB_DETAIL_VISIBLE_CLASS);$(constants.SECTION_TITLE_ID).text(constants.TAB_TRANSACTION_TITLE);$(constants.SECTION_TITLE_ID).css("top","48px");$(constants.TRANSACTION_MAIN_TAB).trigger("click");GENERAL.hide_system_menu();});$(constants.SYSTEM_MENU_ANALYTICS_ITEM).on("click",function(e){e.stopPropagation();$(constants.TAB_DETAIL_VISIBLE).attr("class",constants.TAB_DETAIL_HIDDEN_CLASS);$(constants.ANALYTICS_TAB_DETAIL).attr("class",constants.TAB_DETAIL_VISIBLE_CLASS);$(constants.SECTION_TITLE_ID).text(constants.TAB_ANALYTICS_TITLE);$(constants.SECTION_TITLE_ID).css("top","45px");$(constants.ANALYTICS_MAIN_TAB).trigger("click");GENERAL.hide_system_menu();});$(constants.SYSTEM_MENU_BUDGETS_ITEM).on("click",function(e){e.stopPropagation();$(constants.TAB_DETAIL_VISIBLE).attr("class",constants.TAB_DETAIL_HIDDEN_CLASS);$(constants.BUDGETS_TAB_DETAIL).attr("class",constants.TAB_DETAIL_VISIBLE_CLASS);$(constants.SECTION_TITLE_ID).text(constants.TAB_BUDGETS_TITLE);$(constants.SECTION_TITLE_ID).css("top","65px");$(constants.BUDGETS_MAIN_TAB).trigger("click");GENERAL.hide_system_menu();});$(constants.SYSTEM_MENU_CATEGORIES_ITEM).on("click",function(e){e.stopPropagation();$(constants.TAB_DETAIL_VISIBLE).attr("class",constants.TAB_DETAIL_HIDDEN_CLASS);$(constants.CATEGORIES_TAB_DETAIL).attr("class",constants.TAB_DETAIL_VISIBLE_CLASS);$(constants.SECTION_TITLE_ID).text(constants.TAB_CATEGORIES_TITLE);$(constants.SECTION_TITLE_ID).css("top","48px");$(constants.CATEGORIES_MAIN_TAB).trigger("click");GENERAL.hide_system_menu();});$(constants.SYSTEM_MENU_ACCOUNTS_ITEM).on("click",function(e){e.stopPropagation();$(constants.TAB_DETAIL_VISIBLE).attr("class",constants.TAB_DETAIL_HIDDEN_CLASS);$(constants.ACCOUNTS_TAB_DETAIL).attr("class",constants.TAB_DETAIL_VISIBLE_CLASS);$(constants.SECTION_TITLE_ID).text(constants.TAB_ACCOUNTS_TITLE);$(constants.SECTION_TITLE_ID).css("top","65px");$(constants.ACCOUNTS_MAIN_TAB).trigger("click");GENERAL.hide_system_menu();});};General.prototype.init_categories=function(){$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.GET_USER_CATEGORIES_REQUEST},success:function(data){GENERAL.check_session_expired(data);GENERAL.expense_categories=data;BUDGET.maybe_enable_add_budget_button();}});$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.GET_INCOME_CATEGORIES_REQUEST},success:function(data){GENERAL.check_session_expired(data);GENERAL.income_categories=data;}});ANALYTICS.init_expense_categories();};General.prototype.get_date=function(year_string,month_string,day_string,hour_string,minute_string){var date=new Date();var year=date.getFullYear();var month=date.getMonth();var day=date.getDate();var hour=date.getHours();var minute=date.getMinutes();if(!isNaN(year_string))
year=parseInt(year_string);if(!isNaN(month_string))
month=parseInt(month_string)-1;if(!isNaN(day_string))
day=parseInt(day_string);if(!isNaN(hour_string))
hour=parseInt(hour_string);if(!isNaN(minute_string))
minute=parseInt(minute_string);date=new Date(year,month,day,hour,minute);return date;};General.prototype.format_date=function(date){var day=date.getDate();var month=date.getMonth()+1;var string_month=month>=10?month+"":"0"+month;var string_day=day>=10?day+"":"0"+day;var year=date.getFullYear();switch(GENERAL.dateFormat){case 1:case 3:return string_month+"/"+string_day+"/"+year;break;case 2:case 4:return string_day+"/"+string_month+"/"+year;break;case 5:return year+"/"+string_month+"/"+string_day;break;case 6:case 8:return string_month+"-"+string_day+"-"+year;break;case 7:case 9:return string_day+"-"+string_month+"-"+year;break;case 10:return year+"-"+string_month+"-"+string_day;break;case 11:case 13:return string_month+"."+string_day+"."+year;break;case 12:case 14:return string_day+"."+string_month+"."+year;break;case 15:return year+"."+string_month+"."+string_day;break;}
return string_day+"/"+string_month+"/"+year;};General.prototype.get_date_object=function(formatted_date){var date=new Date();var date_object={year:date.getFullYear(),month:date.getMonth()+1,day:date.getDate()};if(formatted_date.length>10)
return date_object;if(GENERAL.dateFormat==1||GENERAL.dateFormat==3||GENERAL.dateFormat==6||GENERAL.dateFormat==8||GENERAL.dateFormat==11||GENERAL.dateFormat==13){if(isNaN(formatted_date[0]+formatted_date[1])||isNaN(formatted_date[3]+formatted_date[4])||isNaN(formatted_date[6]+formatted_date[7]+formatted_date[8]+formatted_date[9]))
return date_object;var month_string=formatted_date[0]+formatted_date[1];date_object.month=parseInt(month_string);var day_string=formatted_date[3]+formatted_date[4];date_object.day=parseInt(day_string);var year_string=formatted_date[6]+formatted_date[7]+formatted_date[8]+formatted_date[9];date_object.year=parseInt(year_string);}
else if(GENERAL.dateFormat==2||GENERAL.dateFormat==7||GENERAL.dateFormat==9||GENERAL.dateFormat==8||GENERAL.dateFormat==12||GENERAL.dateFormat==14){if(isNaN(formatted_date[0]+formatted_date[1])||isNaN(formatted_date[3]+formatted_date[4])||isNaN(formatted_date[6]+formatted_date[7]+formatted_date[8]+formatted_date[9]))
return date_object;var day_string=formatted_date[0]+formatted_date[1];date_object.day=parseInt(day_string);var month_string=formatted_date[3]+formatted_date[4];date_object.month=parseInt(month_string);var year_string=formatted_date[6]+formatted_date[7]+formatted_date[8]+formatted_date[9];date_object.year=parseInt(year_string);}
else if(GENERAL.dateFormat==5||GENERAL.dateFormat==10||GENERAL.dateFormat==15){if(isNaN(formatted_date[0]+formatted_date[1]+formatted_date[2]+formatted_date[3])||isNaN(formatted_date[8]+formatted_date[9]))
return date_object;var year_string=formatted_date[0]+formatted_date[1]+formatted_date[2]+formatted_date[3];date_object.year=parseInt(year_string);var month_string=formatted_date[5]+formatted_date[6];date_object.month=parseInt(month_string);var day_string=formatted_date[8]+formatted_date[9];date_object.day=parseInt(day_string);}
return date_object;};General.prototype.get_time_object=function(hour,minute,am_pm){var date=new Date();var time_object={hour:date.getHours(),minute:date.getMinutes()};if(isNaN(hour)||isNaN(minute))
return time_object;time_object.hour=parseInt(hour);time_object.minute=parseInt(minute);if(am_pm=="pm"&&time_object.hour<12){time_object.hour+=12;}
if(am_pm=="am"&&time_object.hour==12)
time_object.hour=0;return time_object;};General.prototype.get_hours=function(date){var hour=date.getHours();if(hour>12)
hour-=12;if(hour==0)
hour=12;return hour;};General.prototype.get_minutes=function(date){return date.getMinutes();};General.prototype.get_am_pm=function(date){var hour=date.getHours();if(hour>=12)
return"pm";return"am";};General.prototype.set_bottom_margin_div=function(div){var html=$(constants.BOTTOM_WHITE_SPACE_TEMPLATE_ID).html();div.append(html);};General.prototype.disable_tiny_button=function(button){button.attr("disabled",true);button.removeClass("tiny_button");button.addClass("disabled_tiny_button");};General.prototype.disable_main_button=function(button){button.attr("disabled",true);button.removeClass("button");button.addClass("disabled_button");};General.prototype.disable_button=function(button){button.attr("disabled",true);button.removeClass("regular_button");button.addClass("disabled_regular_button");};General.prototype.enable_button=function(button){button.attr("disabled",false);button.removeClass("disabled_regular_button");button.addClass("regular_button");};General.prototype.enable_main_button=function(button){button.attr("disabled",false);button.removeClass("disabled_button");button.addClass("button");};General.prototype.decode_string=function(encodedString){var textArea=document.createElement('textarea');textArea.innerHTML=encodedString;return textArea.value;};General.prototype.bind_main_tab_events=function(){$(constants.ALL_TABS).on("click",function(e){e.stopPropagation();GENERAL.show_hide_main_tab(this);});$(constants.TRANSACTION_MAIN_TAB).click(TRANSACTION.show_monthly_transaction_overview);};General.prototype.show_hide_main_tab=function(tab){$(constants.PRESSED_TAB).attr("class",constants.UNPRESSED_TAB_CLASS);$(constants.TAB_DETAIL_VISIBLE).attr("class",constants.TAB_DETAIL_HIDDEN_CLASS);$(tab).attr("class",constants.PRESSED_TAB_CLASS);$(tab).children(constants.TAB_DETAIL_HIDDEN).attr("class",constants.TAB_DETAIL_VISIBLE_CLASS);};General.prototype.error_style=function(element,feedback){element.css("borderColor","red");feedback.css("color","red");feedback.css("display","block");return false;};General.prototype.correct_style=function(element,feedback){element.css("borderColor","lightgray");feedback.css("color","green");feedback.html("&#10004");feedback.html("<img src='../images/checkmark.png'>");feedback.css("display","block");return true;};General.prototype.error_style_form=function(element,feedback){feedback.css("background-color","red");feedback.css("left","0px");feedback.css("top","0px");feedback.css("color","white");feedback.css("display","block");return false;};General.prototype.correct_style_form=function(element,feedback){element.css("background-color","white");feedback.css("background-color","white");feedback.css("color","green");feedback.html("&#10004");feedback.html("<img src='../images/checkmark.png'>");feedback.css("display","block");feedback.css("left","4px");feedback.css("top","3px");return true;};General.prototype.error_contact_us_form=function(element,feedback){feedback.css("background-color","red");feedback.css("color","white");feedback.css("display","block");return false;};General.prototype.correct_contact_us_form=function(element,feedback){element.css("background-color","white");feedback.css("background-color","white");feedback.css("color","green");feedback.html("&#10004");feedback.html("<img src='../images/checkmark.png'>");feedback.css("display","block");return true;};General.prototype.reset_element=function(element,feedback){element.css("borderColor","lightgray");feedback.css("color","black");feedback.html("");};General.prototype.show_feedback=function(data){for(var key in data){var element=$("#"+key);var feedback=$("#"+key+"-feedback");if(data[key]==constants.VALID_RESPONSE)
GENERAL.correct_style(element,feedback);else{feedback.html(data[key]);GENERAL.error_style(element,feedback);}}};General.prototype.bind_tab_events=function(tabs){for(var i=0;i<tabs.length;++i){GENERAL.unchoose_tab(tabs[i]);GENERAL.bind_tab_event(tabs[i],tabs);}
GENERAL.choose_tab(tabs[0]);};General.prototype.bind_tab_event=function(tab,tabs){$(tab).on('click',function(e){e.stopPropagation();for(var i=0;i<tabs.length;++i)
GENERAL.unchoose_tab(tabs[i]);GENERAL.choose_tab(tab);});};General.prototype.unchoose_tab=function(tab){var tab_element=$(tab);var tab_detail=$(tab+"_detail");tab_element.removeClass(constants.CHOSEN_TAB_CLASS);tab_element.addClass(constants.UNCHOSEN_TAB_CLASS);tab_detail.css("display","none");};General.prototype.choose_tab=function(tab){var tab_element=$(tab);var tab_detail=$(tab+"_detail");tab_element.removeClass(constants.UNCHOSEN_TAB_CLASS);tab_element.addClass(constants.CHOSEN_TAB_CLASS);tab_detail.css("display","block");};General.prototype.make_color_picker=function(color_picker_id,color_picker_template,target_id){var colors={id:color_picker_id,color:[{color:"#000000",selected:""},{color:"#993201",selected:""},{color:"#333300",selected:""},{color:"#003300",selected:""},{color:"#003466",selected:""},{color:"#00007E",selected:""},{color:"#323398",selected:""},{color:"#333333",selected:""},{color:"#800000",selected:""},{color:"#FF6600",selected:""},{color:"#808001",selected:""},{color:"#008001",selected:""},{color:"#007F7E",selected:""},{color:"#0000FE",selected:""},{color:"#66669A",selected:""},{color:"#808080",selected:""},{color:"#FE0000",selected:""},{color:"#FE9800",selected:""},{color:"#99CC01",selected:""},{color:"#339967",selected:""},{color:"#33CBCB",selected:""},{color:"#3366FF",selected:""},{color:"#81007F",selected:""},{color:"#999999",selected:""},{color:"#FF00FE",selected:""},{color:"#FFCB00",selected:""},{color:"#FFFF01",selected:""},{color:"#00FF00",selected:""},{color:"#01FFFF",selected:""},{color:"#00CCFF",selected:""},{color:"#993365",selected:""},{color:"#C0C0C0",selected:""},{color:"#FF98CA",selected:""},{color:"#FECB9A",selected:""},{color:"#FEFF99",selected:""},{color:"#CDFFCC",selected:""},{color:"#CDFFFF",selected:""},{color:"#99CDFF",selected:""},{color:"#CB99FE",selected:""},{color:"#FFFFFF",selected:"selected"},]};var html_maker=new htmlMaker(color_picker_template);var color_picker_html=html_maker.getHTML(colors);$("#"+target_id).append(color_picker_html);$("#"+color_picker_id).on("click",function(e){e.stopPropagation();var display=$("#colors_"+color_picker_id).css("display");if(display=="none")
$("#colors_"+color_picker_id).css("display","inline-block");else
$("#colors_"+color_picker_id).css("display","none");});$(".color-box").on("click",function(e){e.stopPropagation();$(".color-box").removeClass("selected");$(this).addClass("selected");$("#"+color_picker_id).css("background-color",$(this).attr("data-color"));$("#"+color_picker_id).attr("data-color",$(this).attr("data-color"));$("#colors_"+color_picker_id).css("display","none");});};General.prototype.select_color=function(color_picker_id,color){$("#"+color_picker_id).attr("data-color",color);$("#"+color_picker_id).css("background-color",color);$(".color-box").removeClass("selected");$(".color-box[data-color="+color+"]").addClass("selected");};General.prototype.get_email=function(){$.ajax({method:"POST",url:constants.CONTROLLER_PATH,data:{type:constants.GET_EMAIL},dataType:"json",success:function(data){GENERAL.check_session_expired(data);if(data["result"]==constants.SUCCESS_RESPONSE)
$(constants.LOGOUT_DIV).html("Logout ("+data["email"]+")");else
window.location.assign(constants.LOGIN_PATH);}});};General.prototype.delete_window_events=function(){GENERAL.regular_window_events();$(constants.CANCEL_BUTTON).on("click",function(e){e.stopPropagation();$(constants.WINDOW_ID).css("display","none");});};General.prototype.regular_window_events=function(){$(constants.WINDOW_CLOSE).on("click",function(e){e.stopPropagation();$(constants.WINDOW_ID).css("display","none");});$(constants.WINDOW_BOX).on("click",function(e){e.stopPropagation();});$(constants.WINDOW_INPUT).on("blur",function(){});$(constants.WINDOW_BACKGROUND_ID).on("click",function(e){e.stopPropagation();$(constants.WINDOW_ID).css("display","none");});$(constants.WINDOW_BACKGROUND_ID).on("click",function(e){e.stopPropagation();$(constants.WINDOW_ID).css("display","none");});};General.prototype.hide_window_slowly=function(){$(constants.WINDOW_ID).delay(constants.HIDE_MESSAGE_TIME).fadeOut("slow")};General.prototype.bind_events=function(element_ids,functions){for(var i=0;i<element_ids.length;++i){var element_id=element_ids[i];var feedback_id=element_ids[i]+"-feedback";var function_instance=functions[i];GENERAL.bind_element_with_event(element_id,feedback_id,function_instance);}};General.prototype.bind_element_with_event=function(element_name,feedback_name,function_instance){$(element_name).bind('focusout',function(){function_instance($(element_name),$(feedback_name));});$(element_name).bind('focus',function(){GENERAL.reset_element($(element_name),$(feedback_name));});};General.prototype.highlight=function(text,match){match=match.replace(/[`~!@#$%^&*()_|+\-=?;:'",.<>\{\}\[\]\\\/]/gi,'');if(match==undefined||match.trim().length==0||text==undefined||text.trim().length==0)
return text;var html="";var match_index=text.toLowerCase().trim().search(match.toLowerCase().trim());while(text.length>0){if(match_index!=-1){html+=text.substring(0,match_index)+"<b>"+text.substring(match_index,match_index+match.length)+"</b>";text=text.substring(match_index+match.length,text.length);match_index=text.toLowerCase().trim().search(match.toLowerCase().trim());}
else{html+=text;break;}}
return html;};General.prototype.get_page_param=function(param,url){var results=new RegExp('[\?&]'+param+'=([^&#]*)').exec(url);if(results==null){return null;}
else{return results[1]||0;}};var LOGIN=new Login();function Login(){this.T="";}
Login.prototype.get_t=function(){$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.T_REQUEST},success:function(data){LOGIN.T=data["t"];}});};Login.prototype.show_main_menu=function(){$(constants.MAIN_SETTING_MENU).css("display","block");$(constants.MAIN_SETTING_MENU_ICON).css("background-color","lightgray");};Login.prototype.hide_main_menu=function(){$(constants.MAIN_SETTING_MENU).css("display","none");$(constants.MAIN_SETTING_MENU_ICON).css("background-color","transparent");};Login.prototype.bind_settings=function(){$(constants.MAIN_SETTING_MENU_ICON).on("click",function(e){e.stopPropagation();var display=$(constants.MAIN_SETTING_MENU).css("display");switch(display){case"none":LOGIN.show_main_menu();break;case"block":LOGIN.hide_main_menu();break;}});$(constants.SYSTEM_MENU_ICON).on("click",function(e){e.stopPropagation();var display=$(constants.SYSTEM_MENU).css("display");switch(display){case"none":$(constants.SYSTEM_MENU).css("display","block");$(constants.SYSTEM_MENU_ICON).css("background-color","lightgray");break;case"block":$(constants.SYSTEM_MENU).css("display","none");$(constants.SYSTEM_MENU_ICON).css("background-color","transparent");break;}});};Login.prototype.bind_tab_events=function(){$(constants.LOGIN_TAB).on("click",function(){$(constants.LOGIN_VISIBLE_FORM).css("display","block");$(constants.SIGNIN_FEEDBACK).css("display","block");$(constants.SIGNUP_VISIBLE_FORM).css("display","none");$(constants.SIGNUP_FEEDBACK).css("display","none");LOGIN.choose_tab(this);});$(constants.SIGNUP_TAB).on("click",function(){$(constants.SIGNUP_VISIBLE_FORM).css("display","block");$(constants.SIGNUP_FEEDBACK).css("display","block");$(constants.LOGIN_VISIBLE_FORM).css("display","none");$(constants.SIGNIN_FEEDBACK).css("display","none");LOGIN.choose_tab(this);});}
Login.prototype.choose_tab=function(element){if($(element).attr("class")==constants.UNCHOSEN_TAB_CLASS){$(constants.CHOSEN_TAB).removeClass(constants.CHOSEN_TAB_CLASS).addClass(constants.UNCHOSEN_TAB_CLASS);$(element).removeClass(constants.UNCHOSEN_TAB_CLASS).addClass(constants.CHOSEN_TAB_CLASS);}}
Login.prototype.logout=function(){$.ajax({method:"POST",url:constants.CONTROLLER_PATH,data:{type:constants.LOGOUT_REQUEST},success:function(data){window.location.assign(constants.LOGIN_PATH);},fail:function(){window.location.assign(constants.LOGIN_PATH);}});window.location.assign(constants.LOGIN_PATH);};Login.prototype.sign_up=function(){$(constants.SIGNIN_LOADING_ICON).show();var error_message="An error happened. Try again later!";$.ajax({method:"POST",url:constants.CONTROLLER_PATH,data:{type:constants.SIGNUP_REQUEST,password:$(constants.SIGNUP_PASSWORD_ID).val(),confirm_password:$(constants.SIGNUP_CONFIRM_PASSWORD_ID).val(),email:$(constants.SIGNUP_EMAIL_ID).val(),token:LOGIN.T},dataType:"json",success:function(data){$(constants.SIGNIN_LOADING_ICON).hide();LOGIN.show_feedback(data,constants.SIGNUP_FORM_NAME);if(data[constants.RESULT_ATTR]==constants.FAIL_RESPONSE)
$(constants.SIGNUP_FEEDBACK).html(error_message);else if(data[constants.RESULT_ATTR]==constants.SUCCESS_RESPONSE){window.location.assign("../app/");}},fail:function(jqXHR,textStatus){$(constants.SIGNUP_FEEDBACK).html(error_message);}});};Login.prototype.log_in=function(){var data=$(constants.LOGIN_FORM).form();data["type"]="login";var error_message="Invalid email or password";$(constants.SIGNIN_FEEDBACK).hide();$(constants.SIGNIN_LOADING_ICON).show();$.ajax({method:"POST",url:constants.CONTROLLER_PATH,data:data,success:function(data){$(constants.SIGNIN_LOADING_ICON).hide();if(data.trim()==constants.SUCCESS_RESPONSE)
window.location.assign("../app/");else{$(constants.SIGNIN_FEEDBACK).html(error_message);$(constants.SIGNIN_FEEDBACK).show();}},});};Login.prototype.maybe_log_in=function(event){var keycode=(event.keyCode?event.keyCode:event.which);if(keycode==constants.ENTER_KEY)
LOGIN.log_in();};Login.prototype.maybe_sign_up=function(event){var keycode=(event.keyCode?event.keyCode:event.which);if(keycode==constants.ENTER_KEY)
LOGIN.sign_up();};Login.prototype.validate_password=function(password,feedback){var value=password.val();if(value==null||value==""){feedback.html("Password can't be empty");return GENERAL.error_style(password,feedback);}
else if(value.length<6||value.length>10){feedback.html("Password must be 6-10 characters");return GENERAL.error_style(password,feedback);}
else if(!/\d/.test(value)){feedback.html("Password must contain digits");return GENERAL.error_style(password,feedback);}
else if(!/[a-z]+/.test(value)){feedback.html("Password must contain lowercase letters");return GENERAL.error_style(password,feedback);}
else if(!/[A-Z]+/.test(value)){feedback.html("Password must contain uppercase letters");return GENERAL.error_style(password,feedback);}
else
return GENERAL.correct_style(password,feedback);};Login.prototype.validate_confirm_password=function(password,feedback){if(password.val()!=$("form[name=sign_up_form]  input[name=password]").val()){feedback.html("The two passwords don't match");return GENERAL.error_style(password,feedback);}
else
return GENERAL.correct_style(password,feedback);};Login.prototype.validate_email=function(email,feedback){var value=email.val().trim();if(/[^0-9a-zA-Z@_.]/.test(value)){feedback.html("Only alphanumerical, @, _, and .");return GENERAL.error_style(email,feedback);}
if(/(@.*){2,}/.test(value)){feedback.html("@ should only occur once");return GENERAL.error_style(email,feedback);}
if(/\.{2,}/.test(value)){feedback.html("More than one dot in a row");return GENERAL.error_style(email,feedback);}
var at_position=value.indexOf("@");var dot_position=value.lastIndexOf(".");if(at_position<1||dot_position<at_position+2||dot_position+2>value.length){feedback.html("Not a valid e-mail address");return GENERAL.error_style(email,feedback);}
return GENERAL.correct_style(email,feedback);};Login.prototype.bind_events=function(form_name,array,functions){for(var i=0;i<array.length;++i){var element_name="form[name="+form_name+"] input[name="+array[i]+"]";var feedback_name="#"+array[i]+"_feedback";var function_instance=functions[i];GENERAL.bind_element_with_event(element_name,feedback_name,function_instance);}};Login.prototype.show_feedback=function(data,form_name){for(var key in data){var element=$("form[name="+form_name+"] input[name="+key+"]");var feedback=$("#"+key+"_feedback");if(data[key]=="valid")
GENERAL.correct_style_form(element,feedback);else{feedback.html(data[key]);GENERAL.error_style_form(element,feedback);}}};var CATEGORY=new Category();function Category(){this.VISIBLE_CATEGORY_MENU_ID="";this.VISIBLE_ITEM_MENU_ID="";this.ITEM_FEEDBACK_ID="";this.ITEM_VALUE="";this.ALL_EXPENSE_CATEGORIES=[];this.ALL_INCOME_CATEGORIES=[];}
Category.prototype.display_categories=function(data,cat_type){var template=$(constants.CATEGORY_TEMPLATE).html();var html_maker=new htmlMaker(template);var html=html_maker.getHTML(data);switch(cat_type){case constants.EXPENSE_TYPE:$(constants.EXPENSE_DIV).html(html);$("body").trigger(constants.EXPENSE_CATEGORIES_DISPLAYED);GENERAL.set_bottom_margin_div($(constants.EXPENSE_DIV));break;case constants.INCOME_TYPE:$(constants.INCOME_DIV).html(html);$("body").trigger(constants.INCOME_CATEGORIES_DISPLAYED);GENERAL.set_bottom_margin_div($(constants.INCOME_DIV));break;}
CATEGORY.hide_arrows(data);};Category.prototype.hide_arrows=function(data){for(var i=0;i<data.length;++i){if(data[i][constants.ITEMS_ARRAY].length==0){$(constants.CATEGORY_ARROW_ID+data[i][constants.CATEGORY_ID_ARRAY]).css("display","none");}}};Category.prototype.hide_show_arrow=function(category_id){var num_items=$(constants.ITEMS_DIV_ID+category_id).children(constants.ITEM_CLASS).length;if(num_items==1){$(constants.CATEGORY_ARROW_ID+category_id).css("display","none");CATEGORY.hide_category_items(category_id);}
else
$(constants.CATEGORY_ARROW_ID+category_id).css("display","block");};Category.prototype.init=function(){$("body").on(constants.INCOME_CATEGORIES_DISPLAYED,function(){constants.INCOME_CATEGORIES_DISPLAYED_FLAG=true;if(constants.INCOME_CATEGORIES_DISPLAYED_FLAG&&constants.EXPENSE_CATEGORIES_DISPLAYED_FLAG)
CATEGORY.bind_category_events();});$("body").on(constants.EXPENSE_CATEGORIES_DISPLAYED,function(){constants.EXPENSE_CATEGORIES_DISPLAYED_FLAG=true;if(constants.INCOME_CATEGORIES_DISPLAYED_FLAG&&constants.EXPENSE_CATEGORIES_DISPLAYED_FLAG)
CATEGORY.bind_category_events();});};Category.prototype.get_all_categories=function(){constants.INCOME_CATEGORIES_DISPLAYED_FLAG=false;constants.EXPENSE_CATEGORIES_DISPLAYED_FLAG=false;CATEGORY.get_categories(constants.EXPENSE_TYPE);CATEGORY.get_categories(constants.INCOME_TYPE);};Category.prototype.get_categories=function(cat_type){CATEGORY.show_loading_icon(cat_type);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.GET_CATEGORIES_REQUEST,cat_type:cat_type},success:function(data){GENERAL.check_session_expired(data);if(cat_type=="e")
CATEGORY.ALL_EXPENSE_CATEGORIES=data;else if(cat_type=="i")
CATEGORY.ALL_INCOME_CATEGORIES=data;CATEGORY.hide_loading_icon(cat_type);CATEGORY.display_categories(data,cat_type);}});};Category.prototype.show_loading_icon=function(cat_type){if(cat_type==constants.EXPENSE_TYPE){$(constants.EXPENSE_DIV).hide();$(constants.EXPENSE_LOADING_ICON).show();}
if(cat_type==constants.INCOME_TYPE){$(constants.INCOME_DIV).hide();$(constants.INCOME_LOADING_ICON).show();}};Category.prototype.hide_loading_icon=function(cat_type){if(cat_type==constants.EXPENSE_TYPE){$(constants.EXPENSE_DIV).show();$(constants.EXPENSE_LOADING_ICON).hide();}
if(cat_type==constants.INCOME_TYPE){$(constants.INCOME_DIV).show();$(constants.INCOME_LOADING_ICON).hide();}};Category.prototype.add_category=function(category_name,category_description,category_type,category_color){GENERAL.disable_button($(constants.ADD_CATEGORY_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.ADD_CATEGORY_REQUEST,name:category_name,description:category_description,cat_type:category_type,color:category_color},success:function(data){GENERAL.check_session_expired(data);$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.HIDING_SPEED);CATEGORY.add_category_feedback(data,category_name,category_color,category_description,category_type);}});};Category.prototype.edit_category=function(category_name,category_description,category_type,category_color,category_id){GENERAL.disable_button($(constants.EDIT_CATEGORY_BUTTON));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.EDIT_CATEGORY_REQUEST,name:category_name,description:category_description,cat_type:category_type,color:category_color,cat_id:category_id},success:function(data){GENERAL.check_session_expired(data);GENERAL.enable_button($(constants.EDIT_CATEGORY_BUTTON));$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.HIDING_SPEED);CATEGORY.edit_category_feedback(data,category_id,category_name,category_description,category_color,category_type);}});};Category.prototype.add_item=function(item_name,category_id){GENERAL.disable_button($(constants.NEW_ITEM_SAVE_BUTTON+category_id));$(constants.ADD_ITEM_LOADING_ICON+category_id).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.ADD_ITEM_REQUEST,name:item_name,cat_id:category_id},success:function(data){GENERAL.check_session_expired(data);$(constants.ADD_ITEM_LOADING_ICON+category_id).hide(constants.HIDING_SPEED);CATEGORY.add_item_feedback(data,item_name,category_id);}});};Category.prototype.edit_item=function(item_name,item_id,category_id){GENERAL.disable_button($(constants.ITEM_SAVE_BUTTON+item_id));$(constants.EDIT_ITEM_LOADING_ICON+item_id).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.EDIT_ITEM_REQUEST,name:item_name,item_id:item_id,cat_id:category_id},success:function(data){GENERAL.check_session_expired(data);$(constants.EDIT_ITEM_LOADING_ICON+item_id).hide(constants.HIDING_SPEED);GENERAL.enable_button($(constants.ITEM_SAVE_BUTTON+item_id));CATEGORY.edit_item_feedback(data,item_id,item_name);}});};Category.prototype.delete_item=function(item_id,category_id){$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.DELETE_ITEM_REQUEST,item_id:item_id,cat_id:category_id},success:function(data){GENERAL.check_session_expired(data);CATEGORY.delete_item_feedback(data,item_id,category_id);}});};Category.prototype.change_item_category=function(item_id,category_id,item_name){GENERAL.disable_button($(constants.CHANGE_CATEGORY_BUTTON));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.CHANGE_ITEM_CATEGORY_REQUEST,item_id:item_id,cat_id:category_id},success:function(data){GENERAL.check_session_expired(data);GENERAL.enable_button($(constants.CHANGE_CATEGORY_BUTTON));$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.HIDING_SPEED);CATEGORY.change_item_category_feedback(data,item_id,category_id,item_name);}});};Category.prototype.delete_category=function(category_id){GENERAL.disable_button($(constants.DELETE_CATEGORY_BUTTON));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.DELETE_CATEGORY_REQUEST,cat_id:category_id},success:function(data){GENERAL.check_session_expired(data);$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.SHOWING_SPEED);CATEGORY.delete_category_feedback(data,category_id);}});};Category.prototype.bind_delete_category_events=function(){$(constants.CANCEL_BUTTON).on("click",function(){$(constants.WINDOW_ID).hide(constants.HIDING_SPEED);});$(constants.DELETE_CATEGORY_BUTTON).on("click",function(){var category_id=$(constants.DELETE_CATEGORY_WINDOW).attr(constants.CATEGORY_ID);CATEGORY.delete_category(category_id);});};Category.prototype.bind_edit_category_events=function(){var element_ids=[constants.CATEGORY_NAME];var functions=[CATEGORY.validate_category_name];GENERAL.bind_events(element_ids,functions);$(constants.EDIT_CATEGORY_BUTTON).on("click",function(){var category_id=$(constants.EDIT_CATEGORY_WINDOW).attr(constants.CATEGORY_ID);var category_name=$(constants.CATEGORY_NAME).val();var category_description=$(constants.CATEGORY_DESCRIPTION).val();var category_type=$(constants.CATEGORY_TYPE_ID).val();var category_color=$(constants.COLOR_PICKER_ID).attr(constants.DATA_COLOR);CATEGORY.edit_category(category_name,category_description,category_type,category_color,category_id);});};Category.prototype.show_settings=function(menu){$(menu).css("opacity","0.9");$(menu).css("background-color",constants.SETTINGS_PRESSED_COLOR);};Category.prototype.hide_settings=function(menu){$(menu).css("opacity","0.5");$(menu).css("background-color",constants.SETTINGS_UNPRESSED_COLOR);};Category.prototype.hide_everything=function(){if(CATEGORY.ITEM_FEEDBACK_ID!=""){var feedback=constants.ITEM_INPUT_ID+CATEGORY.ITEM_FEEDBACK_ID+constants.ITEM_INPUT_FEEDBACK;$(feedback).hide(constants.HIDING_SPEED);var save_button=$(constants.ITEM_SAVE_BUTTON+CATEGORY.ITEM_FEEDBACK_ID);$(save_button).hide(constants.HIDING_SPEED);var input=$(constants.ITEM_INPUT_ID+CATEGORY.ITEM_FEEDBACK_ID);input.css("background-color","white");input.css("border-width","0px");input.prop("readonly",true);input.val(CATEGORY.ITEM_VALUE);}
if(CATEGORY.VISIBLE_CATEGORY_MENU_ID!=""){var menu=constants.CATEGORY_MENU_ID+CATEGORY.VISIBLE_CATEGORY_MENU_ID;$(menu).hide(constants.HIDING_SPEED);var gear_icon=constants.CATEGORY_SETTINGS_ID+CATEGORY.VISIBLE_CATEGORY_MENU_ID;CATEGORY.hide_settings(gear_icon);}
if(CATEGORY.VISIBLE_ITEM_MENU_ID!=""){var menu=constants.ITEM_MENU_ID+CATEGORY.VISIBLE_ITEM_MENU_ID;$(menu).hide(constants.HIDING_SPEED);var gear_icon=constants.ITEM_SETTINGS_ID+CATEGORY.VISIBLE_ITEM_MENU_ID;CATEGORY.hide_settings(gear_icon);}};Category.prototype.on_category_settigs_clicked=function(category){var category_id=$(category).attr(constants.CATEGORY_ID);var display=$(constants.CATEGORY_MENU_ID+category_id).css("display");switch(display){case"none":CATEGORY.hide_everything();$(constants.CATEGORY_MENU_ID+category_id).show(constants.SHOWING_SPEED);CATEGORY.show_settings(category);CATEGORY.VISIBLE_CATEGORY_MENU_ID=category_id;break;case"block":$(constants.CATEGORY_MENU_ID+category_id).hide(constants.HIDING_SPEED);CATEGORY.hide_settings(category);CATEGORY.VISIBLE_CATEGORY_MENU_ID="";break;}};Category.prototype.bind_category_events=function(){$(constants.CATEGORY_SETTINGS).on("click",function(e){e.stopPropagation();CATEGORY.on_category_settigs_clicked(this);});$(constants.ITEM_SETTINGS).on("click",function(e){e.stopPropagation();CATEGORY.on_item_settings_clicked(this);});$(constants.CATEGORY_BLOCK).on("click",function(e){e.stopPropagation();var category_id=$(this).attr(constants.CATEGORY_ID);CATEGORY.show_hide_category_items(category_id);CATEGORY.hide_everything();});$(constants.CATEGORY_BACKGROUND).on("click",function(){CATEGORY.hide_everything();});$("html").on("click",function(){CATEGORY.hide_everything();});$(constants.SHOW_ADD_CATEGORY_BUTTON).on("click",function(e){e.stopPropagation();CATEGORY.bind_show_add_category_window();});CATEGORY.bind_show_edit_category_window();CATEGORY.bind_show_delete_category_window();CATEGORY.bind_show_add_item();CATEGORY.bind_edit_item();CATEGORY.bind_delete_item();CATEGORY.bind_change_item_category();};Category.prototype.bind_edit_item=function(){$(constants.EDIT_CATEGORY_ITEM).on("click",function(e){e.stopPropagation();CATEGORY.on_edit_item_clicked(this);});$(constants.ITEM_SAVE_BUTTON_NAME).on("click",function(e){e.stopPropagation();CATEGORY.on_save_item_clicked(this);});};Category.prototype.on_save_item_clicked=function(item){var item_id=$(item).attr(constants.ITEM_ID);var input=$(constants.ITEM_INPUT_ID+item_id);var name=input.val();var category_id=$(item).attr(constants.CATEGORY_ID);CATEGORY.edit_item(name,item_id,category_id);};Category.prototype.on_edit_item_clicked=function(item){var item_id=$(item).attr(constants.ITEM_ID);CATEGORY.ITEM_FEEDBACK_ID=item_id;var input=$(constants.ITEM_INPUT_ID+item_id);input.on("click",function(e){e.stopPropagation();});input.css("background-color","lightyellow");input.css("border","1px solid lightgray");input.prop("readonly",false);CATEGORY.ITEM_VALUE=input.val();var save_button=$(constants.ITEM_SAVE_BUTTON+item_id);save_button.show(constants.SHOWING_SPEED);};Category.prototype.bind_delete_item=function(){$(constants.DELETE_CATEGORY_ITEM).on("click",function(e){e.stopPropagation();CATEGORY.on_delete_item_clicked(this);});};Category.prototype.bind_change_item_category=function(){$(constants.CHANGE_CATEGORY_ITEM).on("click",function(e){e.stopPropagation();CATEGORY.on_change_item_category_clicked(this);});};Category.prototype.on_delete_item_clicked=function(item){var item_id=$(item).attr(constants.ITEM_ID);var category_id=$(item).attr(constants.CATEGORY_ID);CATEGORY.delete_item(item_id,category_id);};Category.prototype.on_change_item_category_clicked=function(item){var category_id=$(item).attr(constants.CATEGORY_ID);var item_id=$(item).attr(constants.ITEM_ID);var item_name=$(item).attr(constants.ITEM_NAME);var category_type=$(constants.CATEGORY_BLOCK_ID+category_id).attr(constants.CATEGORY_TYPE);var category_data=category_type=="e"?GENERAL.expense_categories:GENERAL.income_categories;var data={category_id:category_id,item_id:item_id,item_name:item_name};var window_template=$(constants.CHANGE_CATEGORY_ITEM_WINDOW_TEMPLATE).html();var html_maker=new htmlMaker(window_template);var html=html_maker.getHTML(data);$(constants.WINDOW_ID).html(html);var categories_combobox_template=$(constants.CATEGORIES_COMBOBOX_TEMPLATE).html();html_maker=new htmlMaker(categories_combobox_template);var categories_html=html_maker.getHTML(category_data);$(constants.CATEGORY_COMBOBOX_ID).html(categories_html);$(constants.CATEGORY_COMBOBOX_ID).val(category_id);$(constants.WINDOW_ID).css("display","inline-block");GENERAL.regular_window_events();$(constants.CHANGE_CATEGORY_BUTTON).on("click",function(e){e.stopPropagation();var new_category_id=$(constants.CATEGORY_COMBOBOX_ID).val();CATEGORY.change_item_category(item_id,new_category_id,item_name);});};Category.prototype.bind_show_delete_category_window=function(){$(constants.DELETE_CATEGORY_SHOW_BUTTON).on("click",function(e){e.stopPropagation();CATEGORY.on_delete_category(this);});};Category.prototype.on_delete_category=function(delete_category_button){var category_id=$(delete_category_button).attr(constants.CATEGORY_ID);var data={category_id:category_id};var window_template=$(constants.DELETE_CATEGORY_WINDOW_TEMPLATE).html();var html_maker=new htmlMaker(window_template);var html=html_maker.getHTML(data);$(constants.WINDOW_ID).html(html);$(constants.WINDOW_ID).css("display","inline-block");GENERAL.regular_window_events();CATEGORY.bind_delete_category_events();};Category.prototype.bind_show_add_category_window=function(){var window_template=$(constants.ADD_CATEGORY_WINDOW_TEMPLATE).html();$(constants.WINDOW_ID).html(window_template);$(constants.WINDOW_ID).css("display","inline-block");var color_picker_template=$(constants.COLOR_PICKER_TEMPLATE).html();GENERAL.make_color_picker(constants.COLOR_PICKER,color_picker_template,constants.COLOR_PICKER_CELL);$(constants.COLOR_PICKER_ID).attr(constants.DATA_COLOR,"#FFFFFF");var help_topic_names=[constants.HELP_TOPIC_CATEGORY_TYPE];GENERAL.set_help_tooltip_text(help_topic_names);GENERAL.regular_window_events();CATEGORY.bind_add_category_events();};Category.prototype.bind_show_edit_category_window=function(){$(constants.EDIT_CATEGORY_SHOW_BUTTON).on("click",function(e){e.stopPropagation();CATEGORY.on_edit_category(this);});};Category.prototype.on_edit_category=function(edit_category_button){var category_id=$(edit_category_button).attr(constants.CATEGORY_ID);var category_title=$(edit_category_button).attr(constants.CATEGORY_TITLE);var category_color=$(edit_category_button).attr(constants.CATEGORY_COLOR);var category_type=$(edit_category_button).attr(constants.CATEGORY_TYPE);var category_description=$(edit_category_button).attr(constants.CATEGORY_DESCRIPTION_ATTR);var expense_selected=category_type=="e"?"selected":"";var income_selected=category_type=="i"?"selected":"";var data={expense_selected:expense_selected,income_selected:income_selected,category_id:category_id,category_title:category_title,category_description:category_description};var window_template=$(constants.EDIT_CATEGORY_WINDOW_TEMPLATE).html();var html_maker=new htmlMaker(window_template);var html=html_maker.getHTML(data);$(constants.WINDOW_ID).html(html);$(constants.WINDOW_ID).css("display","inline-block");var color_picker_template=$(constants.COLOR_PICKER_TEMPLATE).html();GENERAL.make_color_picker(constants.COLOR_PICKER,color_picker_template,constants.COLOR_PICKER_CELL);GENERAL.select_color(constants.COLOR_PICKER,category_color);var help_topic_names=[constants.HELP_TOPIC_CATEGORY_TYPE];GENERAL.set_help_tooltip_text(help_topic_names);GENERAL.regular_window_events();CATEGORY.bind_edit_category_events();};Category.prototype.show_first_category_items=function(){var category_id=$(constants.FIRST_CATEGORY_BLOCK).attr(constants.CATEGORY_ID);CATEGORY.show_category_items(category_id);};Category.prototype.show_category_items=function(category_id){var img=$(constants.CATEGORY_ARROW_ID+category_id);var category_description=$(constants.CATEGORY_DESCRIPTION_ID+category_id);img.attr("src",constants.DOUBLE_ARROW_UP);$(constants.ITEMS_ID+category_id).show(constants.SHOWING_SPEED);if(category_description.text().length>0){$(constants.CATEGORY_BLOCK_ID+category_id).css("height","70px");category_description.show(constants.SHOWING_SPEED);}
else{$(constants.CATEGORY_BLOCK_ID+category_id).css("height","40px");category_description.hide(constants.HIDING_SPEED);}};Category.prototype.hide_category_items=function(category_id){$(constants.NEW_ITEM_ID+category_id).css("display","none");var img=$(constants.CATEGORY_ARROW_ID+category_id);var category_description=$(constants.CATEGORY_DESCRIPTION_ID+category_id);img.attr("src",constants.DOUBLE_ARROW_DOWN);$(constants.ITEMS_ID+category_id).hide(constants.HIDING_SPEED);$(constants.CATEGORY_BLOCK_ID+category_id).css("height","40px");category_description.hide(constants.HIDING_SPEED);};Category.prototype.show_hide_category_items=function(category_id){var img=$(constants.CATEGORY_ARROW_ID+category_id);if(img.attr("src").search(constants.DOUBLE_ARROW_UP_TEXT)!=-1)
CATEGORY.hide_category_items(category_id)
else if(img.attr("src").search(constants.DOUBLE_ARROW_DOWN_TEXT)!=-1)
CATEGORY.show_category_items(category_id);};Category.prototype.delete_item_feedback=function(data,item_id,category_id){var item_div=$(constants.ITEM_DIV_ID+item_id);if(data["result"]==constants.SUCCESS_RESPONSE){item_div.remove();CATEGORY.hide_show_arrow(category_id);TRANSACTION.get_transactions();}};Category.prototype.change_item_category_feedback=function(data,item_id,category_id,item_name){var item_div=$(constants.ITEM_DIV_ID+item_id);if(data["result"]==constants.SUCCESS_RESPONSE){item_div.remove();CATEGORY.add_item_to_category(item_id,item_name,category_id);$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("The category of the item has been changed successfully!");$(constants.WINDOW_FEEDBACK_ID).show(constants.SHOWING_SPEED);CATEGORY.show_category_items(category_id);TRANSACTION.get_transactions();}
else if(data["result"]==constants.FAIL_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);if(data[constants.ERROR_MESSAGE_ATTR].trim()===""&&data[constants.ITEM_EXISTS_ATTR]!=constants.VALID_RESPONSE)
$(constants.WINDOW_FEEDBACK_ID).text("The item already exists in the category");else if(data[constants.ERROR_MESSAGE_ATTR].trim()===""&&data[constants.ITEM_EXISTS_ATTR]==constants.VALID_RESPONSE)
$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't change the item's category");else
$(constants.WINDOW_FEEDBACK_ID).text(data[constants.ERROR_MESSAGE_ATTR]);$(constants.WINDOW_FEEDBACK_ID).show(constants.SHOWING_SPEED);}};Category.prototype.edit_item_feedback=function(data,item_id,item_name){var feedback=constants.ITEM_INPUT_ID+item_id+constants.ITEM_INPUT_FEEDBACK;if(data["result"]==constants.SUCCESS_RESPONSE){$(feedback).html(constants.CHECK_MARK);$(feedback).css("background-color",constants.SUCCESS_COLOR);$(constants.CHANGE_CATEGORY_ITEM_ID+item_id).attr(constants.ITEM_NAME,item_name);var input=$(constants.ITEM_INPUT_ID+item_id);CATEGORY.ITEM_VALUE=input.val();TRANSACTION.get_transactions();}
else if(data["result"]==constants.FAIL_RESPONSE){$(feedback).html(data["name"]);$(feedback).css("background-color",constants.FAILURE_COLOR);}
$(feedback).show(constants.SHOWING_SPEED);};Category.prototype.add_item_feedback=function(data,name,category_id){var feedback=constants.NEW_ITEM_INPUT_ID+category_id+constants.NEW_ITEM_INPUT_FEEDBACK;if(data["result"]==constants.SUCCESS_RESPONSE){$(feedback).html(constants.CHECK_MARK);$(feedback).css("background-color",constants.SUCCESS_COLOR);$(feedback).show(constants.SHOWING_SPEED);CATEGORY.add_item_to_category(data["id"],name,category_id);$(constants.ADD_NEW_ITEM_ID+category_id).show().on("click",function(e){e.stopPropagation();var feedback=constants.NEW_ITEM_INPUT_ID+category_id+constants.NEW_ITEM_INPUT_FEEDBACK;$(feedback).hide(constants.HIDING_SPEED);$(constants.NEW_ITEM_INPUT_ID+category_id).val("");$(constants.ADD_NEW_ITEM_ID+category_id).hide();GENERAL.enable_button($(constants.NEW_ITEM_SAVE_BUTTON+category_id));});}
else if(data["result"]==constants.FAIL_RESPONSE){GENERAL.enable_button($(constants.NEW_ITEM_SAVE_BUTTON+category_id));if(data[constants.ERROR_MESSAGE_ATTR].trim()==="")
$(feedback).text(data["name"]);else
$(feedback).text(data[constants.ERROR_MESSAGE_ATTR]);$(feedback).show(constants.SHOWING_SPEED);$(feedback).css("background-color",constants.FAILURE_COLOR);}};Category.prototype.add_item_to_category=function(item_id,name,category_id){var template_data={item_id:item_id,item_name:name,category_id:category_id};var item_template=$(constants.ITEM_TEMPLATE).html();var html_maker=new htmlMaker(item_template);var html=html_maker.getHTML(template_data);$(html).insertAfter(constants.NEW_ITEM_ID+category_id);CATEGORY.hide_show_arrow(category_id);$(constants.ITEM_SETTINGS_ID+item_id).on("click",function(e){e.stopPropagation();CATEGORY.on_item_settings_clicked(this);});$(constants.EDIT_CATEGORY_ITEM_ID+item_id).on("click",function(e){e.stopPropagation();CATEGORY.on_edit_item_clicked(this);});$(constants.DELETE_CATEGORY_ITEM_ID+item_id).on("click",function(e){e.stopPropagation();CATEGORY.on_delete_item_clicked(this);});$(constants.ITEM_SAVE_BUTTON+item_id).on("click",function(e){e.stopPropagation();CATEGORY.on_save_item_clicked(this);});$(constants.CHANGE_CATEGORY_ITEM_ID+item_id).on("click",function(e){e.stopPropagation();CATEGORY.on_change_item_category_clicked(this);});};Category.prototype.add_category_feedback=function(data,title,color,description,type){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data["result"]==constants.SUCCESS_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("A new category has been added successfully!");var template_data={category_id:data["id"],category_title:title,category_color:color,category_description:description};var category_template=$(constants.SINGLE_CATEGORY_TEMPLATE).html();var html_maker=new htmlMaker(category_template);var html=html_maker.getHTML(template_data);switch(type){case constants.EXPENSE_TYPE:$(constants.EXPENSE_DIV).prepend(html);$(constants.EXPENSE_TAB).trigger('click');break;case constants.INCOME_TYPE:$(constants.INCOME_DIV).prepend(html);$(constants.INCOME_TAB).trigger('click');break;}
var category=$(constants.CATEGORY_BLOCK_ID+data["id"]);CATEGORY.bind_single_category_events(category);$(constants.ADD_NEW_CATEGORY_BUTTON_ID).show();$(constants.ADD_NEW_CATEGORY_BUTTON_ID).on("click",function(e){e.stopPropagation();CATEGORY.bind_show_add_category_window();});GENERAL.disable_main_button($(constants.SHOW_ADD_BUDGET_BUTTON_ID));GENERAL.init_categories();}
else if(data["result"]==constants.FAIL_RESPONSE){GENERAL.enable_button($(constants.ADD_CATEGORY_BUTTON_ID));$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);if(data[constants.ERROR_MESSAGE_ATTR].trim()==="")
$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't add the category");else
$(constants.WINDOW_FEEDBACK_ID).text(data[constants.ERROR_MESSAGE_ATTR]);}};Category.prototype.bind_single_category_events=function(category){var category_id=category.attr(constants.CATEGORY_ID);var category_menu=constants.CATEGORY_SETTINGS_ID+category_id;$(category_menu).on("click",function(e){e.stopPropagation();CATEGORY.on_category_settigs_clicked(this);});category.on("click",function(){var category_id=$(this).attr(constants.CATEGORY_ID);CATEGORY.show_hide_category_items(category_id);});$(constants.CATEGORY_COLOR_ID+category_id).on("click",function(e){e.stopPropagation();});$(constants.CATEGORY_DESCRIPTION_ID+category_id).on("click",function(e){e.stopPropagation();});$(constants.EDIT_CATEGORY_SHOW_BUTTON_ID+category_id).on("click",function(e){e.stopPropagation();CATEGORY.on_edit_category(this);});$(constants.DELETE_CATEGORY_SHOW_BUTTON_ID+category_id).on("click",function(e){e.stopPropagation();CATEGORY.on_delete_category(this);});CATEGORY.bind_signle_category_add_item(category);};Category.prototype.bind_signle_category_add_item=function(category){var category_id=category.attr(constants.CATEGORY_ID);$(constants.ADD_ITEM_BUTTON_ID+category_id).on("click",function(e){e.stopPropagation();CATEGORY.on_add_item_button_clicked(this);});$(constants.NEW_ITEM_SAVE_BUTTON+category_id).on("click",function(e){e.stopPropagation();CATEGORY.on_save_item_button_clicked(this);});};Category.prototype.bind_show_add_item=function(){$(constants.ADD_ITEM_BUTTON).on("click",function(e){e.stopPropagation();CATEGORY.on_add_item_button_clicked(this);});$(constants.NEW_ITEM_SAVE_BUTTON_NAME).on("click",function(e){e.stopPropagation();CATEGORY.on_save_item_button_clicked(this);});};Category.prototype.on_add_item_button_clicked=function(button){var category_id=$(button).attr("data-cat-id");var feedback=constants.NEW_ITEM_INPUT_ID+category_id+constants.NEW_ITEM_INPUT_FEEDBACK;$(feedback).hide(constants.HIDING_SPEED);$(constants.NEW_ITEM_ID+category_id).show(constants.SHOWING_SPEED);CATEGORY.show_category_items(category_id);};Category.prototype.on_save_item_button_clicked=function(button){var category_id=$(button).attr(constants.CATEGORY_ID);var name=$(constants.NEW_ITEM_INPUT_ID+category_id).val();CATEGORY.add_item(name,category_id);};Category.prototype.on_item_settings_clicked=function(item_setting){var item_id=$(item_setting).attr(constants.ITEM_ID);var display=$(constants.ITEM_MENU_ID+item_id).css("display");switch(display){case"none":CATEGORY.hide_everything();$(constants.ITEM_MENU_ID+item_id).show(constants.SHOWING_SPEED);CATEGORY.show_settings(item_setting);CATEGORY.VISIBLE_ITEM_MENU_ID=item_id;break;case"block":$(constants.ITEM_MENU_ID+item_id).hide(constants.HIDING_SPEED);CATEGORY.hide_settings(item_setting);CATEGORY.VISIBLE_ITEM_MENU_ID="";break;}};Category.prototype.sync_with_category=function(){GENERAL.disable_main_button($(constants.SHOW_ADD_BUDGET_BUTTON_ID));GENERAL.init_categories();TRANSACTION.get_transactions();BUDGET.get_budgets();ANALYTICS.load();};Category.prototype.edit_category_feedback=function(data,category_id,category_title,category_description,category_color,category_type){$(constants.WINDOW_FEEDBACK_ID).show(constants.SHOWING_SPEED);if(data["result"]==constants.SUCCESS_RESPONSE){var edit_category_button=constants.EDIT_CATEGORY_SHOW_BUTTON_ID+category_id;$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("The category has been edited successfully!");GENERAL.show_feedback(data);$(constants.CATEGORY_TITLE_ID+category_id).html(category_title);$(constants.CATEGORY_DESCRIPTION_ID+category_id).html(category_description);$(constants.CATEGORY_COLOR_ID+category_id).css("background-color",category_color);$(constants.CATEGORY_COLOR_ID+category_id).attr(constants.DATA_COLOR,category_color);$(edit_category_button).attr(constants.CATEGORY_TITLE,category_title);$(edit_category_button).attr(constants.CATEGORY_COLOR,category_color);$(edit_category_button).attr(constants.CATEGORY_DESCRIPTION_ATTR,category_description);var old_category_type=$(edit_category_button).attr(constants.CATEGORY_TYPE);$(edit_category_button).attr(constants.CATEGORY_TYPE,category_type);if(old_category_type.trim()!=category_type.trim()){var html=$("#"+category_id)[0].outerHTML;$("#"+category_id).remove();switch(category_type){case constants.EXPENSE_TYPE:$(constants.EXPENSE_DIV).prepend(html);$(constants.EXPENSE_TAB).trigger('click');break;case constants.INCOME_TYPE:$(constants.INCOME_DIV).prepend(html);$(constants.INCOME_TAB).trigger('click');break;}
var category=$(constants.CATEGORY_BLOCK_ID+category_id);CATEGORY.bind_single_category_events(category);var item_settings=$("#"+category_id).find(constants.ITEM_SETTINGS);var item_settings_edit=$("#"+category_id).find(constants.EDIT_CATEGORY_ITEM);var item_settings_delete=$("#"+category_id).find(constants.DELETE_CATEGORY_ITEM);var item_settings_save=$("#"+category_id).find(constants.ITEM_SAVE_BUTTON_CLASS);var item_settings_change_category=$("#"+category_id).find(constants.CHANGE_CATEGORY_ITEM);item_settings.on("click",function(e){e.stopPropagation();CATEGORY.on_item_settings_clicked(this);});item_settings_edit.on("click",function(e){e.stopPropagation();CATEGORY.on_edit_item_clicked(this);});item_settings_delete.on("click",function(e){e.stopPropagation();CATEGORY.on_delete_item_clicked(this);});item_settings_save.on("click",function(e){e.stopPropagation();CATEGORY.on_save_item_clicked(this);});item_settings_change_category.on("click",function(e){e.stopPropagation();CATEGORY.on_change_item_category_clicked(this);});}
CATEGORY.sync_with_category();}
else if(data["result"]==constants.FAIL_RESPONSE){GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't edit the category.");}};Category.prototype.delete_category_feedback=function(data,category_id){$(constants.WINDOW_FEEDBACK_ID).show(constants.SHOWING_SPEED);if(data["result"]==constants.SUCCESS_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("The category has been deleted successfully!");$(constants.CATEGORY_BLOCK_ID+category_id).remove();$(constants.ITEMS_DIV_ID+category_id).remove();CATEGORY.sync_with_category();}
else if(data["result"]==constants.FAIL_RESPONSE){GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);if(data[constants.ERROR_MESSAGE_ATTR].trim()==="")
$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't delete the category");else
$(constants.WINDOW_FEEDBACK_ID).text(data[constants.ERROR_MESSAGE_ATTR]);}};Category.prototype.bind_add_category_events=function(){var element_ids=[constants.CATEGORY_NAME];var functions=[CATEGORY.validate_category_name];GENERAL.bind_events(element_ids,functions);$(constants.ADD_CATEGORY_BUTTON_ID).on("click",function(){var category_name=$(constants.CATEGORY_NAME).val();var category_description=$(constants.CATEGORY_DESCRIPTION).val();var category_type=$(constants.CATEGORY_TYPE_ID).val();var category_color=$(constants.COLOR_PICKER_ID).attr(constants.DATA_COLOR);CATEGORY.add_category(category_name,category_description,category_type,category_color);});};Category.prototype.validate_category_name=function(name,feedback){if($.trim(name.val())==""){feedback.html("Name is required");return GENERAL.error_style(name,feedback);}
return GENERAL.correct_style(name,feedback);};var BUDGET=new Budget();function Budget(){this.targets_categories=[];this.user_currencies=null;this.user_default_currency=null;this.budget_years=[{"year":2016},{"year":2017},{"year":2018},{"year":2019},{"year":2020},{"year":2021},{"year":2022},{"year":2023},{"year":2024},{"year":2025},{"year":2026}];this.VISIBLE_BUDGET_MENU_ID="";this.VISIBLE_TARGET_MENU_ID="";}
Budget.prototype.maybe_enable_add_budget_button=function(){if(this.user_currencies!=null&&GENERAL.expense_categories!=null)
GENERAL.enable_main_button($(constants.SHOW_ADD_BUDGET_BUTTON_ID));};Budget.prototype.init=function(){BUDGET.get_user_currencies();BUDGET.get_budgets();};Budget.prototype.display_budgets=function(data){for(var i=data.length-1;i>=0;--i){var targets_data=data[i][constants.BUDGET_TARGETS_ATTR];delete data[i][constants.BUDGET_TARGETS_ATTR];BUDGET.display_budget(data[i]);BUDGET.display_targets(data[i][constants.BUDGET_ID_ATTR],targets_data);}
$("html").on("click",function(){BUDGET.hide_everything();});$(constants.SHOW_ADD_BUDGET_BUTTON_ID).on("click",function(e){e.stopPropagation();BUDGET.bind_show_add_budget_window();});GENERAL.set_bottom_margin_div($(constants.BUDGETS_DIV));};Budget.prototype.compare_targets=function(a,b){var attr=constants.TARGET_EQUIVALENT_ATTR;if(a[attr]==b[attr])
return 0
if(a[attr]<b[attr])
return 1;else
return-1;};Budget.prototype.display_targets=function(budget_id,data){if(data.length>0){var max=parseFloat(data[0][constants.TARGET_MAX_ATTR]);$(constants.BUDGET_TOTAL_DIV_ID+budget_id).html(data[0][constants.TARGET_TOTAL_FORMATTED_ATTR]);data.sort(BUDGET.compare_targets);$(constants.EDIT_BUDGET_ID+budget_id).attr(constants.EDIT_BUDGET_TARGETS_PROP,JSON.stringify(data));$(constants.BUDGET_ARROW_ID+budget_id).show();}
for(var i=data.length-1;i>=0;--i){BUDGET.display_target(budget_id,data[i]);BUDGET.show_target_bar_chart(max,data[i]);}};Budget.prototype.show_target_bar_chart=function(max,row){var target_equivalent=row[constants.TARGET_EQUIVALENT_ATTR];var percentage=(target_equivalent / max)*constants.TARGET_BAR_MAX_WIDTH;$(constants.TARGET_BAR_ID+row[constants.TARGET_ID_ATTR]).css("width",percentage+"%");$(constants.TARGET_BAR_LABEL_ID+row[constants.TARGET_ID_ATTR]).html(row[constants.TARGET_FORMATTED_EQUIVALENT_ATTR]);};Budget.prototype.bind_show_add_target_window=function(budget_id){$(constants.ADD_TARGET_ID+budget_id).on("click",function(e){e.stopPropagation();BUDGET.on_add_target_window(budget_id);});};Budget.prototype.on_add_target_window=function(budget_id){var window_template=$(constants.ADD_TARGET_TEMPLATE).html();$(constants.WINDOW_ID).html(window_template);var categories_combobox_template=$(constants.CATEGORIES_COMBOBOX_TEMPLATE).html();var html_maker=new htmlMaker(categories_combobox_template);var categories_html=html_maker.getHTML(GENERAL.expense_categories);$(constants.ADD_TARGET_CATEGORY_ID).html(categories_html);BUDGET.remove_used_categories_from_add_target_window(budget_id);var currencies_combobox_template=$(constants.CURRENCIES_COMBOBOX_TEMPLATE).html();html_maker=new htmlMaker(currencies_combobox_template);var currencies_html=html_maker.getHTML(BUDGET.user_currencies);$(constants.ADD_TARGET_CURRENCY_ID).html(currencies_html);if(BUDGET.default_currency_exists())
$(constants.ADD_TARGET_CURRENCY_ID).val(BUDGET.user_default_currency);var help_topic_names=[constants.HELP_TOPIC_TARGET_FREQUENCY,constants.HELP_TOPIC_TARGET_ROLLOVER];GENERAL.set_help_tooltip_text(help_topic_names);BUDGET.get_category_average($(constants.ADD_TARGET_CATEGORY_ID).val(),1);BUDGET.bind_on_single_target_category_change("1");BUDGET.bind_on_single_amount_focus_events("1");$(constants.ADD_TARGET_BUTTON_ID).on("click",function(e){e.stopPropagation();var category_id=$(constants.ADD_TARGET_CATEGORY_ID).val();var amount=$(constants.ADD_TARGET_AMOUNT_ID).val();var currency_id=$(constants.ADD_TARGET_CURRENCY_ID).val();var period=$(constants.ADD_TARGET_PERIOD_ID).val();var every=$(constants.ADD_TARGET_EVERY_ID).val();var rollover=$(constants.ADD_TARGET_ROLLOVER_ID).prop('checked')?1:0;BUDGET.add_target(budget_id,category_id,amount,currency_id,period,every,rollover);});$(constants.WINDOW_ID).css("display","inline-block");GENERAL.regular_window_events();};Budget.prototype.remove_used_categories_from_add_target_window=function(budget_id){var categories_string=$(constants.ADD_TARGET_ID+budget_id).attr(constants.TARGET_CATEGORIES_PROP);var categories_array=categories_string.split(" ");if(categories_array.length>=GENERAL.expense_categories.length){var window_template=$(constants.CANT_ADD_TARGET_WINDOW_TEMPLATE).html();$(constants.WINDOW_ID).html(window_template);$(constants.WINDOW_ID).css("display","inline-block");GENERAL.regular_window_events();GENERAL.delete_window_events();return;}
for(var i=0;i<categories_array.length;++i){$(constants.ADD_TARGET_CATEGORY_ID+" option[value='"+categories_array[i]+"']").remove();}};Budget.prototype.add_target=function(budget_id,category_id,amount,currency_id,period,every,rollover){GENERAL.disable_button($(constants.ADD_TARGET_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.ADD_TARGET_REQUEST,budget_id:budget_id,category_id:category_id,amount:amount,currency_id:currency_id,period:period,every:every,rollover:rollover},success:function(data){GENERAL.check_session_expired(data);$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.HIDING_SPEED);BUDGET.add_target_feedback(budget_id,data);}});};Budget.prototype.default_currency_exists=function(){for(var i=0;i<BUDGET.user_currencies.length;++i){var current_budget_id=BUDGET.user_currencies[i][constants.CURRENCY_ID_PROP];if(BUDGET.user_default_currency==current_budget_id)
return true;}
return false;};Budget.prototype.init_target_categories=function(num_targets,show_all_categories){var categories_combobox_template=$(constants.CATEGORIES_COMBOBOX_TEMPLATE).html();var html_maker=new htmlMaker(categories_combobox_template);var categories_html=html_maker.getHTML(GENERAL.expense_categories);$(constants.CATEGORY_COMBOX).html(categories_html);if(GENERAL.expense_categories.length==0){$(constants.ADD_TARGET_TABLE_ID).remove();return;}
if(GENERAL.expense_categories.length<num_targets){for(var i=num_targets-1;i>=GENERAL.expense_categories.length;--i){$(constants.ADD_TARGET_ROW_ID+i).remove();}}
for(var i=0;i<num_targets;++i){if(GENERAL.expense_categories.length>i){var category_id=GENERAL.expense_categories[i][constants.CATEGORY_ID_ATTR];$(constants.TARGET_CATEGORY_ID+i).val(category_id);BUDGET.targets_categories[i]=category_id;if(!show_all_categories){BUDGET.remove_category_from_targets(category_id,i,num_targets);BUDGET.get_category_average(category_id,i);}
BUDGET.bind_on_target_category_change(i);BUDGET.bind_on_amount_focus_events(i);}
else
break;}};Budget.prototype.remove_category_from_targets=function(category_id,exempt_target_id,num_targets){for(var i=0;i<num_targets;++i){if(i!=exempt_target_id){$(constants.TARGET_CATEGORY_ID+i+" option[value='"+category_id+"']").remove();}}};Budget.prototype.add_category_to_targets=function(category_name,category_id,exempt_target_id,num_targets){for(var i=0;i<num_targets;++i){if(i!=exempt_target_id){var o=new Option(category_name,category_id);$(constants.TARGET_CATEGORY_ID+i).append($(o));}}};Budget.prototype.bind_on_amount_focus_events=function(target_id){$(constants.TARGET_AMOUNT_ID+target_id).focus(function(){var category_id=$(constants.TARGET_CATEGORY_ID+target_id).val();BUDGET.get_category_average(category_id,target_id);});};Budget.prototype.bind_on_target_category_change=function(target_id){$(constants.TARGET_CATEGORY_ID+target_id).change(function(){var num_targets=parseInt($(constants.ADD_TARGET_TABLE_ID).attr(constants.TARGETS_LENGTH_PROP));var old_category_id=BUDGET.targets_categories[target_id];var old_category_name=GENERAL.get_expense_category_name_from_id(old_category_id);BUDGET.add_category_to_targets(old_category_name,old_category_id,target_id,num_targets);var new_category_id=$(constants.TARGET_CATEGORY_ID+target_id).val();BUDGET.get_category_average(new_category_id,target_id);BUDGET.targets_categories[target_id]=new_category_id;BUDGET.remove_category_from_targets(new_category_id,target_id,num_targets);});};Budget.prototype.bind_on_single_amount_focus_events=function(target_id){$(constants.ADD_TARGET_AMOUNT_ID).focus(function(){var category_id=$(constants.ADD_TARGET_CATEGORY_ID).val();BUDGET.get_category_average(category_id,target_id);});};Budget.prototype.bind_on_single_target_category_change=function(target_id){$(constants.ADD_TARGET_CATEGORY_ID).change(function(){var new_category_id=$(constants.ADD_TARGET_CATEGORY_ID).val();BUDGET.get_category_average(new_category_id,target_id);});};Budget.prototype.get_category_average=function(category_id,target_index){var date=new Date();var start_month=date.getMonth()+1+"";var start_year=date.getFullYear()+"";var time_zone_offset=date.getTimezoneOffset();$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.AVERAGE_CATEGORY_REQUEST,start_month:start_month,start_year:start_year,time_zone_offset:time_zone_offset,category_id:category_id},success:function(data){GENERAL.check_session_expired(data);if(data.length==1){var new_category_name=GENERAL.get_expense_category_name_from_id(category_id);new_category_name=ANALYTICS.shorten_text(new_category_name);$(constants.CATEGORY_AVERAGE_NAME_ID+target_index).text(new_category_name);$(constants.CATEGORY_AVERAGE_SPENDING_ID+target_index).text(data[0][constants.FORMATTED_AVERAGE_AMOUNT_ATTR]);$(constants.CATEGORY_AVERAGE_SPENDING_ROW_ID+target_index).show();}
else
$(constants.CATEGORY_AVERAGE_SPENDING_ROW_ID+target_index).hide();}});};Budget.prototype.bind_show_add_budget_window=function(){var window_template=$(constants.ADD_BUDGET_WINDOW_TEMPLATE_ID).html();$(constants.WINDOW_ID).html(window_template);BUDGET.targets_categories=[];var num_targets=parseInt($(constants.ADD_TARGET_TABLE_ID).attr(constants.TARGETS_LENGTH_PROP));BUDGET.init_target_categories(num_targets,false);var currencies_combobox_template=$(constants.CURRENCIES_COMBOBOX_TEMPLATE).html();var html_maker=new htmlMaker(currencies_combobox_template);var currencies_html=html_maker.getHTML(BUDGET.user_currencies);$(constants.CURRENCY_COMBOX).html(currencies_html);if(BUDGET.default_currency_exists())
$(constants.CURRENCY_COMBOX).val(BUDGET.user_default_currency);var years_combobox_template=$(constants.YEARS_COMBOBOX_TEMPLATE).html();html_maker=new htmlMaker(years_combobox_template);var years_html=html_maker.getHTML(BUDGET.budget_years);$(constants.YEAR_COMBOX).html(years_html);var date=new Date();var current_year=date.getFullYear()+"";$(constants.YEAR_COMBOX).val(current_year);BUDGET.on_target_show_hide_clicked();$(constants.ADD_BUDGET_BUTTON_ID).on("click",function(e){e.stopPropagation();BUDGET.on_add_budget_clicked();});$(constants.ADD_BUDGET_TABLE_ADD_TARGET_BUTTON).on("click",function(e){e.stopPropagation();BUDGET.on_add_budget_add_target_clicked($(constants.ADD_BUDGET_TABLE_ADD_TARGET_BUTTON));});BUDGET.maybe_disable_add_target_button($(constants.ADD_BUDGET_TABLE_ADD_TARGET_BUTTON));var help_topic_names=[constants.HELP_TOPIC_BUDGET_START,constants.HELP_TOPIC_BUDGET_END];GENERAL.set_help_tooltip_text(help_topic_names);var target_tooltips_indices=[];for(var i=0;i<num_targets;++i)
target_tooltips_indices.push(i);var target_help_topic_names=[constants.HELP_TOPIC_TARGET_FREQUENCY,constants.HELP_TOPIC_TARGET_ROLLOVER];GENERAL.set_multiple_help_tooltip_text(target_help_topic_names,target_tooltips_indices);$(constants.WINDOW_ID).css("display","inline-block");GENERAL.regular_window_events();};Budget.prototype.on_target_show_hide_clicked=function(){$(constants.TARGETS_SHOW_HIDE_ID).on("click",function(){var targets_display=$(constants.TARGET_ROW_TO_BE_SHOWN_HIDDEN).css("display");var targets_arrow=$(constants.TARGETS_ARROW_ID);if(targets_display=="none"){$(constants.TARGET_ROW_TO_BE_SHOWN_HIDDEN).show(constants.SHOWING_SPEED);$(constants.TARGET_SPENDING_ROW).hide();targets_arrow.attr("src",constants.DOUBLE_ARROW_UP);}
else{$(constants.TARGET_ROW_TO_BE_SHOWN_HIDDEN).hide(constants.HIDING_SPEED);targets_arrow.attr("src",constants.DOUBLE_ARROW_DOWN);}});};Budget.prototype.on_add_budget_add_target_clicked=function(button){var target_length=parseInt($(constants.ADD_TARGET_TABLE_ID).attr(constants.TARGETS_LENGTH_PROP));if(target_length<GENERAL.expense_categories.length){var add_target_template=$(constants.TARGET_ROW_TEMPLATE_ID).html();var target_row_data={index:target_length};var html_maker=new htmlMaker(add_target_template);var target_row_html=html_maker.getHTML(target_row_data);$(constants.ADD_TARGET_TABLE_ID).prepend(target_row_html);$(constants.TARGET_ROW_TO_BE_SHOWN_HIDDEN).show(constants.SHOWING_SPEED);var target_help_topic_names=[constants.HELP_TOPIC_TARGET_FREQUENCY,constants.HELP_TOPIC_TARGET_ROLLOVER];GENERAL.set_multiple_help_tooltip_text(target_help_topic_names,[target_length]);var categories_combobox_template=$(constants.CATEGORIES_COMBOBOX_TEMPLATE).html();var html_maker=new htmlMaker(categories_combobox_template);var categories_html=html_maker.getHTML(GENERAL.expense_categories);$(constants.TARGET_CATEGORY_ID+target_length).html(categories_html);for(var i=0;i<BUDGET.targets_categories.length;++i){$(constants.TARGET_CATEGORY_ID+target_length+" option[value='"+BUDGET.targets_categories[i]+"']").remove();}
var category_id=$(constants.TARGET_CATEGORY_ID+target_length).val();BUDGET.targets_categories[target_length]=category_id;BUDGET.remove_category_from_targets(category_id,target_length,target_length);BUDGET.get_category_average(category_id,target_length);BUDGET.bind_on_target_category_change(target_length);BUDGET.bind_on_amount_focus_events(target_length);var currencies_combobox_template=$(constants.CURRENCIES_COMBOBOX_TEMPLATE).html();html_maker=new htmlMaker(currencies_combobox_template);var currencies_html=html_maker.getHTML(BUDGET.user_currencies);$(constants.TARGET_CURRENCY_ID+target_length).html(currencies_html);if(BUDGET.default_currency_exists())
$(constants.TARGET_CURRENCY_ID+target_length).val(BUDGET.user_default_currency);target_length++;$(constants.ADD_TARGET_TABLE_ID).attr(constants.TARGETS_LENGTH_PROP,target_length);BUDGET.maybe_disable_add_target_button(button);}};Budget.prototype.on_add_budget_clicked=function(){var name=$(constants.BUDGET_NAME_ID).val();var start_month=$(constants.BUDGET_START_MONTH_ID).val();var end_month=$(constants.BUDGET_END_MONTH_ID).val();var start_year=$(constants.BUDGET_START_YEAR_ID).val();var end_year=$(constants.BUDGET_END_YEAR_ID).val();var category_ids=[];var amounts=[];var currencies=[];var periods=[];var everys=[];var rollovers=[];var indices=[];var num_targets=parseInt($(constants.ADD_TARGET_TABLE_ID).attr(constants.TARGETS_LENGTH_PROP));for(var i=0;i<num_targets;++i){var amount=$(constants.TARGET_AMOUNT_ID+i).val().trim();var rollover=$(constants.TARGET_ROLLOVER_ID+i).prop('checked')?1:0;var category=$(constants.TARGET_CATEGORY_ID+i).val().trim();var currency=$(constants.TARGET_CURRENCY_ID+i).val().trim();var period=$(constants.TARGET_PERIOD_ID+i).val().trim();var every=$(constants.TARGET_EVERY_ID+i).val().trim();if(amount!=""&&amount!=null){amounts.push(amount);category_ids.push(category);currencies.push(currency);periods.push(period);everys.push(every);rollovers.push(rollover);indices.push(i);}}
BUDGET.add_budget(name,start_month,start_year,end_month,end_year,category_ids,amounts,currencies,periods,everys,rollovers,indices);};Budget.prototype.add_budget=function(name,start_month,start_year,end_month,end_year,category_ids,amounts,currency_ids,periods,everys,rollovers,indices){GENERAL.disable_button($(constants.ADD_BUDGET_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.ADD_BUDGET_REQUEST,name:name,start_month:start_month,start_year:start_year,end_month:end_month,end_year:end_year,target_category_ids:category_ids,rollovers:rollovers,target_amounts:amounts,target_currency_ids:currency_ids,target_periods:periods,target_everys:everys,"indices":indices},success:function(data){GENERAL.check_session_expired(data);$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.HIDING_SPEED);BUDGET.add_budget_feedback(data);}});};Budget.prototype.edit_target=function edit_target(budget_id,target_id,amount,currency_id,category_id,period,every,rollover){GENERAL.disable_button($(constants.EDIT_TARGET_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.EDIT_TARGET_REQUEST,budget_id:budget_id,target_id:target_id,amount:amount,currency_id:currency_id,category_id:category_id,period:period,every:every,rollover:rollover},success:function(data){GENERAL.check_session_expired(data);GENERAL.enable_button($(constants.EDIT_TARGET_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.HIDING_SPEED);BUDGET.edit_target_feedback(budget_id,data);}});};Budget.prototype.edit_budget=function(budget_id,budget_name,start_month,start_year,end_month,end_year,target_ids,category_ids,amounts,currencies,periods,everys,rollovers,indices){GENERAL.disable_button($(constants.EDIT_BUDGET_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.EDIT_BUDGET_REQUEST,id:budget_id,name:budget_name,start_month:start_month,start_year:start_year,end_month:end_month,end_year:end_year,target_ids:target_ids,target_category_ids:category_ids,target_amounts:amounts,target_currency_ids:currencies,target_periods:periods,target_everys:everys,rollovers:rollovers,indices:indices},success:function(data){GENERAL.check_session_expired(data);GENERAL.enable_button($(constants.EDIT_BUDGET_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.HIDING_SPEED);BUDGET.edit_budget_feedback(data);}});};Budget.prototype.add_budget_feedback=function(data){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data["result"]==constants.SUCCESS_RESPONSE){GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("A new budget has been added successfully!");BUDGET.get_budget(data[constants.BUDGET_ID_ATTR]);$(constants.ADD_NEW_BUDGET_BUTTON_ID).show();$(constants.ADD_NEW_BUDGET_BUTTON_ID).on("click",function(e){e.stopPropagation();BUDGET.bind_show_add_budget_window();});BUDGET.sync_with_budget();}
else if(data["result"]==constants.FAIL_RESPONSE){GENERAL.enable_button($(constants.ADD_BUDGET_BUTTON_ID));$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);if(data[constants.ERROR_MESSAGE_ATTR].trim()==="")
$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't add the budget");else
$(constants.WINDOW_FEEDBACK_ID).text(data[constants.ERROR_MESSAGE_ATTR]);}
var targets=data["targets"];for(var i=0;i<targets.length;++i){GENERAL.show_feedback(targets[i]);}};Budget.prototype.add_target_feedback=function(budget_id,data){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data["result"]==constants.SUCCESS_RESPONSE){GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("A new target has been added successfully!");BUDGET.edit_budget_data(data[constants.ADD_TARGET_BUDGET_RESULT_ATTR][0]);BUDGET.show_targets(budget_id);BUDGET.edit_targets(budget_id,data[constants.ADD_TARGET_BUDGET_RESULT_ATTR][0][constants.BUDGET_TARGETS_ATTR]);$(constants.ADD_NEW_TARGET_BUTTON_ID).show();$(constants.ADD_NEW_TARGET_BUTTON_ID).on("click",function(e){e.stopPropagation();BUDGET.on_add_target_window(budget_id);});BUDGET.partial_sync_with_budget();}
else if(data["result"]==constants.FAIL_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);if(data[constants.ERROR_MESSAGE_ATTR].trim()==="")
$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't add the target");else
$(constants.WINDOW_FEEDBACK_ID).text(data[constants.ERROR_MESSAGE_ATTR]);GENERAL.enable_button($(constants.ADD_TARGET_BUTTON_ID));}};Budget.prototype.sync_with_budget=function(){ANALYTICS.get_user_budgets();ANALYTICS.get_budget_analytics();};Budget.prototype.partial_sync_with_budget=function(){ANALYTICS.get_budget_analytics();};Budget.prototype.edit_budget_feedback=function(data){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data["result"]==constants.SUCCESS_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).text("The budget has been edited successfully!");BUDGET.get_updated_budget(data[constants.BUDGET_ID_ATTR]);BUDGET.sync_with_budget();}
else if(data["result"]==constants.FAIL_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't edit the budget");}
var targets=data["targets"];for(var i=0;i<targets.length;++i){GENERAL.show_feedback(targets[i]);}};Budget.prototype.edit_target_feedback=function(budget_id,data){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data["result"]==constants.SUCCESS_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).text("The target has been edited successfully!");BUDGET.get_updated_budget(budget_id);BUDGET.partial_sync_with_budget();}
else if(data["result"]==constants.FAIL_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't edit the target");}};Budget.prototype.hide_everything=function(){if(BUDGET.VISIBLE_BUDGET_MENU_ID!=""){$(constants.BUDGET_SETTING_MENU_ID+BUDGET.VISIBLE_BUDGET_MENU_ID).hide(constants.HIDING_SPEED);$(constants.BUDGET_SETTING_GEAR_ID+BUDGET.VISIBLE_BUDGET_MENU_ID).css("background-color",constants.SETTINGS_UNPRESSED_COLOR);BUDGET.VISIBLE_BUDGET_MENU_ID="";}
if(BUDGET.VISIBLE_TARGET_MENU_ID!=""){$(constants.TARGET_SETTING_MENU_ID+BUDGET.VISIBLE_TARGET_MENU_ID).hide(constants.HIDING_SPEED);$(constants.TARGET_SETTING_GEAR_ID+BUDGET.VISIBLE_TARGET_MENU_ID).css("background-color",constants.SETTINGS_UNPRESSED_COLOR);BUDGET.VISIBLE_TARGET_MENU_ID="";}};Budget.prototype.display_updated_budget=function(budget_id,row){var template=$(constants.BUDGET_TEMPLATE).html();var html_maker=new htmlMaker(template);var html=html_maker.getHTML(row);$(constants.BUDGET_WRAPPER_ID+budget_id).replaceWith(html);BUDGET.attach_budget_events(budget_id);};Budget.prototype.display_budget=function(row){var template=$(constants.BUDGET_TEMPLATE).html();var html_maker=new htmlMaker(template);var html=html_maker.getHTML(row);$(constants.BUDGETS_DIV).prepend(html);var budget_id=row[constants.BUDGET_ID_ATTR];BUDGET.attach_budget_events(budget_id);};Budget.prototype.attach_budget_events=function(budget_id){$(constants.BUDGET_ARROW_ID+budget_id).on("click",function(e){e.stopPropagation();BUDGET.hide_show_targets(budget_id);});BUDGET.bind_show_delete_budget_window(budget_id);BUDGET.bind_show_edit_budget_window(budget_id);BUDGET.bind_show_add_target_window(budget_id);$(constants.BUDGET_ID+budget_id).on("click",function(e){e.stopPropagation();BUDGET.hide_show_targets(budget_id);BUDGET.hide_everything();});$(constants.BUDGET_WRAPPER_ID+budget_id).on("click",function(e){e.stopPropagation();BUDGET.hide_everything();});$(constants.BUDGETS_WRAPPER).on("click",function(e){e.stopPropagation();BUDGET.hide_everything();});$(constants.BUDGET_SETTING_GEAR_ID+budget_id).on("click",function(e){e.stopPropagation();var display=$(constants.BUDGET_SETTING_MENU_ID+budget_id).css("display");if(display=="none"){BUDGET.hide_everything();$(constants.BUDGET_SETTING_MENU_ID+budget_id).show(constants.SHOWING_SPEED);$(constants.BUDGET_SETTING_GEAR_ID+budget_id).css("background-color",constants.SETTINGS_PRESSED_COLOR);BUDGET.VISIBLE_BUDGET_MENU_ID=budget_id;}
else{$(constants.BUDGET_SETTING_MENU_ID+budget_id).hide(constants.HIDING_SPEED);$(constants.BUDGET_SETTING_GEAR_ID+budget_id).css("background-color",constants.SETTINGS_UNPRESSED_COLOR);BUDGET.VISIBLE_BUDGET_MENU_ID="";}});};Budget.prototype.edit_budget_data=function(row){var id=row[constants.BUDGET_ID_ATTR];var budget_name=row[constants.BUDGET_NAME_ATTR];var start_month=row[constants.BUDGET_START_MONTH_ATTR];var end_month=row[constants.BUDGET_END_MONTH_ATTR];var start_year=row[constants.BUDGET_START_YEAR_ATTR];var end_year=row[constants.BUDGET_END_YEAR_ATTR];var budget_start=row[constants.BUDGET_START_BUDGET_ATTR];var budget_end=row[constants.BUDGET_END_BUDGET_ATTR];var target_categories=row[constants.TARGET_CATEGORIES_ATTR];$(constants.BUDGET_NAME_DIV_ID+id).text(budget_name);$(constants.BUDGET_START_ID+id).html(budget_start);$(constants.BUDGET_END_ID+id).html(budget_end);var edit_button=$(constants.EDIT_BUDGET_ID+id);var add_target_button=$(constants.ADD_TARGET_ID+id);edit_button.attr(constants.BUDGET_NAME_PROP,budget_name);edit_button.attr(constants.BUDGET_START_MONTH_PROP,start_month);edit_button.attr(constants.BUDGET_END_MONTH_PROP,end_month);edit_button.attr(constants.BUDGET_START_YEAR_PROP,start_year);edit_button.attr(constants.BUDGET_END_YEAR_PROP,end_year);edit_button.attr(constants.TARGET_CATEGORIES_PROP,target_categories);add_target_button.attr(constants.TARGET_CATEGORIES_PROP,target_categories);};Budget.prototype.edit_targets=function(budget_id,data){var target_total=0;if(data.length>0){target_total=data[0][constants.TARGET_TOTAL_ATTR];$(constants.BUDGET_TOTAL_DIV_ID+budget_id).html(data[0][constants.TARGET_TOTAL_FORMATTED_ATTR]);$(constants.BUDGET_ARROW_ID+budget_id).show();}
for(var i=0;i<data.length;++i){var row=data[i];var id=row[constants.TARGET_ID_ATTR];if($(constants.TARGET_DIV_ID+id).length==0)
BUDGET.display_target(budget_id,row);else{var category_id=row[constants.TARGET_CATEGORY_ID_ATTR];var category_name=row[constants.TARGET_CATEGORY_NAME_ATTR];var category_color=row[constants.TARGET_CATEGORY_COLOR_ATTR];var currency_id=row[constants.TARGET_CURRENCY_ID_ATTR];var period=row[constants.TARGET_PERIOD_ATTR];var formatted_period=row[constants.TARGET_FORMATTED_PERIOD_ATTR];var every_as_number=row[constants.TARGET_EVERY_AS_NUMBER_ATTR];var amount_formatted=row[constants.TARGET_AMOUNT_ATTR];var amount_as_number=row[constants.TARGET_AMOUNT_AS_NUMBER_ATTR];var roll_over=row[constants.TARGET_ROLLOVER_ATTR];BUDGET.show_hide_rollover(roll_over,id);$(constants.TARGET_CATEGORY_BOX_ID+id).css("background-color",category_color);$(constants.TARGET_CATEGORY_NAME_ID+id).text(category_name);$(constants.TARGET_AMOUNT_ID+id).html(amount_formatted);$(constants.TARGET_PERIOD_ID+id).html(formatted_period);var edit_button=$(constants.EDIT_TARGET_ID+id);edit_button.attr(constants.TARGET_CATEGORY_ID_PROP,category_id);edit_button.attr(constants.TARGET_AMOUNT_AS_NUMBER_PROP,amount_as_number);edit_button.attr(constants.TARGET_CURRENCY_ID_PROP,currency_id);edit_button.attr(constants.TARGET_PERIOD_PROP,period);edit_button.attr(constants.TARGET_EVERY_AS_NUMBER_PROP,every_as_number);edit_button.attr(constants.TARGET_ROLLOVER_PROP,roll_over);}
BUDGET.show_target_bar_chart(target_total,row);}};Budget.prototype.hide_show_targets=function(budget_id){var img=$(constants.BUDGET_ARROW_ID+budget_id);if(img.attr("src").search(constants.DOUBLE_ARROW_UP_TEXT)!=-1){img.attr("src",constants.DOUBLE_ARROW_DOWN);$(constants.BUDGET_TARGETS_ID+budget_id).hide("fast");}
else if(img.attr("src").search(constants.DOUBLE_ARROW_DOWN_TEXT)!=-1){BUDGET.show_targets(budget_id);}};Budget.prototype.show_first_budget_targets=function(){var budget_id=$(constants.FIRST_BUDGET).attr(constants.BUDGET_ID_PROP);BUDGET.show_targets(budget_id);};Budget.prototype.show_targets=function(budget_id){$(constants.BUDGET_ARROW_ID+budget_id).attr("src",constants.DOUBLE_ARROW_UP);$(constants.BUDGET_TARGETS_ID+budget_id).show("fast");};Budget.prototype.show_hide_rollover=function(roll_over,target_id){switch(roll_over){case constants.TARGET_ROLLOVER_FALSE:$(constants.TARGET_ROLLOVER_ID+target_id).hide();break;case constants.TARGET_ROLLOVER_TRUE:$(constants.TARGET_ROLLOVER_ID+target_id).show();break;}};Budget.prototype.display_target=function(budget_id,row){var template=$(constants.TARGET_TEMPLATE).html();var html_maker=new htmlMaker(template);var html=html_maker.getHTML(row);$(constants.TARGETS_DIV_ID+budget_id).prepend(html);var target_id=row[constants.TARGET_ID_ATTR];var roll_over=row[constants.TARGET_ROLLOVER_ATTR];BUDGET.show_hide_rollover(roll_over,target_id);BUDGET.bind_show_edit_target_window(target_id);BUDGET.bind_show_delete_target_window(budget_id,target_id);$(constants.TARGET_SETTING_GEAR_ID+target_id).on("click",function(e){e.stopPropagation();var display=$(constants.TARGET_SETTING_MENU_ID+target_id).css("display");if(display=="none"){BUDGET.hide_everything();$(constants.TARGET_SETTING_MENU_ID+target_id).show(constants.SHOWING_SPEED);$(constants.TARGET_SETTING_GEAR_ID+target_id).css("background-color",constants.SETTINGS_PRESSED_COLOR);BUDGET.VISIBLE_TARGET_MENU_ID=target_id;}
else{$(constants.TARGET_SETTING_MENU_ID+target_id).hide(constants.HIDING_SPEED);$(constants.TARGET_SETTING_GEAR_ID+target_id).css("background-color",constants.SETTINGS_UNPRESSED_COLOR);BUDGET.VISIBLE_TARGET_MENU_ID="";}});};Budget.prototype.bind_show_edit_target_window=function(target_id){$(constants.EDIT_TARGET_ID+target_id).on("click",function(e){e.stopPropagation();var edit_button=$(this);var category_id=edit_button.attr(constants.TARGET_CATEGORY_ID_PROP);var amount=edit_button.attr(constants.TARGET_AMOUNT_AS_NUMBER_PROP);var currency_id=edit_button.attr(constants.TARGET_CURRENCY_ID_PROP);var period=edit_button.attr(constants.TARGET_PERIOD_PROP);var every_as_number=edit_button.attr(constants.TARGET_EVERY_AS_NUMBER_PROP);var rollover=edit_button.attr(constants.TARGET_ROLLOVER_PROP);var budget_id=edit_button.attr(constants.TARGET_BUDGET_ID_PROP);BUDGET.hide_everything();var template_data={};var window_template=$(constants.EDIT_TARGET_TEMPLATE).html();var html_maker=new htmlMaker(window_template);var html=html_maker.getHTML(template_data);$(constants.WINDOW_ID).html(html);var help_topic_names=[constants.HELP_TOPIC_TARGET_FREQUENCY,constants.HELP_TOPIC_TARGET_ROLLOVER];GENERAL.set_help_tooltip_text(help_topic_names);var categories_combobox_template=$(constants.CATEGORIES_COMBOBOX_TEMPLATE).html();var html_maker=new htmlMaker(categories_combobox_template);var categories_html=html_maker.getHTML(GENERAL.expense_categories);$(constants.ADD_TARGET_CATEGORY_ID).html(categories_html);$(constants.ADD_TARGET_CATEGORY_ID).val(category_id);var categories_string=$(constants.ADD_TARGET_ID+budget_id).attr(constants.TARGET_CATEGORIES_PROP);var categories_array=categories_string.split(" ");for(var i=0;i<categories_array.length;++i){if(categories_array[i]!=category_id)
$(constants.ADD_TARGET_CATEGORY_ID+" option[value='"+categories_array[i]+"']").remove();}
var currencies_combobox_template=$(constants.CURRENCIES_COMBOBOX_TEMPLATE).html();html_maker=new htmlMaker(currencies_combobox_template);var currencies_html=html_maker.getHTML(BUDGET.user_currencies);$(constants.ADD_TARGET_CURRENCY_ID).html(currencies_html);$(constants.ADD_TARGET_CURRENCY_ID).val(currency_id);$(constants.ADD_TARGET_AMOUNT_ID).val(amount);$(constants.ADD_TARGET_PERIOD_ID).val(period);$(constants.ADD_TARGET_EVERY_ID).val(every_as_number);var rollover_checkbox=rollover=="1"?true:false;$(constants.ADD_TARGET_ROLLOVER_ID).prop("checked",rollover_checkbox);BUDGET.get_category_average($(constants.ADD_TARGET_CATEGORY_ID).val(),1);BUDGET.bind_on_single_target_category_change("1");BUDGET.bind_on_single_amount_focus_events("1");$(constants.WINDOW_ID).css("display","inline-block");GENERAL.regular_window_events();$(constants.EDIT_TARGET_BUTTON_ID).on("click",function(e){e.stopPropagation();var rollover=$(constants.ADD_TARGET_ROLLOVER_ID).prop('checked')?1:0;BUDGET.edit_target(budget_id,target_id,$(constants.ADD_TARGET_AMOUNT_ID).val(),$(constants.ADD_TARGET_CURRENCY_ID).val(),$(constants.ADD_TARGET_CATEGORY_ID).val(),$(constants.ADD_TARGET_PERIOD_ID).val(),$(constants.ADD_TARGET_EVERY_ID).val(),rollover);});});};Budget.prototype.maybe_disable_add_target_button=function(button){var target_length=parseInt($(constants.ADD_TARGET_TABLE_ID).attr(constants.TARGETS_LENGTH_PROP));if(target_length>=GENERAL.expense_categories.length)
GENERAL.disable_tiny_button(button);};Budget.prototype.bind_show_edit_budget_window=function(budget_id){$(constants.EDIT_BUDGET_ID+budget_id).on("click",function(e){e.stopPropagation();BUDGET.targets_categories=[];var edit_button=$(this);var budget_name=edit_button.attr(constants.BUDGET_NAME_PROP);var start_month=edit_button.attr(constants.BUDGET_START_MONTH_PROP);var end_month=edit_button.attr(constants.BUDGET_END_MONTH_PROP);var start_year=edit_button.attr(constants.BUDGET_START_YEAR_PROP);var end_year=edit_button.attr(constants.BUDGET_END_YEAR_PROP);var targets=$(constants.EDIT_BUDGET_ID+budget_id).attr(constants.EDIT_BUDGET_TARGETS_PROP).trim()==""?[]:JSON.parse($(constants.EDIT_BUDGET_ID+budget_id).attr(constants.EDIT_BUDGET_TARGETS_PROP));BUDGET.hide_everything();var template_data={id:budget_id,budget_name:budget_name,targets:targets};var window_template=$(constants.EDIT_BUDGET_WINDOW_TEMPLATE_ID).html();var html_maker=new htmlMaker(window_template);var html=html_maker.getHTML(template_data);$(constants.WINDOW_ID).html(html);var years_combobox_template=$(constants.YEARS_COMBOBOX_TEMPLATE).html();html_maker=new htmlMaker(years_combobox_template);var years_html=html_maker.getHTML(BUDGET.budget_years);$(constants.YEAR_COMBOX).html(years_html);$(constants.BUDGET_START_MONTH_ID).val(start_month);$(constants.BUDGET_END_MONTH_ID).val(end_month);$(constants.BUDGET_START_YEAR_ID).val(start_year);$(constants.BUDGET_END_YEAR_ID).val(end_year);BUDGET.init_target_categories(targets.length,true);var currencies_combobox_template=$(constants.CURRENCIES_COMBOBOX_TEMPLATE).html();html_maker=new htmlMaker(currencies_combobox_template);var currencies_html=html_maker.getHTML(BUDGET.user_currencies);$(constants.CURRENCY_COMBOX).html(currencies_html);if(BUDGET.default_currency_exists())
$(constants.CURRENCY_COMBOX).val(BUDGET.user_default_currency);$(constants.ADD_TARGET_TABLE_ID).attr(constants.TARGETS_LENGTH_PROP,targets.length);BUDGET.on_target_show_hide_clicked();var target_length=targets.length;for(var i=0;i<target_length;++i){var category_id=targets[i][constants.TARGET_CATEGORY_ID_ATTR];var amount=targets[i][constants.TARGET_AMOUNT_AS_NUMBER_ATTR];var currency_id=targets[i][constants.TARGET_CURRENCY_ID_ATTR];var every=targets[i][constants.TARGET_EVERY_AS_NUMBER_ATTR];var period=targets[i][constants.TARGET_PERIOD_ATTR];var target_id=targets[i][constants.TARGET_ID_ATTR];var rollover=targets[i][constants.TARGET_ROLLOVER_ATTR];$(constants.TARGET_CATEGORY_ID+i).val(category_id);$(constants.TARGET_CATEGORY_ID+i).attr(constants.TARGET_ID_PROP,target_id);BUDGET.targets_categories[i]=category_id;BUDGET.remove_category_from_targets(category_id,i,targets.length);$(constants.TARGET_AMOUNT_ID+i).val(amount);$(constants.TARGET_CURRENCY_ID+i).val(currency_id);$(constants.TARGET_EVERY_ID+i).val(every);$(constants.TARGET_PERIOD_ID+i).val(period);$(constants.TARGET_ROLLOVER_ID+i).prop("checked",rollover=="1");}
var help_topic_names=[constants.HELP_TOPIC_BUDGET_START,constants.HELP_TOPIC_BUDGET_END];GENERAL.set_help_tooltip_text(help_topic_names);var target_tooltips_indices=[];for(var i=0;i<target_length;++i)
target_tooltips_indices.push(i);var target_help_topic_names=[constants.HELP_TOPIC_TARGET_FREQUENCY,constants.HELP_TOPIC_TARGET_ROLLOVER];GENERAL.set_multiple_help_tooltip_text(target_help_topic_names,target_tooltips_indices);$(constants.WINDOW_ID).css("display","inline-block");GENERAL.regular_window_events();if(targets.length==0)
BUDGET.on_add_budget_add_target_clicked($(constants.EDIT_BUDGET_TABLE_ADD_TARGET_BUTTON));$(constants.EDIT_BUDGET_TABLE_ADD_TARGET_BUTTON).on("click",function(e){e.stopPropagation();BUDGET.on_add_budget_add_target_clicked($(constants.EDIT_BUDGET_TABLE_ADD_TARGET_BUTTON));});BUDGET.maybe_disable_add_target_button($(constants.EDIT_BUDGET_TABLE_ADD_TARGET_BUTTON));$(constants.EDIT_BUDGET_BUTTON_ID).on("click",function(e){e.stopPropagation();var target_ids=[];var amounts=[];var category_ids=[];var currencies=[];var periods=[];var everys=[];var rollovers=[];var indices=[];var target_length=parseInt($(constants.ADD_TARGET_TABLE_ID).attr(constants.TARGETS_LENGTH_PROP));for(var i=0;i<target_length;++i){var amount=$(constants.TARGET_AMOUNT_ID+i).val().trim();var rollover=$(constants.TARGET_ROLLOVER_ID+i).prop('checked')?1:0;var category=$(constants.TARGET_CATEGORY_ID+i).val().trim();var id=$(constants.TARGET_CATEGORY_ID+i).attr(constants.TARGET_ID_PROP).trim();var currency=$(constants.TARGET_CURRENCY_ID+i).val().trim();var period=$(constants.TARGET_PERIOD_ID+i).val().trim();var every=$(constants.TARGET_EVERY_ID+i).val().trim();if(amount!=""&&amount!=null){amounts.push(amount);category_ids.push(category);currencies.push(currency);periods.push(period);everys.push(every);rollovers.push(rollover);target_ids.push(id);indices.push(i);}}
BUDGET.edit_budget(budget_id,$(constants.BUDGET_NAME_ID).val(),$(constants.BUDGET_START_MONTH_ID).val(),$(constants.BUDGET_START_YEAR_ID).val(),$(constants.BUDGET_END_MONTH_ID).val(),$(constants.BUDGET_END_YEAR_ID).val(),target_ids,category_ids,amounts,currencies,periods,everys,rollovers,indices);});});};Budget.prototype.bind_show_delete_target_window=function(budget_id,target_id){$(constants.DELETE_TARGET_ID+target_id).on("click",function(e){e.stopPropagation();BUDGET.hide_everything();var template_data={};var window_template=$(constants.DELETE_TARGET_WINDOW_TEMPLATE_ID).html();var html_maker=new htmlMaker(window_template);var html=html_maker.getHTML(template_data);$(constants.WINDOW_ID).html(html);$(constants.WINDOW_ID).css("display","inline-block");GENERAL.delete_window_events();$(constants.DELETE_TARGET_BUTTON_ID).on("click",function(e){e.stopPropagation();BUDGET.delete_target(budget_id,target_id);});});};Budget.prototype.bind_show_delete_budget_window=function(budget_id){$(constants.DELETE_BUDGET_ID+budget_id).on("click",function(e){e.stopPropagation();BUDGET.hide_everything();var template_data={id:budget_id};var window_template=$(constants.DELETE_BUDGET_WINDOW_TEMPLATE_ID).html();var html_maker=new htmlMaker(window_template);var html=html_maker.getHTML(template_data);$(constants.WINDOW_ID).html(html);$(constants.WINDOW_ID).css("display","inline-block");GENERAL.delete_window_events();$(constants.DELETE_BUDGET_BUTTON_ID).on("click",function(e){e.stopPropagation();BUDGET.delete_budget(budget_id);});});};Budget.prototype.delete_target_feedback=function(data,budget_id,target_id){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data["result"]==constants.SUCCESS_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("The target has been deleted successfully!");BUDGET.get_updated_budget(budget_id);BUDGET.partial_sync_with_budget();}
else if(data["result"]==constants.FAIL_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't delete the target");}};Budget.prototype.delete_budget_feedback=function(data,budget_id){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data["result"]==constants.SUCCESS_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("The budget has been deleted successfully!");$(constants.BUDGET_WRAPPER_ID+budget_id).remove();BUDGET.sync_with_budget();}
else if(data["result"]==constants.FAIL_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);if(data[constants.ERROR_MESSAGE_ATTR].trim()==="")
$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't delete the budget");else
$(constants.WINDOW_FEEDBACK_ID).text(data[constants.ERROR_MESSAGE_ATTR]);}};Budget.prototype.delete_target=function(budget_id,target_id){GENERAL.disable_button($(constants.DELETE_TARGET_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.DELETE_TARGET_REQUEST,budget_id:budget_id,target_id:target_id},success:function(data){GENERAL.check_session_expired(data);$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.SHOWING_SPEED);BUDGET.delete_target_feedback(data,budget_id,target_id);}});};Budget.prototype.delete_budget=function(id){GENERAL.disable_button($(constants.DELETE_BUDGET_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.DELETE_BUDGET_REQUEST,id:id},success:function(data){GENERAL.check_session_expired(data);$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.SHOWING_SPEED);BUDGET.delete_budget_feedback(data,id);}});};Budget.prototype.get_budget=function(id){$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.GET_BUDGET_REQUEST,id:id},success:function(data){GENERAL.check_session_expired(data);var targets_data=data[0][constants.BUDGET_TARGETS_ATTR];delete data[0][constants.BUDGET_TARGETS_ATTR];BUDGET.display_budget(data[0]);BUDGET.display_targets(data[0][constants.BUDGET_ID_ATTR],targets_data);}});};Budget.prototype.get_updated_budget=function(id){$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.GET_BUDGET_REQUEST,id:id},success:function(data){GENERAL.check_session_expired(data);var targets_data=data[0][constants.BUDGET_TARGETS_ATTR];delete data[0][constants.BUDGET_TARGETS_ATTR];BUDGET.display_updated_budget(id,data[0]);BUDGET.display_targets(data[0][constants.BUDGET_ID_ATTR],targets_data);BUDGET.show_targets(id);}});};Budget.prototype.get_budgets=function(){$(constants.BUDGETS_DIV).html("");$(constants.BUDGET_LOADING_ICON).show();$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.GET_BUDGETS_REQUEST},success:function(data){GENERAL.check_session_expired(data);$(constants.BUDGET_LOADING_ICON).hide();BUDGET.display_budgets(data);}});};Budget.prototype.get_user_currencies=function(){$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.GET_USER_CURRENCIES_REQUEST},success:function(data){GENERAL.check_session_expired(data);BUDGET.user_default_currency=data[0][constants.USER_CURRENCY_ID_ATTR];BUDGET.user_currencies=data;BUDGET.user_currencies.splice(0,1);BUDGET.maybe_enable_add_budget_button();}});};Budget.prototype.get_targets=function(budget_id){$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.GET_TARGETS_REQUEST,budget_id:budget_id},success:function(data){GENERAL.check_session_expired(data);BUDGET.display_targets(budget_id,data);}});};var ACCOUNT=new Account();function Account(){this.currencies=null;this.VISIBLE_ACCOUNT_MENU_ID="";}
Account.prototype.display_accounts=function(data){for(var i=data.length-1;i>=0;--i)
ACCOUNT.display_account(data[i]);$("html").on("click",function(){ACCOUNT.hide_everything();});$(constants.SHOW_ADD_ACCOUNT_BUTTON_ID).on("click",function(e){e.stopPropagation();ACCOUNT.bind_show_add_account_window();});var template=$(constants.ACCOUNT_SUMMARY_TEMPLATE).html();$(constants.ACCOUNTS_DIV).append(template);if(data.length>=1){$(constants.ACCOUNT_CREDIT_SUMMARY_ID).html(data[0][constants.ACCOUNT_CREDIT_SUMMARY_ATTR]);$(constants.ACCOUNT_DEBIT_SUMMARY_ID).html(data[0][constants.ACCOUNT_DEBIT_SUMMARY_ATTR]);$(constants.ACCOUNT_CASH_SUMMARY_ID).html(data[0][constants.ACCOUNT_CASH_SUMMARY_ATTR]);$(constants.ACCOUNT_TOTAL_ID).html(data[0][constants.ACCOUNT_TOTAL_ATTR]);if(data[0][constants.ACCOUNT_CREDIT_SUMMARY_AS_NUMBER_ATTR]==0)
$(constants.ACCOUNT_CREDIT_SUMMARY_ROW_ID).hide();if(data[0][constants.ACCOUNT_DEBIT_SUMMARY_AS_NUMBER_ATTR]==0)
$(constants.ACCOUNT_DEBIT_SUMMARY_ROW_ID).hide();if(data[0][constants.ACCOUNT_CASH_SUMMARY_AS_NUMBER_ATTR]==0)
$(constants.ACCOUNT_CASH_SUMMARY_ROW_ID).hide();}
if(data.length>0){$(constants.ACCOUNT_DIV_ID+data[data.length-1][constants.ACCOUNT_ID_ATTRIBUTE]).addClass("last_item");GENERAL.set_bottom_margin_div($(constants.ACCOUNTS_DIV));}};Account.prototype.hide_everything=function(){if(ACCOUNT.VISIBLE_ACCOUNT_MENU_ID!=""){$(constants.ACCOUNT_SETTING_MENU_ID+ACCOUNT.VISIBLE_ACCOUNT_MENU_ID).hide(constants.HIDING_SPEED);$(constants.ACCOUNT_SETTING_GEAR_ID+ACCOUNT.VISIBLE_ACCOUNT_MENU_ID).css("background-color",constants.SETTINGS_UNPRESSED_COLOR);ACCOUNT.VISIBLE_ACCOUNT_MENU_ID="";}};Account.prototype.display_account=function(row){var template=$(constants.ACCOUNT_TEMPLATE).html();var html_maker=new htmlMaker(template);var html=html_maker.getHTML(row);$(constants.ACCOUNTS_DIV).prepend(html);var account_id=row[constants.ACCOUNT_ID_ATTRIBUTE];ACCOUNT.bind_show_edit_account_window(account_id);ACCOUNT.bind_show_delete_account_window(account_id);var account_type=row[constants.ACCOUNT_TYPE_ATTR];if(account_type==constants.ACCOUNT_TYPE_CASH){$(constants.ACCOUNT_MONEY_TYPE_DIV_ID+account_id).hide();}
$(constants.ACCOUNT_DIV_ID+account_id).on("click",function(e){e.stopPropagation();ACCOUNT.hide_everything();});$(constants.ACCOUNTS_WRAPPER_ID).on("click",function(e){e.stopPropagation();ACCOUNT.hide_everything();});$(constants.ACCOUNT_SETTING_GEAR_ID+account_id).on("click",function(e){e.stopPropagation();var display=$(constants.ACCOUNT_SETTING_MENU_ID+account_id).css("display");if(display=="none"){ACCOUNT.hide_everything();$(constants.ACCOUNT_SETTING_MENU_ID+account_id).show(constants.SHOWING_SPEED);$(constants.ACCOUNT_SETTING_GEAR_ID+account_id).css("background-color",constants.SETTINGS_PRESSED_COLOR);ACCOUNT.VISIBLE_ACCOUNT_MENU_ID=account_id;}
else{$(constants.ACCOUNT_SETTING_MENU_ID+account_id).hide(constants.HIDING_SPEED);$(constants.ACCOUNT_SETTING_GEAR_ID+account_id).css("background-color",constants.SETTINGS_UNPRESSED_COLOR);ACCOUNT.VISIBLE_ACCOUNT_MENU_ID="";}});};Account.prototype.get_currencies=function(){$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.GET_CURRENCIES_REQUEST},success:function(data){GENERAL.check_session_expired(data);ACCOUNT.currencies=data;GENERAL.enable_main_button($(constants.SHOW_ADD_ACCOUNT_BUTTON_ID));}});};Account.prototype.get_accounts=function(){$(constants.ACCOUNTS_DIV).html("");$(constants.ACCOUNT_LOADING_ICON).show();$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.GET_ACCOUNTS_REQUEST},success:function(data){GENERAL.check_session_expired(data);$(constants.ACCOUNT_LOADING_ICON).hide();ACCOUNT.display_accounts(data);}});};Account.prototype.populate_currencies=function(){var currencies_template=$(constants.CURRENCIES_TEMPLATE_ID).html();var html_maker=new htmlMaker(currencies_template);var currencies_html=html_maker.getHTML(ACCOUNT.currencies);$(constants.ACCOUNT_CURRENCY_TYPE_ID).html(currencies_html);};Account.prototype.bind_show_add_account_window=function(){var window_template=$(constants.ADD_ACCOUNT_WINDOW_TEMPLATE_ID).html();$(constants.WINDOW_ID).html(window_template);ACCOUNT.populate_currencies();$(constants.WINDOW_ID).css("display","inline-block");$(constants.ADD_ACCOUNT_BUTTON).on("click",function(){var account_name=$(constants.ACCOUNT_NAME_ID).val();var account_description=$(constants.ACCOUNT_DESCRIPTION_ID).val();var account_type=$(constants.ACCOUNT_TYPE_ID).val();var account_money_type=$(constants.ACCOUNT_MONEY_TYPE_ID).val();var initial_balance=$(constants.ACCOUNT_INITIAL_BALANCE_ID).val();var currency_id=$(constants.ACCOUNT_CURRENCY_TYPE_ID).val();ACCOUNT.add_account(account_name,account_description,account_type,account_money_type,initial_balance,currency_id);});$(constants.ACCOUNT_TYPE_ID).on("change",ACCOUNT.on_account_type_changed);var help_topic_names=[constants.HELP_TOPIC_ACCOUNT_TYPE,constants.HELP_TOPIC_MONEY_TYPE,constants.HELP_TOPIC_INITIAL_BALANCE];GENERAL.set_help_tooltip_text(help_topic_names);GENERAL.regular_window_events();};Account.prototype.add_account=function(account_name,account_description,account_type,account_money_type,initial_balance,currency_id){GENERAL.disable_button($(constants.ADD_ACCOUNT_BUTTON));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.ADD_ACCOUNT_REQUEST,name:account_name,description:account_description,currency_id:currency_id,money_type:account_money_type,account_type:account_type,initial_balance:initial_balance},success:function(data){GENERAL.check_session_expired(data);$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.HIDING_SPEED);ACCOUNT.add_account_feedback(data,account_name,account_description,account_type,account_money_type,initial_balance,currency_id);}});};Account.prototype.add_account_feedback=function(data,account_name,account_description,account_type,account_money_type,initial_balance,currency_id){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data[constants.RESULT_ATTR]==constants.SUCCESS_RESPONSE){GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("A new account has been added successfully!");var type=constants.ACCOUNT_BANK_TYPE_ARRAY[account_type];var money_type=constants.ACCOUNT_MONEY_TYPE_ARRAY[account_money_type];var template_data={id:data["id"],account_name:account_name,account_description:account_description,account_type:type,money_type:money_type,currency_id:currency_id,account_balance:data[constants.CURRENCY_FORMATTED_BALANCE_ATTR],account_initial_balance:initial_balance,type_as_number:account_type,money_type_as_number:account_money_type,initial_balance_formatted:data[constants.INITIAL_BALANCE_FORMATTED_ATTR]};ACCOUNT.display_account(template_data);$(constants.ADD_NEW_ACCOUNT_BUTTON).show();$(constants.ADD_NEW_ACCOUNT_BUTTON).on("click",function(e){e.stopPropagation();ACCOUNT.bind_show_add_account_window();});ACCOUNT.partial_sync_with_accounts();}
else if(data[constants.RESULT_ATTR]==constants.FAIL_RESPONSE){GENERAL.enable_button($(constants.ADD_ACCOUNT_BUTTON));$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);if(data[constants.ERROR_MESSAGE_ATTR].trim()==="")
$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't add the account");else
$(constants.WINDOW_FEEDBACK_ID).text(data[constants.ERROR_MESSAGE_ATTR]);}};Account.prototype.edit_account=function(account_name,account_description,account_type,account_money_type,initial_balance,currency_id,id){GENERAL.disable_button($(constants.EDIT_ACCOUNT_BUTTON));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.EDIT_ACCOUNT_REQUEST,name:account_name,description:account_description,currency_id:currency_id,money_type:account_money_type,account_type:account_type,initial_balance:initial_balance,id:id},success:function(data){GENERAL.check_session_expired(data);GENERAL.enable_button($(constants.EDIT_ACCOUNT_BUTTON));$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.HIDING_SPEED);ACCOUNT.edit_account_feedback(data,account_name,account_description,account_type,account_money_type,initial_balance,currency_id,id);}});};Account.prototype.delete_account=function(id){GENERAL.disable_button($(constants.DELETE_ACCOUNT_BUTTON));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.DELETE_ACCOUNT_REQUEST,id:id},success:function(data){GENERAL.check_session_expired(data);$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.SHOWING_SPEED);ACCOUNT.delete_account_feedback(data,id);}});};Account.prototype.sync_with_accounts=function(){GENERAL.disable_main_button($(constants.SHOW_ADD_TRANSACTION_BUTTON_ID));GENERAL.disable_main_button($(constants.SHOW_ADD_BUDGET_BUTTON_ID));TRANSACTION.get_user_accounts();TRANSACTION.get_transactions();BUDGET.get_user_currencies();TRANSACTION.get_monthly_transactions_overview();ANALYTICS.load();};Account.prototype.partial_sync_with_accounts=function(){GENERAL.disable_main_button($(constants.SHOW_ADD_TRANSACTION_BUTTON_ID));GENERAL.disable_main_button($(constants.SHOW_ADD_BUDGET_BUTTON_ID));TRANSACTION.get_user_accounts();BUDGET.get_user_currencies();};Account.prototype.delete_account_feedback=function(data,account_id){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data[constants.RESULT_ATTR]==constants.SUCCESS_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("The account has been deleted successfully!");$(constants.ACCOUNT_DIV_ID+account_id).remove();ACCOUNT.sync_with_accounts();}
else if(data[constants.RESULT_ATTR]==constants.FAIL_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);if(data[constants.ERROR_MESSAGE_ATTR].trim()==="")
$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't delete the account");else
$(constants.WINDOW_FEEDBACK_ID).text(data[constants.ERROR_MESSAGE_ATTR]);}};Account.prototype.edit_account_feedback=function(data,account_name,account_description,account_type,account_money_type,initial_balance,currency_id,id){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data["result"]==constants.SUCCESS_RESPONSE){GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("The account has been editted successfully!");var type=constants.ACCOUNT_BANK_TYPE_ARRAY[account_type];var money_type=constants.ACCOUNT_MONEY_TYPE_ARRAY[account_money_type];$(constants.ACCOUNT_NAME_DIV_ID+id).html(account_name);$(constants.ACCOUNT_MONEY_TYPE_DIV_ID+id).html(money_type);$(constants.ACCOUNT_ACCOUNT_TYPE_DIV_ID+id).html(type);$(constants.ACCOUNT_ACCOUNT_BALANCE_DIV_ID+id).html(data[constants.CURRENCY_FORMATTED_BALANCE_ATTR]);$(constants.INITIAL_BALANCE_FORMATTED_ID+id).html(data[constants.INITIAL_BALANCE_FORMATTED_ATTR]);$(constants.ACCOUNT_ACCOUNT_DESCRIPTION_DIV_ID+id).attr(constants.ACCOUNT_DESCRIPTION_TITLE_PROP,account_description);$(constants.EDIT_ACCOUNT_ID+id).attr(constants.ACCOUNT_NAME_PROP,account_name).attr(constants.ACCOUNT_DESCRIPTION_PROP,account_description).attr(constants.ACCOUNT_INITIAL_BALANCE_PROP,initial_balance).attr(constants.ACCOUNT_TYPE_PROP,account_type).attr(constants.ACCOUNT_CURRENCY_ID_PROP,currency_id).attr(constants.ACCOUNT_MONEY_TYPE_PROP,account_money_type);if(account_type==constants.ACCOUNT_TYPE_CASH)
$(constants.ACCOUNT_MONEY_TYPE_DIV_ID+id).hide();else
$(constants.ACCOUNT_MONEY_TYPE_DIV_ID+id).show();ACCOUNT.sync_with_accounts();}
else if(data["result"]==constants.FAIL_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't edit the account");}};Account.prototype.bind_show_edit_account_window=function(account_id){$(constants.EDIT_ACCOUNT_ID+account_id).on("click",function(e){e.stopPropagation();ACCOUNT.hide_everything();var name=$(this).attr(constants.ACCOUNT_NAME_PROP);var description=$(this).attr(constants.ACCOUNT_DESCRIPTION_PROP);var initial_balance=$(this).attr(constants.ACCOUNT_INITIAL_BALANCE_PROP);var type=$(this).attr(constants.ACCOUNT_TYPE_PROP);var money_type=$(this).attr(constants.ACCOUNT_MONEY_TYPE_PROP);var currency_id=$(this).attr(constants.ACCOUNT_CURRENCY_ID_PROP);var template_data={account_name:name,account_description:description,account_initial_balance:initial_balance};var window_template=$(constants.EDIT_ACCOUNT_WINDOW_TEMPLATE_ID).html();var html_maker=new htmlMaker(window_template);var html=html_maker.getHTML(template_data);$(constants.WINDOW_ID).html(html);ACCOUNT.populate_currencies();$(constants.ACCOUNT_CURRENCY_TYPE_ID).val(currency_id);$(constants.ACCOUNT_TYPE_ID).val(type);$(constants.ACCOUNT_MONEY_TYPE_ID).val(money_type);$(constants.WINDOW_ID).css("display","inline-block");GENERAL.regular_window_events();ACCOUNT.bind_edit_account_button(account_id);$(constants.ACCOUNT_TYPE_ID).on("change",ACCOUNT.on_account_type_changed);ACCOUNT.on_account_type_changed();var help_topic_names=[constants.HELP_TOPIC_ACCOUNT_TYPE,constants.HELP_TOPIC_MONEY_TYPE,constants.HELP_TOPIC_INITIAL_BALANCE];GENERAL.set_help_tooltip_text(help_topic_names);});};Account.prototype.on_account_type_changed=function(){if($(constants.ACCOUNT_TYPE_ID).val()==constants.ACCOUNT_TYPE_BANK_ACCOUNT)
$(constants.ACCOUNT_MONEY_TYPE_ROW_ID).show();else
$(constants.ACCOUNT_MONEY_TYPE_ROW_ID).hide();};Account.prototype.bind_edit_account_button=function(account_id){$(constants.EDIT_ACCOUNT_BUTTON).on("click",function(e){e.stopPropagation();var account_name=$(constants.ACCOUNT_NAME_ID).val();var account_description=$(constants.ACCOUNT_DESCRIPTION_ID).val();var account_type=$(constants.ACCOUNT_TYPE_ID).val();var account_money_type=$(constants.ACCOUNT_MONEY_TYPE_ID).val();var initial_balance=$(constants.ACCOUNT_INITIAL_BALANCE_ID).val();var currency_id=$(constants.ACCOUNT_CURRENCY_TYPE_ID).val();ACCOUNT.edit_account(account_name,account_description,account_type,account_money_type,initial_balance,currency_id,account_id);});};Account.prototype.bind_show_delete_account_window=function(account_id){$(constants.DELETE_ACCOUNT_ID+account_id).on("click",function(e){e.stopPropagation();ACCOUNT.hide_everything();var template_data={id:account_id};var window_template=$(constants.DELETE_ACCOUNT_WINDOW_TEMPLATE_ID).html();var html_maker=new htmlMaker(window_template);var html=html_maker.getHTML(template_data);$(constants.WINDOW_ID).html(html);$(constants.WINDOW_ID).css("display","inline-block");GENERAL.delete_window_events();$(constants.DELETE_ACCOUNT_BUTTON).on("click",function(e){e.stopPropagation();ACCOUNT.delete_account(account_id);});});};var TRANSACTION=new Transaction();function Transaction(){this.user_accounts=null;this.transaction_overview_data=null;this.selected_transaction_item_suggestion_index=-1;this.selected_payee_suggestion_index=-1;this.VISIBLE_TRANSACTION_MENU_ID="";this.VISIBLE_ITEM_MENU_ID="";this.VISIBLE_TRANSFER_MENU_ID="";this.VISIBLE_INCOME_MENU_ID="";this.PAYEES=[];}
Transaction.prototype.init=function(){var date=new Date();var month=date.getMonth()+1+"";var year=date.getFullYear()+"";$(constants.TRANSACTION_COMBO_MONTH).val(month);$(constants.TRANSACTION_COMBO_YEAR).val(year);$(constants.TRANSACTION_COMBO_MONTH).on("change",TRANSACTION.get_transactions);$(constants.TRANSACTION_COMBO_YEAR).on("change",TRANSACTION.get_transactions);$(constants.TRANSACTION_COMBO_TYPE).on("change",TRANSACTION.get_transactions);$(constants.TRANSACTION_ACCOUNT_ID).on("change",TRANSACTION.get_transactions);$(constants.TRANSACTION_COMBO_MONTH).on("change",TRANSACTION.get_monthly_transactions_overview);$(constants.TRANSACTION_COMBO_YEAR).on("change",TRANSACTION.get_monthly_transactions_overview);$(constants.TRANSACTION_ACCOUNT_ID).on("change",TRANSACTION.get_monthly_transactions_overview);$(constants.TRANSACTION_FILTER_MORE_FILTERS_BUTTON_ID).on("click",function(e){e.stopPropagation();var expanded=$(constants.TRANSACTION_FILTER_MORE_FILTERS_BUTTON_ID).attr(constants.DATA_EXPANDED_PROP);if(expanded==="0"){$(constants.TRANSACTION_FILTER_CUSTOM_CLASS).show();$(constants.TRANSACTION_FILTER_MORE_FILTERS_BUTTON_ID).attr(constants.DATA_EXPANDED_PROP,"1");}
else if(expanded==="1"){$(constants.TRANSACTION_FILTER_CUSTOM_CLASS).hide();$(constants.TRANSACTION_FILTER_MORE_FILTERS_BUTTON_ID).attr(constants.DATA_EXPANDED_PROP,"0");}});$(constants.SHOW_ADD_TRANSACTION_BUTTON_ID).on("click",function(e){e.stopPropagation();TRANSACTION.on_show_add_transaction_window();});TRANSACTION.get_transaction_years();$(window).resize(TRANSACTION.show_monthly_transaction_overview);$(constants.TRANSACTION_TAB).click(TRANSACTION.show_monthly_transaction_overview);TRANSACTION.get_user_accounts();$("html").on("click",function(){TRANSACTION.hide_everything();});TRANSACTION.get_monthly_transactions_overview();TRANSACTION.get_payees();};Transaction.prototype.on_show_add_transaction_window=function(){var window_template=$(constants.ADD_TRANSACTION_WINDOW_TEMPLATE_ID).html();$(constants.WINDOW_ID).html(window_template);var account_combobox_template=$(constants.ACCOUNTS_COMBOBOX_TEMPLATE).html();var html_maker=new htmlMaker(account_combobox_template);var accounts_html=html_maker.getHTML(TRANSACTION.user_accounts);$(constants.ADD_TRANSACTION_ACCOUNTS_ID).html(accounts_html);$(constants.ADD_INCOME_ACCOUNTS_ID).html(accounts_html);$(constants.ADD_TRANSFER_FROM_ACCOUNTS_ID).html(accounts_html);$(constants.ADD_TRANSFER_TO_ACCOUNTS_ID).html(accounts_html);$(constants.WINDOW_ID).show(constants.SHOWING_SPEED);var tabs=[constants.ADD_TRANSACTION_TAB,constants.ADD_INCOME_TAB,constants.ADD_TRANSFER_TAB];GENERAL.bind_tab_events(tabs);var help_topic_names=[constants.HELP_TOPIC_PAYEE,constants.HELP_TOPIC_ACCOUNT,constants.HELP_TOPIC_TRANSACTION_ITEMS,constants.HELP_TOPIC_INCOME_ACCOUNT,constants.HELP_TOPIC_INCOME_SOURCE,constants.HELP_TOPIC_TO_ACCOUNT,constants.HELP_TOPIC_FROM_ACCOUNT];GENERAL.set_help_tooltip_text(help_topic_names);var date_object=new Date();var add_transaction_datepicker_wrapper=$(constants.ADD_TRANSACTION_DATE_WRAPPER_ID);var add_income_datepicker_wrapper=$(constants.ADD_INCOME_DATE_WRAPPER_ID);var add_transfer_datepicker_wrapper=$(constants.ADD_TRANSFER_DATE_WRAPPER_ID);DATEPICKER.generate_calendar(date_object,add_transaction_datepicker_wrapper,constants.ADD_TRANSACTION_CALENDAR_ID,$(constants.ADD_TRANSACTION_DATE),null);DATEPICKER.generate_calendar(date_object,add_income_datepicker_wrapper,constants.ADD_INCOME_CALENDAR_ID,$(constants.ADD_INCOME_DATE),null);DATEPICKER.generate_calendar(date_object,add_transfer_datepicker_wrapper,constants.ADD_TRANSFER_CALENDAR_ID,$(constants.ADD_TRANSFER_DATE),null);var date=GENERAL.format_date(date_object);$(constants.ADD_TRANSACTION_DATE).val(date);$(constants.ADD_TRANSACTION_HOUR_ID).val(GENERAL.get_hours(date_object));$(constants.ADD_TRANSACTION_MINUTE_ID).val(GENERAL.get_minutes(date_object));$(constants.ADD_TRANSACTION_AM_PM_ID).val(GENERAL.get_am_pm(date_object));$(constants.ADD_INCOME_DATE).val(date);$(constants.ADD_INCOME_HOUR_ID).val(GENERAL.get_hours(date_object));$(constants.ADD_INCOME_MINUTE_ID).val(GENERAL.get_minutes(date_object));$(constants.ADD_INCOME_AM_PM_ID).val(GENERAL.get_am_pm(date_object));$(constants.ADD_TRANSFER_DATE).val(date);$(constants.ADD_TRANSFER_HOUR_ID).val(GENERAL.get_hours(date_object));$(constants.ADD_TRANSFER_MINUTE_ID).val(GENERAL.get_minutes(date_object));$(constants.ADD_TRANSFER_AM_PM_ID).val(GENERAL.get_am_pm(date_object));$(constants.ADD_TRANSACTION_PAYEE_ID).on("keydown",function(e){var textbox=$(constants.ADD_TRANSACTION_PAYEE_ID);var container=$(constants.PAYEE_SUGGESTIONS_ID);TRANSACTION.on_live_search_payee_textbox_down_arrow_typed(e,textbox,container);});$(constants.ADD_TRANSACTION_PAYEE_ID).on("keyup",function(e){if(e.which==constants.DOWN_KEY||e.which==constants.UP_KEY||e.which==constants.ENTER_KEY)
return;var textbox=$(constants.ADD_TRANSACTION_PAYEE_ID);var text=textbox.val();var suggestions_container=$(constants.PAYEE_SUGGESTIONS_ID);TRANSACTION.get_payee_suggestions(text,suggestions_container,textbox);});GENERAL.regular_window_events();for(var i=0;i<constants.ADD_TRANSACTION_NUMBER_OF_ITEMS;++i){var textbox=$(constants.ADD_TRANSACTION_ITEM_ID+(i+1));var suggestions_container=$(constants.ADD_TRANSACTION_ITEM_SUGGESTIONS_ID+(i+1));TRANSACTION.bind_item_suggestions_event(textbox,suggestions_container);TRANSACTION.bind_item_suggestions_from_payee_event(textbox,suggestions_container);TRANSACTION.bind_textbox_live_search(textbox,suggestions_container);}
$(constants.ADD_INCOME_ITEM_ID).on("keyup",function(e){if(e.which==constants.DOWN_KEY||e.which==constants.UP_KEY||e.which==constants.ENTER_KEY)
return;var textbox=$(constants.ADD_INCOME_ITEM_ID);var text=textbox.val();var suggestions_container=$(constants.ADD_INCOME_ITEM_SUGGESTIONS_ID);TRANSACTION.get_item_suggestions(text,suggestions_container,textbox,"i");});$(constants.ADD_INCOME_ITEM_ID).on("keydown",function(e){var textbox=$(constants.ADD_INCOME_ITEM_ID);var container=$(constants.ADD_INCOME_ITEM_SUGGESTIONS_ID);TRANSACTION.on_live_search_textbox_down_arrow_typed(e,textbox,container);});$(constants.ADD_TRANSACTION_BUTTON_ID).on("click",function(e){e.stopPropagation();TRANSACTION.on_add_transaction_clicked();});$(constants.ADD_TRANSACTION_TABLE_ADD_ITEM_BUTTON_ID).on("click",function(e){e.stopPropagation();TRANSACTION.on_add_transaction_table_add_item_button_clicked();});$(constants.ADD_INCOME_BUTTON_ID).on("click",function(e){e.stopPropagation();TRANSACTION.on_add_income_clicked();});$(constants.ADD_TRANSFER_BUTTON_ID).on("click",function(e){e.stopPropagation();TRANSACTION.on_add_transfer_clicked();});};Transaction.prototype.bind_textbox_live_search=function(textbox,container){textbox.on("keydown",function(e){TRANSACTION.on_live_search_textbox_down_arrow_typed(e,textbox,container);});};Transaction.prototype.on_live_search_textbox_down_arrow_typed=function(e,textbox,container){var regular_elements_size=$(constants.ADD_TRANSACTION_ITEM_SUGGESTIONS_CLASS).size();if(regular_elements_size==0)
return;var selected_size=$(constants.ADD_TRANSACTION_SELECTED_ITEM_SUGGESTIONS_CLASS).size();if(e.which==constants.DOWN_KEY){if(selected_size==0){$(constants.ADD_TRANSACTION_ITEM_SUGGESTIONS_CLASS).eq(0).addClass(constants.ADD_TRANSACTION_SELECTED_ITEM_SUGGESTIONS_CLASS_NAME);return;}
else{var index=$(constants.ADD_TRANSACTION_SELECTED_ITEM_SUGGESTIONS_CLASS).index();if(index==regular_elements_size-1)
index=-1;$(constants.ADD_TRANSACTION_ITEM_SUGGESTIONS_CLASS).removeClass(constants.ADD_TRANSACTION_SELECTED_ITEM_SUGGESTIONS_CLASS_NAME);$(constants.ADD_TRANSACTION_ITEM_SUGGESTIONS_CLASS).eq(index+1).addClass(constants.ADD_TRANSACTION_SELECTED_ITEM_SUGGESTIONS_CLASS_NAME);}}
else if(e.which==constants.UP_KEY){if(selected_size==0){$(constants.ADD_TRANSACTION_ITEM_SUGGESTIONS_CLASS).eq(regular_elements_size-1).addClass(constants.ADD_TRANSACTION_SELECTED_ITEM_SUGGESTIONS_CLASS_NAME);return;}
else{var index=$(constants.ADD_TRANSACTION_SELECTED_ITEM_SUGGESTIONS_CLASS).index();if(index==0)
index=regular_elements_size;$(constants.ADD_TRANSACTION_ITEM_SUGGESTIONS_CLASS).removeClass(constants.ADD_TRANSACTION_SELECTED_ITEM_SUGGESTIONS_CLASS_NAME);$(constants.ADD_TRANSACTION_ITEM_SUGGESTIONS_CLASS).eq(index-1).addClass(constants.ADD_TRANSACTION_SELECTED_ITEM_SUGGESTIONS_CLASS_NAME);}}
else if(e.which==constants.ENTER_KEY){if(selected_size==0)
return;TRANSACTION.on_suggestion_item_selected($(constants.ADD_TRANSACTION_SELECTED_ITEM_SUGGESTIONS_CLASS),textbox,container);}};Transaction.prototype.on_live_search_payee_textbox_down_arrow_typed=function(e,textbox,container){var regular_elements_size=$(constants.ADD_TRANSACTION_PAYEE_SUGGESTIONS_CLASS).size();if(regular_elements_size==0)
return;var selected_size=$(constants.ADD_TRANSACTION_SELECTED_PAYEE_SUGGESTIONS_CLASS).size();if(e.which==constants.DOWN_KEY){if(selected_size==0){$(constants.ADD_TRANSACTION_PAYEE_SUGGESTIONS_CLASS).eq(0).addClass(constants.ADD_TRANSACTION_SELECTED_PAYEE_SUGGESTIONS_CLASS_NAME);return;}
else{var index=$(constants.ADD_TRANSACTION_SELECTED_PAYEE_SUGGESTIONS_CLASS).index();if(index==regular_elements_size-1)
index=-1;$(constants.ADD_TRANSACTION_PAYEE_SUGGESTIONS_CLASS).removeClass(constants.ADD_TRANSACTION_SELECTED_PAYEE_SUGGESTIONS_CLASS_NAME);$(constants.ADD_TRANSACTION_PAYEE_SUGGESTIONS_CLASS).eq(index+1).addClass(constants.ADD_TRANSACTION_SELECTED_PAYEE_SUGGESTIONS_CLASS_NAME);}}
else if(e.which==constants.UP_KEY){if(selected_size==0){$(constants.ADD_TRANSACTION_PAYEE_SUGGESTIONS_CLASS).eq(regular_elements_size-1).addClass(constants.ADD_TRANSACTION_SELECTED_PAYEE_SUGGESTIONS_CLASS_NAME);return;}
else{var index=$(constants.ADD_TRANSACTION_SELECTED_PAYEE_SUGGESTIONS_CLASS).index();if(index==0)
index=regular_elements_size;$(constants.ADD_TRANSACTION_PAYEE_SUGGESTIONS_CLASS).removeClass(constants.ADD_TRANSACTION_SELECTED_PAYEE_SUGGESTIONS_CLASS_NAME);$(constants.ADD_TRANSACTION_PAYEE_SUGGESTIONS_CLASS).eq(index-1).addClass(constants.ADD_TRANSACTION_SELECTED_PAYEE_SUGGESTIONS_CLASS_NAME);}}
else if(e.which==constants.ENTER_KEY){if(selected_size==0)
return;TRANSACTION.on_suggestion_payee_selected($(constants.ADD_TRANSACTION_SELECTED_PAYEE_SUGGESTIONS_CLASS),textbox,container);}};Transaction.prototype.on_add_transaction_table_add_item_button_clicked=function(){var transaction_item_length=parseInt($(constants.ADD_TRANSACTION_TABLE_ID).attr(constants.TRANSACTION_TABLE_ITEM_LENGTH_PROP));transaction_item_length++;var transaction_item_row_id=$(constants.TRANSACTION_ITEM_ROW_TEMPLATE_ID).html();var transaction_item_row_data={index:transaction_item_length};var html_maker=new htmlMaker(transaction_item_row_id);var transaction_item_row_html=html_maker.getHTML(transaction_item_row_data);$(constants.TRANSACTION_ITEM_ROW_ID+(transaction_item_length-1)).after(transaction_item_row_html);$(constants.ADD_TRANSACTION_TABLE_ID).attr(constants.TRANSACTION_TABLE_ITEM_LENGTH_PROP,transaction_item_length);var textbox=$(constants.ADD_TRANSACTION_ITEM_ID+transaction_item_length);var suggestions_container=$(constants.ADD_TRANSACTION_ITEM_SUGGESTIONS_ID+transaction_item_length);TRANSACTION.bind_item_suggestions_event(textbox,suggestions_container);TRANSACTION.bind_item_suggestions_from_payee_event(textbox,suggestions_container);TRANSACTION.bind_textbox_live_search(textbox,suggestions_container);};Transaction.prototype.on_edit_transaction_table_add_item_button_clicked=function(){var transaction_item_length=parseInt($(constants.EDIT_TRANSACTION_TABLE_ID).attr(constants.TRANSACTION_TABLE_ITEM_LENGTH_PROP));var transaction_item_row_id=$(constants.TRANSACTION_ITEM_ROW_TEMPLATE_ID).html();var transaction_item_row_data={index:transaction_item_length};var html_maker=new htmlMaker(transaction_item_row_id);var transaction_item_row_html=html_maker.getHTML(transaction_item_row_data);if(transaction_item_length==0)
$(constants.TRANSACTION_ITEMS_HEADING_ROW_ID).after(transaction_item_row_html);else if(transaction_item_length>0)
$(constants.TRANSACTION_ITEM_ROW_ID+(transaction_item_length-1)).after(transaction_item_row_html);var textbox=$(constants.ADD_TRANSACTION_ITEM_ID+transaction_item_length);var suggestions_container=$(constants.ADD_TRANSACTION_ITEM_SUGGESTIONS_ID+transaction_item_length);TRANSACTION.bind_item_suggestions_event(textbox,suggestions_container);TRANSACTION.bind_item_suggestions_from_payee_event(textbox,suggestions_container);TRANSACTION.bind_textbox_live_search(textbox,suggestions_container);transaction_item_length++;$(constants.EDIT_TRANSACTION_TABLE_ID).attr(constants.TRANSACTION_TABLE_ITEM_LENGTH_PROP,transaction_item_length);};Transaction.prototype.on_add_transaction_clicked=function(){var current_date=new Date();var payee=$(constants.ADD_TRANSACTION_PAYEE_ID).val();var formatted_date=$(constants.ADD_TRANSACTION_DATE).val();var date_object=GENERAL.get_date_object(formatted_date);var date_day=date_object.day;var date_month=date_object.month;var date_year=date_object.year;var hour_string=$(constants.ADD_TRANSACTION_HOUR_ID).val();var minute_string=$(constants.ADD_TRANSACTION_MINUTE_ID).val();var am_pm_string=$(constants.ADD_TRANSACTION_AM_PM_ID).val();var time_object=GENERAL.get_time_object(hour_string,minute_string,am_pm_string);var time_hour=time_object.hour;var time_minute=time_object.minute;var time_zone_offset=current_date.getTimezoneOffset();var account_id=$(constants.ADD_TRANSACTION_ACCOUNTS_ID).val();var item_names=[];var category_names=[];var amounts=[];var quantities=[];var indices=[];var category_type="e";var transaction_item_length=parseInt($(constants.ADD_TRANSACTION_TABLE_ID).attr(constants.TRANSACTION_TABLE_ITEM_LENGTH_PROP));for(var i=1;i<=transaction_item_length;++i){var amount=$(constants.ADD_TRANSACTION_ITEM_AMOUNT_ID+i).val();var quantity=$(constants.ADD_TRANSACTION_ITEM_QUANTITY_ID+i).val();var item_string=$(constants.ADD_TRANSACTION_ITEM_ID+i).val();var item_object=TRANSACTION.parse_item_category(item_string);var item_name=item_object.item_name;var category_name=item_object.category_name;if(amount.trim()!=""){amounts.push(amount);item_names.push(item_name);category_names.push(category_name);quantities.push(quantity);indices.push(i);}}
TRANSACTION.add_transaction(payee,date_day,date_month,date_year,time_hour,time_minute,time_zone_offset,account_id,item_names,category_names,amounts,quantities,indices,category_type);};Transaction.prototype.on_add_income_clicked=function(){var current_date=new Date();var formatted_date=$(constants.ADD_INCOME_DATE).val();var date_object=GENERAL.get_date_object(formatted_date);var date_day=date_object.day;var date_month=date_object.month;var date_year=date_object.year;var hour_string=$(constants.ADD_INCOME_HOUR_ID).val();var minute_string=$(constants.ADD_INCOME_MINUTE_ID).val();var am_pm_string=$(constants.ADD_INCOME_AM_PM_ID).val();var time_object=GENERAL.get_time_object(hour_string,minute_string,am_pm_string);var time_hour=time_object.hour;var time_minute=time_object.minute;var time_zone_offset=current_date.getTimezoneOffset();var account_id=$(constants.ADD_INCOME_ACCOUNTS_ID).val();var item_string=$(constants.ADD_INCOME_ITEM_ID).val();var item_object=TRANSACTION.parse_item_category(item_string);var item_name=item_object.item_name;var category_name=item_object.category_name;var amount=$(constants.ADD_INCOME_AMOUNT_ID).val();var category_type="i";TRANSACTION.add_income(date_day,date_month,date_year,time_hour,time_minute,time_zone_offset,account_id,item_name,category_name,amount,category_type);};Transaction.prototype.on_add_transfer_clicked=function(){var current_date=new Date();var formatted_date=$(constants.ADD_TRANSFER_DATE).val();var date_object=GENERAL.get_date_object(formatted_date);var date_day=date_object.day;var date_month=date_object.month;var date_year=date_object.year;var hour_string=$(constants.ADD_TRANSFER_HOUR_ID).val();var minute_string=$(constants.ADD_TRANSFER_MINUTE_ID).val();var am_pm_string=$(constants.ADD_TRANSFER_AM_PM_ID).val();var time_object=GENERAL.get_time_object(hour_string,minute_string,am_pm_string);var time_hour=time_object.hour;var time_minute=time_object.minute;var time_zone_offset=current_date.getTimezoneOffset();var from_account_id=$(constants.ADD_TRANSFER_FROM_ACCOUNTS_ID).val();var to_account_id=$(constants.ADD_TRANSFER_TO_ACCOUNTS_ID).val();var amount=$(constants.ADD_TRANSFER_AMOUNT_ID).val();TRANSACTION.add_transfer(date_day,date_month,date_year,time_hour,time_minute,time_zone_offset,from_account_id,to_account_id,amount);};Transaction.prototype.get_transaction_years=function(){var date=new Date();var current_month=date.getMonth()+1+"";var current_year=date.getFullYear()+"";var time_zone_offset=date.getTimezoneOffset();$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.GET_TRANSACTION_YEARS_REQUEST,"current_month":current_month,"current_year":current_year,"time_zone_offset":time_zone_offset},success:function(data){GENERAL.check_session_expired(data);if(data.length>=1){TRANSACTION.populate_combobox_years(data,$(constants.TRANSACTION_COMBO_YEAR),$(constants.TRANSACTION_COMBO_MONTH),current_year,current_month,"transaction_years");TRANSACTION.populate_combobox_years(data,$(constants.ANALYTICS_EXPENSE_YEAR_COMBOBOX_ID),$(constants.ANALYTICS_EXPENSE_MONTH_COMBOBOX_ID),current_year,current_month,"analytics_spending_years");TRANSACTION.populate_combobox_years(data,$(constants.ANALYTICS_BUDGET_YEAR_ID),$(constants.ANALYTICS_BUDGET_MONTH_ID),current_year,current_month,"analytics_budget_years");}}});};Transaction.prototype.populate_combobox_years=function(data,year_combobox,month_combobox,current_year,current_month,update){var prev_year=year_combobox.val();var transaction_years_template=$(constants.TRANSACTION_YEAR_COMBOBOX_TEMPLATE).html();var html_maker=new htmlMaker(transaction_years_template);var years_html=html_maker.getHTML(data);year_combobox.html(years_html);var prev_year_found=false;for(var i=0;i<data.length;++i){if(data[i]["year"]==prev_year)
prev_year_found=true;}
if(prev_year_found){year_combobox.val(prev_year);}
else{year_combobox.val(current_year);month_combobox.val(current_month);switch(update){case"transaction_years":TRANSACTION.get_transactions();TRANSACTION.get_monthly_transactions_overview();break;case"analytics_spending_years":ANALYTICS.get_monthly_expense();break;case"analytics_budget_years":ANALYTICS.get_user_budgets();break;}}};Transaction.prototype.add_transfer=function(date_day,date_month,date_year,time_hour,time_minute,time_zone_offset,from_account_id,to_account_id,amount){GENERAL.disable_button($(constants.ADD_TRANSFER_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_TRANSFER_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.ADD_TRANSFER_REQUEST,"date_day":date_day,"date_month":date_month,"date_year":date_year,"time_hour":time_hour,"time_minute":time_minute,"time_zone_offset":time_zone_offset,"from_account_id":from_account_id,"to_account_id":to_account_id,"amount":amount},success:function(data){GENERAL.check_session_expired(data);$(constants.REGULAR_BUTTON_LOADING_TRANSFER_IMG).hide(constants.HIDING_SPEED);TRANSACTION.add_transfer_feedback(data);}});};Transaction.prototype.edit_transfer=function(transfer_id,date_day,date_month,date_year,time_hour,time_minute,time_zone_offset,from_account_id,to_account_id,amount){GENERAL.disable_button($(constants.EDIT_TRANSFER_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.EDIT_TRANSFER_REQUEST,"transfer_id":transfer_id,"date_day":date_day,"date_month":date_month,"date_year":date_year,"time_hour":time_hour,"time_minute":time_minute,"time_zone_offset":time_zone_offset,"from_account_id":from_account_id,"to_account_id":to_account_id,"amount":amount},success:function(data){GENERAL.check_session_expired(data);GENERAL.enable_button($(constants.EDIT_TRANSFER_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.HIDING_SPEED);TRANSACTION.edit_transfer_feedback(transfer_id,data,date_month,date_year);}});};Transaction.prototype.edit_income=function(income_id,date_day,date_month,date_year,time_hour,time_minute,time_zone_offset,account_id,item_name,category_name,amount,category_type){GENERAL.disable_button($(constants.EDIT_INCOME_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.EDIT_INCOME_REQUEST,"income_id":income_id,"date_day":date_day,"date_month":date_month,"date_year":date_year,"time_hour":time_hour,"time_minute":time_minute,"time_zone_offset":time_zone_offset,"account_id":account_id,"item_name":item_name,"category_name":category_name,"amount":amount,"category_type":category_type},success:function(data){GENERAL.check_session_expired(data);GENERAL.enable_button($(constants.EDIT_INCOME_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.HIDING_SPEED);TRANSACTION.edit_income_feedback(income_id,data,date_month,date_year);}});};Transaction.prototype.add_income=function(date_day,date_month,date_year,time_hour,time_minute,time_zone_offset,account_id,item_name,category_name,amount,category_type){GENERAL.disable_button($(constants.ADD_INCOME_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_INCOME_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.ADD_INCOME_REQUEST,"date_day":date_day,"date_month":date_month,"date_year":date_year,"time_hour":time_hour,"time_minute":time_minute,"time_zone_offset":time_zone_offset,"account_id":account_id,"item_name":item_name,"category_name":category_name,"amount":amount,"category_type":category_type},success:function(data){GENERAL.check_session_expired(data);$(constants.REGULAR_BUTTON_LOADING_INCOME_IMG).hide(constants.HIDING_SPEED);TRANSACTION.add_income_feedback(data);}});};Transaction.prototype.add_transaction_item=function(transaction_id,item_name,category_name,amount,quantity){GENERAL.disable_button($(constants.ADD_TRANSACTION_ITEM_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.ADD_TRANSACTION_ITEM_REQUEST,"transaction_id":transaction_id,"item_name":item_name,"category_name":category_name,"amount":amount,"quantity":quantity},success:function(data){GENERAL.check_session_expired(data);$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.HIDING_SPEED);TRANSACTION.add_transaction_item_feedback(transaction_id,data);}});};Transaction.prototype.add_transaction=function(payee,date_day,date_month,date_year,time_hour,time_minute,time_zone_offset,account_id,item_names,category_names,amounts,quantities,indices,category_type){GENERAL.disable_button($(constants.ADD_TRANSACTION_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_TRANSACTION_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.ADD_TRANSACTION_REQUEST,"payee":payee,"date_day":date_day,"date_month":date_month,"date_year":date_year,"time_hour":time_hour,"time_minute":time_minute,"time_zone_offset":time_zone_offset,"quantities":quantities,"account_id":account_id,"item_names":item_names,"category_names":category_names,"amounts":amounts,"category_type":category_type,"indices":indices},success:function(data){GENERAL.check_session_expired(data);$(constants.REGULAR_BUTTON_LOADING_TRANSACTION_IMG).hide(constants.HIDING_SPEED);TRANSACTION.add_transaction_feedback(data);}});};Transaction.prototype.sync_with_transaction=function(){CATEGORY.get_all_categories();ACCOUNT.get_accounts();TRANSACTION.get_monthly_transactions_overview();TRANSACTION.get_transaction_years();TRANSACTION.get_payees();ANALYTICS.load();};Transaction.prototype.partial_sync_with_transaction=function(){ACCOUNT.get_accounts();TRANSACTION.get_monthly_transactions_overview();TRANSACTION.get_transaction_years();ANALYTICS.load();};Transaction.prototype.add_transaction_feedback=function(data){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data[constants.RESULT_ATTR]==constants.SUCCESS_RESPONSE){GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("A new transaction has been added successfully!");TRANSACTION.get_transaction(data[constants.TRANSACTION_ID_ATTR]);$(constants.ADD_NEW_TRANSACTION_BUTTON_ID).show();$(constants.ADD_NEW_TRANSACTION_BUTTON_ID).on("click",function(e){e.stopPropagation();TRANSACTION.on_show_add_transaction_window();});TRANSACTION.sync_with_transaction();}
else if(data[constants.RESULT_ATTR]==constants.FAIL_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);if(data[constants.ERROR_MESSAGE_ATTR].trim()==="")
$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't add the transaction");else
$(constants.WINDOW_FEEDBACK_ID).text(data[constants.ERROR_MESSAGE_ATTR]);GENERAL.enable_button($(constants.ADD_TRANSACTION_BUTTON_ID));}
var items=data["items"];for(var i=0;i<items.length;++i){GENERAL.show_feedback(items[i]);}};Transaction.prototype.delete_transfer_feedback=function(transfer_id,data){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data["result"]==constants.SUCCESS_RESPONSE){GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("The transfer has been deleted successfully!");$(constants.TRANSFER_ID+transfer_id).remove();ACCOUNT.get_accounts();}
else if(data["result"]==constants.FAIL_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't delete the transfer");}};Transaction.prototype.delete_income_feedback=function(income_id,data){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data["result"]==constants.SUCCESS_RESPONSE){GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("The income has been deleted successfully!");$(constants.INCOME_ID+income_id).remove();TRANSACTION.partial_sync_with_transaction();}
else if(data["result"]==constants.FAIL_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't delete the income");}};Transaction.prototype.delete_transaction_feedback=function(transaction_id,data){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data["result"]==constants.SUCCESS_RESPONSE){GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("The transaction has been deleted successfully!");$(constants.TRANSACTION_WRAPPER_ID+transaction_id).remove();GENERAL.disable_button($(constants.DELETE_TRANSACTION_BUTTON_ID));TRANSACTION.partial_sync_with_transaction();}
else if(data["result"]==constants.FAIL_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't delete the transaction");}};Transaction.prototype.delete_transaction_item_feedback=function(transaction_id,data){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data["result"]==constants.SUCCESS_RESPONSE){GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("The transaction item has been deleted successfully!");TRANSACTION.get_updated_transaction(transaction_id);GENERAL.disable_button($(constants.DELETE_TRANSACTION_ITEM_BUTTON_ID));TRANSACTION.partial_sync_with_transaction();}
else if(data["result"]==constants.FAIL_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't delete the transaction item");}};Transaction.prototype.edit_transaction_feedback=function(transaction_id,data,month,year){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data["result"]==constants.SUCCESS_RESPONSE){GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("A new transaction has been added successfully!");if(month==$(constants.TRANSACTION_COMBO_MONTH).val()&&year==$(constants.TRANSACTION_COMBO_YEAR).val())
TRANSACTION.get_updated_transaction(transaction_id);else
$(constants.TRANSACTION_WRAPPER_ID+transaction_id).remove();TRANSACTION.sync_with_transaction();}
else if(data["result"]==constants.FAIL_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't add the transaction");}
var items=data["items"];for(var i=0;i<items.length;++i){GENERAL.show_feedback(items[i]);}};Transaction.prototype.edit_transaction_item_feedback=function(transaction_item_id,transaction_id,data){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data["result"]==constants.SUCCESS_RESPONSE){GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("The transaction item has been edited successfully!");TRANSACTION.get_updated_transaction(transaction_id);TRANSACTION.sync_with_transaction();}
else if(data["result"]==constants.FAIL_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't edit the transaction item");}};Transaction.prototype.add_transaction_item_feedback=function(transaction_id,data){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data["result"]==constants.SUCCESS_RESPONSE){GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("A new transaction item has been added successfully!");TRANSACTION.get_transaction_item(transaction_id,data[constants.TRANSACTION_ITEM_ID_ATTR]);$(constants.ADD_NEW_TRANSACTION_ITEM_BUTTON_ID).show();$(constants.ADD_NEW_TRANSACTION_ITEM_BUTTON_ID).on("click",function(e){e.stopPropagation();TRANSACTION.on_add_transaction_item_menu_clicked(transaction_id);});TRANSACTION.sync_with_transaction();}
else if(data["result"]==constants.FAIL_RESPONSE){GENERAL.enable_button($(constants.ADD_TRANSACTION_ITEM_BUTTON_ID));$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);if(data[constants.ERROR_MESSAGE_ATTR].trim()==="")
$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't add the transaction item");else
$(constants.WINDOW_FEEDBACK_ID).text(data[constants.ERROR_MESSAGE_ATTR]);}};Transaction.prototype.edit_transfer_feedback=function(transfer_id,data,month,year){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data["result"]==constants.SUCCESS_RESPONSE){GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("The transfer has been edited successfully!");if(month==$(constants.TRANSACTION_COMBO_MONTH).val()&&year==$(constants.TRANSACTION_COMBO_YEAR).val())
TRANSACTION.get_updated_transfer(transfer_id);else
$(constants.TRANSFER_ID+transfer_id).remove();ACCOUNT.get_accounts();}
else if(data["result"]==constants.FAIL_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't edit the transfer");if(data[constants.TRANSFER_ACCOUNTS_ATTR]!=constants.VALID_RESPONSE&&data[constants.TRANSFER_ACCOUNTS_ATTR].trim()!=""){$(constants.WINDOW_FEEDBACK_ID).text(data[constants.TRANSFER_ACCOUNTS_ATTR]);}}};Transaction.prototype.edit_income_feedback=function(income_id,data,month,year){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data["result"]==constants.SUCCESS_RESPONSE){GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("The income has been edited successfully!");if(month==$(constants.TRANSACTION_COMBO_MONTH).val()&&year==$(constants.TRANSACTION_COMBO_YEAR).val())
TRANSACTION.get_updated_income(income_id);else
$(constants.INCOME_ID+income_id).remove();TRANSACTION.sync_with_transaction();}
else if(data["result"]==constants.FAIL_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't edit the income");}};Transaction.prototype.add_income_feedback=function(data){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data["result"]==constants.SUCCESS_RESPONSE){GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("The income has been added successfully!");TRANSACTION.get_income(data[constants.TRANSACTION_ID_ATTR]);$(constants.ADD_NEW_INCOME_BUTTON_ID).show();$(constants.ADD_NEW_INCOME_BUTTON_ID).on("click",function(e){e.stopPropagation();TRANSACTION.on_show_add_transaction_window();GENERAL.unchoose_tab(constants.ADD_TRANSACTION_TAB);GENERAL.choose_tab(constants.ADD_INCOME_TAB);});TRANSACTION.sync_with_transaction();}
else if(data["result"]==constants.FAIL_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);if(data[constants.ERROR_MESSAGE_ATTR].trim()==="")
$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't add the income");else
$(constants.WINDOW_FEEDBACK_ID).text(data[constants.ERROR_MESSAGE_ATTR]);GENERAL.enable_button($(constants.ADD_INCOME_BUTTON_ID));}};Transaction.prototype.add_transfer_feedback=function(data){$(constants.WINDOW_FEEDBACK_ID).css("display","block");if(data["result"]==constants.SUCCESS_RESPONSE){GENERAL.show_feedback(data);$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.SUCCESS_COLOR);$(constants.WINDOW_FEEDBACK_ID).text("The transfer has been added successfully!");TRANSACTION.get_transfer(data[constants.TRANSACTION_ID_ATTR]);$(constants.ADD_NEW_TRANSFER_BUTTON_ID).show();$(constants.ADD_NEW_TRANSFER_BUTTON_ID).on("click",function(e){e.stopPropagation();TRANSACTION.on_show_add_transaction_window();GENERAL.unchoose_tab(constants.ADD_TRANSACTION_TAB);GENERAL.choose_tab(constants.ADD_TRANSFER_TAB);});ACCOUNT.get_accounts();}
else if(data["result"]==constants.FAIL_RESPONSE){$(constants.WINDOW_FEEDBACK_ID).css("background-color",constants.FAILURE_COLOR);GENERAL.show_feedback(data);if(data[constants.ERROR_MESSAGE_ATTR].trim()==="")
$(constants.WINDOW_FEEDBACK_ID).text("The system couldn't add the transfer");else
$(constants.WINDOW_FEEDBACK_ID).text(data[constants.ERROR_MESSAGE_ATTR]);GENERAL.enable_button($(constants.ADD_TRANSFER_BUTTON_ID));}};Transaction.prototype.parse_item_category=function(text){var result={"item_name":"","category_name":""};var location_1=text.indexOf("(");var location_2=text.indexOf(")");if(location_2==-1)
location_2=text.length;if(location_1==-1){result["item_name"]=text;result["category_name"]="";}
else{result["item_name"]=text.substring(0,location_1).trim();result["category_name"]=text.substring(location_1+1,location_2).trim();}
return result;};Transaction.prototype.bind_item_suggestions_event=function(textbox,suggestions_container){textbox.on("keyup",function(e){if(e.which==constants.DOWN_KEY||e.which==constants.UP_KEY||e.which==constants.ENTER_KEY)
return;var text=textbox.val();TRANSACTION.get_item_suggestions(text,suggestions_container,textbox,"e");});};Transaction.prototype.bind_item_suggestions_from_payee_event=function(textbox,item_suggestions_container){textbox.on("focus",function(){var text=textbox.val();var payee=$(constants.ADD_TRANSACTION_PAYEE_ID).val();if(text.trim()=="")
TRANSACTION.get_item_suggestions_from_payee(payee,item_suggestions_container,textbox)});};Transaction.prototype.get_payee_suggestions=function(payee,payee_suggestions_container,textbox){if(payee.trim()=="")
return;var result=[];var payees=TRANSACTION.PAYEES;for(var i=0;i<payees.length;++i){var payee_name=payees[i][constants.PAYEE_NAME_SUGGESTION_PROP];var rank=TRANSACTION.rank_payee_suggestions(payee_name,payee);var payee_found=payees[i][constants.PAYEE_NAME_SUGGESTION_PROP].trim().toLowerCase().includes(payee.trim().toLowerCase());if(payee_found)
result.push({"payee_name":payees[i][constants.PAYEE_NAME_SUGGESTION_PROP],"rank":rank});}
result.sort(TRANSACTION.compare_payee_suggestions);result=result.splice(0,5);TRANSACTION.display_payee_suggestions(result,payee_suggestions_container,payee,textbox);};Transaction.prototype.compare_payee_suggestions=function(a,b){var attr="rank";if(a[attr]==b[attr])
return 0
if(a[attr]>b[attr])
return 1;else
return-1;};Transaction.prototype.rank_payee_suggestions=function(payee_name,payee_match){var payee_empty=payee_match.trim()==""||payee_name.trim()=="";var payee_equals=payee_empty?false:payee_name.toLowerCase().trim()==payee_match.toLowerCase().trim();var payee_starts_with=payee_empty?false:payee_name.toLowerCase().trim().startsWith(payee_match.toLowerCase().trim())&&!payee_equals;var payee_includes=payee_empty?false:payee_name.toLowerCase().trim().includes(payee_match.toLowerCase().trim())&&!payee_starts_with&&!payee_equals;var payee_ends_with=payee_empty?false:payee_name.toLowerCase().trim().endsWith(payee_match.toLowerCase().trim())&&!payee_starts_with;if(payee_equals)
return 1;else if(payee_starts_with)
return 2;else if(payee_includes)
return 3;else if(payee_ends_with)
return 4;else
return 5;};Transaction.prototype.get_payees=function(){$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.GET_PAYEES},success:function(data){GENERAL.check_session_expired(data);TRANSACTION.PAYEES=data;}});};Transaction.prototype.get_item_suggestions_from_payee=function(payee,item_suggestions_container,textbox){$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.GET_ITEM_SUGGESTIONS_FROM_PAYEE_REQUEST,"payee":payee},success:function(data){GENERAL.check_session_expired(data);TRANSACTION.display_item_suggestions(data,item_suggestions_container,payee,textbox);}});};Transaction.prototype.get_item_suggestions=function(text,item_suggestions_container,textbox,item_type){var categories=item_type==constants.EXPENSE_TYPE?CATEGORY.ALL_EXPENSE_CATEGORIES:CATEGORY.ALL_INCOME_CATEGORIES;var item_category_name=TRANSACTION.parse_item_category(text);var category_name=item_category_name[constants.CATEGORY_NAME_SUGGESTION_PROP];var item_name=item_category_name["item_name"];if(category_name.trim()=="")
category_name=item_name;else if(item_name.trim()=="")
item_name=category_name;var item_found=false;var category_found=false;var result=[];var rank=100;for(var i=0;i<categories.length;++i){item_found=false;var items=categories[i]["items"];var category_color=categories[i]["category_color"];var category_title=categories[i]["category_title"];rank=TRANSACTION.rank_item_suggestions("",category_title,item_name,category_name);category_found=category_name.trim()!=""?category_title.toLowerCase().trim().includes(category_name.toLowerCase().trim()):false;if(items.length==0&&category_found)
result.push({"category_name":category_title,"category_color":category_color,"item_name":category_title,"rank":rank});for(var j=0;j<items.length;++j){var item_title=items[j]["item_name"];if(item_name.trim()!=""&&item_title.toLowerCase().trim().includes(item_name.toLowerCase().trim()))
item_found=true;if(category_found||item_found){rank=TRANSACTION.rank_item_suggestions(item_title,category_title,item_name,category_name);result.push({"category_name":category_title,"category_color":category_color,"item_name":item_title,"rank":rank});}}
if(!item_found&&category_found){rank=TRANSACTION.rank_item_suggestions(item_name,category_title,item_name,category_name);result.push({"category_name":category_title,"category_color":category_color,"item_name":item_name,"rank":rank});}}
result.sort(TRANSACTION.sort_item_suggestions_based_on_rank);result=result.splice(0,5);TRANSACTION.display_item_suggestions(result,item_suggestions_container,text,textbox);};Transaction.prototype.sort_item_suggestions_based_on_rank=function(a,b){var attr="rank";if(a[attr]==b[attr])
return 0
if(a[attr]>b[attr])
return 1;else
return-1;};Transaction.prototype.rank_item_suggestions=function(item_name,category_name,item_match,category_match){var item_empty=item_match.trim()==""||item_name.trim()=="";var category_empty=category_match.trim()==""||category_name.trim()=="";var item_equals=item_empty?false:item_name.toLowerCase().trim()==item_match.toLowerCase().trim();var item_starts_with=item_empty?false:item_name.toLowerCase().trim().startsWith(item_match.toLowerCase().trim())&&!item_equals;var item_includes=item_empty?false:item_name.toLowerCase().trim().includes(item_match.toLowerCase().trim())&&!item_starts_with&&!item_equals;var item_ends_with=item_empty?false:item_name.toLowerCase().trim().endsWith(item_match.toLowerCase().trim())&&!item_starts_with;var category_equals=category_empty?false:category_name.toLowerCase().trim()==category_match.toLowerCase().trim();var category_starts_with=category_empty?false:category_name.toLowerCase().trim().startsWith(category_match.toLowerCase().trim())&&!category_equals;var category_includes=category_empty?false:category_name.toLowerCase().trim().includes(category_match.toLowerCase().trim())&&!category_starts_with;var category_ends_with=category_empty?false:category_name.toLowerCase().trim().endsWith(category_match.toLowerCase().trim())&&!category_starts_with;if(item_equals&&category_equals)
return 1;else if(item_equals&&category_starts_with)
return 2;else if(item_equals&&category_includes)
return 3;else if(item_equals&&category_ends_with)
return 4;else if(item_equals)
return 5;else if(item_starts_with&&category_equals)
return 6;else if(item_starts_with&&category_starts_with)
return 7;else if(item_starts_with&&category_includes)
return 8;else if(item_starts_with&&category_ends_with)
return 9;else if(item_starts_with)
return 10;else if(item_includes&&category_equals)
return 11;else if(item_includes&&category_starts_with)
return 12;else if(item_includes&&category_includes)
return 13;else if(item_includes&&category_ends_with)
return 14;else if(item_includes)
return 15;else if(item_ends_with&&category_equals)
return 16;else if(item_ends_with&&category_starts_with)
return 17;else if(item_ends_with&&category_includes)
return 18;else if(item_ends_with&&category_ends_with)
return 19;else if(item_ends_with)
return 20;else if(category_equals)
return 21;else if(category_starts_with)
return 22;else if(category_includes)
return 23;else if(category_ends_with)
return 24;else
return 25;};Transaction.prototype.display_payee_suggestions=function(data,container,payee_name,textbox){TRANSACTION.selected_payee_suggestion_index=-1;$(constants.PAYEE_SUGGESTIONS_CLASS).hide();$(constants.PAYEE_SUGGESTIONS_CLASS).html("");if(data.length==0)
return;for(var i=0;i<data.length;++i){data[i][constants.FORMATTED_PAYEE_NAME_SUGGESTION_PROP]=GENERAL.highlight(data[i][constants.PAYEE_NAME_SUGGESTION_PROP],payee_name);}
var template=$(constants.PAYEE_SUGGESTION_TEMPLATE).html();var html_maker=new htmlMaker(template);var html=html_maker.getHTML(data);container.html(html);container.show();$(constants.ADD_TRANSACTION_PAYEE_SUGGESTIONS_CLASS).on("click",function(e){e.stopPropagation();TRANSACTION.on_suggestion_payee_selected($(this),textbox,container);});$(".window").on("click",function(){container.hide();container.html("");});};Transaction.prototype.display_item_suggestions=function(data,container,match,textbox){var item_object=TRANSACTION.parse_item_category(match);var item_name=item_object.item_name;var category_name=item_object.category_name;TRANSACTION.selected_transaction_item_suggestion_index=-1;$(constants.ITEM_SUGGESTIONS_CLASS).hide();$(constants.ITEM_SUGGESTIONS_CLASS).html("");if(data.length==0)
return;for(var i=0;i<data.length;++i){data[i][constants.FORMATTED_ITEM_NAME_SUGGESTION_PROP]=GENERAL.highlight(data[i][constants.ITEM_NAME_SUGGESTION_PROP],item_name);data[i][constants.FORMATTED_CATEGORY_NAME_SUGGESTION_PROP]=GENERAL.highlight(data[i][constants.CATEGORY_NAME_SUGGESTION_PROP],category_name);}
var template=$(constants.ITEM_SUGGESTION_TEMPLATE).html();var html_maker=new htmlMaker(template);var html=html_maker.getHTML(data);container.html(html);container.show();$(constants.ADD_TRANSACTION_ITEM_SUGGESTIONS_CLASS).on("click",function(e){e.stopPropagation();TRANSACTION.on_suggestion_item_selected($(this),textbox,container);});$(".window").on("click",function(){container.hide();container.html("");});};Transaction.prototype.on_suggestion_payee_selected=function(suggestion_item,textbox,container){var payee_name=suggestion_item.attr(constants.PAYEE_NAME_SUGGESTION_ATTR);textbox.val(payee_name);container.hide();container.html("");};Transaction.prototype.on_suggestion_item_selected=function(suggestion_item,textbox,container){var item_name=suggestion_item.attr(constants.ITEM_NAME_SUGGESTION_ATTR);var category_name=suggestion_item.attr(constants.CATEGORY_NAME_SUGGESTION_ATTR);textbox.val(item_name+" ("+category_name+")");container.hide();container.html("");};Transaction.prototype.get_transaction_item=function(transaction_id,id){$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.GET_TRANSACTION_ITEM_REQUEST,"transaction_id":transaction_id,"id":id},success:function(data){GENERAL.check_session_expired(data);if(data.length>0){TRANSACTION.display_transaction_item(transaction_id,data[0]);TRANSACTION.update_transaction_amount(transaction_id,data[0][constants.FORMATTED_TOTAL_AMOUNT_PROP],data[0][constants.TOTAL_AMOUNT_PROP]);TRANSACTION.show_items(transaction_id);}}});};Transaction.prototype.get_updated_transaction_item=function(transaction_id,id){$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.GET_TRANSACTION_ITEM_REQUEST,"transaction_id":transaction_id,"id":id},success:function(data){GENERAL.check_session_expired(data);if(data.length>0){TRANSACTION.display_updated_transaction_item(transaction_id,data[0]);TRANSACTION.update_transaction_amount(transaction_id,data[0][constants.FORMATTED_TOTAL_AMOUNT_PROP],data[0][constants.TOTAL_AMOUNT_PROP]);TRANSACTION.show_items(transaction_id);}}});};Transaction.prototype.get_updated_transaction=function(id){var current_date=new Date();var time_zone_offset=current_date.getTimezoneOffset();$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.GET_TRANSACTION_REQUEST,"time_zone_offset":time_zone_offset,"id":id,"month":$(constants.TRANSACTION_COMBO_MONTH).val(),"year":$(constants.TRANSACTION_COMBO_YEAR).val(),"transaction_type":constants.THE_TRANSACTION_TYPE,"transaction_account":$(constants.TRANSACTION_ACCOUNT_ID).val()},success:function(data){GENERAL.check_session_expired(data);if(data.length>0){TRANSACTION.update_transaction_info(id,data[0],data[0][constants.TRANSACTION_ITEMS_ATTR]);}}});};Transaction.prototype.get_updated_transaction_show_items=function(id){var current_date=new Date();var time_zone_offset=current_date.getTimezoneOffset();$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.GET_TRANSACTION_REQUEST,"time_zone_offset":time_zone_offset,"id":id,"month":$(constants.TRANSACTION_COMBO_MONTH).val(),"year":$(constants.TRANSACTION_COMBO_YEAR).val(),"transaction_type":constants.THE_TRANSACTION_TYPE},success:function(data){GENERAL.check_session_expired(data);if(data.length>0){TRANSACTION.update_transaction_info_show_items(id,data[0],data[0][constants.TRANSACTION_ITEMS_ATTR]);}}});};Transaction.prototype.get_transaction=function(id){var current_date=new Date();var time_zone_offset=current_date.getTimezoneOffset();$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.GET_TRANSACTION_REQUEST,"time_zone_offset":time_zone_offset,"id":id,"month":$(constants.TRANSACTION_COMBO_MONTH).val(),"year":$(constants.TRANSACTION_COMBO_YEAR).val(),"transaction_type":constants.THE_TRANSACTION_TYPE,"transaction_account":$(constants.TRANSACTION_ACCOUNT_ID).val()},success:function(data){GENERAL.check_session_expired(data);if(data.length>0){TRANSACTION.display_transaction(data[0]);TRANSACTION.display_transaction_items(data[0][constants.TRANSACTION_ID_ATTR],data[0][constants.TRANSACTION_ITEMS_ATTR]);}}});};Transaction.prototype.get_income=function(id){var current_date=new Date();var time_zone_offset=current_date.getTimezoneOffset();$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.GET_TRANSACTION_REQUEST,"time_zone_offset":time_zone_offset,"id":id,"month":$(constants.TRANSACTION_COMBO_MONTH).val(),"year":$(constants.TRANSACTION_COMBO_YEAR).val(),"transaction_type":constants.THE_INCOME_TYPE,"transaction_account":$(constants.TRANSACTION_ACCOUNT_ID).val()},success:function(data){GENERAL.check_session_expired(data);if(data.length>0){TRANSACTION.display_income(data[0]);}}});};Transaction.prototype.get_updated_transfer=function(id){var current_date=new Date();var time_zone_offset=current_date.getTimezoneOffset();$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.GET_TRANSACTION_REQUEST,"time_zone_offset":time_zone_offset,"id":id,"month":$(constants.TRANSACTION_COMBO_MONTH).val(),"year":$(constants.TRANSACTION_COMBO_YEAR).val(),"transaction_type":constants.THE_TRANSFER_TYPE},success:function(data){GENERAL.check_session_expired(data);if(data.length>0){TRANSACTION.update_transfer_info(id,data[0]);}}});};Transaction.prototype.get_updated_income=function(id){var current_date=new Date();var time_zone_offset=current_date.getTimezoneOffset();$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.GET_TRANSACTION_REQUEST,"time_zone_offset":time_zone_offset,"id":id,"month":$(constants.TRANSACTION_COMBO_MONTH).val(),"year":$(constants.TRANSACTION_COMBO_YEAR).val(),"transaction_type":constants.THE_INCOME_TYPE},success:function(data){GENERAL.check_session_expired(data);if(data.length>0){TRANSACTION.update_income_info(id,data[0]);}}});};Transaction.prototype.get_transfer=function(id){var current_date=new Date();var time_zone_offset=current_date.getTimezoneOffset();$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.GET_TRANSACTION_REQUEST,"time_zone_offset":time_zone_offset,"id":id,"month":$(constants.TRANSACTION_COMBO_MONTH).val(),"year":$(constants.TRANSACTION_COMBO_YEAR).val(),"transaction_type":constants.THE_TRANSFER_TYPE,"transaction_account":$(constants.TRANSACTION_ACCOUNT_ID).val()},success:function(data){GENERAL.check_session_expired(data);if(data.length>0){TRANSACTION.display_transfer(data[0]);}}});};Transaction.prototype.get_transactions=function(){$(constants.MONTHLY_TRANSACTION_LIST_MONTH).hide();$(constants.TRANSACTION_LOADING_ICON).show();$(constants.TRANSACTIONS_DIV).hide();var current_date=new Date();var time_zone_offset=current_date.getTimezoneOffset();$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.GET_TRANSACTIONS_REQUEST,"month":$(constants.TRANSACTION_COMBO_MONTH).val(),"year":$(constants.TRANSACTION_COMBO_YEAR).val(),"transaction_type":$(constants.TRANSACTION_COMBO_TYPE).val(),"time_zone_offset":time_zone_offset,"transaction_account":$(constants.TRANSACTION_ACCOUNT_ID).val()},success:function(data){GENERAL.check_session_expired(data);$(constants.TRANSACTION_LOADING_ICON).hide();$(constants.TRANSACTIONS_DIV).show();$(constants.TRANSACTIONS_DIV).html("");TRANSACTION.display_transactions(data);}});};Transaction.prototype.get_monthly_transactions_overview=function(){$(constants.TRANSACTION_OVERVIEW_LOADING_ICON).show();$(constants.MONTHLY_TRANSACTIONS_OVERVIEW_ID).hide();var current_date=new Date();var time_zone_offset=current_date.getTimezoneOffset();var start_month=$(constants.TRANSACTION_COMBO_MONTH).val();var start_year=$(constants.TRANSACTION_COMBO_YEAR).val();var account_id=$(constants.TRANSACTION_ACCOUNT_ID).val();$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.ANALYTICS_GET_MONTHLY_TRANSACTIONS_OVERVIEW_REQUEST,start_month:start_month,start_year:start_year,time_zone_offset:time_zone_offset,account_id:account_id},success:function(data){GENERAL.check_session_expired(data);$(constants.TRANSACTION_OVERVIEW_LOADING_ICON).hide();$(constants.MONTHLY_TRANSACTIONS_OVERVIEW_ID).show();TRANSACTION.transaction_overview_data=data;TRANSACTION.show_monthly_transaction_overview();GENERAL.check_session_expired(data);}});};Transaction.prototype.show_monthly_transaction_overview=function(){var date=new Date();var day=date.getDate();var month=date.getMonth()+1;var year=date.getFullYear();var screen_width=$(document).width();var small_screen=screen_width<450;var data=[];if(TRANSACTION.transaction_overview_data!=null)
data=TRANSACTION.transaction_overview_data;else
return;var max_amount=0;var savings=0;var overspending=0;if(data.length>0){max_amount=parseFloat(data[0][constants.ANALYTICS_MONTHLY_EXPENSE_MAX_AMOUNT_ATTR]);savings=parseFloat(data[0][constants.INCOME_SPENDING_SAVINGS_ATTR]);overspending=parseFloat(data[0][constants.TRANSACTION_OVERSPENDING_ATTR]);}
var single_transaction_bar_overview_template=$(constants.ANALYTICS_SINGLE_TRANSACTION_BAR_OVERVIEW_TEMPLATE_ID).html();var transaction_overview_today_pointer_template=$(constants.ANALYTICS_TRANSACTION_OVERVIEW_TODAY_POINTER_TEMPLATE).html();var html_maker=new htmlMaker(single_transaction_bar_overview_template);var html=html_maker.getHTML(data);$(constants.MONTHLY_TRANSACTIONS_OVERVIEW_ID).html(html);$(constants.MONTHLY_TRANSACTIONS_OVERVIEW_ID).prepend(transaction_overview_today_pointer_template);var pointer_width=parseInt($(constants.TRANSACTION_OVERVIEW_TODAY_POINTER).css("width"));$(constants.TRANSACTION_OVERVIEW_TODAY_POINTER).hide();for(var i=0;i<data.length;++i){var today=parseInt(data[i][constants.TRANSACTION_YEAR_ATTR])==year&&parseInt(data[i][constants.TRANSACTION_MONTH_ATTR])==month&&parseInt(data[i][constants.TRANSACTION_DAY_ATTR])==day;var transaction_overview_callout_template=$(constants.ANALYTICS_TRANSACTION_OVERVIEW_CALLOUT_TEMPLATE).html();html_maker=new htmlMaker(transaction_overview_callout_template);html=html_maker.getHTML(data[i][constants.ANALYTICS_TRANSACTION_OVERVIEW_TRANSACTION_ITEMS_ATTR]);$(html).insertAfter(constants.ANALYTICS_TRANSACTION_OVERVIEW_TABLE_HEADING_ID+i);var converted_amount=parseFloat(data[i][constants.ANALYTICS_MONTHLY_EXPENSE_CONVERTED_AMOUNT_ATTR]);if(converted_amount>0){var bar_length=converted_amount/max_amount*constants.MONTHLY_TRANSACTIONS_OVERVIEW_BAR_MAX_LENGTH;$(constants.MONTHLY_TRANSACTION_BAR_OVERVIEW_BAR_ID+i).css("height",bar_length+"px");}
else
$(constants.MONTHLY_TRANSACTION_BAR_OVERVIEW_BAR_ID+i).css("opacity","0.4");var bar_width=parseInt($(constants.MONTHLY_TRANSACTION_BAR_OVERVIEW_BAR_BACKGROUND_ID+i).css("width"));$(constants.MONTHLY_TRANSACTION_BAR_OVERVIEW_BAR_BACKGROUND_ID+i).css("left",2*bar_width*i+"px");if(today){var addition=(bar_width+2-pointer_width)/2;$(constants.TRANSACTION_OVERVIEW_TODAY_POINTER).show();$(constants.TRANSACTION_OVERVIEW_TODAY_POINTER).css("left",addition+2*bar_width*i+"px");}
$(constants.MONTHLY_TRANSACTION_BAR_OVERVIEW_BAR_BACKGROUND_ID+i).css("height",constants.MONTHLY_TRANSACTIONS_OVERVIEW_BAR_MAX_LENGTH+"px");if(i==0||i==14||i==data.length-1||(!small_screen&&(i==4||i==9||i==19||i==24))){$(constants.MONTHLY_TRANSACTION_BAR_OVERVIEW_LABEL_ID+i).show();$(constants.MONTHLY_TRANSACTION_BAR_OVERVIEW_LABEL_ID+i).css("left",2*bar_width*i+"px");$(constants.MONTHLY_TRANSACTION_BAR_OVERVIEW_LABEL_ID+i).text(i+1);}
else
$(constants.MONTHLY_TRANSACTION_BAR_OVERVIEW_LABEL_ID+i).hide();}
var single_transaction_bar_line_overview_template=$(constants.ANALYTICS_SINGLE_TRANSACTION_BAR_LINE_OVERVIEW_TEMPLATE_ID).html();$(constants.MONTHLY_TRANSACTIONS_OVERVIEW_ID).append(single_transaction_bar_line_overview_template);$(constants.MONTHLY_TRANSACTION_BAR_OVERVIEW_LINE_ID).css("width",2*bar_width*i+"px");var transaction_spending_income_table_template=$(constants.TRANSACTION_SPENDING_INCOME_TABLE_TEMPLATE).html();if(data.length>0){html_maker=new htmlMaker(transaction_spending_income_table_template);html=html_maker.getHTML(data[0]);$(constants.MONTHLY_TRANSACTIONS_OVERVIEW_ID).append(html);if(savings>0){$(constants.SPENDING_INCOME_TABLE_SAVINGS_ROW_ID).show();$(constants.SPENDING_INCOME_TABLE_OVERSPENDING_ROW_ID).hide();}
else{$(constants.SPENDING_INCOME_TABLE_SAVINGS_ROW_ID).hide();}
if(overspending==0)
$(constants.SPENDING_INCOME_TABLE_OVERSPENDING_ROW_ID).hide();}};Transaction.prototype.populate_transaction_account_filter=function(){var account_combobox_template=$(constants.ACCOUNTS_FILTER_COMBOBOX_TEMPLATE).html();var html_maker=new htmlMaker(account_combobox_template);var accounts_html=html_maker.getHTML(TRANSACTION.user_accounts);$(constants.TRANSACTION_ACCOUNT_ID).html("<option value='all'>All</option>");$(constants.TRANSACTION_ACCOUNT_ID).append(accounts_html);};Transaction.prototype.get_user_accounts=function(){$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.GET_USER_ACCOUNTS_REQUEST},success:function(data){GENERAL.check_session_expired(data);TRANSACTION.user_accounts=data;GENERAL.enable_main_button($(constants.SHOW_ADD_TRANSACTION_BUTTON_ID));TRANSACTION.populate_transaction_account_filter();ANALYTICS.populate_account_filters();}});};Transaction.prototype.display_transactions=function(data){if(data.length>2)
data.sort(TRANSACTION.compare_transactions);var start_month=$(constants.TRANSACTION_COMBO_MONTH).find('option:selected').text();var start_year=$(constants.TRANSACTION_COMBO_YEAR).val();$(constants.MONTHLY_TRANSACTIONS_TITLE_ID).text(start_month+" "+start_year);if(data.length>=1){$(constants.MONTHLY_TRANSACTION_LIST_MONTH).hide();}
else{$(constants.MONTHLY_TRANSACTION_LIST_MONTH).show();}
for(var i=data.length-1;i>=0;--i){if(data[i][constants.TRANSACTIONS_TYPE]==constants.TRANSACTION_TYPE){TRANSACTION.display_transaction(data[i]);TRANSACTION.display_transaction_items(data[i][constants.TRANSACTION_ID_ATTR],data[i][constants.TRANSACTION_ITEMS_ATTR]);}
else if(data[i][constants.TRANSACTIONS_TYPE]==constants.TRANSFER_TYPE){TRANSACTION.display_transfer(data[i]);}
else if(data[i][constants.TRANSACTIONS_TYPE]==constants.INCOME_TRANSACTION_TYPE){TRANSACTION.display_income(data[i]);}}
GENERAL.set_bottom_margin_div($(constants.TRANSACTIONS_DIV));};Transaction.prototype.compare_transactions=function(a,b){var attr=constants.TRANSACTION_DATE_ATTR;if(a[attr]==b[attr])
return 0
if(a[attr]<b[attr])
return 1;else
return-1;};Transaction.prototype.display_transaction=function(row){$(constants.MONTHLY_TRANSACTION_LIST_MONTH).hide();var template=$(constants.TRANSACTION_TEMPLATE).html();var html_maker=new htmlMaker(template);var html=html_maker.getHTML(row);$(constants.TRANSACTIONS_DIV).prepend(html);var transaction_id=row[constants.TRANSACTION_ID_ATTR];var amount=parseFloat(row[constants.AMOUNT_PROP]);if(amount==0){$(constants.TRANSACTION_ARROW_ID+transaction_id).hide();$(constants.TRANSACTION_ICON_ID+transaction_id).hide();}
TRANSACTION.bind_transaction_events(transaction_id);};Transaction.prototype.bind_transaction_events=function(transaction_id){$(constants.TRANSACTION_ID+transaction_id).on("click",function(e){e.stopPropagation();TRANSACTION.hide_show_items(transaction_id);TRANSACTION.hide_everything();});$(constants.TRANSACTION_WRAPPER_ID+transaction_id).on("click",function(e){e.stopPropagation();TRANSACTION.hide_everything();});$(constants.TRANSACTIONS_WRAPPER).on("click",function(e){e.stopPropagation();TRANSACTION.hide_everything();});$(constants.TRANSACTION_SETTING_GEAR_ID+transaction_id).on("click",function(e){e.stopPropagation();var display=$(constants.TRANSACTION_SETTING_MENU_ID+transaction_id).css("display");if(display=="none"){TRANSACTION.hide_everything();$(constants.TRANSACTION_SETTING_MENU_ID+transaction_id).show(constants.SHOWING_SPEED);$(constants.TRANSACTION_SETTING_GEAR_ID+transaction_id).css("background-color",constants.SETTINGS_PRESSED_COLOR);TRANSACTION.VISIBLE_TRANSACTION_MENU_ID=transaction_id;}
else{$(constants.TRANSACTION_SETTING_MENU_ID+transaction_id).hide(constants.HIDING_SPEED);$(constants.TRANSACTION_SETTING_GEAR_ID+transaction_id).css("background-color",constants.SETTINGS_UNPRESSED_COLOR);TRANSACTION.VISIBLE_TRANSACTION_MENU_ID="";}});$(constants.ADD_TRANSACTION_ITEM_MENU_ITEM_ID+transaction_id).on("click",function(e){e.stopPropagation();TRANSACTION.on_add_transaction_item_menu_clicked(transaction_id);});$(constants.EDIT_TRANSACTION_ITEM_MENU_ITEM_ID+transaction_id).on("click",function(e){e.stopPropagation();TRANSACTION.on_edit_transaction_item_menu_clicked(transaction_id);});$(constants.DELETE_TRANSACTION_ITEM_MENU_ITEM_ID+transaction_id).on("click",function(e){e.stopPropagation();TRANSACTION.bind_show_delete_transaction_window(transaction_id);});};Transaction.prototype.bind_show_delete_transaction_window=function(transaction_id){TRANSACTION.hide_everything();var window_template=$(constants.DELETE_TRANSACTION_WINDOW_TEMPLATE_ID).html();$(constants.WINDOW_ID).html(window_template);$(constants.WINDOW_ID).css("display","inline-block");GENERAL.delete_window_events();$(constants.DELETE_TRANSACTION_BUTTON_ID).on("click",function(e){e.stopPropagation();TRANSACTION.delete_transaction(transaction_id);});};Transaction.prototype.on_edit_transaction_item_menu_clicked=function(transaction_id){var window_template=$(constants.EDIT_TRANSACTION_WINDOW_TEMPLATE_ID).html();var html_maker=new htmlMaker(window_template);var year_string=$(constants.EDIT_TRANSACTION_ITEM_MENU_ITEM_ID+transaction_id).attr(constants.YEAR_PROP);var month_string=$(constants.EDIT_TRANSACTION_ITEM_MENU_ITEM_ID+transaction_id).attr(constants.MONTH_PROP);var day_string=$(constants.EDIT_TRANSACTION_ITEM_MENU_ITEM_ID+transaction_id).attr(constants.DAY_PROP);var hour_string=$(constants.EDIT_TRANSACTION_ITEM_MENU_ITEM_ID+transaction_id).attr(constants.HOUR_PROP);var minute_string=$(constants.EDIT_TRANSACTION_ITEM_MENU_ITEM_ID+transaction_id).attr(constants.MINUTE_PROP);var date_object=GENERAL.get_date(year_string,month_string,day_string,hour_string,minute_string);var payee=$(constants.EDIT_TRANSACTION_ITEM_MENU_ITEM_ID+transaction_id).attr(constants.EDIT_TRANSACTION_PAYEE_PROP);var formatted_date=GENERAL.format_date(date_object);var account_id=$(constants.EDIT_TRANSACTION_ITEM_MENU_ITEM_ID+transaction_id).attr(constants.EDIT_TRANSACTION_ACCOUNT_ID_PROP);var transaction_items=JSON.parse($(constants.EDIT_TRANSACTION_ITEM_MENU_ITEM_ID+transaction_id).attr(constants.EDIT_TRANSACTION_TRANSACTION_ITEMS_PROP));var data={payee:payee,date:formatted_date,transaction_items:transaction_items};var html=html_maker.getHTML(data);$(constants.WINDOW_ID).html(html);var transaction_item_length=transaction_items.length;$(constants.EDIT_TRANSACTION_TABLE_ID).attr(constants.TRANSACTION_TABLE_ITEM_LENGTH_PROP,transaction_item_length);var help_topic_names=[constants.HELP_TOPIC_PAYEE,constants.HELP_TOPIC_ACCOUNT,constants.HELP_TOPIC_TRANSACTION_ITEMS];GENERAL.set_help_tooltip_text(help_topic_names);if(transaction_item_length==0){TRANSACTION.on_edit_transaction_table_add_item_button_clicked();}
$(constants.EDIT_TRANSACTION_BUTTON_ID).attr(constants.EDIT_TRANSACTION_TRANSACTION_ITEMS_NUM_PROP,transaction_items.length);for(var i=0;i<transaction_item_length;++i){var item_name=GENERAL.decode_string(transaction_items[i][constants.ITEM_NAME_SUGGESTION_PROP]);var category_name=GENERAL.decode_string(transaction_items[i][constants.CATEGORY_NAME_SUGGESTION_PROP]);var amount=transaction_items[i][constants.AMOUNT_PROP];var qty=transaction_items[i][constants.TRANSACTION_ITEM_QUANTITY_ATTR];var id=transaction_items[i][constants.TRANSACTION_ITEM_ID_ATTR];var textbox=$(constants.TRANSACTION_ITEM_ID+i);textbox.val(item_name+" ("+category_name+")");textbox.attr(constants.TRANSACTION_ITEM_ID_PROP,id);$(constants.ADD_TRANSACTION_ITEM_AMOUNT_ID+i).val(amount);$(constants.ADD_TRANSACTION_ITEM_QUANTITY_ID+i).val(qty);var suggestions_container=$(constants.ADD_TRANSACTION_ITEM_SUGGESTIONS_ID+i);TRANSACTION.bind_item_suggestions_event(textbox,suggestions_container);TRANSACTION.bind_item_suggestions_from_payee_event(textbox,suggestions_container);TRANSACTION.bind_textbox_live_search(textbox,suggestions_container);}
$(constants.ADD_TRANSACTION_PAYEE_ID).on("keydown",function(e){var textbox=$(constants.ADD_TRANSACTION_PAYEE_ID);var container=$(constants.PAYEE_SUGGESTIONS_ID);TRANSACTION.on_live_search_payee_textbox_down_arrow_typed(e,textbox,container);});$(constants.ADD_TRANSACTION_PAYEE_ID).on("keyup",function(e){if(e.which==constants.DOWN_KEY||e.which==constants.UP_KEY||e.which==constants.ENTER_KEY)
return;var textbox=$(constants.ADD_TRANSACTION_PAYEE_ID);var text=textbox.val();var suggestions_container=$(constants.PAYEE_SUGGESTIONS_ID);TRANSACTION.get_payee_suggestions(text,suggestions_container,textbox);});$(constants.ADD_TRANSACTION_HOUR_ID).val(GENERAL.get_hours(date_object));$(constants.ADD_TRANSACTION_MINUTE_ID).val(GENERAL.get_minutes(date_object));$(constants.ADD_TRANSACTION_AM_PM_ID).val(GENERAL.get_am_pm(date_object));var account_combobox_template=$(constants.ACCOUNTS_COMBOBOX_TEMPLATE).html();var html_maker=new htmlMaker(account_combobox_template);var accounts_html=html_maker.getHTML(TRANSACTION.user_accounts);$(constants.ADD_TRANSACTION_ACCOUNTS_ID).html(accounts_html);$(constants.ADD_TRANSACTION_ACCOUNTS_ID).val(account_id);var add_transaction_datepicker_wrapper=$(constants.ADD_TRANSACTION_DATE_WRAPPER_ID);DATEPICKER.generate_calendar(date_object,add_transaction_datepicker_wrapper,constants.ADD_TRANSACTION_CALENDAR_ID,$(constants.ADD_TRANSACTION_DATE),date_object);$(constants.WINDOW_ID).css("display","inline-block");GENERAL.regular_window_events();$(constants.EDIT_TRANSACTION_TABLE_ADD_ITEM_BUTTON_ID).on("click",function(e){e.stopPropagation();TRANSACTION.on_edit_transaction_table_add_item_button_clicked();});$(constants.EDIT_TRANSACTION_BUTTON_ID).on("click",function(e){e.stopPropagation();var payee=$(constants.ADD_TRANSACTION_PAYEE_ID).val();var formatted_date=$(constants.ADD_TRANSACTION_DATE).val();var date_object=GENERAL.get_date_object(formatted_date);var day=date_object.day;var month=date_object.month;var year=date_object.year;var hour_string=$(constants.ADD_TRANSACTION_HOUR_ID).val();var minute_string=$(constants.ADD_TRANSACTION_MINUTE_ID).val();var am_pm_string=$(constants.ADD_TRANSACTION_AM_PM_ID).val();var time_object=GENERAL.get_time_object(hour_string,minute_string,am_pm_string);var hour=time_object.hour;var minute=time_object.minute;var current_date=new Date();var time_zone_offset=current_date.getTimezoneOffset();var account_id=$(constants.ADD_TRANSACTION_ACCOUNTS_ID).val();var category_type="e";var item_names=[];var category_names=[];var amounts=[];var quantities=[];var transaction_item_ids=[];var indices=[];var transaction_item_length=parseInt($(constants.EDIT_TRANSACTION_TABLE_ID).attr(constants.TRANSACTION_TABLE_ITEM_LENGTH_PROP));for(var i=0;i<transaction_item_length;++i){var amount=$(constants.ADD_TRANSACTION_ITEM_AMOUNT_ID+i).val();var quantity=$(constants.ADD_TRANSACTION_ITEM_QUANTITY_ID+i).val();var item_string=$(constants.ADD_TRANSACTION_ITEM_ID+i).val();var item_object=TRANSACTION.parse_item_category(item_string);var item_name=item_object.item_name;var category_name=item_object.category_name;var transaction_item_id=$(constants.ADD_TRANSACTION_ITEM_ID+i).attr(constants.TRANSACTION_ITEM_ID_PROP);if(amount.trim()!=""){amounts.push(amount);item_names.push(item_name);category_names.push(category_name);quantities.push(quantity);transaction_item_ids.push(transaction_item_id);indices.push(i);}}
TRANSACTION.edit_transaction(transaction_id,payee,year,month,day,hour,minute,time_zone_offset,account_id,transaction_item_ids,item_names,category_names,amounts,quantities,indices,category_type);});};Transaction.prototype.delete_transfer=function(transfer_id){GENERAL.disable_button($(constants.DELETE_TRANSFER_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.DELETE_TRANSFER_REQUEST,"transfer_id":transfer_id},success:function(data){GENERAL.check_session_expired(data);$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.HIDING_SPEED);TRANSACTION.delete_transfer_feedback(transfer_id,data);}});};Transaction.prototype.delete_income=function(income_id){GENERAL.disable_button($(constants.DELETE_INCOME_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.DELETE_INCOME_REQUEST,"income_id":income_id},success:function(data){GENERAL.check_session_expired(data);$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.HIDING_SPEED);TRANSACTION.delete_income_feedback(income_id,data);}});};Transaction.prototype.delete_transaction=function(transaction_id){GENERAL.disable_button($(constants.DELETE_TRANSACTION_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.DELETE_TRANSACTION_REQUEST,"transaction_id":transaction_id},success:function(data){GENERAL.check_session_expired(data);$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.HIDING_SPEED);TRANSACTION.delete_transaction_feedback(transaction_id,data);}});};Transaction.prototype.delete_transaction_item=function(transaction_id,transaction_item_id){GENERAL.disable_button($(constants.DELETE_TRANSACTION_ITEM_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.DELETE_TRANSACTION_ITEM_REQUEST,"transaction_id":transaction_id,"transaction_item_id":transaction_item_id},success:function(data){GENERAL.check_session_expired(data);$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.SHOWING_SPEED);TRANSACTION.delete_transaction_item_feedback(transaction_id,data);}});};Transaction.prototype.edit_transaction=function(transaction_id,payee,year,month,day,hour,minute,time_zone_offset,account_id,transaction_item_ids,item_names,category_names,item_amounts,quantities,indices,category_type){GENERAL.disable_button($(constants.EDIT_TRANSACTION_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.EDIT_TRANSACTION_REQUEST,"payee":payee,"date_day":day,"date_month":month,"date_year":year,"time_hour":hour,"time_minute":minute,"time_zone_offset":time_zone_offset,"account_id":account_id,"transaction_id":transaction_id,"transaction_item_ids":transaction_item_ids,"item_names":item_names,"category_names":category_names,"item_amounts":item_amounts,"quantities":quantities,"category_type":category_type,"indices":indices},success:function(data){GENERAL.check_session_expired(data);$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.SHOWING_SPEED);GENERAL.enable_button($(constants.EDIT_TRANSACTION_BUTTON_ID));TRANSACTION.edit_transaction_feedback(transaction_id,data,month,year);}});};Transaction.prototype.on_add_transaction_item_menu_clicked=function(transaction_id){var window_template=$(constants.ADD_TRANSACTION_ITEM_WINDOW_TEMPLATE_ID).html();$(constants.WINDOW_ID).html(window_template);$(constants.ADD_ONE_TRANSACTION_ITEM_ID).on("keydown",function(e){var textbox=$(constants.ADD_ONE_TRANSACTION_ITEM_ID);var container=$(constants.ADD_ONE_TRANSACTION_ITEM_SUGGESTIONS_ID);TRANSACTION.on_live_search_textbox_down_arrow_typed(e,textbox,container);});$(constants.ADD_ONE_TRANSACTION_ITEM_ID).on("keyup",function(e){if(e.which==constants.DOWN_KEY||e.which==constants.UP_KEY||e.which==constants.ENTER_KEY)
return;var textbox=$(constants.ADD_ONE_TRANSACTION_ITEM_ID);var text=textbox.val();var suggestions_container=$(constants.ADD_ONE_TRANSACTION_ITEM_SUGGESTIONS_ID);TRANSACTION.get_item_suggestions(text,suggestions_container,textbox,"e");});$(constants.ADD_TRANSACTION_ITEM_BUTTON_ID).on("click",function(e){e.stopPropagation();var amount=$(constants.ADD_ONE_TRANSACTION_ITEM_AMOUNT_ID).val();var item_string=$(constants.ADD_ONE_TRANSACTION_ITEM_ID).val();var item_object=TRANSACTION.parse_item_category(item_string);var item_name=item_object.item_name;var category_name=item_object.category_name;var quantity=$(constants.ADD_ONE_TRANSACTION_ITEM_QUANTITY_ID).val();TRANSACTION.add_transaction_item(transaction_id,item_name,category_name,amount,quantity);});$(constants.WINDOW_ID).css("display","inline-block");GENERAL.regular_window_events();};Transaction.prototype.display_transaction_items=function(transaction_id,data){$(constants.EDIT_TRANSACTION_ITEM_MENU_ITEM_ID+transaction_id).attr(constants.EDIT_TRANSACTION_TRANSACTION_ITEMS_PROP,JSON.stringify(data));for(var i=data.length-1;i>=0;--i){TRANSACTION.display_transaction_item(transaction_id,data[i]);}};Transaction.prototype.display_transaction_item=function(transaction_id,row){var template=$(constants.TRANSACTION_ITEM_TEMPLATE).html();var html_maker=new htmlMaker(template);var html=html_maker.getHTML(row);$(constants.TRANSACTIONS_ITEMS_DIV+transaction_id).prepend(html);var transaction_item_id=row[constants.TRANSACTION_ITEM_ID_ATTR];var quantity=parseInt(row[constants.TRANSACTION_ITEM_QUANTITY_ATTR]);if(quantity==1)
$(constants.TRANSACTION_ITEM_QUANTITY_ID+transaction_item_id).hide();TRANSACTION.bind_transaction_item_events(transaction_id,transaction_item_id);};Transaction.prototype.display_updated_transaction_item=function(transaction_id,row){var template=$(constants.TRANSACTION_ITEM_TEMPLATE).html();var html_maker=new htmlMaker(template);var html=html_maker.getHTML(row);var transaction_item_id=row[constants.TRANSACTION_ITEM_ID_ATTR];$(constants.TRANSACTION_ITEM_ID+transaction_item_id).replaceWith(html);var quantity=parseInt(row[constants.TRANSACTION_ITEM_QUANTITY_ATTR]);if(quantity==1)
$(constants.TRANSACTION_ITEM_QUANTITY_ID+transaction_item_id).hide();TRANSACTION.bind_transaction_item_events(transaction_id,transaction_item_id);};Transaction.prototype.bind_transaction_item_events=function(transaction_id,transaction_item_id){$(constants.TRANSACTION_ITEM_SETTING_GEAR_ID+transaction_item_id).on("click",function(e){e.stopPropagation();var display=$(constants.TRANSACTION_ITEM_SETTING_MENU_ID+transaction_item_id).css("display");if(display=="none"){TRANSACTION.hide_everything();$(constants.TRANSACTION_ITEM_SETTING_MENU_ID+transaction_item_id).show(constants.SHOWING_SPEED);$(constants.TRANSACTION_ITEM_SETTING_GEAR_ID+transaction_item_id).css("background-color",constants.SETTINGS_PRESSED_COLOR);TRANSACTION.VISIBLE_ITEM_MENU_ID=transaction_item_id;}
else{$(constants.TRANSACTION_ITEM_SETTING_MENU_ID+transaction_item_id).hide(constants.HIDING_SPEED);$(constants.TRANSACTION_ITEM_SETTING_GEAR_ID+transaction_item_id).css("background-color",constants.SETTINGS_UNPRESSED_COLOR);TRANSACTION.VISIBLE_ITEM_MENU_ID="";}});$(constants.EDIT_TRANSACTION_ITEM_ITEM_MENU_ITEM_ID+transaction_item_id).on("click",function(e){e.stopPropagation();TRANSACTION.on_edit_transaction_item_item_menu_clicked($(this),transaction_id,transaction_item_id);});$(constants.DELETE_TRANSACTION_ITEM_ITEM_MENU_ITEM_ID+transaction_item_id).on("click",function(e){e.stopPropagation();TRANSACTION.on_delete_transaction_item_item_menu_clicked(transaction_id,transaction_item_id);});};Transaction.prototype.on_edit_transaction_item_item_menu_clicked=function(edit_menu,transaction_id,transaction_item_id){var item_name=edit_menu.attr(constants.ITEM_NAME_SUGGESTION_ATTR);var category_name=edit_menu.attr(constants.CATEGORY_NAME_SUGGESTION_ATTR);var amount=edit_menu.attr(constants.TRANSACTION_ITEM_AMOUNT_ATTR);var data={"item_name":item_name,"category_name":category_name,"amount":amount};var window_template=$(constants.EDIT_TRANSACTION_ITEM_WINDOW_TEMPLATE_ID).html();var html_maker=new htmlMaker(window_template);var html=html_maker.getHTML(data);$(constants.WINDOW_ID).html(html);var quantity=edit_menu.attr(constants.TRANSACTION_ITEM_QUANTITY_PROP);$(constants.ADD_ONE_TRANSACTION_ITEM_QUANTITY_ID).val(quantity);$(constants.ADD_ONE_TRANSACTION_ITEM_ID).on("keydown",function(e){var textbox=$(constants.ADD_ONE_TRANSACTION_ITEM_ID);var container=$(constants.ADD_ONE_TRANSACTION_ITEM_SUGGESTIONS_ID);TRANSACTION.on_live_search_textbox_down_arrow_typed(e,textbox,container);});$(constants.ADD_ONE_TRANSACTION_ITEM_ID).on("keyup",function(e){if(e.which==constants.DOWN_KEY||e.which==constants.UP_KEY||e.which==constants.ENTER_KEY)
return;var textbox=$(constants.ADD_ONE_TRANSACTION_ITEM_ID);var text=textbox.val();var suggestions_container=$(constants.ADD_ONE_TRANSACTION_ITEM_SUGGESTIONS_ID);TRANSACTION.get_item_suggestions(text,suggestions_container,textbox,"e");});$(constants.EDIT_TRANSACTION_ITEM_BUTTON_ID).on("click",function(e){e.stopPropagation();var amount=$(constants.ADD_ONE_TRANSACTION_ITEM_AMOUNT_ID).val();var item_string=$(constants.ADD_ONE_TRANSACTION_ITEM_ID).val();var item_object=TRANSACTION.parse_item_category(item_string);var item_name=item_object.item_name;var category_name=item_object.category_name;var quantity=$(constants.ADD_ONE_TRANSACTION_ITEM_QUANTITY_ID).val();TRANSACTION.edit_transaction_item(transaction_id,transaction_item_id,item_name,category_name,amount,quantity);});$(constants.WINDOW_ID).css("display","inline-block");GENERAL.regular_window_events();};Transaction.prototype.on_delete_transaction_item_item_menu_clicked=function(transaction_id,transaction_item_id){var window_template=$(constants.DELETE_TRANSACTION_ITEM_WINDOW_TEMPLATE_ID).html();$(constants.WINDOW_ID).html(window_template);$(constants.DELETE_TRANSACTION_ITEM_BUTTON_ID).on("click",function(e){e.stopPropagation();TRANSACTION.delete_transaction_item(transaction_id,transaction_item_id);});$(constants.WINDOW_ID).css("display","inline-block");GENERAL.delete_window_events();};Transaction.prototype.edit_transaction_item=function(transaction_id,transaction_item_id,item_name,category_name,amount,quantity){GENERAL.disable_button($(constants.EDIT_TRANSACTION_ITEM_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_IMG).show(constants.SHOWING_SPEED);$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.EDIT_TRANSACTION_ITEM_REQUEST,"transaction_id":transaction_id,"item_name":item_name,"category_name":category_name,"amount":amount,"transaction_item_id":transaction_item_id,"quantity":quantity},success:function(data){GENERAL.check_session_expired(data);GENERAL.enable_button($(constants.EDIT_TRANSACTION_ITEM_BUTTON_ID));$(constants.REGULAR_BUTTON_LOADING_IMG).hide(constants.HIDING_SPEED);TRANSACTION.edit_transaction_item_feedback(transaction_item_id,transaction_id,data);}});};Transaction.prototype.update_transaction_item_info=function(row){var template=$(constants.TRANSACTION_ITEM_TEMPLATE).html();var html_maker=new htmlMaker(template);var html=html_maker.getHTML(row);var transaction_item_id=row[constants.TRANSACTION_ITEM_ID_ATTR];var transaction_id=row[constants.TRANSACTIONITEM_TRANSACTION_ID_ATTR];$(constants.TRANSACTION_ITEM_ID+transaction_item_id).replaceWith(html);TRANSACTION.bind_transaction_item_events(transaction_id,transaction_item_id);};Transaction.prototype.update_transaction_info_show_items=function(transaction_id,transaction_data,items_data){TRANSACTION.update_transaction_info(transaction_id,transaction_data,items_data);TRANSACTION.show_items(transaction_id);};Transaction.prototype.update_transaction_info=function(transaction_id,transaction_data,items_data){$(constants.TRANSACTIONS_ITEMS_DIV+transaction_id).html("");var template=$(constants.TRANSACTION_TEMPLATE).html();var html_maker=new htmlMaker(template);var html=html_maker.getHTML(transaction_data);$(constants.TRANSACTION_ID+transaction_id).replaceWith(html);var amount=parseFloat(transaction_data[constants.AMOUNT_PROP]);if(amount<=0){$(constants.TRANSACTION_ARROW_ID+transaction_id).hide();$(constants.TRANSACTION_ICON_ID+transaction_id).hide();}
$(constants.EDIT_TRANSACTION_ITEM_MENU_ITEM_ID+transaction_id).attr(constants.EDIT_TRANSACTION_TRANSACTION_ITEMS_PROP,JSON.stringify(items_data));for(var i=items_data.length-1;i>=0;--i){TRANSACTION.display_transaction_item(transaction_id,items_data[i]);}
TRANSACTION.show_items(transaction_id);TRANSACTION.bind_transaction_events(transaction_id);};Transaction.prototype.update_transaction_amount=function(transaction_id,formatted_amount,amount){$(constants.TRANSACTION_AMOUNT_ID+transaction_id).html(formatted_amount);if(amount<=0){$(constants.TRANSACTION_ARROW_ID+transaction_id).hide();$(constants.TRANSACTION_ICON_ID+transaction_id).hide();}
else if(amount>0){$(constants.TRANSACTION_ARROW_ID+transaction_id).show();$(constants.TRANSACTION_ICON_ID+transaction_id).show();}};Transaction.prototype.display_transfer=function(row){var template=$(constants.TRANSFER_TEMPLATE).html();var html_maker=new htmlMaker(template);var html=html_maker.getHTML(row);$(constants.TRANSACTIONS_DIV).prepend(html);var transfer_id=row[constants.TRANSFER_ID_ATTR];TRANSACTION.bind_transfer_events(transfer_id);};Transaction.prototype.bind_transfer_events=function(transfer_id){$(constants.TRANSFER_SETTING_GEAR_ID+transfer_id).on("click",function(e){e.stopPropagation();var display=$(constants.TRANSFER_SETTING_MENU_ID+transfer_id).css("display");if(display=="none"){TRANSACTION.hide_everything();$(constants.TRANSFER_SETTING_MENU_ID+transfer_id).show(constants.SHOWING_SPEED);$(constants.TRANSFER_SETTING_GEAR_ID+transfer_id).css("background-color",constants.SETTINGS_PRESSED_COLOR);TRANSACTION.VISIBLE_TRANSFER_MENU_ID=transfer_id;}
else{$(constants.TRANSFER_SETTING_MENU_ID+transfer_id).hide(constants.HIDING_SPEED);$(constants.TRANSFER_SETTING_GEAR_ID+transfer_id).css("background-color",constants.SETTINGS_UNPRESSED_COLOR);TRANSACTION.VISIBLE_TRANSFER_MENU_ID="";}});$(constants.EDIT_TRANSFER_ITEM_MENU_ITEM_ID+transfer_id).on("click",function(e){e.stopPropagation();TRANSACTION.on_edit_transfer_item_menu_clicked(transfer_id);});$(constants.DELETE_TRANSFER_ITEM_MENU_ITEM_ID+transfer_id).on("click",function(e){e.stopPropagation();TRANSACTION.bind_show_delete_transfer_window(transfer_id);});};Transaction.prototype.display_income=function(row){var template=$(constants.INCOME_TEMPLATE).html();var html_maker=new htmlMaker(template);var html=html_maker.getHTML(row);$(constants.TRANSACTIONS_DIV).prepend(html);var income_id=row[constants.INCOME_ID_ATTR];TRANSACTION.bind_income_events(income_id);};Transaction.prototype.update_transfer_info=function(transfer_id,row){var template=$(constants.TRANSFER_TEMPLATE).html();var html_maker=new htmlMaker(template);var html=html_maker.getHTML(row);$(constants.TRANSFER_ID+transfer_id).replaceWith(html);TRANSACTION.bind_transfer_events(transfer_id);};Transaction.prototype.update_income_info=function(income_id,row){var template=$(constants.INCOME_TEMPLATE).html();var html_maker=new htmlMaker(template);var html=html_maker.getHTML(row);$(constants.INCOME_ID+income_id).replaceWith(html);TRANSACTION.bind_income_events(income_id);};Transaction.prototype.bind_income_events=function(income_id){$(constants.INCOME_SETTING_GEAR_ID+income_id).on("click",function(e){e.stopPropagation();var display=$(constants.INCOME_SETTING_MENU_ID+income_id).css("display");if(display=="none"){TRANSACTION.hide_everything();$(constants.INCOME_SETTING_MENU_ID+income_id).show(constants.SHOWING_SPEED);$(constants.INCOME_SETTING_GEAR_ID+income_id).css("background-color",constants.SETTINGS_PRESSED_COLOR);TRANSACTION.VISIBLE_INCOME_MENU_ID=income_id;}
else{$(constants.INCOME_SETTING_MENU_ID+income_id).hide(constants.HIDING_SPEED);$(constants.INCOME_SETTING_GEAR_ID+income_id).css("background-color",constants.SETTINGS_UNPRESSED_COLOR);TRANSACTION.VISIBLE_INCOME_MENU_ID="";}});$(constants.EDIT_INCOME_ITEM_MENU_ITEM_ID+income_id).on("click",function(e){e.stopPropagation();TRANSACTION.on_edit_income_item_menu_clicked(income_id);});$(constants.DELETE_INCOME_ITEM_MENU_ITEM_ID+income_id).on("click",function(e){e.stopPropagation();TRANSACTION.bind_show_delete_income_window(income_id);});};Transaction.prototype.bind_show_delete_transfer_window=function(transfer_id){TRANSACTION.hide_everything();var window_template=$(constants.DELETE_TRANSFER_WINDOW_TEMPLATE_ID).html();$(constants.WINDOW_ID).html(window_template);$(constants.WINDOW_ID).css("display","inline-block");GENERAL.delete_window_events();$(constants.DELETE_TRANSFER_BUTTON_ID).on("click",function(e){e.stopPropagation();TRANSACTION.delete_transfer(transfer_id);});};Transaction.prototype.bind_show_delete_income_window=function(income_id){TRANSACTION.hide_everything();var window_template=$(constants.DELETE_INCOME_WINDOW_TEMPLATE_ID).html();$(constants.WINDOW_ID).html(window_template);$(constants.WINDOW_ID).css("display","inline-block");GENERAL.delete_window_events();$(constants.DELETE_INCOME_BUTTON_ID).on("click",function(e){e.stopPropagation();TRANSACTION.delete_income(income_id);});};Transaction.prototype.on_edit_income_item_menu_clicked=function(income_id){var window_template=$(constants.EDIT_INCOME_WINDOW_TEMPLATE_ID).html();var html_maker=new htmlMaker(window_template);var account_id=$(constants.EDIT_INCOME_ITEM_MENU_ITEM_ID+income_id).attr(constants.ACCOUNT_ID_PROP);var amount=$(constants.EDIT_INCOME_ITEM_MENU_ITEM_ID+income_id).attr(constants.EDIT_TRANSACTION_AMOUNT_PROP);var year=$(constants.EDIT_INCOME_ITEM_MENU_ITEM_ID+income_id).attr(constants.YEAR_PROP);var month=$(constants.EDIT_INCOME_ITEM_MENU_ITEM_ID+income_id).attr(constants.MONTH_PROP);var day=$(constants.EDIT_INCOME_ITEM_MENU_ITEM_ID+income_id).attr(constants.DAY_PROP);var hour=$(constants.EDIT_INCOME_ITEM_MENU_ITEM_ID+income_id).attr(constants.HOUR_PROP);var minute=$(constants.EDIT_INCOME_ITEM_MENU_ITEM_ID+income_id).attr(constants.MINUTE_PROP);var date_object=GENERAL.get_date(year,month,day,hour,minute);var formatted_date=GENERAL.format_date(date_object);var category_name=$(constants.EDIT_INCOME_ITEM_MENU_ITEM_ID+income_id).attr(constants.INCOME_CATEGORY_NAME_PROP);var income_name=$(constants.EDIT_INCOME_ITEM_MENU_ITEM_ID+income_id).attr(constants.INCOME_NAME_PROP);var data={source:income_name+" ("+category_name+")",formatted_date:formatted_date,amount:amount};var html=html_maker.getHTML(data);$(constants.WINDOW_ID).html(html);var help_topic_names=[constants.HELP_TOPIC_INCOME_ACCOUNT,constants.HELP_TOPIC_INCOME_SOURCE];GENERAL.set_help_tooltip_text(help_topic_names);$(constants.ADD_INCOME_HOUR_ID).val(GENERAL.get_hours(date_object));$(constants.ADD_INCOME_MINUTE_ID).val(GENERAL.get_minutes(date_object));$(constants.ADD_INCOME_AM_PM_ID).val(GENERAL.get_am_pm(date_object));var account_combobox_template=$(constants.ACCOUNTS_COMBOBOX_TEMPLATE).html();var html_maker=new htmlMaker(account_combobox_template);var accounts_html=html_maker.getHTML(TRANSACTION.user_accounts);$(constants.ADD_INCOME_ACCOUNTS_ID).html(accounts_html);$(constants.ADD_INCOME_ACCOUNTS_ID).val(account_id);var add_transaction_datepicker_wrapper=$(constants.ADD_INCOME_DATE_WRAPPER_ID);DATEPICKER.generate_calendar(date_object,add_transaction_datepicker_wrapper,constants.ADD_INCOME_CALENDAR_ID,$(constants.ADD_INCOME_DATE),date_object);$(constants.ADD_INCOME_ITEM_ID).on("keyup",function(e){if(e.which==constants.DOWN_KEY||e.which==constants.UP_KEY||e.which==constants.ENTER_KEY)
return;var textbox=$(constants.ADD_INCOME_ITEM_ID);var text=textbox.val();var suggestions_container=$(constants.ADD_INCOME_ITEM_SUGGESTIONS_ID);TRANSACTION.get_item_suggestions(text,suggestions_container,textbox,"i");});$(constants.ADD_INCOME_ITEM_ID).on("keydown",function(e){var textbox=$(constants.ADD_INCOME_ITEM_ID);var container=$(constants.ADD_INCOME_ITEM_SUGGESTIONS_ID);TRANSACTION.on_live_search_textbox_down_arrow_typed(e,textbox,container);});$(constants.WINDOW_ID).css("display","inline-block");GENERAL.regular_window_events();$(constants.EDIT_INCOME_BUTTON_ID).on("click",function(e){e.stopPropagation();var account_id=$(constants.ADD_INCOME_ACCOUNTS_ID).val();var formatted_date=$(constants.ADD_INCOME_DATE).val();var date_object=GENERAL.get_date_object(formatted_date);var day=date_object.day;var month=date_object.month;var year=date_object.year;var hour_string=$(constants.ADD_INCOME_HOUR_ID).val();var minute_string=$(constants.ADD_INCOME_MINUTE_ID).val();var am_pm_string=$(constants.ADD_INCOME_AM_PM_ID).val();var time_object=GENERAL.get_time_object(hour_string,minute_string,am_pm_string);var hour=time_object.hour;var minute=time_object.minute;var current_date=new Date();var time_zone_offset=current_date.getTimezoneOffset();var item_string=$(constants.ADD_INCOME_ITEM_ID).val();var item_object=TRANSACTION.parse_item_category(item_string);var item_name=item_object.item_name;var category_name=item_object.category_name;var amount=$(constants.ADD_INCOME_AMOUNT_ID).val();var category_type="i";TRANSACTION.edit_income(income_id,day,month,year,hour,minute,time_zone_offset,account_id,item_name,category_name,amount,category_type);});};Transaction.prototype.on_edit_transfer_item_menu_clicked=function(transfer_id){var window_template=$(constants.EDIT_TRANSFER_WINDOW_TEMPLATE_ID).html();var html_maker=new htmlMaker(window_template);var from_account_id=$(constants.EDIT_TRANSFER_ITEM_MENU_ITEM_ID+transfer_id).attr(constants.FROM_ACCOUNT_ID_PROP);var to_account_id=$(constants.EDIT_TRANSFER_ITEM_MENU_ITEM_ID+transfer_id).attr(constants.TO_ACCOUNT_ID_PROP);var amount=$(constants.EDIT_TRANSFER_ITEM_MENU_ITEM_ID+transfer_id).attr(constants.EDIT_TRANSFER_AMOUNT_PROP);var year=$(constants.EDIT_TRANSFER_ITEM_MENU_ITEM_ID+transfer_id).attr(constants.YEAR_PROP);var month=$(constants.EDIT_TRANSFER_ITEM_MENU_ITEM_ID+transfer_id).attr(constants.MONTH_PROP);var day=$(constants.EDIT_TRANSFER_ITEM_MENU_ITEM_ID+transfer_id).attr(constants.DAY_PROP);var hour=$(constants.EDIT_TRANSFER_ITEM_MENU_ITEM_ID+transfer_id).attr(constants.HOUR_PROP);var minute=$(constants.EDIT_TRANSFER_ITEM_MENU_ITEM_ID+transfer_id).attr(constants.MINUTE_PROP);var date_object=GENERAL.get_date(year,month,day,hour,minute);var formatted_date=GENERAL.format_date(date_object);var data={amount:amount,formatted_date:formatted_date};var html=html_maker.getHTML(data);$(constants.WINDOW_ID).html(html);var help_topic_names=[constants.HELP_TOPIC_TO_ACCOUNT,constants.HELP_TOPIC_FROM_ACCOUNT];GENERAL.set_help_tooltip_text(help_topic_names);$(constants.ADD_TRANSFER_HOUR_ID).val(GENERAL.get_hours(date_object));$(constants.ADD_TRANSFER_MINUTE_ID).val(GENERAL.get_minutes(date_object));$(constants.ADD_TRANSFER_AM_PM_ID).val(GENERAL.get_am_pm(date_object));var account_combobox_template=$(constants.ACCOUNTS_COMBOBOX_TEMPLATE).html();var html_maker=new htmlMaker(account_combobox_template);var accounts_html=html_maker.getHTML(TRANSACTION.user_accounts);$(constants.ADD_TRANSFER_FROM_ACCOUNTS_ID).html(accounts_html);$(constants.ADD_TRANSFER_TO_ACCOUNTS_ID).html(accounts_html);$(constants.ADD_TRANSFER_FROM_ACCOUNTS_ID).val(from_account_id);$(constants.ADD_TRANSFER_TO_ACCOUNTS_ID).val(to_account_id);var add_transaction_datepicker_wrapper=$(constants.ADD_TRANSFER_DATE_WRAPPER_ID);DATEPICKER.generate_calendar(date_object,add_transaction_datepicker_wrapper,constants.ADD_TRANSFER_CALENDAR_ID,$(constants.ADD_TRANSFER_DATE),date_object);$(constants.WINDOW_ID).css("display","inline-block");GENERAL.regular_window_events();$(constants.EDIT_TRANSFER_BUTTON_ID).on("click",function(e){e.stopPropagation();var from_account_id=$(constants.ADD_TRANSFER_FROM_ACCOUNTS_ID).val();var to_account_id=$(constants.ADD_TRANSFER_TO_ACCOUNTS_ID).val();var formatted_date=$(constants.ADD_TRANSFER_DATE).val();var date_object=GENERAL.get_date_object(formatted_date);var day=date_object.day;var month=date_object.month;var year=date_object.year;var hour_string=$(constants.ADD_INCOME_HOUR_ID).val();var minute_string=$(constants.ADD_INCOME_MINUTE_ID).val();var am_pm_string=$(constants.ADD_INCOME_AM_PM_ID).val();var time_object=GENERAL.get_time_object(hour_string,minute_string,am_pm_string);var hour=time_object.hour;var minute=time_object.minute;var current_date=new Date();var time_zone_offset=current_date.getTimezoneOffset();var amount=$(constants.ADD_TRANSFER_AMOUNT_ID).val();TRANSACTION.edit_transfer(transfer_id,day,month,year,hour,minute,time_zone_offset,from_account_id,to_account_id,amount);});};Transaction.prototype.hide_everything=function(){if(TRANSACTION.VISIBLE_TRANSACTION_MENU_ID!=""){$(constants.TRANSACTION_SETTING_MENU_ID+TRANSACTION.VISIBLE_TRANSACTION_MENU_ID).hide(constants.HIDING_SPEED);$(constants.TRANSACTION_SETTING_GEAR_ID+TRANSACTION.VISIBLE_TRANSACTION_MENU_ID).css("background-color",constants.SETTINGS_UNPRESSED_COLOR);TRANSACTION.VISIBLE_TRANSACTION_MENU_ID="";}
if(TRANSACTION.VISIBLE_ITEM_MENU_ID!=""){$(constants.TRANSACTION_ITEM_SETTING_MENU_ID+TRANSACTION.VISIBLE_ITEM_MENU_ID).hide(constants.HIDING_SPEED);$(constants.TRANSACTION_ITEM_SETTING_GEAR_ID+TRANSACTION.VISIBLE_ITEM_MENU_ID).css("background-color",constants.SETTINGS_UNPRESSED_COLOR);TRANSACTION.VISIBLE_ITEM_MENU_ID="";}
if(TRANSACTION.VISIBLE_TRANSFER_MENU_ID!=""){$(constants.TRANSFER_SETTING_MENU_ID+TRANSACTION.VISIBLE_TRANSFER_MENU_ID).hide(constants.HIDING_SPEED);$(constants.TRANSFER_SETTING_GEAR_ID+TRANSACTION.VISIBLE_TRANSFER_MENU_ID).css("background-color",constants.SETTINGS_UNPRESSED_COLOR);TRANSACTION.VISIBLE_TRANSFER_MENU_ID="";}
if(TRANSACTION.VISIBLE_INCOME_MENU_ID!=""){$(constants.INCOME_SETTING_MENU_ID+TRANSACTION.VISIBLE_INCOME_MENU_ID).hide(constants.HIDING_SPEED);$(constants.INCOME_SETTING_GEAR_ID+TRANSACTION.VISIBLE_INCOME_MENU_ID).css("background-color",constants.SETTINGS_UNPRESSED_COLOR);TRANSACTION.VISIBLE_INCOME_MENU_ID="";}};Transaction.prototype.hide_show_items=function(transaction_id){var img=$(constants.TRANSACTION_ARROW_ID+transaction_id);if(img.attr("src").search(constants.DOUBLE_ARROW_UP_TEXT)!=-1){img.attr("src",constants.DOUBLE_ARROW_DOWN);var num_children=$(constants.TRANSACTIONS_ITEMS_DIV+transaction_id).children().length;if(num_children==0)
num_children=1;$(constants.TRANSACTIONS_ITEMS_DIV+transaction_id).hide(constants.HIDING_SPEED_MS*num_children*0.5);}
else if(img.attr("src").search(constants.DOUBLE_ARROW_DOWN_TEXT)!=-1){TRANSACTION.show_items(transaction_id);}};Transaction.prototype.show_first_transaction=function(){var transaction_id=$(constants.FIRST_TRANSACTION).attr(constants.TRANSACTION_ID_PROP);TRANSACTION.show_items(transaction_id);};Transaction.prototype.show_items=function(transaction_id){$(constants.TRANSACTION_ARROW_ID+transaction_id).attr("src",constants.DOUBLE_ARROW_UP);var num_children=$(constants.TRANSACTIONS_ITEMS_DIV+transaction_id).children().length;if(num_children==0)
num_children=1;$(constants.TRANSACTIONS_ITEMS_DIV+transaction_id).show(constants.SHOWING_SPEED_MS*num_children*0.5);};var ANALYTICS=new Analytics();function Analytics(){this.expense_categories=null;}
Analytics.prototype.init=function(){var date=new Date();var month=date.getMonth()+1+"";var year=date.getFullYear()+"";$(constants.ANALYTICS_EXPENSE_MONTH_COMBOBOX_ID).val(month);$(constants.ANALYTICS_EXPENSE_YEAR_COMBOBOX_ID).val(year);$(constants.ANALYTICS_BUDGET_MONTH_ID).val(month);$(constants.ANALYTICS_BUDGET_YEAR_ID).val(year);ANALYTICS.get_user_budgets();$(constants.ANALYTICS_BUDGET_MONTH_ID).on("change",ANALYTICS.get_user_budgets);$(constants.ANALYTICS_BUDGET_YEAR_ID).on("change",ANALYTICS.get_user_budgets);$(constants.ANALYTICS_BUGET_ACCOUNT_ID).on("change",ANALYTICS.get_budget_analytics);$(constants.ANALYTICS_BUDGET_BUDGET_ID).on("change",ANALYTICS.get_budget_analytics);$(constants.ANALYTICS_BUDGET_SCALE_ID).on("change",ANALYTICS.get_budget_analytics);$(constants.ANALYTICS_EXPENSE_MONTH_COMBOBOX_ID).on("change",ANALYTICS.get_monthly_expense);$(constants.ANALYTICS_EXPENSE_YEAR_COMBOBOX_ID).on("change",ANALYTICS.get_monthly_expense);$(constants.ANALYTICS_EXPENSE_ACCOUNT_COMBOBOX_ID).on("change",ANALYTICS.get_monthly_expense);$(constants.ANALYTICS_EXPENSE_FILTER_COMBOBOX_ID).on("change",ANALYTICS.get_monthly_expense);$(constants.ANALYTICS_MONTHLY_EXPENSE_CHECKBOX).on("change",ANALYTICS.get_monthly_expense);$(constants.ANALYTICS_AVG_MONTHLY_EXPENSE_CHECKBOX).on("change",ANALYTICS.get_monthly_expense);$(constants.ANALYTICS_TOTAL_EXPENSE_PERIOD_ID).on("change",ANALYTICS.get_monthly_expenses_stats);$(constants.ANALYTICS_TOTAL_EXPENSE_CATEGORY_ID).on("change",ANALYTICS.get_monthly_expenses_stats);$(constants.ANALYTICS_TOTAL_EXPENSE_ACCOUNT_COMBOBOX_ID).on("change",ANALYTICS.get_monthly_expenses_stats);$(constants.ANALYTICS_MONTHLY_TOTAL_EXPENSE_AVG_COMBOBOX_ID).on("change",ANALYTICS.show_total_monthly_vertical_bar_average);$(constants.ANALYTICS_BUDGET_MORE_FILTERS_BUTTON_ID).on("click",ANALYTICS.show_hide_budget_filters);$(constants.ANALYTICS_INCOME_EXPENSE_PERIOD_ID).on("change",ANALYTICS.get_monthly_income_expense_stats);$(constants.ANALYTICS_INCOME_EXPENSE_ACCOUNT_COMBOBOX_ID).on("change",ANALYTICS.get_monthly_income_expense_stats);$(constants.ANALYTICS_INCOME_EXPENSE_SORT_BY_ID).on("change",ANALYTICS.get_monthly_income_expense_stats);$(constants.ANALYTICS_SAVING_PERIOD_ID).on("change",ANALYTICS.get_monthly_savings_stats);$(constants.ANALYTICS_SAVING_ACCOUNT_COMBOBOX_ID).on("change",ANALYTICS.get_monthly_savings_stats);ANALYTICS.load();};Analytics.prototype.load=function(){ANALYTICS.get_monthly_expense();ANALYTICS.get_monthly_expenses_stats();ANALYTICS.get_monthly_income_expense_stats();ANALYTICS.get_monthly_savings_stats();};Analytics.prototype.init_expense_categories=function(){var current_date=new Date();var start_month=current_date.getMonth()+1;var start_year=current_date.getFullYear();var time_zone_offset=current_date.getTimezoneOffset();var period=constants.ANALYTICS_GET_EXPENSE_CATEGORIES_REQUEST_PERIOD;$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.ANALYTICS_GET_EXPENSE_CATEGORIES_REQUEST,start_month:start_month,start_year:start_year,time_zone_offset:time_zone_offset,period:period},success:function(data){GENERAL.check_session_expired(data);if(data==null||data.length==0)
ANALYTICS.expense_categories=null;else
ANALYTICS.expense_categories=data;ANALYTICS.init_total_expenses_categories_combobox();}});};Analytics.prototype.init_total_expenses_categories_combobox=function(){var categories_combobox_template=$(constants.CATEGORIES_COMBOBOX_TEMPLATE).html();var html_maker=new htmlMaker(categories_combobox_template);var categories_html=html_maker.getHTML(ANALYTICS.expense_categories);$(constants.ANALYTICS_TOTAL_EXPENSE_CATEGORY_ID).html("<option value='all'>All</option>");if(ANALYTICS.expense_categories!=null)
$(constants.ANALYTICS_TOTAL_EXPENSE_CATEGORY_ID).append(categories_html);};Analytics.prototype.get_monthly_expense=function(){var current_date=new Date();var start_day=1;var start_month=parseInt($(constants.ANALYTICS_EXPENSE_MONTH_COMBOBOX_ID).val())-1;var start_year=parseInt($(constants.ANALYTICS_EXPENSE_YEAR_COMBOBOX_ID).val());var next_month_current_day=new Date(start_year,start_month,start_day);next_month_current_day.setMonth(start_month+1);var end_day=next_month_current_day.getDate();var end_month=next_month_current_day.getMonth();var end_year=next_month_current_day.getFullYear();var time_zone_offset=current_date.getTimezoneOffset();var account=$(constants.ANALYTICS_EXPENSE_ACCOUNT_COMBOBOX_ID).val();var filter_by=$(constants.ANALYTICS_EXPENSE_FILTER_COMBOBOX_ID).val();var prev_month=$(constants.ANALYTICS_MONTHLY_EXPENSE_CHECKBOX).prop("checked")?"yes":"no";var avg=$(constants.ANALYTICS_AVG_MONTHLY_EXPENSE_CHECKBOX).prop("checked")?"yes":"no";ANALYTICS.get_monthly_expense_request(start_day,(start_month+1),start_year,end_day,(end_month+1),end_year,time_zone_offset,account,filter_by,prev_month,avg);};Analytics.prototype.get_monthly_savings_stats=function(){var current_date=new Date();var start_day=1;var start_month=current_date.getMonth()+1;var start_year=current_date.getFullYear();var time_zone_offset=current_date.getTimezoneOffset();var account=$(constants.ANALYTICS_SAVING_ACCOUNT_COMBOBOX_ID).val();var period=$(constants.ANALYTICS_SAVING_PERIOD_ID).val();ANALYTICS.get_monthly_savings_stats_request(start_day,start_month,start_year,time_zone_offset,account,period);};Analytics.prototype.get_monthly_income_expense_stats=function(){var current_date=new Date();var start_day=1;var start_month=current_date.getMonth()+1;var start_year=current_date.getFullYear();var time_zone_offset=current_date.getTimezoneOffset();var account=$(constants.ANALYTICS_INCOME_EXPENSE_ACCOUNT_COMBOBOX_ID).val();var period=$(constants.ANALYTICS_INCOME_EXPENSE_PERIOD_ID).val();var sort_by=$(constants.ANALYTICS_INCOME_EXPENSE_SORT_BY_ID).val();ANALYTICS.get_monthly_income_vs_expenses_stats_request(start_day,start_month,start_year,time_zone_offset,account,period,sort_by);};Analytics.prototype.get_monthly_expenses_stats=function(){var current_date=new Date();var start_day=1;var start_month=current_date.getMonth()+1;var start_year=current_date.getFullYear();var time_zone_offset=current_date.getTimezoneOffset();var account=$(constants.ANALYTICS_TOTAL_EXPENSE_ACCOUNT_COMBOBOX_ID).val();var period=$(constants.ANALYTICS_TOTAL_EXPENSE_PERIOD_ID).val();var category=$(constants.ANALYTICS_TOTAL_EXPENSE_CATEGORY_ID).val();ANALYTICS.get_monthly_expenses_stats_request(start_day,start_month,start_year,time_zone_offset,account,period,category);};Analytics.prototype.get_monthly_expense_request=function(start_day,start_month,start_year,end_day,end_month,end_year,time_zone_offset,account_id,filter_by,prev_month,avg){$(constants.ANALYTICS_MONTHLY_EXPENSE_WRAPPER_LOADING_ID).show();$(constants.ANALYTICS_MONTHLY_EXPENSE_WRAPPER_ID).hide();$(constants.ANALYTICS_MONTHLY_EXPENSE_WRAPPER_NOTHING_FOUND_ID).hide();$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.ANALYTICS_GET_MONTHLY_EXPENSE_REQUEST,start_day:start_day,start_month:start_month,start_year:start_year,end_day:end_day,end_month:end_month,end_year:end_year,time_zone_offset:time_zone_offset,account_id:account_id,filter_by:filter_by,prev_month:prev_month,avg:avg},success:function(data){GENERAL.check_session_expired(data);$(constants.ANALYTICS_MONTHLY_EXPENSE_WRAPPER_LOADING_ID).hide();$(constants.ANALYTICS_MONTHLY_EXPENSE_WRAPPER_ID).show();ANALYTICS.show_monthly_expense(data,filter_by,prev_month,avg,start_month,start_year);}});};Analytics.prototype.get_monthly_expenses_stats_request=function(start_day,start_month,start_year,time_zone_offset,account_id,period,category){$(constants.ANALYTICS_MONTHLY_EXPENSE_STATS_WRAPPER_LOADING_ID).show();$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_DIV_WRAPPER).hide();$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.ANALYTICS_GET_MONTHLY_EXPENSE_STATS_REQUEST,start_day:start_day,start_month:start_month,start_year:start_year,time_zone_offset:time_zone_offset,account_id:account_id,period:period,category:category},success:function(data){GENERAL.check_session_expired(data);$(constants.ANALYTICS_MONTHLY_EXPENSE_STATS_WRAPPER_LOADING_ID).hide();$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_DIV_WRAPPER).show();ANALYTICS.show_total_monthly_vertical_bar_expense(data);}});};Analytics.prototype.get_monthly_income_vs_expenses_stats_request=function(start_day,start_month,start_year,time_zone_offset,account_id,period,sort_by){$(constants.BUDGETS_ANALYTICS_INCOME_EXPENSE_WRAPPER_ID).hide();$(constants.BUDGETS_ANALYTICS_INCOME_EXPENSE_WRAPPER_LOADING_ID).show();$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.ANALYTICS_GET_MONTHLY_EXPENSE_VS_INCOME_STATS_REQUEST,start_day:start_day,start_month:start_month,start_year:start_year,time_zone_offset:time_zone_offset,account_id:account_id,period:period,sort_by:sort_by},success:function(data){GENERAL.check_session_expired(data);$(constants.BUDGETS_ANALYTICS_INCOME_EXPENSE_WRAPPER_ID).show();$(constants.BUDGETS_ANALYTICS_INCOME_EXPENSE_WRAPPER_LOADING_ID).hide();ANALYTICS.show_income_expenses_stats(data,sort_by);}});};Analytics.prototype.get_monthly_savings_stats_request=function(start_day,start_month,start_year,time_zone_offset,account_id,period,category){$(constants.ANALYTICS_MONTHLY_SAVING_LINE_DIV_WRAPPER).hide();$(constants.ANALYTICS_MONTHLY_SAVING_LINE_DIV_WRAPPER_LOADING).show();$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.ANALYTICS_GET_MONTHLY_SAVINGS_STATS_REQUEST,start_day:start_day,start_month:start_month,start_year:start_year,time_zone_offset:time_zone_offset,account_id:account_id,period:period},success:function(data){GENERAL.check_session_expired(data);$(constants.ANALYTICS_MONTHLY_SAVING_LINE_DIV_WRAPPER).show();$(constants.ANALYTICS_MONTHLY_SAVING_LINE_DIV_WRAPPER_LOADING).hide();ANALYTICS.show_total_monthly_vertical_bar_savings(data);}});};Analytics.prototype.max_savings=function(data){var max_savings=0;for(var i=0;i<data.length;++i){var converted_income_amount=parseFloat(data[i][constants.ANALYTICS_INCOME_CONVERTED_AMOUNT_ATTR]);var converted_expense_amount=parseFloat(data[i][constants.ANALYTICS_EXPENSE_CONVERTED_AMOUNT_ATTR]);var savings=converted_income_amount-converted_expense_amount;if(savings>max_savings)
max_savings=savings;}
return max_savings;};Analytics.prototype.show_income_expenses_stats=function(data,sort_by){var max_savings=ANALYTICS.max_savings(data);var max_amount=0;var formatted_total_income="";var formatted_total_expense="";var total_savings="";var formatted_total_savings="";var formatted_total_overspending="";if(data.length>0){max_amount=parseFloat(data[0][constants.ANALYTICS_MONTHLY_EXPENSE_MAX_AMOUNT_ATTR]);formatted_total_income=data[0][constants.ANALYTICS_FORMATTED_TOTAL_INCOME_ATTR];formatted_total_expense=data[0][constants.ANALYTICS_FORMATTED_TOTAL_EXPENSE_ATTR];total_savings=parseFloat(data[0][constants.ANALYTICS_TOTAL_SAVINGS_ATTR]);formatted_total_savings=data[0][constants.ANALYTICS_FORMATTED_TOTAL_SAVINGS_ATTR];formatted_total_overspending=data[0][constants.ANALYTICS_FORMATTED_TOTAL_OVERSPENDING_ATTR];}
if(data.length>1){if(sort_by==constants.ANALYTICS_TOTAL_MONTHLY_EXPENSES_SORT_BY_ASC)
data.sort(ANALYTICS.sort_savings_ascending);else if(sort_by==constants.ANALYTICS_TOTAL_MONTHLY_EXPENSES_SORT_BY_DSC)
data.sort(ANALYTICS.sort_savings_descending);}
var income_expense_template=$(constants.ANALYTICS_MONTHLY_EXPENSE_INCOME_TEMPLATE_ID).html();var total_income_expense_template=$(constants.ANALYTICS_MONTHLY_TOTAL_EXPENSE_INCOME_TEMPLATE_ID).html()
var html_maker=new htmlMaker(income_expense_template);var html=html_maker.getHTML(data);$(constants.BUDGETS_ANALYTICS_INCOME_EXPENSE_WRAPPER_ID).html(html);$(constants.BUDGETS_ANALYTICS_INCOME_EXPENSE_WRAPPER_ID).append(total_income_expense_template);$(constants.ANALYTICS_FORMATTED_TOTAL_INCOME_ID).html(formatted_total_income);$(constants.ANALYTICS_FORMATTED_TOTAL_EXPENSE_ID).html(formatted_total_expense);if(total_savings>0){$(constants.ANALYTICS_FORMATTED_TOTAL_SAVINGS_WRAPPER_ID).show();$(constants.ANALYTICS_FORMATTED_TOTAL_SAVINGS_ID).html(formatted_total_savings);$(constants.ANALYTICS_FORMATTED_TOTAL_OVERSPENDING_WRAPPER_ID).hide();}
else if(total_savings<0){$(constants.ANALYTICS_FORMATTED_TOTAL_SAVINGS_WRAPPER_ID).hide();$(constants.ANALYTICS_FORMATTED_TOTAL_OVERSPENDING_ID).html(formatted_total_overspending);$(constants.ANALYTICS_FORMATTED_TOTAL_OVERSPENDING_WRAPPER_ID).show();}
else{$(constants.ANALYTICS_FORMATTED_TOTAL_SAVINGS_WRAPPER_ID).hide();$(constants.ANALYTICS_FORMATTED_TOTAL_OVERSPENDING_WRAPPER_ID).hide();}
var percentage=constants.ANALYTICS_BAR_WIDTH_PERCENTAGE;for(var i=0;i<data.length;i++){var formatted_overspending=data[i][constants.ANALYTICS_FORMATTED_OVERSPENDING_ATTR];var formatted_savings=data[i][constants.ANALYTICS_FORMATTED_SAVINGS_ATTR];var converted_expense_amount=parseFloat(data[i][constants.ANALYTICS_EXPENSE_CONVERTED_AMOUNT_ATTR]);var expense_width=converted_expense_amount / max_amount*percentage;expense_width+="%";if(converted_expense_amount>0)
$(constants.ANALYTICS_EXPENSE_BAR_ID+i).show();else
$(constants.ANALYTICS_EXPENSE_BAR_ID+i).hide();$(constants.ANALYTICS_EXPENSE_BAR_ID+i).css("width",expense_width);var converted_income_amount=parseFloat(data[i][constants.ANALYTICS_INCOME_CONVERTED_AMOUNT_ATTR]);var income_width=converted_income_amount / max_amount*percentage;income_width+="%";if(converted_income_amount>0)
$(constants.ANALYTICS_INCOME_BAR_ID+i).show();else
$(constants.ANALYTICS_INCOME_BAR_ID+i).hide();$(constants.ANALYTICS_INCOME_BAR_ID+i).css("width",income_width);var savings=converted_income_amount-converted_expense_amount;if(converted_income_amount==0&&converted_expense_amount==0)
$(constants.ANALYTICS_INCOME_EXPENSE_LIMIT_ID+i).hide();else
$(constants.ANALYTICS_INCOME_EXPENSE_LIMIT_ID+i).show();$(constants.ANALYTICS_SAVINGS_BAR_ID+i).hide();$(constants.ANALYTICS_INCOME_EXPENSE_LIMIT_ID+i).css("left",income_width);$(constants.ANALYTICS_OVERSPENDING_ARROW_ID+i).hide();$(constants.ANALYTICS_SAVINGS_ARROW_ID+i).hide();$(constants.ANALYTICS_LOSS_BAR_ID+i).hide();$(constants.ANALYTICS_TOOLTIP_SAVINGS_ID+i).hide();$(constants.ANALYTICS_TOOLTIP_OVERSPENDING_ID+i).hide();if(savings>0){var savings_width=savings / max_amount*percentage;if(savings_width<constants.ANALYTICS_MIN_LABEL_WIDTH)
$(constants.ANALYTICS_SAVINGS_ARROW_LABEL_ID+i).hide();else
$(constants.ANALYTICS_SAVINGS_ARROW_LABEL_ID+i).show();savings_width+="%";var savings_left=converted_expense_amount/max_amount*percentage;$(constants.ANALYTICS_SAVINGS_BAR_ID+i).show();$(constants.ANALYTICS_LOSS_BAR_ID+i).hide();$(constants.ANALYTICS_SAVINGS_BAR_ID+i).css("width",savings_width);$(constants.ANALYTICS_SAVINGS_BAR_ID+i).css("left",savings_left+"%");$(constants.ANALYTICS_INCOME_EXPENSE_LIMIT_ID+i).css("left",savings_left+"%");$(constants.ANALYTICS_SAVINGS_ARROW_ID+i).show();$(constants.ANALYTICS_SAVINGS_ARROW_ID+i).css("width",savings_width);$(constants.ANALYTICS_SAVINGS_ARROW_ID+i).css("left",savings_left+"%");$(constants.ANALYTICS_SAVINGS_ARROW_LABEL_ID+i).html(formatted_savings);$(constants.ANALYTICS_TOOLTIP_SAVINGS_ID+i).show();$(constants.ANALYTICS_INCOME_BAR_LABEL_ID+i).css("left",income_width);$(constants.ANALYTICS_EXPENSE_BAR_LABEL_ID+i).hide();$(constants.ANALYTICS_INCOME_EXPENSE_TOOLTIP_SAVINGS_ROW_ID+i).show();$(constants.ANALYTICS_INCOME_EXPENSE_TOOLTIP_LOSS_ROW_ID+i).hide();if(savings==max_savings){$(constants.ANALYTICS_INCOME_EXPENSE_TOOLTIP_LEAF_MONTH_ICON_ID+i).show();$(constants.ANALYTICS_INCOME_EXPENSE_TOOLTIP_LEAF_ICON_ID+i).show();}}
else if(savings<0){var loss=-1*savings;var loss_width=loss / max_amount*percentage;if(loss_width<constants.ANALYTICS_MIN_LABEL_WIDTH)
$(constants.ANALYTICS_OVERSPENDING_ARROW_LABEL_ID+i).hide();else
$(constants.ANALYTICS_OVERSPENDING_ARROW_LABEL_ID+i).show();loss_width+="%";var loss_left=converted_income_amount/max_amount*percentage;$(constants.ANALYTICS_LOSS_BAR_ID+i).show();$(constants.ANALYTICS_LOSS_BAR_ID+i).css("width",loss_width);$(constants.ANALYTICS_LOSS_BAR_ID+i).css("left",loss_left+"%");$(constants.ANALYTICS_INCOME_EXPENSE_LIMIT_ID+i).css("left",loss_left+"%");$(constants.ANALYTICS_OVERSPENDING_ARROW_ID+i).show();$(constants.ANALYTICS_OVERSPENDING_ARROW_ID+i).css("width",loss_width);$(constants.ANALYTICS_OVERSPENDING_ARROW_ID+i).css("left",loss_left+"%");$(constants.ANALYTICS_OVERSPENDING_ARROW_LABEL_ID+i).html(formatted_overspending);$(constants.ANALYTICS_TOOLTIP_OVERSPENDING_ID+i).show();$(constants.ANALYTICS_EXPENSE_BAR_LABEL_ID+i).css("left",expense_width);$(constants.ANALYTICS_INCOME_BAR_LABEL_ID+i).hide();$(constants.ANALYTICS_INCOME_EXPENSE_TOOLTIP_SAVINGS_ROW_ID+i).hide();$(constants.ANALYTICS_INCOME_EXPENSE_TOOLTIP_LOSS_ROW_ID+i).show();$(constants.ANALYTICS_INCOME_EXPENSE_TOOLTIP_WARNING_ICON_ID+i).show();$(constants.ANALYTICS_INCOME_EXPENSE_TOOLTIP_WARNING_MONTH_ICON_ID+i).show();}
else{$(constants.ANALYTICS_SAVINGS_BAR_ID+i).hide();$(constants.ANALYTICS_LOSS_BAR_ID+i).hide();$(constants.ANALYTICS_INCOME_EXPENSE_TOOLTIP_SAVINGS_ROW_ID+i).hide();$(constants.ANALYTICS_INCOME_EXPENSE_TOOLTIP_LOSS_ROW_ID+i).hide();$(constants.ANALYTICS_INCOME_EXPENSE_TOOLTIP_ID+i).css("height",constants.ANALYTICS_INCOME_EXPENSE_TOOLTIP_MIN_HEIGHT);$(constants.ANALYTICS_INCOME_EXPENSE_TOOLTIP_ID+i).css("top",constants.ANALYTICS_INCOME_EXPENSE_TOOLTIP_MIN_TOP);}
if(converted_income_amount==0&&converted_expense_amount==0){$(constants.ANALYTICS_SAVINGS_ARROW_LABEL_ID+i).show();$(constants.ANALYTICS_SAVINGS_ARROW_LABEL_ID+i).html(formatted_savings);$(constants.ANALYTICS_INCOME_BAR_LABEL_ID+i).hide();}}};Analytics.prototype.get_budget_analytics=function(){$(constants.BUDGETS_ANALYTICS_WRAPPER_ID).hide();$(constants.BUDGETS_ANALYTICS_WRAPPER_LOADING_ID).show();var current_date=new Date();var start_month=$(constants.ANALYTICS_BUDGET_MONTH_ID).val();var start_year=$(constants.ANALYTICS_BUDGET_YEAR_ID).val();var time_zone_offset=current_date.getTimezoneOffset();var budget_id=$(constants.ANALYTICS_BUDGET_BUDGET_ID).val();var account_id=$(constants.ANALYTICS_BUGET_ACCOUNT_ID).val();$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.ANALYITCS_GET_BUDGETS_ANALYTICS_REQUEST,start_month:start_month,start_year:start_year,time_zone_offset:time_zone_offset,budget_id:budget_id,account_id:account_id},success:function(data){GENERAL.check_session_expired(data);$(constants.BUDGETS_ANALYTICS_WRAPPER_ID).show();$(constants.BUDGETS_ANALYTICS_WRAPPER_LOADING_ID).hide();ANALYTICS.show_budget_analytics(data);}});};Analytics.prototype.show_hide_budget_filters=function(){var filters_shown=$(constants.ANALYTICS_BUDGET_MORE_FILTERS_BUTTON_ID).attr(constants.ANALYTICS_BUDGET_FILTERS_SHOWN_ATTR);if(filters_shown==constants.ANALYTICS_BUDGET_FILTERS_SHOWN_YES){$(constants.ANALYTICS_BUDGET_FILTERS_DIV_ID).css("height",constants.ANALYTICS_BUDGET_FILTERS_LESS_FILTERS_HEIGHT);$(constants.ANALYTICS_BUDGET_FILTERS_BUTTON_TEXT_ID).text(constants.ANALYTICS_BUDGET_MORE_FILTERS_TEXT);$(constants.ANALYTICS_BUDGET_MORE_FILTERS_BUTTON_ID).attr(constants.ANALYTICS_BUDGET_FILTERS_SHOWN_ATTR,constants.ANALYTICS_BUDGET_FILTERS_SHOWN_NO);}
else if(filters_shown==constants.ANALYTICS_BUDGET_FILTERS_SHOWN_NO){$(constants.ANALYTICS_BUDGET_FILTERS_DIV_ID).css("height",constants.ANALYTICS_BUDGET_FILTERS_MORE_FILTERS_HEIGHT);$(constants.ANALYTICS_BUDGET_FILTERS_BUTTON_TEXT_ID).text(constants.ANALYTICS_BUDGET_LESS_FILTERS_TEXT);$(constants.ANALYTICS_BUDGET_MORE_FILTERS_BUTTON_ID).attr(constants.ANALYTICS_BUDGET_FILTERS_SHOWN_ATTR,constants.ANALYTICS_BUDGET_FILTERS_SHOWN_YES);}};Analytics.prototype.show_budget_analytics=function(data){var scale=$(constants.ANALYTICS_BUDGET_SCALE_ID).val();if(scale==constants.ANALYTICS_BUDGET_SCALE_MONEY_VAL){ANALYTICS.show_budget_analytics_money_scale(data);return;}
var max_amount=0;if(data.length>0)
max_amount=parseFloat(data[0][constants.ANALYTICS_BUDGET_ANALYTICS_MAX_AMOUNT_ATTR]);if(data.length>1)
data.sort(ANALYTICS.sort_budget_analytics_percentage_descending);var budget_analytics_template=$(constants.BUDGETS_ANALYTICS_TEMPLATE).html();var html_maker=new htmlMaker(budget_analytics_template);var html=html_maker.getHTML(data);$(constants.BUDGETS_ANALYTICS_WRAPPER_ID).html(html);var total_percentage=constants.ANALYTICS_BAR_WIDTH_PERCENTAGE;if(max_amount!=0&&max_amount<100)
max_amount=100;var complete_percentage_width=max_amount==0?total_percentage:100 / max_amount*total_percentage;complete_percentage_width+="%";for(var i=0;i<data.length;i++){var percentage=parseFloat(data[i][constants.ANALYTICS_BUDGET_ANALYTICS_PERCENTAGE]);var percentage_width=max_amount==0?0:percentage / max_amount*total_percentage;var percentage_width_text=percentage_width+"%";$(constants.ANALYTICS_BUDGET_ANALYTICS_BAR_ID+i).css("width",percentage_width_text);if(percentage==0)
$(constants.ANALYTICS_BUDGET_ANALYTICS_BAR_ID+i).hide();$(constants.ANALYTICS_COMPLETE_BUDGET_ANALYTICS_BAR_ID+i).css("width",complete_percentage_width);$(constants.ANALYTICS_BUDGET_UNDERSPENT_TOOLTIP_ID+i).hide();$(constants.ANALYTICS_BUDGET_OVERSPENT_TOOLTIP_ID+i).hide();$(constants.ANALYTICS_BUDGET_ALL_SPENT_TOOLTIP_ID+i).hide();$(constants.ANALYTICS_BUDGET_ABOVE_PERCENTAGE_ANALYTICS_BAR_ID+i).hide();if(percentage>100){var above_percentage_width=(percentage-100)/ max_amount*total_percentage;var above_percentage_width_text=above_percentage_width+"%";var above_percentage_left=percentage_width-above_percentage_width;above_percentage_left+="%";$(constants.ANALYTICS_BUDGET_ABOVE_PERCENTAGE_ANALYTICS_BAR_ID+i).css("left",above_percentage_left);$(constants.ANALYTICS_BUDGET_ABOVE_PERCENTAGE_ANALYTICS_BAR_ID+i).css("width",above_percentage_width_text);$(constants.ANALYTICS_BUDGET_OVERSPENT_TOOLTIP_ID+i).show();$(constants.ANALYTICS_BUDGET_ABOVE_PERCENTAGE_ANALYTICS_BAR_ID+i).show();$(constants.ANALYTICS_BUDGET_TOOLTIP_WARNING_ICON_ID+i).show();$(constants.ANALYTICS_BUDGET_TOOLTIP_WARNING_CATEGORY_ICON_ID+i).show();}
else if(percentage<100){$(constants.ANALYTICS_BUDGET_UNDERSPENT_TOOLTIP_ID+i).show();}
else if(percentage==100){$(constants.ANALYTICS_BUDGET_ALL_SPENT_TOOLTIP_ID+i).show();}
if(percentage==0)
$(constants.ANALYTICS_BUDGET_BAR_LABEL_ID+ +i).hide();else
$(constants.ANALYTICS_BUDGET_BAR_LABEL_ID+ +i).show();$(constants.ANALYTICS_BUDGET_BAR_LABEL_ID+i).css("left",complete_percentage_width);$(constants.ANALYTICS_BUDGET_BAR_LABEL_ID+i).css("width",constants.ANALYTICS_BAR_LABEL_WIDTH+"px");if(percentage>100)
$(constants.ANALYTICS_BUDGET_BAR_LABEL_ID+i).css("left",percentage_width_text);var shorten_category_name=ANALYTICS.shorten_text(data[i][constants.ANALYTICS_EXPENSE_TOOLTIP_CATEGORY_NAME_PROP]);$(constants.ANALYTICS_BUDGET_TOOLTIP_CATEGORY_NAME_ID+i).text(shorten_category_name);}
var budget_analytics_limit=$(constants.BUDGET_ANALYTICS_BUDGET_LIMIT_TEMPLATE).html();var height=constants.TOTAL_ANALYTICS_BUDGET_LIMIT_BAR_HEIGHT*data.length;$(constants.ANALYTICS_BUDGET_ANALYTICS_BAR_WRAPPER_CLASS).first().append(budget_analytics_limit);$(constants.BUDGET_ANALYTICS_BUDGET_LIMIT_ID).css("height",height-constants.TOTAL_ANALYTICS_BUDGET_LIMIT_MARGIN / 2+"px");$(constants.BUDGET_ANALYTICS_BUDGET_LIMIT_ID).css("left",complete_percentage_width);$(constants.BUDGET_ANALYTICS_BUDGET_LIMIT_LABEL_ID).css("left",complete_percentage_width);$(constants.BUDGET_ANALYTICS_BUDGET_LIMIT_LABEL_ID).css("top",height-constants.TOTAL_ANALYTICS_BUDGET_LIMIT_MARGIN+"px");};Analytics.prototype.show_budget_analytics_money_scale=function(data){var max_amount=0;if(data.length>0)
max_amount=parseFloat(data[0][constants.ANALYTICS_BUDGET_ANALYTICS_MAX_AMOUNT_MONEY_SCALE_ATTR]);if(data.length>1)
data.sort(ANALYTICS.sort_budget_analytics_amount_descending);var budget_analytics_template=$(constants.BUDGETS_ANALYTICS_MONEY_SCALE_TEMPLATE).html();var html_maker=new htmlMaker(budget_analytics_template);var html=html_maker.getHTML(data);$(constants.BUDGETS_ANALYTICS_WRAPPER_ID).html(html);var total_percentage=constants.ANALYTICS_BAR_WIDTH_PERCENTAGE;var min_label_width=constants.ANALYTICS_MIN_LABEL_WIDTH;for(var i=0;i<data.length;i++){var spent_amount=parseFloat(data[i][constants.ANALYTICS_BUDGET_ANALYTICS_SPENT_AMOUNT]);var overspent_amount=parseFloat(data[i][constants.ANALYTICS_BUDGET_ANALYTICS_OVERSPENT_AMOUNT]);var remaining_amount=parseFloat(data[i][constants.ANALYTICS_BUDGET_ANALYTICS_REMAINING_AMOUNT]);var planned_amount=parseFloat(data[i][constants.ANALYTICS_BUDGET_ANALYTICS_PLANNED_AMOUNT]);var spent_amount_width=max_amount==0?0:spent_amount / max_amount*total_percentage;var spent_amount_width_text=spent_amount_width+"%";$(constants.ANALYTICS_BUDGET_ANALYTICS_BAR_ID+i).css("width",spent_amount_width_text);$(constants.ANALYTICS_BUDGET_BAR_LABEL_ID+i).css("width",spent_amount_width_text);if(spent_amount==0)
$(constants.ANALYTICS_BUDGET_ANALYTICS_BAR_ID+i).hide();else
$(constants.ANALYTICS_BUDGET_ANALYTICS_BAR_ID+i).show();var planned_amount_width=planned_amount==0?0:planned_amount / max_amount*total_percentage;var planned_amount_width_text=planned_amount_width+"%";$(constants.ANALYTICS_COMPLETE_BUDGET_ANALYTICS_BAR_ID+i).css("width",planned_amount_width_text);var overspent_left=planned_amount_width_text;if(spent_amount==0)
$(constants.ANALYTICS_BUDGET_BAR_LABEL_ID+ +i).hide();else
$(constants.ANALYTICS_BUDGET_BAR_LABEL_ID+ +i).show();$(constants.ANALYTICS_BUDGET_BAR_LABEL_ID+i).css("left",spent_amount_width+"%");$(constants.ANALYTICS_BUDGET_BAR_LABEL_ID+i).css("width",constants.ANALYTICS_BAR_LABEL_WIDTH+"px");if(overspent_amount<=0)
$(constants.ANALYTICS_BUDGET_BAR_LABEL_ID+i).css("left",planned_amount_width+"%");$(constants.ANALYTICS_BUDGET_UNDERSPENT_TOOLTIP_ID+i).hide();$(constants.ANALYTICS_BUDGET_OVERSPENT_TOOLTIP_ID+i).hide();$(constants.ANALYTICS_BUDGET_ALL_SPENT_TOOLTIP_ID+i).hide();$(constants.ANALYTICS_BUDGET_ABOVE_PERCENTAGE_ANALYTICS_BAR_ID+i).hide();if(overspent_amount>0){var overspent_width=overspent_amount / max_amount*total_percentage;var overspent_width_text=overspent_width+"%";overspent_left=(spent_amount-overspent_amount)/ max_amount*total_percentage;overspent_left+="%";$(constants.ANALYTICS_BUDGET_ABOVE_PERCENTAGE_ANALYTICS_BAR_ID+i).css("left",overspent_left);$(constants.ANALYTICS_BUDGET_ABOVE_PERCENTAGE_ANALYTICS_BAR_ID+i).css("width",overspent_width_text);$(constants.ANALYTICS_BUDGET_OVERSPENT_TOOLTIP_ID+i).show();$(constants.ANALYTICS_BUDGET_ABOVE_PERCENTAGE_ANALYTICS_BAR_ID+i).show();$(constants.ANALYTICS_BUDGET_TOOLTIP_WARNING_ICON_ID+i).show();$(constants.ANALYTICS_BUDGET_TOOLTIP_WARNING_CATEGORY_ICON_ID+i).show();}
else if(remaining_amount>0){$(constants.ANALYTICS_BUDGET_UNDERSPENT_TOOLTIP_ID+i).show();}
else if(remaining_amount==0&&overspent_amount==0){$(constants.ANALYTICS_BUDGET_ALL_SPENT_TOOLTIP_ID+i).show();}
$(constants.BUDGET_ANALYTICS_BUDGET_LIMIT_SINGLE_ID+i).css("height",constants.BUDGET_ANALYTICS_BUDGET_LIMIT_HEIGHT);$(constants.BUDGET_ANALYTICS_BUDGET_LIMIT_SINGLE_ID+i).css("top",constants.BUDGET_ANALYTICS_BUDGET_LIMIT_TOP);$(constants.BUDGET_ANALYTICS_BUDGET_LIMIT_SINGLE_ID+i).css("left",overspent_left);var shorten_category_name=ANALYTICS.shorten_text(data[i][constants.ANALYTICS_EXPENSE_TOOLTIP_CATEGORY_NAME_PROP]);$(constants.ANALYTICS_BUDGET_TOOLTIP_CATEGORY_NAME_ID+i).text(shorten_category_name);}};Analytics.prototype.get_user_budgets=function(){var current_date=new Date();var start_month=$(constants.ANALYTICS_BUDGET_MONTH_ID).val();var start_year=$(constants.ANALYTICS_BUDGET_YEAR_ID).val();var time_zone_offset=current_date.getTimezoneOffset();$.ajax({method:"POST",url:constants.CONTROLLER_PATH,dataType:"json",data:{type:constants.ANALYITCS_GET_BUDGETS_REQUEST,start_month:start_month,start_year:start_year,time_zone_offset:time_zone_offset},success:function(data){GENERAL.check_session_expired(data);ANALYTICS.populate_budget_filters(data);}});};Analytics.prototype.populate_budget_filters=function(data){var account_combobox_template=$(constants.BUDGETS_FILTER_COMBOBOX_TEMPLATE).html();var html_maker=new htmlMaker(account_combobox_template);var budgets_html=html_maker.getHTML(data);$(constants.ANALYTICS_BUDGET_BUDGET_ID).html(budgets_html);ANALYTICS.get_budget_analytics();};Analytics.prototype.populate_account_filters=function(){var account_combobox_template=$(constants.ACCOUNTS_FILTER_COMBOBOX_TEMPLATE).html();var html_maker=new htmlMaker(account_combobox_template);var accounts_html=html_maker.getHTML(TRANSACTION.user_accounts);$(constants.ANALYTICS_EXPENSE_ACCOUNT_COMBOBOX_ID).html("<option value='all_accounts'>All</option>");$(constants.ANALYTICS_EXPENSE_ACCOUNT_COMBOBOX_ID).append(accounts_html);$(constants.ANALYTICS_TOTAL_EXPENSE_ACCOUNT_COMBOBOX_ID).html("<option value='all_accounts'>All</option>");$(constants.ANALYTICS_TOTAL_EXPENSE_ACCOUNT_COMBOBOX_ID).append(accounts_html);$(constants.ANALYTICS_BUGET_ACCOUNT_ID).html("<option value='all_accounts'>All</option>");$(constants.ANALYTICS_BUGET_ACCOUNT_ID).append(accounts_html);$(constants.ANALYTICS_INCOME_EXPENSE_ACCOUNT_COMBOBOX_ID).html("<option value='all_accounts'>All</option>");$(constants.ANALYTICS_INCOME_EXPENSE_ACCOUNT_COMBOBOX_ID).append(accounts_html);$(constants.ANALYTICS_SAVING_ACCOUNT_COMBOBOX_ID).html("<option value='all_accounts'>All</option>");$(constants.ANALYTICS_SAVING_ACCOUNT_COMBOBOX_ID).append(accounts_html);};Analytics.prototype.show_total_monthly_vertical_bar_savings=function(data){var previous_tab=ANALYTICS.save_previous_tab();var parent_width=parseInt($(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_DIV_WRAPPER).css("width"));ANALYTICS.restore_previous_tab(previous_tab);var divide_by=data.length<6?12:data.length*2.3;var bar_width=parent_width/divide_by;var max_saving=0;var min_saving=0;var max_amount=0;var total_amount=0;var formatted_total_amount="";if(data.length>0){max_saving=parseFloat(data[0][constants.ANALYTICS_SAVING_MAX_SAVING_ATTR]);min_saving=parseFloat(data[0][constants.ANALYTICS_SAVING_MIN_SAVING_ATTR]);if((max_saving>0&&min_saving>0)||(max_saving<0&&min_saving<0))
max_amount=Math.abs(max_saving);else if(max_saving>0&&min_saving<0)
max_amount=max_saving+Math.abs(min_saving);else if(max_saving>0&&min_saving==0)
max_amount=max_saving;else if(max_saving==0&&min_saving<0)
max_amount=Math.abs(min_saving);formatted_total_amount=data[0][constants.ANALYTICS_SAVING_FORMATTED_TOTAL_SAVING_ATTR];total_amount=parseFloat(data[0][constants.ANALYTICS_SAVING_TOTAL_SAVING_ATTR]);}
data.reverse();var total_monthly_saving_template=$(constants.ANALYTICS_TOTAL_SAVING_TRANSACTION_BAR_TEMPLATE_ID).html();var html_maker=new htmlMaker(total_monthly_saving_template);var html=html_maker.getHTML(data);var line_chart_template=$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_TEMPLATE_ID).html();var svg_wrapper=$(constants.ANALYTICS_TOTAL_SAVING_BAR_SVG_WRAPPER_TEMPLATE_ID).html();$(constants.ANALYTICS_MONTHLY_SAVING_LINE_DIV_WRAPPER).html(svg_wrapper);$(constants.ANALYTICS_MONTHLY_SAVING_LINE_WRAPPER).html(html);$(constants.ANALYTICS_MONTHLY_SAVING_LINE_WRAPPER).append(line_chart_template);var label_template=$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_LABEL_TEMPLATE_ID).html();html_maker=new htmlMaker(label_template);html=html_maker.getHTML(data);$(constants.ANALYTICS_MONTHLY_SAVING_LINE_DIV_WRAPPER).append(html);if(data.length>0){$(constants.ANALYTICS_SAVING_TOTAL_AMOUNT_ID).html(formatted_total_amount);if(total_amount<0)
$(constants.ANALYTICS_SAVING_TOTAL_AMOUNT_ID).css("background-color",constants.ANALYTICS_MONTHLY_OVERSPENDING_TEXT_COLOR);}
else
$(constants.ANALYTICS_SAVING_TOTAL_AMOUNT_ID).hide();var lineData=[];var top=45;if(min_saving<0){var shift=Math.abs(min_saving)/ max_amount*constants.ANALYTICS_MONTHLY_EXPENSE_LINE_WRAPPER_HEIGHT;top-=shift;var x_axis_bottom=parseInt($(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_HORIZONTAL_LINE_ID).css("bottom"));$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_HORIZONTAL_LINE_ID).css("bottom",(x_axis_bottom+shift)+"px");var label_bottom=parseInt($(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_LABEL_CLASS).css("bottom"));$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_LABEL_CLASS).css("bottom",(label_bottom+shift+6)+"px");}
for(var i=0;i<data.length;i++){var previous_amount=i<=1?0:parseFloat(data[i-1][constants.ANALYTICS_SAVING_AMOUNT_ATTR]);var converted_amount=parseFloat(data[i][constants.ANALYTICS_SAVING_AMOUNT_ATTR]);var next_amount=i==data.length-1?0:parseFloat(data[i+1][constants.ANALYTICS_SAVING_AMOUNT_ATTR]);var height=converted_amount / max_amount*constants.ANALYTICS_MONTHLY_EXPENSE_LINE_WRAPPER_HEIGHT;var left=2*i*bar_width+bar_width;var bar_top=constants.ANALYTICS_MONTHLY_EXPENSE_LINE_WRAPPER_HEIGHT-height+top;var point={"x":left+bar_width/2,"y":constants.ANALYTICS_MONTHLY_EXPENSE_LINE_WRAPPER_HEIGHT-height+top};$(constants.ANALYTICS_SAVING_TOTAL_BAR_ID+i).attr("width",bar_width+"px");$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_LABEL+i).css("width",bar_width+"px");$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_SPENDING_LABEL+i).css("width",bar_width+"px");$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_SPENDING_LABEL+i).css("top",bar_top-constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_AVERAGE_LABEL_TOP_MARGIN+"px");$(constants.ANALYTICS_SAVING_TOTAL_BAR_ID+i).show();if(height<0){height=-1*height;$(constants.ANALYTICS_SAVING_TOTAL_BAR_ID+i).css("fill",constants.ANALYTICS_MONTHLY_OVERSPENDING_TEXT_COLOR);bar_top=constants.ANALYTICS_MONTHLY_EXPENSE_LINE_WRAPPER_HEIGHT+top;var x_axis_bottom=parseInt($(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_HORIZONTAL_LINE_ID).css("bottom"));$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_LABEL+i).css("bottom",(x_axis_bottom-4)+"px");$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_SPENDING_LABEL+i).css("top",(bar_top+height)+"px");}
$(constants.ANALYTICS_SAVING_TOTAL_BAR_ID+i).attr("height",height+"px");$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_LABEL+i).css("left",left+"px");$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_SPENDING_LABEL+i).css("left",left+"px");$(constants.ANALYTICS_SAVING_TOTAL_BAR_ID+i).attr("x",left+"px");$(constants.ANALYTICS_SAVING_TOTAL_BAR_ID+i).attr("y",bar_top);$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_TRANSPARENT_BAR_ID+i).css({"width":bar_width+"px","left":left+"px","height":constants.ANALYTICS_MONTHLY_EXPENSE_LINE_WRAPPER_HEIGHT+"px","top":top+"px"});$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_TOOLTIP_ID+i).css("top",-height-constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_BOTTOM_MARGIN+"px");if(converted_amount<0){$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_TRANSPARENT_BAR_ID+i).css("top",bar_top+"px");$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_TOOLTIP_ID+i).css("top",-50+"px");}
if(i>=data.length-2&&data.length>4&&data.length<=7){$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_TOOLTIP_ID+i).removeClass(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_TOOLTIP_CLASS);$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_TOOLTIP_ID+i).addClass(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_TOOLTIP_CLASS_V2);}
else if(i>=data.length-4&&data.length>7){$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_TOOLTIP_ID+i).removeClass(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_TOOLTIP_CLASS);$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_TOOLTIP_ID+i).addClass(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_TOOLTIP_CLASS_V3);}
if(parent_width<600&&i%2==0&&data.length>5){$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_LABEL_TEXT+i).hide();}
if(i==data.length-1||(converted_amount>0&&converted_amount>previous_amount&&converted_amount>next_amount&&i!=data.length-2)||(converted_amount<0&&converted_amount<next_amount&&converted_amount<previous_amount))
$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_SPENDING_LABEL+i).show();else
$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_SPENDING_LABEL+i).hide();if(converted_amount<0&&parent_width<600&&data.length>5)
$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_SPENDING_LABEL+i).hide();if(converted_amount>0){$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_SPENDING_LABEL+i).css("color",constants.ANALYTICS_MONTHLY_SAVING_TEXT_COLOR);$(constants.ANALYTICS_MONTHLY_SAVING_TOOLTIP_AMOUNT_ID+i).css("color",constants.ANALYTICS_MONTHLY_SAVING_TEXT_COLOR);}
else if(converted_amount<0){$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_SPENDING_LABEL+i).css("color",constants.ANALYTICS_MONTHLY_OVERSPENDING_TEXT_COLOR);$(constants.ANALYTICS_MONTHLY_SAVING_TOOLTIP_AMOUNT_ID+i).css("color",constants.ANALYTICS_MONTHLY_OVERSPENDING_TEXT_COLOR);}
if(converted_amount<0&&next_amount==max_saving&&data.length>6)
$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_SPENDING_LABEL+i).hide();if(converted_amount>0&&converted_amount==max_saving&&parent_width>=600){$(constants.ANALYTICS_MONTHLY_SAVING_SPENDING_ICON+i).css("visibility","visible");var bottom=parseInt($(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_LABEL+i).css("bottom"));$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_LABEL+i).css("bottom",(bottom-6)+"px");}
else
$(constants.ANALYTICS_MONTHLY_SAVING_SPENDING_ICON+i).parent().hide();lineData.push(point);}
var lineFunction=d3.svg.line().x(function(d){return d.x;}).y(function(d){return d.y;}).interpolate("linear");var line_chart_path=d3.select(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_PATH_ID);line_chart_path.attr("d",lineFunction(lineData));html=$(constants.ANALYTICS_MONTHLY_SAVING_LINE_DIV_WRAPPER).html();$(constants.ANALYTICS_MONTHLY_SAVING_LINE_DIV_WRAPPER).html(html);for(var i=0;i<data.length;i++)
ANALYTICS.on_saving_bar_hovered(i);};Analytics.prototype.on_saving_bar_hovered=function(index){$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_TRANSPARENT_BAR_ID+index).hover(function(){$(constants.ANALYTICS_SAVING_TOTAL_BAR_ID+index).css({"stroke":"orange","cursor":"pointer","stroke-width":2});});$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_TRANSPARENT_BAR_ID+index).mouseout(function(){var color=$(constants.ANALYTICS_SAVING_TOTAL_BAR_ID+index).css("fill");$(constants.ANALYTICS_SAVING_TOTAL_BAR_ID+index).css({"stroke":color,"stroke-width":"1"});});$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_TOOLTIP_ID+index).hover(function(){$(constants.ANALYTICS_SAVING_TOTAL_BAR_ID+index).css({"stroke":"orange","cursor":"pointer","stroke-width":2});});$(constants.ANALYTICS_MONTHLY_SAVING_LINE_CHART_TOOLTIP_ID+index).mouseout(function(){var color=$(constants.ANALYTICS_SAVING_TOTAL_BAR_ID+index).css("fill");$(constants.ANALYTICS_SAVING_TOTAL_BAR_ID+index).css({"stroke":color,"stroke-width":"1"});});};Analytics.prototype.show_total_monthly_vertical_bar_average=function(){var avg_checkbox_checked=$(constants.ANALYTICS_MONTHLY_TOTAL_EXPENSE_AVG_COMBOBOX_ID).prop("checked");if(avg_checkbox_checked){$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_AVERAGE).show();$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_AVERAGE_LABEL_ID).show();}
else{$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_AVERAGE).hide();$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_AVERAGE_LABEL_ID).hide();}};Analytics.prototype.show_total_monthly_vertical_bar_expense=function(data){var previous_tab=ANALYTICS.save_previous_tab();var parent_width=parseInt($(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_DIV_WRAPPER).css("width"));ANALYTICS.restore_previous_tab(previous_tab);var divide_by=data.length<=6.2?12:data.length*2.3;var bar_width=parent_width/divide_by;var max_amount=0;var total_amount="";if(data.length>0){max_amount=parseFloat(data[0][constants.ANALYTICS_MONTHLY_EXPENSE_MAX_AMOUNT_ATTR]);total_amount=data[0][constants.ANALYTICS_FORMATTED_TOTAL_AMOUNT_ATTR];}
data.reverse();var total_monthly_expense_template=$(constants.ANALYTICS_TOTAL_TRANSACTION_BAR_TEMPLATE_ID).html();var html_maker=new htmlMaker(total_monthly_expense_template);var html=html_maker.getHTML(data);var line_chart_template=$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_TEMPLATE_ID).html();var svg_wrapper=$(constants.ANALYTICS_TOTAL_TRANSACTION_BAR_SVG_WRAPPER_TEMPLATE_ID).html();$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_DIV_WRAPPER).html(svg_wrapper);$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_WRAPPER).html(html);$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_WRAPPER).append(line_chart_template);var label_template=$(constants.ANALYTICS_MONTHLY_LINE_CHART_LABEL_TEMPLATE_ID).html();html_maker=new htmlMaker(label_template);html=html_maker.getHTML(data);$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_DIV_WRAPPER).append(html);if(data.length>0){$(constants.ANALYTICS_EXPENSE_TOTAL_AMOUNT_ID).html(total_amount);}
else
$(constants.ANALYTICS_EXPENSE_TOTAL_AMOUNT_ID).hide();var lineData=[];var top=50;for(var i=0;i<data.length;i++){var previous_amount=i<=1?0:parseFloat(data[i-1][constants.ANALYTICS_CONVERTED_AMOUNT_ATTR]);var converted_amount=parseFloat(data[i][constants.ANALYTICS_CONVERTED_AMOUNT_ATTR]);var next_amount=i==data.length-1?0:parseFloat(data[i+1][constants.ANALYTICS_CONVERTED_AMOUNT_ATTR]);var class_name=data[i][constants.TOTAL_ANALYTICS_CLASS_NAME_ATTR];var height=converted_amount / max_amount*constants.ANALYTICS_MONTHLY_EXPENSE_LINE_WRAPPER_HEIGHT;var left=2*(i-1)*bar_width+bar_width;var bar_top=constants.ANALYTICS_MONTHLY_EXPENSE_LINE_WRAPPER_HEIGHT-height+top;var point={"x":left+bar_width/2,"y":constants.ANALYTICS_MONTHLY_EXPENSE_LINE_WRAPPER_HEIGHT-height+top};$(constants.ANALYTICS_TRANSACTION_TOTAL_BAR_BACKGROUND_ID+i).attr("width",bar_width+"px");$(constants.ANALYTICS_TRANSACTION_TOTAL_BAR_ID+i).attr("width",bar_width+"px");$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_LABEL+i).css("width",bar_width+"px");$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_SPENDING_LABEL+i).css("width",bar_width+"px");$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_SPENDING_LABEL+i).css("top",bar_top-constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_AVERAGE_LABEL_TOP_MARGIN+"px");$(constants.ANALYTICS_TRANSACTION_TOTAL_BAR_ID+i).show();$(constants.ANALYTICS_TRANSACTION_TOTAL_BAR_ID+i).attr("height",height+"px");$(constants.ANALYTICS_TRANSACTION_TOTAL_BAR_BACKGROUND_ID+i).attr("x",left+"px");$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_LABEL+i).css("left",left+"px");$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_SPENDING_LABEL+i).css("left",left+"px");$(constants.ANALYTICS_TRANSACTION_TOTAL_BAR_ID+i).attr("x",left+"px");$(constants.ANALYTICS_TRANSACTION_TOTAL_BAR_BACKGROUND_ID+i).attr("y",top+"px");$(constants.ANALYTICS_TRANSACTION_TOTAL_BAR_ID+i).attr("y",bar_top);if(i==data.length-1){$(constants.ANALYTICS_TRANSACTION_TOTAL_BAR_ID+i).css({"stroke":"rgb(0,190,253)","fill":"rgb(0,190,253)"});$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_SPENDING_LABEL+i).css({"color":"rgb(0,190,253)","font-weight":"bold"});}
$(constants.ANALYTICS_TRANSACTION_TOTAL_BAR_BACKGROUND_ID+i).attr("height",constants.ANALYTICS_MONTHLY_EXPENSE_LINE_WRAPPER_HEIGHT+"px");$(constants.ANALYTICS_TRANSACTION_TOTAL_BAR_BACKGROUND_ID+i).hide();$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_TRANSPARENT_BAR_ID+i).css({"width":bar_width+"px","left":left+"px","height":constants.ANALYTICS_MONTHLY_EXPENSE_LINE_WRAPPER_HEIGHT+"px","top":top+"px"});$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_TOOLTIP_ID+i).css("top",-height-constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_BOTTOM_MARGIN+"px");$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_AVERAGE_ID+i).css("left",left+"px");if(i>=data.length-2&&data.length>4&&data.length<=7){$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_TOOLTIP_ID+i).removeClass(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_TOOLTIP_CLASS);$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_TOOLTIP_ID+i).addClass(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_TOOLTIP_CLASS_V2);}
else if(i>=data.length-4&&data.length>7){$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_TOOLTIP_ID+i).removeClass(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_TOOLTIP_CLASS);$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_TOOLTIP_ID+i).addClass(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_TOOLTIP_CLASS_V3);}
var below_average=parseFloat(data[i][constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_BELOW_AVERAGE_ATTR]);var above_average=parseFloat(data[i][constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_ABOVE_AVERAGE_ATTR]);if(above_average>0)
$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_ABOVE_AVERAGE_ROW_ID+i).show();else
$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_ABOVE_AVERAGE_ROW_ID+i).hide();if(below_average>0)
$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_BELOW_AVERAGE_ROW_ID+i).show();else
$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_BELOW_AVERAGE_ROW_ID+i).hide();if(parent_width<600&&(i+1)%2==0&&data.length>6){$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_LABEL_TEXT+i).hide();}
if(max_amount==converted_amount||i==data.length-1||(converted_amount>previous_amount&&converted_amount>next_amount))
$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_SPENDING_LABEL+i).show();else
$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_SPENDING_LABEL+i).hide();if(max_amount==converted_amount){$(constants.ANALYTICS_EXPENSE_MONTHLY_LINE_CHART_FLAME_ICON_ID+i).css("visibility","visible");$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_LABEL+i).css("bottom","18px");}
else
$(constants.ANALYTICS_EXPENSE_MONTHLY_LINE_CHART_FLAME_ICON_ID+i).parent().hide();if(class_name==constants.TOTAL_ANALYTICS_AVERAGE_BAR_CLASS_NAME){$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_TRANSPARENT_BAR_ID+i).hide();$(constants.ANALYTICS_TRANSACTION_TOTAL_BAR_BACKGROUND_ID+i).hide();$(constants.ANALYTICS_TRANSACTION_TOTAL_BAR_ID+i).hide();$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_LABEL+i).hide();$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_SPENDING_LABEL+i).hide();var avg_template=$(constants.ANALYTICS_MONTHLY_LINE_CHART_AVERAGE_TEMPLATE_ID).html();html_maker=new htmlMaker(avg_template);html=html_maker.getHTML(data[i]);var avg_bar_top=constants.ANALYTICS_MONTHLY_EXPENSE_LINE_WRAPPER_HEIGHT-height+top;var avg_bar_width=bar_width*2*(data.length-1)-bar_width+constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_AVERAGE_EXTRA_WIDTH;$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_DIV_WRAPPER).append(html);$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_AVERAGE_CLASS).css("top",avg_bar_top+"px");$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_AVERAGE_CLASS).css("width",bar_width+"px");$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_AVERAGE).css({"width":avg_bar_width+"px","left":bar_width+"px"});ANALYTICS.show_total_monthly_vertical_bar_average();}
else
lineData.push(point);}
var lineFunction=d3.svg.line().x(function(d){return d.x;}).y(function(d){return d.y;}).interpolate("linear");var line_chart_path=d3.select(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_PATH_ID);line_chart_path.attr("d",lineFunction(lineData));html=$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_DIV_WRAPPER).html();$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_DIV_WRAPPER).html(html);for(var i=0;i<data.length;i++)
ANALYTICS.on_analytics_transaction_bar_hovered(i,data.length-1);};Analytics.prototype.on_analytics_transaction_bar_hovered=function(index,last_index){$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_TRANSPARENT_BAR_ID+index).hover(function(){$(constants.ANALYTICS_TRANSACTION_TOTAL_BAR_ID+index).css({"stroke":"orange","cursor":"pointer","stroke-width":2});$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_AVERAGE_ID+index).show();$(constants.ANALYTICS_TRANSACTION_TOTAL_BAR_BACKGROUND_ID+index).show();});$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_TRANSPARENT_BAR_ID+index).mouseout(function(){var stroke_color=index===last_index?"rgb(0,190,253)":"rgb(245,245,245)";$(constants.ANALYTICS_TRANSACTION_TOTAL_BAR_ID+index).css({"stroke":stroke_color,"stroke-width":"1"});$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_AVERAGE_ID+index).hide();$(constants.ANALYTICS_TRANSACTION_TOTAL_BAR_BACKGROUND_ID+index).hide();});$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_TOOLTIP_ID+index).hover(function(){$(constants.ANALYTICS_TRANSACTION_TOTAL_BAR_ID+index).css({"stroke":"orange","cursor":"pointer","stroke-width":2});$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_AVERAGE_ID+index).show();$(constants.ANALYTICS_TRANSACTION_TOTAL_BAR_BACKGROUND_ID+index).show();});$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_TOOLTIP_ID+index).mouseout(function(){$(constants.ANALYTICS_TRANSACTION_TOTAL_BAR_ID+index).css({"stroke":"rgb(0,190,253)","stroke-width":"1"});$(constants.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_AVERAGE_ID+index).hide();$(constants.ANALYTICS_TRANSACTION_TOTAL_BAR_BACKGROUND_ID+index).hide();});};Analytics.prototype.save_previous_tab=function(){var tab_analytics_chosen=$(constants.ANALYTICS_MAIN_TAB).attr("class");var main_tab_pressed_id=$(constants.PRESSED_TAB).attr('id');if(("#"+main_tab_pressed_id)!=constants.ANALYTICS_MAIN_TAB)
$(constants.ANALYTICS_MAIN_TAB).click();if(tab_analytics_chosen==constants.CHOSEN_TAB_CLASS)
$(constants.ANALYTICS_MAIN_TAB).click();return main_tab_pressed_id;};Analytics.prototype.restore_previous_tab=function(tab_id){if(("#"+tab_id)!=constants.ANALYTICS_MAIN_TAB)
$("#"+tab_id).click();};Analytics.prototype.shorten_text=function(text){if(text.length<=constants.ANALYTICS_EXPENSE_TOOLTIP_SPENDING_NAME_MAX_LENGTH)
return text;var short_text=text.substring(0,constants.ANALYTICS_EXPENSE_TOOLTIP_SPENDING_NAME_MAX_LENGTH);return short_text+constants.ELLIPSIS;};Analytics.prototype.show_monthly_expense=function(data,filter_by,prev_show,avg_show,month,year){var max_amount=0;var this_max_amount=0;var prev_max_amount=0;var avg_max_amount=0;var this_month_text="";var prev_month_text="";var date=new Date();var this_month=date.getMonth()+1;var this_year=date.getFullYear();var this_day=date.getDate();var current_month=this_month==month&&this_year==year;var after_twenty=current_month&&this_day>=20;var apply_encouragement=after_twenty||!current_month;if(data.length>0){max_amount=parseFloat(data[0][constants.ANALYTICS_MONTHLY_EXPENSE_MAX_AMOUNT_ATTR]);this_max_amount=parseFloat(data[0][constants.ANALYTICS_MONTHLY_EXPENSE_THIS_MONTH_MAX_AMOUNT_ATTR]);prev_max_amount=parseFloat(data[0][constants.ANALYTICS_MONTHLY_EXPENSE_PREV_MONTH_MAX_AMOUNT_ATTR]);avg_max_amount=parseFloat(data[0][constants.ANALYTICS_MONTHLY_EXPENSE_AVG_MAX_AMOUNT_ATTR]);this_month_text=data[0][constants.ANALYTICS_EXPENSE_TOOLTIP_THIS_MONTH_TEXT_ATTR];prev_month_text=data[0][constants.ANALYTICS_EXPENSE_TOOLTIP_PREV_MONTH_TEXT_ATTR];if(prev_show=="yes"&&avg_show=="no"){max_amount=this_max_amount>prev_max_amount?this_max_amount:prev_max_amount;}
else if(prev_show=="no"&&avg_show=="yes"){max_amount=this_max_amount>avg_max_amount?this_max_amount:avg_max_amount;}
else if(prev_show=="no"&&avg_show=="no"){max_amount=this_max_amount;}}
if(data.length>1)
data.sort(ANALYTICS.compare_monthly_expense);var monthly_expense_template="";if(filter_by==constants.ANALYTICS_MONTHLY_EXPENSE_FILTER_BY_CATEGORY)
monthly_expense_template=$(constants.ANALYTICS_MONTHLY_EXPENSE_TEMPLATE_ID).html();else if(filter_by==constants.ANALYTICS_MONTHLY_EXPENSE_FILTER_BY_ITEM)
monthly_expense_template=$(constants.ANALYTICS_MONTHLY_EXPENSE_ITEM_TEMPLATE_ID).html();else if(filter_by==constants.ANALYTICS_MONTHLY_EXPENSE_FILTER_BY_PAYEE)
monthly_expense_template=$(constants.ANALYTICS_MONTHLY_EXPENSE_PAYEE_TEMPLATE_ID).html();var html_maker=new htmlMaker(monthly_expense_template);var html=html_maker.getHTML(data);$(constants.ANALYTICS_MONTHLY_EXPENSE_WRAPPER_ID).html(html);var percentage=constants.ANALYTICS_BAR_WIDTH_PERCENTAGE;$("html").on("click",function(){$(constants.ANALYTICS_EXPENSE_TOOLTIP_CLASS).hide();});var start_month=$(constants.ANALYTICS_INCOME_EXPENSE_MONTH_COMBOBOX_ID).find('option:selected').text();var start_year=$(constants.ANALYTICS_INCOME_EXPENSE_YEAR_COMBOBOX_ID).val();$(constants.ANALYTICS_MONTHLY_EXPENSE_WRAPPER_NOTHING_FOUND_MONTH_ID).text(start_month+" "+start_year);if(data.length==0){$(constants.ANALYTICS_MONTHLY_EXPENSE_WRAPPER_NOTHING_FOUND_ID).show();}
for(var i=0;i<data.length;i++){var tabs=[constants.BY_NAME_TAB+i,constants.BY_PAYEE_TAB+i];GENERAL.bind_tab_events(tabs);var converted_amount=parseFloat(data[i][constants.ANALYTICS_CONVERTED_AMOUNT_ATTR]);var max_tooltip_amount=converted_amount;var this_month_bar=isNaN(converted_amount)?false:converted_amount<=0?false:true;if(this_month_bar){var this_month_width=converted_amount / max_amount*percentage;var label_left=this_month_width+"%";$(constants.ANALYTICS_MONTHLY_EXPENSE_BAR_LABEL_ID+i).css("left",label_left);$(constants.ANALYTICS_MONTHLY_EXPENSE_BAR_ID+i).show();$(constants.ANALYTICS_MONTHLY_EXPENSE_BAR_ID+i).css("width",this_month_width+"%");}
else{$(constants.ANALYTICS_MONTHLY_EXPENSE_BAR_ID+i).hide();$(constants.ANALYTICS_EXPENSE_TOOLTIP_ID+i).hide();}
var prev_converted_amount=parseFloat(data[i][constants.ANALYTICS_PREV_MONTH_CONVERTED_AMOUNT_ATTR]);if(prev_converted_amount>max_tooltip_amount)
max_tooltip_amount=prev_converted_amount;var prev_month_bar=prev_show=="no"?false:isNaN(prev_converted_amount)?false:prev_converted_amount<=0?false:true;if(prev_month_bar){var prev_month_width=prev_converted_amount / max_amount*percentage;var label_left=prev_month_width+"%";$(constants.ANALYTICS_PREV_MONTHLY_EXPENSE_BAR_LABEL_ID+i).css("left",label_left);$(constants.ANALYTICS_PREV_MONTHLY_EXPENSE_BAR_ID+i).show();$(constants.ANALYTICS_PREV_MONTHLY_EXPENSE_BAR_ID+i).css("width",prev_month_width+"%");if(prev_converted_amount>converted_amount)
$(constants.ANALYTICS_MONTHLY_EXPENSE_BAR_LABEL_ID+i).hide();}
else{$(constants.ANALYTICS_PREV_MONTHLY_EXPENSE_BAR_ID+i).hide();$(constants.ANALYTICS_PREV_MONTHLY_EXPENSE_BAR_LABEL_ID+i).hide();$(constants.ANALYTICS_MONTHLY_EXPENSE_BAR_LABEL_ID+i).show();}
var avg_converted_amount=parseFloat(data[i][constants.ANALYTICS_AVG_MONTH_CONVERTED_AMOUNT_ATTR]);if(avg_converted_amount>max_tooltip_amount)
max_tooltip_amount=avg_converted_amount;var avg_display=avg_show=="no"?false:isNaN(avg_converted_amount)?false:avg_converted_amount<=0?false:true;if(avg_display){var this_avg_month_width=avg_converted_amount / max_amount*percentage;this_avg_month_width+="%";$(constants.ANALYTICS_AVG_MONTHLY_EXPENSE_BAR_ID+i).show();$(constants.ANALYTICS_AVG_MONTHLY_EXPENSE_BAR_ID+i).css("width",this_avg_month_width);}
else
$(constants.ANALYTICS_AVG_MONTHLY_EXPENSE_BAR_ID+i).hide();if(apply_encouragement&&avg_converted_amount>0&&converted_amount>0&&converted_amount<avg_converted_amount&&converted_amount<prev_converted_amount){$(constants.ANALYTICS_EXPENSE_LEAF_ICON_ID+i).show();$(constants.ANALYTICS_EXPENSE_LEAF_CATEGORY_ICON_ID+i).show();}
else if(avg_converted_amount>0&&converted_amount>avg_converted_amount&&converted_amount>prev_converted_amount){$(constants.ANALYTICS_EXPENSE_WARNING_ICON_ID+i).show();$(constants.ANALYTICS_EXPENSE_WARNING_CATEGORY_ICON_ID+i).show();}
else if(apply_encouragement&&prev_converted_amount>0&&converted_amount<prev_converted_amount)
$(constants.ANALYTICS_EXPENSE_LESS_SPENDING_ICON_ID+i).show();else if(prev_converted_amount>0&&converted_amount>prev_converted_amount)
$(constants.ANALYTICS_EXPENSE_MORE_SPENDING_ICON_ID+i).show();var radius_value=constants.ANALYTICS_MONTHLY_EXPENSE_PIE_CHART_FULL_RADIUS-parseFloat(data[i][constants.ANALYTICS_MONTHLY_EXPENSE_UNFORMATTED_PERCENTAGE_ATTR])*constants.ANALYTICS_MONTHLY_EXPENSE_PIE_CHART_FULL_RADIUS;$(constants.ANALYTICS_MONTHLY_EXPENSE_TOOLTIP_PERCENTAGE_ID+i).attr("stroke-dashoffset",radius_value);$(constants.ANALYTICS_MONTHLY_EXPENSE_TOOLTIP_PERCENTAGE_BORDER_ID+i).attr("stroke-dashoffset",radius_value);var this_month_tooltip_width=converted_amount/max_tooltip_amount*constants.ANALYTICS_EXPENSE_TOOLTIP_BAR_MAX_WIDTH;var prev_month_tooltip_width=prev_converted_amount/max_tooltip_amount*constants.ANALYTICS_EXPENSE_TOOLTIP_BAR_MAX_WIDTH;var avg_month_tooltip_width=avg_converted_amount/max_tooltip_amount*constants.ANALYTICS_EXPENSE_TOOLTIP_BAR_MAX_WIDTH;$(constants.ANALYTICS_EXPENSE_TOOLTIP_THIS_MONTH_BAR_ID+i).css("width",this_month_tooltip_width+"px");$(constants.ANALYTICS_EXPENSE_TOOLTIP_PREV_MONTH_BAR_ID+i).css("width",prev_month_tooltip_width+"px");$(constants.ANALYTICS_EXPENSE_TOOLTIP_AVG_MONTH_BAR_ID+i).css("width",avg_month_tooltip_width+"px");$(constants.ANALYTICS_EXPENSE_TOOLTIP_STATS_CELL_THIS_MONTH_ID+i).text(this_month_text);$(constants.ANALYTICS_EXPENSE_TOOLTIP_STATS_CELL_PREV_MONTH_ID+i).text(prev_month_text);$(constants.ANALYTICS_EXPENSE_TOOLTIP_BOTTOM_TABLE_MONTH_TITLE_ID+i).text(this_month_text);$(constants.ANALYTICS_EXPENSE_TOOLTIP_SPENDING_BREAKDOWN_MONTH_ID+i).text(this_month_text);var shorten_category_name=ANALYTICS.shorten_text(data[i][constants.ANALYTICS_EXPENSE_TOOLTIP_CATEGORY_NAME_PROP]);$(constants.ANALYTICS_EXPENSE_SPENDING_TITLE_ID+i).text(shorten_category_name);$(constants.ANALYTICS_EXPENSE_TOOLTIP_BOTTOM_TABLE_TITLE_ID+i).text(shorten_category_name);ANALYTICS.attach_close_tooltip_event(i,this_month_bar);}};Analytics.prototype.attach_close_tooltip_event=function(index,show_it){if(show_it){$(constants.ANALYTICS_TOOLTIP_CLOSE_ID+index).on("click",function(e){e.stopPropagation();$(constants.ANALYTICS_EXPENSE_TOOLTIP_ID+index).hide();});$(constants.ANALYTICS_MONTHLY_EXPENSE_BAR_ID+index).click(function(){$(constants.ANALYTICS_EXPENSE_TOOLTIP_CLASS).hide();$(constants.ANALYTICS_EXPENSE_TOOLTIP_ID+index).show();});$(constants.ANALYTICS_PREV_MONTHLY_EXPENSE_BAR_ID+index).click(function(){$(constants.ANALYTICS_EXPENSE_TOOLTIP_CLASS).hide();$(constants.ANALYTICS_EXPENSE_TOOLTIP_ID+index).show();});}};Analytics.prototype.sort_budget_analytics_percentage_descending=function(a,b){var attr=constants.ANALYTICS_BUDGET_ANALYTICS_PERCENTAGE;return a[attr]==b[attr]?0:a[attr]>b[attr]?-1:1;};Analytics.prototype.sort_budget_analytics_amount_descending=function(a,b){var attr=constants.ANALYTICS_BUDGET_ANALYTICS_SPENT_AMOUNT;return a[attr]==b[attr]?0:a[attr]>b[attr]?-1:1;};Analytics.prototype.sort_savings_ascending=function(a,b){var expense=constants.ANALYTICS_EXPENSE_CONVERTED_AMOUNT_ATTR;var income=constants.ANALYTICS_INCOME_CONVERTED_AMOUNT_ATTR;var a_savings=parseFloat(a[income])-parseFloat(a[expense]);var b_savings=parseFloat(b[income])-parseFloat(b[expense]);return a_savings==b_savings?0:a_savings<b_savings?-1:1;};Analytics.prototype.sort_savings_descending=function(a,b){var expense=constants.ANALYTICS_EXPENSE_CONVERTED_AMOUNT_ATTR;var income=constants.ANALYTICS_INCOME_CONVERTED_AMOUNT_ATTR;var a_savings=parseFloat(a[income])-parseFloat(a[expense]);var b_savings=parseFloat(b[income])-parseFloat(b[expense]);return a_savings==b_savings?0:a_savings>b_savings?-1:1;};Analytics.prototype.sort_total_monthly_ascending=function(a,b){var attr=constants.ANALYTICS_MONTHLY_EXPENSE_CONVERTED_AMOUNT_ATTR;return a[attr]==b[attr]?0:a[attr]<b[attr]?-1:1;};Analytics.prototype.sort_total_monthly_descending=function(a,b){var attr=constants.ANALYTICS_MONTHLY_EXPENSE_CONVERTED_AMOUNT_ATTR;return a[attr]==b[attr]?0:a[attr]<b[attr]?1:-1;};Analytics.prototype.compare_monthly_expense=function(a,b){var attr_1=constants.ANALYTICS_MONTHLY_EXPENSE_CONVERTED_AMOUNT_ATTR;var attr_2=constants.ANALYTICS_PREV_MONTH_CONVERTED_AMOUNT_ATTR;if(a[attr_1]==b[attr_1]){return a[attr_2]==b[attr_2]?0:a[attr_2]<b[attr_2]?1:-1;}
return a[attr_1]<b[attr_1]?1:-1;};var constants=new Constants();function Constants(){this.DOWN_KEY=40;this.UP_KEY=38;this.RIGHT_KEY=39;this.LEFT_KEY=37;this.ENTER_KEY=13;this.CONTROLLER_PATH="../_main/controller.php";this.LOGIN_PATH="../login/";this.SETTINGS_PRESSED_COLOR="lightgray";this.SETTINGS_UNPRESSED_COLOR="transparent";this.GET_CURRENCIES_REQUEST="currencies";this.CURRENCIES_TEMPLATE_ID="#currencies-template";this.SHOWING_SPEED="fast";this.SHOWING_SPEED_MS=100;this.HIDING_SPEED="fast";this.HIDING_SPEED_MS=100;this.REGULAR_BUTTON_LOADING_IMG="#button_loading";this.REGULAR_BUTTON_LOADING_TRANSACTION_IMG="#button_loading_transaction";this.REGULAR_BUTTON_LOADING_INCOME_IMG="#button_loading_income";this.REGULAR_BUTTON_LOADING_TRANSFER_IMG="#button_loading_transfer";this.ELLIPSIS="...";this.CATEGORY_TEMPLATE="#category-template";this.SINGLE_CATEGORY_TEMPLATE="#single-category-template";this.ITEM_TEMPLATE="#single-item-template";this.CALENDAR_TEMPLATE_ID="#calendar-template";this.BOTTOM_WHITE_SPACE_TEMPLATE_ID="#bottom-whitespace-template";this.PRESSED_TAB=".tab_pressed";this.PRESSED_TAB_CLASS="tab_pressed";this.UNPRESSED_TAB=".tab";this.UNPRESSED_TAB_CLASS="tab";this.ALL_TABS=".tab, .tab_pressed";this.TAB_DETAIL_VISIBLE=".tab_detail";this.TAB_DETAIL_VISIBLE_CLASS="tab_detail";this.TAB_DETAIL_HIDDEN=".tab_detail_hidden";this.TAB_DETAIL_HIDDEN_CLASS="tab_detail_hidden";this.TRANSACTION_MAIN_TAB="#transactions_tab";this.ANALYTICS_MAIN_TAB="#analytics_tab";this.BUDGETS_MAIN_TAB="#budgets_tab";this.CATEGORIES_MAIN_TAB="#categories_tab";this.ACCOUNTS_MAIN_TAB="#accounts_tab";this.TRANSACTION_TAB_DETAIL="#transactions_tab_detail";this.ANALYTICS_TAB_DETAIL="#analytics_tab_detail";this.BUDGETS_TAB_DETAIL="#budgets_tab_detail";this.CATEGORIES_TAB_DETAIL="#categories";this.ACCOUNTS_TAB_DETAIL="#accounts_tab_detail";this.SECTION_TITLE_ID="#section_title";this.TAB_TRANSACTION_TITLE="Transactions";this.TAB_ANALYTICS_TITLE="Insights";this.TAB_BUDGETS_TITLE="Budgets";this.TAB_CATEGORIES_TITLE="Categories";this.TAB_ACCOUNTS_TITLE="Accounts";this.TRANSACTION_FILTER_MORE_FILTERS_BUTTON_ID="#transaction_filter_more_filters";this.DATA_EXPANDED_PROP="data-expanded";this.TRANSACTION_FILTER_DIV=".transaction_filter";this.MONTHLY_TRANSACTION_TITLE=".monthly_transaction_title";this.MONTHLY_TRANSACTION_LIST=".monthly_transaction_list";this.MONTHLY_TRANSACTION_LIST_MONTH=".monthly_transaction_list_month";this.TRANSACTION_FILTER_CUSTOM_CLASS=".transaction_filter_custom";this.LOGOUT_DIV="#logout";this.SIGNUP_FEEDBACK="#sign_up_feedback";this.SIGNIN_FEEDBACK="#log_in_feedback";this.MAIN_SETTING_MENU_ICON=".main_setting";this.MAIN_SETTING_MENU=".main_menu";this.LOGOUT_MENU_ITEM="#main-logout";this.SETTING_MENU_ITEM="#main-settings";this.ORIENTATION_MENU_ITEM="#main-orientation";this.HELP_MENU_ITEM="#main-help";this.HELP_CENTER_TITLE="Organic Budget Help Center";this.HELP_CENTER_URL="../help_center/";this.SYSTEM_MENU_ICON=".system_menu_icon";this.SYSTEM_MENU=".system_menu";this.SYSTEM_MENU_TRANSACTIONS_ITEM="#system-menu-transactions";this.SYSTEM_MENU_ANALYTICS_ITEM="#system-menu-analytics";this.SYSTEM_MENU_BUDGETS_ITEM="#system-menu-budgets";this.SYSTEM_MENU_CATEGORIES_ITEM="#system-menu-categories";this.SYSTEM_MENU_ACCOUNTS_ITEM="#system-menu-accounts";this.EXPENSE_DIV="#expenses_content";this.INCOME_DIV="#income_content";this.EXPENSE_LOADING_ICON="#expenses-loading";this.INCOME_LOADING_ICON="#income-loading";this.CATEGORY_DESCRIPTION_ID="#category_description_";this.CATEGORY_TITLE_ID="#category_title_";this.CATEGORY_COLOR_ID="#category_color_";this.CATEGORY_SETTINGS=".category_setting";this.CATEGORY_SETTINGS_ID="#category_setting_";this.CATEGORY_BLOCK=".category_block";this.ITEM_SETTINGS=".item_setting";this.ITEM_SETTINGS_ID="#item-settings-";this.CATEGORY_MENU=".setting_menu";this.CATEGORY_MENU_ID="#setting_menu_";this.ITEM_MENU_ID="#item_menu_";this.NEW_ITEM_ID="#new-item-";this.NEW_ITEM_INPUT_ID="#new-item-input-";this.EDIT_ITEM_LOADING_ICON="#edit-item-loading-";this.NEW_ITEM_INPUT_FEEDBACK="-feedback";this.NEW_ITEM_NAME="[name=new_item]";this.ITEM_INPUT_ID="#input-item-";this.ITEM_INPUT_FEEDBACK="-feedback";this.ITEM_INPUT_NAME="[name=input-item]";this.ITEM_FEEDBACK_NAME="[name=item-feedback]";this.ITEM_MENU=".item_menu";this.ITEM_DIV_ID="#item-";this.ITEMS_DIV_ID="#items_";this.CATEGORY_NAME="#category-name";this.CATEGORY_DESCRIPTION="#category-description";this.CATEGORY_TYPE_ID="#category-type";this.COLOR_PICKER_ID="#color-picker";this.COLOR_PICKER="color-picker";this.COLOR_PICKER_CELL="color-picker-cell";this.CATEGORY_COLOR_DESCRIPTION_TITLE=".category_color,.category_description,.category_title";this.CATEGORY_ARROW_ID="#category_arrow_";this.ITEMS_ID="#items_";this.CATEGORY_BLOCK_ID="#category_block_";this.ITEMS_ARRAY="items";this.ITEM_EXISTS_ATTR="item_exists";this.CATEGORY_BACKGROUND="body, .inside_tabs, .category";this.EMAIL_NAME="email";this.PASSWORD_NAME="password";this.CONFIRM_PASSWORD_NAME="confirm_password";this.SIGNUP_FORM_ID="#signup_form";this.SIGNUP_FORM_NAME="signup_form";this.SIGNUP_CONFIRM_PASSWORD="form[name=signup_form]  input[name=confirm_password]";this.SIGNUP_VISIBLE_FORM="table.signup";this.SIGNUP_TAB="#signup";this.SIGNUP_FORM_TOKEN="form[name=signup_form]  input[name=token]";this.SIGNUP_REQUEST="signup";this.SIGNUP_PASSWORD_ID="#password";this.SIGNUP_CONFIRM_PASSWORD_ID="#confirm_password";this.SIGNUP_EMAIL_ID="#email";this.LOGIN_FORM_PASSWORD="form[name=login_form]  input[name=password]";this.LOGIN_FORM="#login_form";this.LOGIN_VISIBLE_FORM="table.login";this.LOGIN_TAB="#login";this.CHOSEN_TAB=".chosen";this.CHOSEN_TAB_CLASS="chosen";this.UNCHOSEN_TAB=".unchosen";this.UNCHOSEN_TAB_CLASS="unchosen";this.EXPENSE_TAB="#expenses";this.INCOME_TAB="#income";this.BY_NAME_TAB="#by_name_";this.BY_PAYEE_TAB="#by_payee_";this.DELETE_CATEGORY_BUTTON="#delete-category-button";this.DELETE_CATEGORY_SHOW_BUTTON=".delete-category";this.DELETE_CATEGORY_SHOW_BUTTON_ID="#delete_category_";this.EDIT_CATEGORY_SHOW_BUTTON=".edit-category";this.EDIT_CATEGORY_SHOW_BUTTON_ID="#edit_category_";this.EDIT_CATEGORY_ITEM=".edit-item";this.EDIT_CATEGORY_ITEM_ID="#edit_item_";this.DELETE_CATEGORY_ITEM=".delete-item";this.DELETE_CATEGORY_ITEM_ID="#delete_item_";this.CHANGE_CATEGORY_ITEM=".change-category-item";this.CHANGE_CATEGORY_ITEM_ID="#change_category_item_";this.EDIT_CATEGORY_BUTTON="#edit-category-button";this.CHANGE_CATEGORY_BUTTON="#change-category-button";this.ADD_ITEM_BUTTON=".add_item_button";this.ADD_ITEM_BUTTON_ID="#add_item_button_";this.SHOW_ADD_CATEGORY_BUTTON="#show-add-category-button";this.ADD_CATEGORY_BUTTON_ID="#add-category-button";this.ADD_NEW_CATEGORY_BUTTON_ID="#add-new-category-button";this.SIGNUP_BUTTON="#sign_up_button";this.SIGNIN_BUTTON="#login_button";this.SIGNIN_LOADING_ICON="#login_loading";this.NEW_ITEM_SAVE_BUTTON="#new-item-save-";this.ADD_ITEM_LOADING_ICON="#add_item_loading_icon_";this.ADD_NEW_ITEM_ID="#add-new-item-";this.NEW_ITEM_SAVE_BUTTON_NAME="[name=new-item-save-button]";this.ITEM_SAVE_BUTTON="#item-save-";this.ITEM_SAVE_BUTTON_NAME="[name=item-save-button]";this.ITEM_SAVE_BUTTON_CLASS=".item_save";this.ITEM_CLASS=".item";this.DELETE_CATEGORY_WINDOW="#delete-category-window";this.EDIT_CATEGORY_WINDOW="#edit-category-window";this.DELETE_CATEGORY_WINDOW_TEMPLATE="#delete-category-window-template";this.CANT_ADD_TARGET_WINDOW_TEMPLATE="#cant-add-target-window-template";this.ADD_CATEGORY_WINDOW_TEMPLATE="#add-category-window-template";this.EDIT_CATEGORY_WINDOW_TEMPLATE="#edit-category-window-template";this.CHANGE_CATEGORY_ITEM_WINDOW_TEMPLATE="#change-category-window-template";this.WINDOW_ID="#window";this.CANCEL_BUTTON="#cancel-button";this.WINDOW_CLOSE="#window-close";this.WINDOW_BOX=".window";this.WINDOW_INPUT=".window input";this.WINDOW_BACKGROUND_ID="#window-background";this.WINDOW_FEEDBACK_ID="#window-feedback";this.COLOR_PICKER_TEMPLATE="#color-picker-template";this.SUCCESS_COLOR="#2ECC71";this.FAILURE_COLOR="red";this.HIDE_MESSAGE_TIME=5000;this.CATEGORY_ID="data-cat-id";this.FIRST_CATEGORY_BLOCK="div.category:first-child div.category_block";this.CATEGORY_ID_ATTR="id";this.CATEGORY_NAME_ATTR="name";this.CATEGORY_ID_ARRAY="category_id";this.ITEM_ID="data-item-id";this.ITEM_NAME="data-item-name";this.CATEGORY_COMBOBOX_ID="#item-category";this.CATEGORY_TITLE="data-category-title";this.CATEGORY_COLOR="data-category-color";this.CATEGORY_TYPE="data-category-type";this.CATEGORY_DESCRIPTION_ATTR="data-category-description";this.DATA_COLOR="data-color";this.CATEGORY_TITLE_DATA="category_data";this.CATEGORY_COLOR_DATA="category_color";this.CATEGORY_DESCRIPTION_DATA="category_description";this.GET_CATEGORIES_REQUEST="categories";this.ADD_CATEGORY_REQUEST="add_category";this.ADD_ITEM_REQUEST="add_item";this.EDIT_ITEM_REQUEST="edit_item";this.DELETE_ITEM_REQUEST="delete_item";this.CHANGE_ITEM_CATEGORY_REQUEST="change_item_category";this.DELETE_CATEGORY_REQUEST="delete_category";this.EDIT_CATEGORY_REQUEST="edit_category";this.GET_EMAIL="getemail";this.GET_SETTINGS="settings";this.LOGOUT_REQUEST="logout";this.T_REQUEST="generate_token";this.EDIT_ORIENTATION="edit_orientation";this.SESSION_INACTIVE_RESPONSE="session_inactive";this.SUCCESS_RESPONSE="success";this.FAIL_RESPONSE="fail";this.VALID_RESPONSE="valid";this.RESULT_ATTR="result";this.ERROR_MESSAGE_ATTR="error_message";this.NUMBER_FORMAT_ATTR="numberformat";this.DATE_FORMAT_ATTR="dateformat";this.TIME_FORMAT_ATTR="timeformat";this.USERNAME_ATTR="username";this.CURRENCY_ATTR="currency";this.ORIENTATION_ATTR="orientation";this.DOUBLE_ARROW_UP="../images/double_up_arrow.png";this.DOUBLE_ARROW_UP_TEXT="double_up_arrow";this.DOUBLE_ARROW_DOWN="../images/double_down_arrow.png";this.DOUBLE_ARROW_DOWN_TEXT="double_down_arrow";this.INCOME_CATEGORIES_DISPLAYED="income_categories_displayed";this.EXPENSE_CATEGORIES_DISPLAYED="expense_categories_displayed";this.INCOME_CATEGORIES_DISPLAYED_FLAG=false;this.EXPENSE_CATEGORIES_DISPLAYED_FLAG=false;this.INCOME_TYPE="i";this.EXPENSE_TYPE="e";this.CHECK_MARK="<img src='../images/white_checkmark.png'>";this.ACCOUNT_DIV_ID="#bank_account_";this.ACCOUNT_TEMPLATE="#bank-account-template";this.ACCOUNT_SUMMARY_TEMPLATE="#account-summary-template";this.ACCOUNT_CREDIT_SUMMARY_ID="#credit-account-summary";this.ACCOUNT_CREDIT_SUMMARY_ROW_ID="#credit_summary_row";this.ACCOUNT_CREDIT_SUMMARY_ATTR="account_summary_credit";this.ACCOUNT_CREDIT_SUMMARY_AS_NUMBER_ATTR="account_summary_credit_as_number";this.ACCOUNT_DEBIT_SUMMARY_ROW_ID="#debit_summary_row";this.ACCOUNT_DEBIT_SUMMARY_ID="#debit-account-summary";this.ACCOUNT_DEBIT_SUMMARY_ATTR="account_summary_debit";this.ACCOUNT_DEBIT_SUMMARY_AS_NUMBER_ATTR="account_summary_debit_as_number";this.ACCOUNT_CASH_SUMMARY_ID="#cash-summary";this.ACCOUNT_CASH_SUMMARY_ROW_ID="#cash_summary_row";this.ACCOUNT_CASH_SUMMARY_ATTR="account_summary_cash";this.ACCOUNT_CASH_SUMMARY_AS_NUMBER_ATTR="account_summary_cash_as_number";this.ACCOUNT_TOTAL_ID="#total-account-summary";this.ACCOUNT_TOTAL_ATTR="account_summary_total";this.ACCOUNTS_WRAPPER_ID="#accounts_wrapper";this.ACCOUNTS_DIV="#accounts";this.ACCOUNT_LOADING_ICON="#account-loading";this.GET_ACCOUNTS_REQUEST="accounts";this.ADD_ACCOUNT_REQUEST="add_account";this.DELETE_ACCOUNT_REQUEST="delete_account";this.EDIT_ACCOUNT_REQUEST="edit_account";this.ACCOUNT_SETTING_GEAR_ID="#account_setting_";this.ACCOUNT_SETTING_GEAR=".account_setting";this.ACCOUNT_SETTING_MENU_ID="#account_setting_menu_";this.ACCOUNT_SETTING_MENU=".bank_settings";this.ACCOUNT_ID_ATTRIBUTE="id";this.SHOW_ADD_ACCOUNT_BUTTON_ID="#show-add-account-button";this.ADD_ACCOUNT_WINDOW_TEMPLATE_ID="#add-account-window-template";this.EDIT_ACCOUNT_WINDOW_TEMPLATE_ID="#edit-account-window-template";this.DELETE_ACCOUNT_WINDOW_TEMPLATE_ID="#delete-account-window-template";this.ACCOUNT_CURRENCY_TYPE_ID="#account-currency-type";this.ADD_ACCOUNT_BUTTON="#add-account-button";this.ADD_NEW_ACCOUNT_BUTTON="#add-new-account-button";this.EDIT_ACCOUNT_BUTTON="#edit-account-button";this.DELETE_ACCOUNT_BUTTON="#delete-account-button";this.ACCOUNT_NAME_ID="#account-name";this.ACCOUNT_DESCRIPTION_ID="#account-description";this.ACCOUNT_TYPE_ID="#account-type";this.ACCOUNT_MONEY_TYPE_ID="#account-money-type";this.ACCOUNT_INITIAL_BALANCE_ID="#account-initial-balance";this.ACCOUNT_MONEY_TYPE_ROW_ID="#money-type-row";this.EDIT_ACCOUNT_ID="#edit_account_";this.DELETE_ACCOUNT_ID="#delete_account_";this.ACCOUNT_NAME_DIV_ID="#account_name_";this.ACCOUNT_SUMMARY_TABLE_ID="#account_summary_table";this.ACCOUNT_MONEY_TYPE_DIV_ID="#money_type_";this.ACCOUNT_ACCOUNT_TYPE_DIV_ID="#account_type_";this.ACCOUNT_ACCOUNT_BALANCE_DIV_ID="#account_balance_";this.ACCOUNT_ACCOUNT_DESCRIPTION_DIV_ID="#account_balance_";this.ACCOUNT_TYPE_ATTR="type_as_number";this.ACCOUNT_MONEY_TYPE_ARRAY={"1":"Debit","2":"Credit"};this.ACCOUNT_TYPE_BANK_ACCOUNT=1;this.ACCOUNT_TYPE_CASH=2;this.ACCOUNT_BANK_TYPE_ARRAY={"1":"Bank Account","2":"Cash"};this.CURRENCY_FORMATTED_BALANCE_ATTR="formatted_balance";this.INITIAL_BALANCE_FORMATTED_ATTR="initial_balance_formatted";this.INITIAL_BALANCE_FORMATTED_ID="#initial_balance_formatted_";this.FROM_ACCOUNT_ID_PROP="data-from-account-id";this.TO_ACCOUNT_ID_PROP="data-to-account-id";this.ACCOUNT_ID_PROP="data-account-id";this.ACCOUNT_NAME_PROP="data-account-name";this.ACCOUNT_DESCRIPTION_PROP="data-account-description";this.ACCOUNT_INITIAL_BALANCE_PROP="data-account-initial-balance";this.ACCOUNT_TYPE_PROP="data-account-type-as-number";this.ACCOUNT_CURRENCY_ID_PROP="data-currency-id";this.ACCOUNT_MONEY_TYPE_PROP="data-money-type-as-number";this.ACCOUNT_DESCRIPTION_TITLE_PROP="title";this.CURRENCY_ID_PROP="id";this.TRANSACTION_LOADING_ICON="#transaction-loading";this.TRANSACTION_OVERVIEW_LOADING_ICON="#transaction-overview-loading";this.TRANSACTIONS_WRAPPER="#transactions_wrapper";this.GET_TRANSACTIONS_REQUEST="transactions";this.GET_TRANSACTION_REQUEST="transaction";this.GET_TRANSACTION_YEARS_REQUEST="transaction_years";this.GET_TRANSACTION_ITEM_REQUEST="transaction_item";this.GET_ITEM_SUGGESTIONS_REQUEST="item_suggestions";this.GET_PAYEE_SUGGESTIONS_REQUEST="payee_suggestions";this.GET_PAYEES="payees";this.GET_ITEM_SUGGESTIONS_FROM_PAYEE_REQUEST="item_suggestions_from_payee";this.ADD_TRANSACTION_REQUEST="add_transaction";this.EDIT_TRANSACTION_REQUEST="edit_transaction";this.DELETE_TRANSACTION_REQUEST="delete_transaction";this.DELETE_TRANSACTION_ITEM_REQUEST="delete_transaction_item";this.DELETE_INCOME_REQUEST="delete_income";this.DELETE_TRANSFER_REQUEST="delete_transfer";this.ADD_TRANSACTION_ITEM_REQUEST="add_transaction_item";this.EDIT_TRANSACTION_ITEM_REQUEST="edit_transaction_item";this.ADD_INCOME_REQUEST="add_income";this.EDIT_INCOME_REQUEST="edit_income";this.EDIT_TRANSFER_REQUEST="edit_transfer";this.ADD_TRANSFER_REQUEST="add_transfer";this.TRANSACTION_TEMPLATE="#transaction-template";this.TRANSACTION_ITEM_TEMPLATE="#transaction-item-template";this.ITEM_SUGGESTION_TEMPLATE="#item-suggestion-template";this.PAYEE_SUGGESTION_TEMPLATE="#payee-suggestion-template";this.TRANSACTION_YEAR_COMBOBOX_TEMPLATE="#transaction-year-combobox-template";this.TRANSACTION_ITEM_ID="#transaction_item_";this.INCOME_TEMPLATE="#income-template";this.TRANSFER_TEMPLATE="#transfer-template";this.TRANSACTIONS_DIV="#all_transactions";this.TRANSACTIONS_ITEMS_DIV="#transaction_items_";this.TRANSACTION_AMOUNT_ID="#transaction_amount_";this.TRANSACTION_PAYEE_ID="#transaction_payee_";this.TRANSACTION_DATE_ID="#transaction_date_";this.TRANSACTION_ACCOUNT_NAME_ID="#transaction_account_";this.TRANSACTION_ACCOUNT_ID="#transaction_account";this.TRANSACTION_ITEMS_ROW_ID="#transaction-items";this.TRANSACTION_ITEMS_HEADING_ROW_ID="#transaction-items-heading";this.FIRST_TRANSACTION="div.transaction_wrapper:first-child div.transaction";this.TRANSACTION_ID_PROP="data-transaction-id";this.EDIT_TRANSACTION_ID="#edit_transaction_";this.EDIT_TRANSACTION_AMOUNT_PROP="data-amount";this.EDIT_TRANSFER_AMOUNT_PROP="data-amount";this.EDIT_TRANSACTION_PAYEE_PROP="data-payee";this.EDIT_TRANSACTION_ACCOUNT_ID_PROP="data-account-id";this.EDIT_TRANSACTION_TRANSACTION_ITEMS_PROP="data-transaction-items";this.EDIT_TRANSACTION_TRANSACTION_ITEMS_NUM_PROP="data-transaction-items-number";this.ID_PROP="data-id";this.YEAR_PROP="data-year";this.MONTH_PROP="data-month";this.DAY_PROP="data-day";this.HOUR_PROP="data-hour";this.MINUTE_PROP="data-minute";this.INCOME_CATEGORY_NAME_PROP="data-category-name";this.INCOME_NAME_PROP="data-income-name";this.TRANSACTION_ACCOUNT_NAME_ATTR="account_name";this.TRANSACTION_ACCOUNT_ID_ATTR="account_id";this.TRANSACTION_PAYEE_ATTR="payee";this.TRANSACTION_MONTH_ATTR="month";this.TRANSACTION_YEAR_ATTR="year";this.TRANSACTION_DAY_ATTR="day";this.TRANSACTION_MINUTE_ATTR="minute";this.TRANSACTION_HOUR_ATTR="hour";this.TRANSACTION_FORMATTED_DATE_ATTR="formatted_date";this.TRANSACTION_ITEM_QUANTITY_ATTR="quantity";this.TRANSACTION_ITEM_ID_PROP="data-transaction-item-id";this.THE_TRANSACTION_TYPE="transactions";this.THE_TRANSFER_TYPE="transfer";this.THE_INCOME_TYPE="income";this.TRANSACTIONS_TYPE="type";this.TRANSACTION_TYPE="transaction";this.TRANSFER_TYPE="transfer";this.INCOME_TRANSACTION_TYPE="income";this.TRANSACTION_ID_ATTR="id";this.TRANSACTIONITEM_TRANSACTION_ID_ATTR="transaction_id";this.TRANSACTION_ITEM_ID_ATTR="id";this.TRANSFER_ID_ATTR="id";this.INCOME_ID_ATTR="id";this.INCOME_ID="#income_";this.TRANSFER_ID="#transfer_";this.TRANSACTION_ITEMS_ATTR="items";this.TRANSACTION_COMBO_MONTH="#transaction_month";this.TRANSACTION_COMBO_MONTH_SELECTED="#transaction_month:selected";this.TRANSACTION_COMBO_YEAR="#transaction_year";this.TRANSACTION_COMBO_TYPE="#transaction_type";this.TRANSACTION_SETTING_GEAR_ID="#transaction_setting_";this.TRANSACTION_ITEM_SETTING_MENU_ID="#transaction_item_settings_menu_";this.TRANSACTION_ITEM_SETTING_GEAR_ID="#transaction_item_setting_";this.TRANSACTION_SETTING_MENU_ID="#transaction_settings_menu_";this.TRANSFER_SETTING_GEAR_ID="#transfer_setting_";this.TRANSFER_SETTING_MENU_ID="#transfer_settings_menu_";this.INCOME_SETTING_GEAR_ID="#income_setting_";this.INCOME_SETTING_MENU_ID="#income_settings_menu_";this.TRANSACTION_SETTING_MENU=".transaction_settings";this.TRANSACTION_SETTING_GEAR=".transaction_setting";this.TRANSFER_SETTING_MENU=".transfer_settings";this.TRANSFER_SETTING_GEAR=".transfer_setting";this.INCOME_SETTING_MENU=".income_settings";this.INCOME_SETTING_GEAR=".income_setting";this.TRANSACTION_ITEM_SETTING_MENU=".transaction_item_settings";this.TRANSACTION_ITEM_SETTING_GEAR=".transaction_item_setting";this.TRANSACTION_ARROW_ID="#transaction_arrow_";this.TRANSACTION_ICON_ID="#transaction_icon_";this.TRANSACTION_ID="#transaction_";this.TRANSACTION_WRAPPER_ID="#transaction_wrapper_";this.TRANSACTION_OVERVIEW_TODAY_POINTER="#transaction_overview_today_pointer";this.SHOW_ADD_TRANSACTION_BUTTON_ID="#show-add-transaction-button";this.ADD_TRANSACTION_WINDOW_TEMPLATE_ID="#add-transaction-window-template";this.EDIT_TRANSACTION_WINDOW_TEMPLATE_ID="#edit-transaction-window-template";this.TRANSACTION_ITEM_ROW_TEMPLATE_ID="#transaction-item-row-template";this.EDIT_TRANSACTION_TABLE_ID="#edit-transaction-table";this.ADD_TRANSACTION_TABLE_ID="#add-transaction-table";this.ADD_TRANSACTION_TABLE_ADD_ITEM_BUTTON_ID="#add-transaction-table-add-item-button";this.EDIT_TRANSACTION_TABLE_ADD_ITEM_BUTTON_ID="#edit-transaction-table-add-item-button";this.TRANSACTION_TABLE_ITEM_LENGTH_PROP="data-item-length";this.EDIT_INCOME_WINDOW_TEMPLATE_ID="#edit-income-window-template";this.EDIT_TRANSFER_WINDOW_TEMPLATE_ID="#edit-transfer-window-template";this.DELETE_TRANSACTION_WINDOW_TEMPLATE_ID="#delete-transaction-window-template";this.DELETE_TRANSACTION_ITEM_WINDOW_TEMPLATE_ID="#delete-transaction-item-window-template";this.DELETE_INCOME_WINDOW_TEMPLATE_ID="#delete-income-window-template";this.DELETE_TRANSFER_WINDOW_TEMPLATE_ID="#delete-transfer-window-template";this.ADD_TRANSACTION_ITEM_WINDOW_TEMPLATE_ID="#add-transaction-item-window-template";this.EDIT_TRANSACTION_ITEM_WINDOW_TEMPLATE_ID="#edit-transaction-item-window-template";this.DELETE_TRANSACTION_ITEM_WINDOW_TEMPLATE_ID="#delete-transaction-item-window-template";this.ADD_TRANSACTION_BUTTON_ID="#add-transaction-button";this.EDIT_TRANSACTION_BUTTON_ID="#edit-transaction-button";this.EDIT_INCOME_BUTTON_ID="#edit-income-button";this.EDIT_TRANSFER_BUTTON_ID="#edit-transfer-button";this.DELETE_TRANSACTION_BUTTON_ID="#delete-transaction-button";this.DELETE_INCOME_BUTTON_ID="#delete-income-button";this.DELETE_TRANSFER_BUTTON_ID="#delete-transfer-button";this.ADD_TRANSACTION_ITEM_BUTTON_ID="#add-transaction-item-button";this.ADD_NEW_TRANSACTION_ITEM_BUTTON_ID="#add-new-transaction-item-button";this.ADD_NEW_TRANSACTION_BUTTON_ID="#add-new-transaction-button";this.EDIT_TRANSACTION_ITEM_BUTTON_ID="#edit-transaction-item-button";this.DELETE_TRANSACTION_ITEM_BUTTON_ID="#delete-transaction-item-button";this.ADD_TRANSACTION_PAYEE_ID="#transaction-payee";this.ADD_INCOME_BUTTON_ID="#add-income-button";this.ADD_NEW_INCOME_BUTTON_ID="#add-new-income-button";this.ADD_TRANSFER_BUTTON_ID="#add-transfer-button";this.ADD_NEW_TRANSFER_BUTTON_ID="#add-new-transfer-button";this.PAYEE_NAME_SUGGESTION_PROP="payee_name";this.ITEM_NAME_SUGGESTION_PROP="item_name";this.ITEM_NAME_SUGGESTION_ATTR="data-item-name";this.PAYEE_NAME_SUGGESTION_ATTR="data-payee-name";this.CATEGORY_NAME_SUGGESTION_ATTR="data-category-name";this.TRANSACTION_ITEM_AMOUNT_ATTR="data-transaction-item-amount";this.TRANSACTION_ITEM_QUANTITY_PROP="data-quantity";this.FORMATTED_ITEM_NAME_SUGGESTION_PROP="formatted_item_name";this.FORMATTED_PAYEE_NAME_SUGGESTION_PROP="formatted_payee_name";this.CATEGORY_NAME_SUGGESTION_PROP="category_name";this.FORMATTED_CATEGORY_NAME_SUGGESTION_PROP="formatted_category_name";this.FORMATTED_AMOUNT_PROP="formatted_amount";this.FORMATTED_TOTAL_AMOUNT_PROP="formatted_total_amount";this.AMOUNT_PROP="amount";this.TOTAL_AMOUNT_PROP="total_amount";this.ADD_TRANSACTION_TAB="#add-transaction-tab";this.ADD_TRANSFER_TAB="#add-transfer-tab";this.ADD_INCOME_TAB="#add-income-tab";this.ADD_TRANSACTION_DATE="#transaction-date";this.ADD_ONE_TRANSACTION_ITEM_ID="#transaction_item_1";this.ADD_TRANSACTION_ITEM_ID="#transaction_item_";this.ADD_ONE_TRANSACTION_ITEM_SUGGESTIONS_ID="#transaction_item_suggestions";this.PAYEE_SUGGESTIONS_ID="#payee_suggestions";this.ADD_TRANSACTION_ITEM_SUGGESTIONS_ID="#transaction_item_suggestions_";this.ADD_TRANSACTION_ITEM_SUGGESTIONS_CLASS=".item_suggestion";this.ADD_TRANSACTION_PAYEE_SUGGESTIONS_CLASS=".payee_suggestion";this.ADD_TRANSACTION_SELECTED_ITEM_SUGGESTIONS_CLASS_NAME="item_suggestion_selected";this.ADD_TRANSACTION_SELECTED_ITEM_SUGGESTIONS_CLASS=".item_suggestion_selected";this.ADD_TRANSACTION_SELECTED_PAYEE_SUGGESTIONS_CLASS_NAME="payee_suggestion_selected";this.ADD_TRANSACTION_SELECTED_PAYEE_SUGGESTIONS_CLASS=".payee_suggestion_selected";this.ADD_TRANSACTION_NUMBER_OF_ITEMS=5;this.TRANSACTION_ITEM_ROW_ID="#transaction-item-";this.ADD_ONE_TRANSACTION_ITEM_AMOUNT_ID="#transaction-item-amount-1";this.ADD_ONE_TRANSACTION_ITEM_QUANTITY_ID="#transaction-item-quantity-1";this.ADD_TRANSACTION_ITEM_AMOUNT_ID="#transaction-item-amount-";this.ADD_TRANSACTION_ITEM_QUANTITY_ID="#transaction-item-quantity-";this.ADD_INCOME_AMOUNT_ID="#income-amount";this.ADD_INCOME_ITEM_ID="#income-source";this.ADD_INCOME_ITEM_SUGGESTIONS_ID="#income_item_suggestions";this.ITEM_SUGGESTIONS_CLASS=".transaction-item-suggestions";this.PAYEE_SUGGESTIONS_CLASS=".payee-suggestions";this.TRANSACTION_ITEM_QUANTITY_ID="#transaction_item_quantity_";this.ADD_TRANSACTION_ITEM_MENU_ITEM_ID="#add_transaction_item_";this.EDIT_TRANSACTION_ITEM_MENU_ITEM_ID="#edit_transaction_";this.DELETE_TRANSACTION_ITEM_MENU_ITEM_ID="#delete_transaction_";this.EDIT_TRANSACTION_ITEM_ITEM_MENU_ITEM_ID="#edit_transaction_item_";this.DELETE_TRANSACTION_ITEM_ITEM_MENU_ITEM_ID="#delete_transaction_item_";this.EDIT_INCOME_ITEM_MENU_ITEM_ID="#edit_income_";this.DELETE_INCOME_ITEM_MENU_ITEM_ID="#delete_income_";this.EDIT_TRANSFER_ITEM_MENU_ITEM_ID="#edit_transfer_";this.DELETE_TRANSFER_ITEM_MENU_ITEM_ID="#delete_transfer_";this.TRANSACTION_DATE_ATTR="date";this.GET_USER_ACCOUNTS_REQUEST="user_accounts";this.ACCOUNTS_COMBOBOX_TEMPLATE="#account-combobox-template";this.ACCOUNTS_FILTER_COMBOBOX_TEMPLATE="#account-filter-combobox-template";this.ADD_TRANSACTION_ACCOUNTS_ID="#transaction-account";this.ADD_INCOME_ACCOUNTS_ID="#income-account";this.ADD_TRANSFER_FROM_ACCOUNTS_ID="#transfer-from-account";this.ADD_TRANSFER_TO_ACCOUNTS_ID="#transfer-to-account";this.ADD_TRANSFER_AMOUNT_ID="#transfer-amount";this.ADD_TRANSACTION_HOUR_ID="#transaction-hour";this.ADD_TRANSACTION_MINUTE_ID="#transaction-minute";this.ADD_TRANSACTION_AM_PM_ID="#transaction-am-pm";this.ADD_TRANSACTION_DATE_WRAPPER_ID="#add_transaction_datepicker_wrapper";this.ADD_INCOME_DATE_WRAPPER_ID="#add_income_datepicker_wrapper";this.ADD_TRANSFER_DATE_WRAPPER_ID="#add_transfer_datepicker_wrapper";this.ADD_TRANSACTION_CALENDAR_ID="add_transaction_calendar";this.ADD_INCOME_CALENDAR_ID="add_income_calendar";this.ADD_TRANSFER_CALENDAR_ID="add_transfer_calendar";this.CALENDAR_LEFT_ARROW_ID="#calendar_left_arrow_";this.CALENDAR_RIGHT_ARROW_ID="#calendar_right_arrow_";this.CALENDAR_YEAR_ATTR="data-year";this.CALENDAR_MONTH_ATTR="data-month";this.CALENDAR_DAY_ATTR="data-day";this.CALENDAR_CELL=".calendar_cell";this.ADD_INCOME_DATE="#income-date";this.ADD_INCOME_HOUR_ID="#income-hour";this.ADD_INCOME_MINUTE_ID="#income-minute";this.ADD_INCOME_AM_PM_ID="#income-am-pm";this.TRANSFER_ACCOUNTS_ATTR="transfer-accounts";this.ADD_TRANSFER_DATE="#transfer-date";this.ADD_TRANSFER_HOUR_ID="#transfer-hour";this.ADD_TRANSFER_MINUTE_ID="#transfer-minute";this.ADD_TRANSFER_AM_PM_ID="#transfer-am-pm";this.FORMATTED_AVERAGE_AMOUNT_ATTR="formatted_avg_amount";this.AVERAGE_CATEGORY_REQUEST="average_category";this.CATEGORY_AVERAGE_SPENDING_ROW_ID="#category_average_spending_row_";this.CATEGORY_AVERAGE_NAME_ID="#category_average_name_";this.CATEGORY_AVERAGE_SPENDING_ID="#category_average_spending_";this.BUDGET_LOADING_ICON="#budget-loading";this.BUDGET_TEMPLATE="#budget-template";this.TARGET_TEMPLATE="#target-template";this.CATEGORIES_COMBOBOX_TEMPLATE="#category-combobox-template";this.CURRENCIES_COMBOBOX_TEMPLATE="#currencies-combobox-template";this.YEARS_COMBOBOX_TEMPLATE="#years-combobox-template";this.EDIT_TARGET_TEMPLATE="#edit-target-window-template";this.ADD_TARGET_TEMPLATE="#add-target-window-template";this.ADD_TARGET_CATEGORY_ID="#target-category";this.ADD_TARGET_CURRENCY_ID="#target-currency";this.ADD_TARGET_BUTTON_ID="#add-target-button";this.ADD_NEW_TARGET_BUTTON_ID="#add-new-target-button";this.EDIT_TARGET_BUTTON_ID="#edit-target-button";this.ADD_TARGET_AMOUNT_ID="#target-amount";this.ADD_TARGET_PERIOD_ID="#target-period";this.ADD_TARGET_EVERY_ID="#target-every";this.ADD_TARGET_ROLLOVER_ID="#target-rollover";this.ADD_TARGET_ROW_ID="#target-row-";this.ADD_TARGET_TABLE_ID="#target-table";this.TARGETS_LENGTH_PROP="data-targets-length";this.TARGET_HEADING_ROW_ID="#target-heading-row";this.CATEGORY_COMBOX=".category-combobox";this.CURRENCY_COMBOX=".currency-combobox";this.YEAR_COMBOX=".budget-year";this.USER_CURRENCY_ID_ATTR="user_currency_id";this.TARGETS_SHOW_HIDE_ID="#targets-expand";this.TARGET_ROW_TO_BE_SHOWN_HIDDEN=".target-hide-show";this.TARGET_SPENDING_ROW=".target_spending_row";this.BUDGETS_DIV="#budgets";this.BUDGET_ID_ATTR="id";this.BUDGET_TARGETS_ATTR="targets";this.BUDGET_NAME_ATTR="budget_name";this.BUDGET_START_MONTH_ATTR="start_month";this.BUDGET_END_MONTH_ATTR="end_month";this.BUDGET_START_YEAR_ATTR="start_year";this.BUDGET_END_YEAR_ATTR="end_year";this.BUDGET_START_BUDGET_ATTR="budget_start";this.BUDGET_END_BUDGET_ATTR="budget_end";this.TARGET_CATEGORIES_ATTR="target_categories";this.BUDGET_NAME_PROP="data-budget-name";this.BUDGET_START_MONTH_PROP="data-start-month";this.BUDGET_END_MONTH_PROP="data-end-month";this.BUDGET_START_YEAR_PROP="data-start-year";this.BUDGET_END_YEAR_PROP="data-end-year";this.TARGET_CATEGORIES_PROP="data-target-categories";this.TARGET_DIV_ID="#target_";this.TARGET_AMOUNT_ATTR="target_amount";this.TARGET_AMOUNT_AS_NUMBER_ATTR="target_amount_as_number";this.TARGET_ROLLOVER_ATTR="target_rollover";this.TARGET_FORMATTED_PERIOD_ATTR="target_formatted_period";this.TARGET_PERIOD_ATTR="target_period";this.TARGET_EVERY_AS_NUMBER_ATTR="target_every_as_number";this.TARGET_CATEGORY_ID_ATTR="category_id";this.TARGET_CATEGORY_COLOR_ATTR="target_category_color";this.TARGET_CATEGORY_NAME_ATTR="target_category_name";this.TARGET_CURRENCY_ID_ATTR="target_currency_id";this.TARGET_ID_ATTR="id";this.TARGET_MAX_ATTR="max";this.TARGET_TOTAL_ATTR="target_total";this.TARGET_TOTAL_FORMATTED_ATTR="target_total_formatted";this.BUDGET_TOTAL_DIV_ID="#budget_total_";this.BUDGET_TOTAL_PROP="budget_total";this.TARGET_BAR_ID="#target_bar_";this.TARGET_BAR_LABEL_ID="#target_bar_label_";this.TARGET_EQUIVALENT_ATTR="target_equivalent";this.TARGET_FORMATTED_EQUIVALENT_ATTR="target_formatted_equivalent";this.TARGET_BAR_MAX_WIDTH=50;this.TARGET_ROLLOVER_FALSE="0";this.TARGET_ROLLOVER_TRUE="1";this.TARGET_ID_PROP="data-target-id";this.TARGET_CATEGORY_ID_PROP="data-target-category-id";this.TARGET_AMOUNT_AS_NUMBER_PROP="data-target-amount-as-number";this.TARGET_CURRENCY_ID_PROP="data-target-currency-id";this.TARGET_PERIOD_PROP="data-target-period";this.TARGET_EVERY_AS_NUMBER_PROP="data-target-every-as-number";this.TARGET_ROLLOVER_PROP="data-target-rollover";this.TARGET_BUDGET_ID_PROP="data-budget-id";this.TARGET_CATEGORY_BOX_ID="#target_category_box_";this.TARGET_CATEGORY_NAME_ID="#target_category_name_";this.BUDGETS_WRAPPER="#budgets_wrapper";this.BUDGET_WRAPPER_ID="#budget_wrapper_";this.TARGETS_DIV_ID="#budget_targets_";this.GET_BUDGETS_REQUEST="budgets";this.GET_BUDGET_REQUEST="one_budget";this.DELETE_BUDGET_REQUEST="delete_budget";this.DELETE_TARGET_REQUEST="delete_target";this.ADD_BUDGET_REQUEST="add_budget";this.EDIT_BUDGET_REQUEST="edit_budget";this.EDIT_TARGET_REQUEST="edit_target";this.GET_TARGETS_REQUEST="targets";this.GET_USER_CURRENCIES_REQUEST="user_currencies";this.GET_USER_CATEGORIES_REQUEST="user_categories";this.GET_INCOME_CATEGORIES_REQUEST="income_categories";this.ADD_TARGET_REQUEST="add_target";this.ADD_TARGET_BUDGET_RESULT_ATTR="budget";this.DELETE_BUDGET_BUTTON_ID="#delete-budget-button";this.DELETE_TARGET_BUTTON_ID="#delete-target-button";this.DELETE_BUDGET_ID="#delete_budget_";this.DELETE_TARGET_ID="#delete_target_";this.EDIT_BUDGET_ID="#edit_budget_";this.EDIT_BUDGET_TARGETS_PROP="data-targets";this.EDIT_TARGET_ID="#edit_target_";this.ADD_TARGET_ID="#add_target_";this.BUDGET_NAME_DIV_ID="#budget_name_";this.BUDGET_START_ID="#budget_start_";this.BUDGET_END_ID="#budget_end_";this.FIRST_BUDGET="div.budget_wrapper:first-child div.budget";this.BUDGET_ID_PROP="data-budget-id";this.BUDGET_ARROW_ID="#budget_arrow_";this.BUDGET_TARGETS_ID="#budget_targets_";this.BUDGET_ID="#budget_";this.BUDGET_SETTING_MENU_ID="#budget_setting_menu_";this.BUDGET_SETTING_MENU=".budget_settings";this.BUDGET_SETTING_GEAR_ID="#budget_setting_";this.BUDGET_SETTING_GEAR=".budget_setting";this.TARGET_SETTING_MENU_ID="#target_setting_menu_";this.TARGET_ROLLOVER_ID="#target_rollover_";this.TARGET_SETTING_MENU=".target_settings";this.TARGET_SETTING_GEAR_ID="#target_setting_";this.TARGET_SETTING_GEAR=".target_setting";this.SHOW_ADD_BUDGET_BUTTON_ID="#show-add-budget-button";this.ADD_BUDGET_BUTTON_ID="#add-budget-button";this.ADD_NEW_BUDGET_BUTTON_ID="#add-new-budget-button";this.EDIT_BUDGET_BUTTON_ID="#edit-budget-button";this.ADD_BUDGET_WINDOW_TEMPLATE_ID="#add-budget-window-template";this.ADD_BUDGET_TABLE_ADD_TARGET_BUTTON="#add-budget-table-add-target-button";this.EDIT_BUDGET_TABLE_ADD_TARGET_BUTTON="#edit-budget-table-add-target-button";this.TARGET_ROW_TEMPLATE_ID="#target-row-template";this.DELETE_BUDGET_WINDOW_TEMPLATE_ID="#delete-budget-window-template";this.DELETE_TARGET_WINDOW_TEMPLATE_ID="#delete-target-window-template";this.EDIT_BUDGET_WINDOW_TEMPLATE_ID="#edit-budget-window-template";this.TARGETS_ARROW_ID="#targets-arrow";this.TARGETS_ADD_HIDE_ID="#targets-add-hide";this.BUDGET_NAME_ID="#budget-name";this.BUDGET_START_MONTH_ID="#budget-start-month";this.BUDGET_END_MONTH_ID="#budget-end-month";this.BUDGET_START_YEAR_ID="#budget-start-year";this.BUDGET_END_YEAR_ID="#budget-end-year";this.TARGET_CATEGORY_ID="#target_category_";this.TARGET_AMOUNT_ID="#target-amount-";this.TARGET_ROLLOVER_ID="#target_rollover_";this.TARGET_CURRENCY_ID="#target_currency_";this.TARGET_PERIOD_ID="#target_period_";this.TARGET_EVERY_ID="#target_every_";this.NUM_TARGETS=5;this.ANALYTICS_EXPENSE_MONTH_COMBOBOX_ID="#analytics_expenses_month";this.ANALYTICS_EXPENSE_YEAR_COMBOBOX_ID="#analytics_expenses_year";this.ANALYTICS_EXPENSE_ACCOUNT_COMBOBOX_ID="#analytics_expenses_account";this.ANALYTICS_TOTAL_EXPENSE_ACCOUNT_COMBOBOX_ID="#analytics_total_expenses_account";this.ANALYTICS_EXPENSE_FILTER_COMBOBOX_ID="#analytics_expenses_filter";this.ANALYTICS_GET_MONTHLY_EXPENSE_REQUEST="analytics_monthly_expense";this.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_PATH_ID="#monthly_expense_line_chart_path";this.ANALYTICS_MONTHLY_SAVING_LINE_CHART_PATH_ID="#monthly_saving_line_chart_path";this.ANALYTICS_GET_MONTHLY_TRANSACTIONS_OVERVIEW_REQUEST="transactions_monthly_overview";this.ANALYTICS_GET_MONTHLY_EXPENSE_STATS_REQUEST="analytics_monthly_expenses_stats";this.ANALYTICS_GET_MONTHLY_EXPENSE_VS_INCOME_STATS_REQUEST="analytics_monthly_income_vs_expenses_stats";this.ANALYTICS_GET_MONTHLY_SAVINGS_STATS_REQUEST="analytics_monthly_savings_stats";this.ANALYTICS_MONTHLY_EXPENSE_TEMPLATE_ID="#monthly-expense-template";this.ANALYTICS_TOTAL_MONTHLY_EXPENSE_TEMPLATE_ID="#total-monthly-expense-template";this.ANALYTICS_MONTHLY_EXPENSE_ITEM_TEMPLATE_ID="#monthly-expense-item-template";this.ANALYTICS_MONTHLY_EXPENSE_PAYEE_TEMPLATE_ID="#monthly-expense-payee-template";this.ANALYTICS_MONTHLY_EXPENSE_WRAPPER_NOTHING_FOUND_ID="#monthly_expense_wrapper_nothing_found";this.ANALYTICS_MONTHLY_EXPENSE_WRAPPER_NOTHING_FOUND_MONTH_ID="#monthly_expense_wrapper_nothing_found_month";this.ANALYTICS_MONTHLY_EXPENSE_WRAPPER_ID="#monthly_expense_wrapper";this.ANALYTICS_MONTHLY_EXPENSE_WRAPPER_LOADING_ID="#monthly-expense-wrapper-loading";this.ANALYTICS_MONTHLY_EXPENSE_STATS_WRAPPER_ID="#monthly_expense_stats_wrapper";this.ANALYTICS_MONTHLY_EXPENSE_STATS_WRAPPER_LOADING_ID="#monthly-expense-stats-wrapper-loading";this.ANALYTICS_MONTHLY_EXPENSE_CONVERTED_AMOUNT_ATTR="converted_amount";this.ANALYTICS_MONTHLY_EXPENSE_MAX_AMOUNT_ATTR="max_amount";this.ANALYTICS_MONTHLY_EXPENSE_THIS_MONTH_MAX_AMOUNT_ATTR="this_month_max_amount";this.ANALYTICS_MONTHLY_EXPENSE_PREV_MONTH_MAX_AMOUNT_ATTR="prev_month_max_amount";this.ANALYTICS_MONTHLY_EXPENSE_AVG_MAX_AMOUNT_ATTR="avg_max_amount";this.ANALYTICS_MONTHLY_EXPENSE_FILTER_BY_ITEM="by_item";this.ANALYTICS_MONTHLY_EXPENSE_FILTER_BY_CATEGORY="by_category";this.ANALYTICS_MONTHLY_EXPENSE_FILTER_BY_PAYEE="by_payee";this.ANALYTICS_PREV_MONTH_CONVERTED_AMOUNT_ATTR="prev_month_converted_amount";this.ANALYTICS_AVG_MONTH_CONVERTED_AMOUNT_ATTR="avg_converted_amount";this.ANALYTICS_CONVERTED_AMOUNT_ATTR="converted_amount";this.ANALYTICS_SAVING_AMOUNT_ATTR="saving";this.ANALYTICS_MONTHLY_EXPENSE_CHECKBOX="#analytics_monthly_expense_checkbox";this.ANALYTICS_AVG_MONTHLY_EXPENSE_CHECKBOX="#analytics_avg_monthly_expense_checkbox";this.ANALYTICS_MONTHLY_EXPENSE_BAR_WRAPPER_CLASS=".monthly_expense_bar_wrapper";this.ANALYTICS_MONTHLY_EXPENSE_BAR_ID="#monthly_expense_bar_";this.ANALYTICS_TOTAL_MONTHLY_EXPENSE_BAR_ID="#total_monthly_expense_bar_";this.ANALYTICS_PREV_MONTHLY_EXPENSE_BAR_ID="#prev_monthly_expense_bar_";this.ANALYTICS_AVG_MONTHLY_EXPENSE_BAR_ID="#avg_monthly_expense_bar_";this.ANALYTICS_TOTAL_EXPENSE_PERIOD_ID="#analytics_total_expenses_period";this.ANALYTICS_TOTAL_EXPENSE_CATEGORY_ID="#analytics_total_expenses_category";this.ANALYTICS_TOTAL_MONTHLY_EXPENSES_SORT_BY_DSC="max_min";this.ANALYTICS_TOTAL_MONTHLY_EXPENSES_SORT_BY_ASC="min_max";this.ANALYTICS_INCOME_EXPENSE_SORT_BY_ID="#analytics_income_vs_expense_sort_by";this.ANALYTICS_INCOME_EXPENSE_PERIOD_ID="#analytics_income_vs_expense_period";this.ANALYTICS_SAVING_PERIOD_ID="#analytics_saving_period";this.ANALYTICS_INCOME_EXPENSE_ACCOUNT_COMBOBOX_ID="#analytics_income_vs_expense_account";this.ANALYTICS_SAVING_ACCOUNT_COMBOBOX_ID="#analytics_saving_account";this.ANALYTICS_INCOME_EXPENSE_MONTH_COMBOBOX_ID="#analytics_expenses_month";this.ANALYTICS_INCOME_EXPENSE_YEAR_COMBOBOX_ID="#analytics_expenses_year";this.ANALYTICS_MONTHLY_EXPENSE_CLASS=".monthly-expense";this.ANALYTICS_BAR_LABEL_WIDTH=100;this.TOTAL_ANALYTICS_BAR_LABEL_WIDTH=60;this.TOTAL_ANALYTICS_AVERAGE_BAR_HEIGHT=40;this.TOTAL_ANALYTICS_BUDGET_LIMIT_BAR_HEIGHT=40;this.TOTAL_ANALYTICS_BUDGET_LIMIT_MARGIN=35;this.TOTAL_ANALYTICS_AVERAGE_BAR_MARGIN=20;this.TOTAL_ANALYTICS_AVERAGE_BAR_CLASS_NAME="total_avg_monthly_expense_bar";this.TOTAL_ANALYTICS_CLASS_NAME_ATTR="expense_title_class";this.TOTAL_ANALYTICS_TOOLTIP_ID="#total_monthly_expense_tooltip_";this.ANALYTICS_BUGET_ACCOUNT_ID="#analytics_budget_account";this.ANALYTICS_BUDGET_BUDGET_ID="#analytics_budget_budget";this.ANALYTICS_BUDGET_MONTH_ID="#analytics_budget_month";this.ANALYTICS_BUDGET_YEAR_ID="#analytics_budget_year";this.ANALYITCS_GET_BUDGETS_REQUEST="analytics_budgets";this.ANALYITCS_GET_BUDGETS_ANALYTICS_REQUEST="budget_analytics";this.BUDGETS_FILTER_COMBOBOX_TEMPLATE="#budget-filter-combobox-template";this.BUDGET_ANALYTICS_BUDGET_LIMIT_TEMPLATE="#budget-analytics-budget-limit-template";this.ANALYTICS_TRANSACTION_OVERVIEW_CALLOUT_TEMPLATE="#transaction-overview-callout-template";this.ANALYTICS_TRANSACTION_OVERVIEW_TODAY_POINTER_TEMPLATE="#transaction-overview-today-pointer";this.BUDGET_ANALYTICS_BUDGET_LIMIT_ID="#budget_analytics_budget_limit";this.BUDGET_ANALYTICS_BUDGET_LIMIT_SINGLE_ID="#budget_analytics_budget_limit_";this.BUDGET_ANALYTICS_BUDGET_LIMIT_HEIGHT="25px";this.BUDGET_ANALYTICS_BUDGET_LIMIT_TOP="-8.5px";this.BUDGET_ANALYTICS_BUDGET_LIMIT_LABEL_ID="#budget_analytics_budget_limit_label";this.BUDGETS_ANALYTICS_TEMPLATE="#budget-analytics-template";this.BUDGETS_ANALYTICS_MONEY_SCALE_TEMPLATE="#budget-analytics-money-scale-template";this.TRANSACTION_SPENDING_INCOME_TABLE_TEMPLATE="#transaction-spending-income-table-template";this.BUDGETS_ANALYTICS_WRAPPER_ID="#analytics_budgets_wrapper";this.BUDGETS_ANALYTICS_WRAPPER_LOADING_ID="#analytics-budgets-wrapper-loading";this.BUDGETS_ANALYTICS_INCOME_EXPENSE_WRAPPER_ID="#income_vs_expenses_wrapper";this.BUDGETS_ANALYTICS_INCOME_EXPENSE_WRAPPER_LOADING_ID="#income-vs-expenses-loading";this.ANALYTICS_BUDGET_ANALYTICS_MAX_AMOUNT_ATTR="max_percentage";this.ANALYTICS_BUDGET_ANALYTICS_MAX_AMOUNT_MONEY_SCALE_ATTR="max_amount";this.ANALYTICS_BUDGET_ANALYTICS_BAR_WRAPPER_CLASS=".budget_analytics_bar_wrapper";this.ANALYTICS_BUDGET_ANALYTICS_PERCENTAGE="percentage";this.ANALYTICS_BUDGET_ANALYTICS_SPENT_AMOUNT="spent_amount";this.ANALYTICS_BUDGET_ANALYTICS_OVERSPENT_AMOUNT="overspent_amount";this.ANALYTICS_BUDGET_ANALYTICS_REMAINING_AMOUNT="remaining_amount";this.ANALYTICS_BUDGET_ANALYTICS_PLANNED_AMOUNT="planned_amount";this.ANALYTICS_BUDGET_ANALYTICS_BAR_ID="#budget_analytics_bar_";this.ANALYTICS_COMPLETE_BUDGET_ANALYTICS_BAR_ID="#complete_budget_analytics_";this.ANALYTICS_BUDGET_ABOVE_PERCENTAGE_ANALYTICS_BAR_ID="#budget_analytics_above_percentage_bar_";this.ANALYTICS_BUDGET_MORE_FILTERS_BUTTON_ID="#analytics_budget_more_filters";this.ANALYTICS_BUDGET_FILTERS_DIV_ID="#analytics_budget_filters";this.ANALYTICS_BUDGET_FILTERS_SHOWN_ATTR="data-filters-shown";this.ANALYTICS_BUDGET_FILTERS_SHOWN_YES="yes";this.ANALYTICS_BUDGET_FILTERS_SHOWN_NO="no";this.ANALYTICS_BUDGET_MORE_FILTERS_TEXT="more filters ...";this.ANALYTICS_BUDGET_LESS_FILTERS_TEXT="less filters";this.ANALYTICS_BUDGET_FILTERS_MORE_FILTERS_HEIGHT="110px";this.ANALYTICS_BUDGET_FILTERS_LESS_FILTERS_HEIGHT="55px";this.ANALYTICS_BUDGET_FILTERS_BUTTON_TEXT_ID="#analytics_budget_filters_button_text";this.ANALYTICS_BUDGET_SCALE_ID="#analytics_budget_scale";this.ANALYTICS_BUDGET_SCALE_MONEY_VAL="money";this.ANALYTICS_BUDGET_SCALE_TARGET_VAL="target";this.ANALYTICS_BUDGET_UNDERSPENT_TOOLTIP_ID="#budget_analytics_underspent_tooltip_";this.ANALYTICS_BUDGET_OVERSPENT_TOOLTIP_ID="#budget_analytics_overspent_tooltip_";this.ANALYTICS_BUDGET_ALL_SPENT_TOOLTIP_ID="#budget_analytics_all_spent_tooltip_";this.ANALYTICS_EXPENSE_CONVERTED_AMOUNT_ATTR="expense_converted_amount";this.ANALYTICS_INCOME_CONVERTED_AMOUNT_ATTR="income_converted_amount";this.ANALYTICS_FORMATTED_SAVINGS_ATTR="formatted_savings";this.ANALYTICS_FORMATTED_OVERSPENDING_ATTR="formatted_overspending";this.ANALYTICS_MONTHLY_EXPENSE_INCOME_TEMPLATE_ID="#income-expense-analytics-template";this.ANALYTICS_MONTHLY_TOTAL_EXPENSE_INCOME_TEMPLATE_ID="#total-income-expense-analytics-template";this.ANALYTICS_FORMATTED_TOTAL_INCOME_ATTR="formatted_total_income";this.ANALYTICS_FORMATTED_TOTAL_INCOME_ID="#total_income_expense_income";this.ANALYTICS_FORMATTED_TOTAL_EXPENSE_ATTR="formatted_total_expense";this.ANALYTICS_FORMATTED_TOTAL_EXPENSE_ID="#total_income_expense_expense";this.ANALYTICS_FORMATTED_TOTAL_SAVINGS_ATTR="formatted_total_savings";this.ANALYTICS_TOTAL_SAVINGS_ATTR="total_savings";this.ANALYTICS_FORMATTED_TOTAL_SAVINGS_WRAPPER_ID="#total_income_expense_savings_wrapper";this.ANALYTICS_FORMATTED_TOTAL_SAVINGS_ID="#total_income_expense_savings";this.ANALYTICS_FORMATTED_TOTAL_OVERSPENDING_ATTR="formatted_total_overspending";this.ANALYTICS_FORMATTED_TOTAL_OVERSPENDING_WRAPPER_ID="#total_income_expense_overspending_wrapper";this.ANALYTICS_FORMATTED_TOTAL_OVERSPENDING_ID="#total_income_expense_overspending";this.ANALYTICS_TOTAL_SAVINGS_ATTR="total_savings";this.ANALYTICS_SINGLE_TRANSACTION_BAR_OVERVIEW_TEMPLATE_ID="#single-transaction-bar-overview-template";this.ANALYTICS_SINGLE_TRANSACTION_BAR_LINE_OVERVIEW_TEMPLATE_ID="#single-transaction-bar-line-overview-template";this.ANALYTICS_EXPENSE_BAR_ID="#monthly_expenses_bar_";this.ANALYTICS_INCOME_BAR_ID="#monthly_income_bar_";this.ANALYTICS_INCOME_BAR_LABEL_ID="#monthly_income_bar_label_";this.ANALYTICS_EXPENSE_BAR_LABEL_ID="#monthly_expenses_bar_label_";this.ANALYTICS_SAVINGS_BAR_ID="#monthly_savings_bar_";this.ANALYTICS_LOSS_BAR_ID="#monthly_loss_bar_";this.ANALYTICS_INCOME_EXPENSE_LIMIT_ID="#income_expense_limit_";this.ANALYTICS_OVERSPENDING_ARROW_ID="#analytics_overspending_arrow_";this.ANALYTICS_SAVINGS_ARROW_ID="#analytics_savings_arrow_";this.ANALYTICS_OVERSPENDING_ARROW_LABEL_ID="#analytics_overspending_label_";this.ANALYTICS_SAVINGS_ARROW_LABEL_ID="#analytics_savings_label_";this.ANALYTICS_TOOLTIP_SAVINGS_ID="#tooltip_savings_";this.ANALYTICS_TOOLTIP_OVERSPENDING_ID="#tooltip_overspending_";this.MONTHLY_TRANSACTIONS_OVERVIEW_ID="#monthly_transactions_overview";this.MONTHLY_TRANSACTIONS_TITLE_ID="#monthly_transaction_title_month";this.MONTHLY_TRANSACTIONS_OVERVIEW_BAR_MAX_LENGTH=50;this.MONTHLY_TRANSACTION_BAR_OVERVIEW_BAR_BACKGROUND_ID="#transaction_bar_overview_background_";this.MONTHLY_TRANSACTION_BAR_OVERVIEW_BAR_ID="#transaction_bar_overview_";this.MONTHLY_TRANSACTION_BAR_OVERVIEW_LINE_ID="#transaction_bar_overview_line";this.MONTHLY_TRANSACTION_BAR_OVERVIEW_LABEL_ID="#transaction_bar_label_overview_";this.TRANSACTION_OVERSPENDING_ATTR="overspending";this.INCOME_SPENDING_SAVINGS_ATTR="savings";this.SPENDING_INCOME_TABLE_SAVINGS_ROW_ID="#spending-income-table-savings-row";this.SPENDING_INCOME_TABLE_OVERSPENDING_ROW_ID="#spending-income-table-overspending-row";this.ANALYTICS_TRANSACTION_OVERVIEW_TRANSACTION_ITEMS_ATTR="transaction_items"
this.ANALYTICS_TRANSACTION_OVERVIEW_BAR_TABLE_ID="#transaction_bar_table_";this.ANALYTICS_TRANSACTION_BAR_TOOLTIP_ID="#transaction_bar_tooltip_";this.ANALYTICS_TRANSACTION_OVERVIEW_TABLE_HEADING_ID="#transaction_table_heading_";this.ANALYTICS_MONTHLY_EXPENSE_LINE_WRAPPER="#monthly_expense_line_wrapper";this.ANALYTICS_MONTHLY_SAVING_LINE_WRAPPER="#monthly_saving_line_wrapper";this.ANALYTICS_MONTHLY_EXPENSE_LINE_DIV_WRAPPER="#monthly_expense_line_div_wrapper";this.ANALYTICS_MONTHLY_SAVING_LINE_DIV_WRAPPER="#monthly_saving_line_div_wrapper";this.ANALYTICS_MONTHLY_SAVING_LINE_DIV_WRAPPER_LOADING="#monthly-saving-line-div-wrapper-loading";this.ANALYTICS_MONTHLY_EXPENSE_LINE_WRAPPER_HEIGHT=60;this.ANALYTICS_TOTAL_TRANSACTION_BAR_TEMPLATE_ID="#expense-total-bar-template";this.ANALYTICS_TOTAL_SAVING_TRANSACTION_BAR_TEMPLATE_ID="#saving-total-bar-template";this.ANALYTICS_TOTAL_TRANSACTION_BAR_SVG_WRAPPER_TEMPLATE_ID="#expense-total-bar-svg-wrapper-template";this.ANALYTICS_TOTAL_SAVING_BAR_SVG_WRAPPER_TEMPLATE_ID="#saving-total-bar-svg-wrapper-template";this.ANALYTICS_TRANSACTION_TOTAL_BAR_BACKGROUND_ID="#transaction_total_bar_background_";this.ANALYTICS_TRANSACTION_TOTAL_BAR_ID="#transaction_total_bar_";this.ANALYTICS_SAVING_TOTAL_BAR_ID="#saving_total_bar_";this.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_TEMPLATE_ID="#monthly-expense-line-chart-template";this.ANALYTICS_MONTHLY_SAVING_LINE_CHART_TEMPLATE_ID="#monthly-saving-line-chart-template";this.ANALYTICS_MONTHLY_LINE_CHART_LABEL_TEMPLATE_ID="#monthly-expense-line-chart-month-label-template";this.ANALYTICS_MONTHLY_SAVING_LINE_CHART_LABEL_TEMPLATE_ID="#monthly-saving-line-chart-month-label-template";this.ANALYTICS_MONTHLY_LINE_CHART_AVERAGE_TEMPLATE_ID="#monthly-expense-line-chart-month-average-template";this.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_BOTTOM_MARGIN=25;this.ANALYTICS_MONTHLY_SAVING_LINE_CHART_BOTTOM_MARGIN=5;this.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_LABEL="#monthly_expense_line_chart_month_label_";this.ANALYTICS_MONTHLY_SAVING_LINE_CHART_LABEL="#monthly_saving_line_chart_month_label_";this.ANALYTICS_MONTHLY_SAVING_LINE_CHART_LABEL_CLASS=".monthly_saving_line_chart_month_label";this.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_LABEL_TEXT="#monthly_expense_line_chart_month_label_text_";this.ANALYTICS_MONTHLY_SAVING_LINE_CHART_LABEL_TEXT="#monthly_saving_line_chart_month_label_text_";this.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_SPENDING_LABEL="#monthly_expense_line_chart_spending_label_";this.ANALYTICS_MONTHLY_SAVING_LINE_CHART_SPENDING_LABEL="#monthly_saving_line_chart_spending_label_";this.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_AVERAGE_CLASS=".monthly_expense_line_chart_month_average";this.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_AVERAGE="#monthly_expense_line_chart_month_average";this.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_AVERAGE_ID="#monthly_expense_line_chart_month_average_";this.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_AVERAGE_LABEL_ID="#monthly_expense_line_chart_average_label";this.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_AVERAGE_LABEL_TOP_MARGIN=28;this.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_AVERAGE_LABEL_LEFT_MARGIN=75;this.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_AVERAGE_EXTRA_WIDTH=50;this.ANALYTICS_MONTHLY_TOTAL_EXPENSE_AVG_COMBOBOX_ID="#analytics_total_expenses_average_checkbox";this.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_TOOLTIP_ID="#monthly_expense_line_chart_tooltip_";this.ANALYTICS_MONTHLY_SAVING_LINE_CHART_TOOLTIP_ID="#monthly_saving_line_chart_tooltip_";this.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_BELOW_AVERAGE_ATTR="below_average";this.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_BELOW_AVERAGE_ROW_ID="#monthly_expense_line_chart_less_avg_";this.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_ABOVE_AVERAGE_ATTR="above_average";this.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_ABOVE_AVERAGE_ROW_ID="#monthly_expense_line_chart_more_avg_";this.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_TOOLTIP_CLASS="monthly_expenses_line_chart_tooltip";this.ANALYTICS_MONTHLY_SAVING_LINE_CHART_TOOLTIP_CLASS="monthly_saving_line_chart_tooltip";this.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_TOOLTIP_CLASS_V2="monthly_expenses_line_chart_tooltip_v2";this.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_TOOLTIP_CLASS_V3="monthly_expenses_line_chart_tooltip_v3";this.ANALYTICS_MONTHLY_SAVING_LINE_CHART_TOOLTIP_CLASS_V2="monthly_saving_line_chart_tooltip_v2";this.ANALYTICS_MONTHLY_SAVING_LINE_CHART_TOOLTIP_CLASS_V3="monthly_saving_line_chart_tooltip_v3";this.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_TOOLTIP_V2_WIDTH=80;this.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_TOOLTIP_V3_WIDTH=120;this.ANALYTICS_MONTHLY_EXPENSE_LINE_CHART_TRANSPARENT_BAR_ID="#monthly_expense_line_chart_transparent_bar_";this.ANALYTICS_MONTHLY_SAVING_LINE_CHART_TRANSPARENT_BAR_ID="#monthly_saving_line_chart_transparent_bar_";this.ANALYTICS_GET_EXPENSE_CATEGORIES_REQUEST="analytics_expense_categories";this.ANALYTICS_GET_EXPENSE_CATEGORIES_REQUEST_PERIOD=12;this.ANALYTICS_MONTHLY_EXPENSE_BAR_LABEL_ID="#monthly_expense_bar_label_";this.ANALYTICS_PREV_MONTHLY_EXPENSE_BAR_LABEL_ID="#prev_monthly_expense_bar_label_";this.ANALYTICS_MONTHLY_EXPENSE_PIE_CHART_FULL_RADIUS=182.212373908;this.ANALYTICS_MONTHLY_EXPENSE_UNFORMATTED_PERCENTAGE_ATTR="expense_percentage_unformatted";this.ANALYTICS_MONTHLY_EXPENSE_TOOLTIP_PERCENTAGE_ID="#expense_tooltip_percentage_";this.ANALYTICS_MONTHLY_EXPENSE_TOOLTIP_PERCENTAGE_BORDER_ID="#expense_tooltip_percentage_border_";this.ANALYTICS_EXPENSE_TOOLTIP_THIS_MONTH_BAR_ID="#expense_tooltip_this_month_bar_";this.ANALYTICS_EXPENSE_TOOLTIP_PREV_MONTH_BAR_ID="#expense_tooltip_prev_month_bar_";this.ANALYTICS_EXPENSE_TOOLTIP_AVG_MONTH_BAR_ID="#expense_tooltip_avg_month_bar_";this.ANALYTICS_EXPENSE_TOOLTIP_BAR_MAX_WIDTH=60;this.ANALYTICS_EXPENSE_TOOLTIP_THIS_MONTH_TEXT_ATTR="this_month_text";this.ANALYTICS_EXPENSE_TOOLTIP_PREV_MONTH_TEXT_ATTR="prev_month_text";this.ANALYTICS_EXPENSE_TOOLTIP_STATS_CELL_THIS_MONTH_ID="#expense_tooltip_stats_cell_this_month_";this.ANALYTICS_EXPENSE_TOOLTIP_SPENDING_BREAKDOWN_MONTH_ID="#spending_breakdown_month_";this.ANALYTICS_EXPENSE_TOOLTIP_STATS_CELL_PREV_MONTH_ID="#expense_tooltip_stats_cell_prev_month_";this.ANALYTICS_EXPENSE_TOOLTIP_ID="#expense_tooltip_";this.ANALYTICS_EXPENSE_TOOLTIP_BOTTOM_TABLE_MONTH_TITLE_ID="#expense_tooltip_bottom_table_month_title_";this.ANALYTICS_EXPENSE_TOOLTIP_CLASS=".expense_tooltip";this.ANALYTICS_TOOLTIP_CLOSE_ID="#tooltip_close_";this.ANALYTICS_EXPENSE_MORE_SPENDING_ICON_ID="#expense_tooltip_more_spending_icon_";this.ANALYTICS_EXPENSE_LESS_SPENDING_ICON_ID="#expense_tooltip_less_spending_icon_";this.ANALYTICS_EXPENSE_LEAF_ICON_ID="#expense_tooltip_leaf_icon_";this.ANALYTICS_EXPENSE_WARNING_ICON_ID="#expense_tooltip_warning_icon_";this.ANALYTICS_EXPENSE_LEAF_CATEGORY_ICON_ID="#expense_tooltip_leaf_category_icon_";this.ANALYTICS_EXPENSE_WARNING_CATEGORY_ICON_ID="#expense_tooltip_warning_category_icon_";this.ANALYTICS_EXPENSE_MONTHLY_LINE_CHART_FLAME_ICON_ID="#monthly_expense_line_chart_flame_icon_";this.ANALYTICS_EXPENSE_TOOLTIP_SPENDING_NAME_MAX_LENGTH=15;this.ANALYTICS_EXPENSE_SPENDING_TITLE_ID="#expense_tooltip_top_spending_title_";this.ANALYTICS_EXPENSE_TOOLTIP_BOTTOM_TABLE_TITLE_ID="#expense_tooltip_bottom_table_title_";this.ANALYTICS_EXPENSE_TOOLTIP_CATEGORY_NAME_PROP="category_name";this.ANALYTICS_BUDGET_TOOLTIP_WARNING_ICON_ID="#budget_tooltip_warning_icon_";this.ANALYTICS_BUDGET_TOOLTIP_CATEGORY_NAME_ID="#budget_tooltip_category_name_";this.ANALYTICS_BUDGET_TOOLTIP_WARNING_CATEGORY_ICON_ID="#budget_tooltip_warning_category_icon_";this.ANALYTICS_BUDGET_BAR_LABEL_ID="#budget_analytics_bar_label_";this.ANALYTICS_BAR_WIDTH_PERCENTAGE=95;this.ANALYTICS_MIN_LABEL_WIDTH=20;this.ANALYTICS_INCOME_EXPENSE_TOOLTIP_SAVINGS_ROW_ID="#income_expense_tooltip_savings_row_";this.ANALYTICS_INCOME_EXPENSE_TOOLTIP_LOSS_ROW_ID="#income_expense_tooltip_loss_row_";this.ANALYTICS_INCOME_EXPENSE_TOOLTIP_WARNING_ICON_ID="#income_expense_tooltip_warning_icon_";this.ANALYTICS_INCOME_EXPENSE_TOOLTIP_WARNING_MONTH_ICON_ID="#expense_income_tooltip_warning_month_icon_";this.ANALYTICS_INCOME_EXPENSE_TOOLTIP_LEAF_MONTH_ICON_ID="#expense_income_tooltip_leaf_month_icon_";this.ANALYTICS_INCOME_EXPENSE_TOOLTIP_LEAF_ICON_ID="#income_expense_tooltip_leaf_icon_";this.ANALYTICS_INCOME_EXPENSE_TOOLTIP_MIN_HEIGHT=85;this.ANALYTICS_INCOME_EXPENSE_TOOLTIP_ID="#income_expense_tooltip_";this.ANALYTICS_INCOME_EXPENSE_TOOLTIP_MIN_TOP="-90px";this.ANALYTICS_EXPENSE_TOTAL_AMOUNT_ID="#expense_all_total_amount";this.ANALYTICS_SAVING_TOTAL_AMOUNT_ID="#saving_all_total_amount";this.ANALYTICS_FORMATTED_TOTAL_AMOUNT_ATTR="formatted_total_amount";this.ANALYTICS_SAVING_MAX_SAVING_ATTR="max_saving";this.ANALYTICS_SAVING_MIN_SAVING_ATTR="min_saving";this.ANALYTICS_SAVING_FORMATTED_TOTAL_SAVING_ATTR="formatted_total_savings";this.ANALYTICS_SAVING_TOTAL_SAVING_ATTR="total_savings";this.ANALYTICS_MONTHLY_SAVING_LINE_CHART_HORIZONTAL_LINE_ID="#monthly_saving_line_chart_horizontal_line";this.ANALYTICS_MONTHLY_SAVING_TEXT_COLOR="rgb(95,189,0)";this.ANALYTICS_MONTHLY_OVERSPENDING_TEXT_COLOR="red";this.ANALYTICS_MONTHLY_SAVING_SPENDING_ICON="#monthly_saving_line_chart_spending_icon_";this.ANALYTICS_MONTHLY_SAVING_TOOLTIP_AMOUNT_ID="#monthly_saving_tooltip_amount_";this.SETTINGS_WINDOW_TEMPLATE_ID="#settings-window-template";this.SETTINGS_USERNAME_ID="#username";this.CHANGE_PASSWORD_BUTTON_ID="#change-password-button";this.SETTINGS_DATE_FORMAT_ID="#date-format";this.SETTINGS_DATE_FORMAT_EXAMPLE_ID="#date-format-example";this.SETTINGS_TIME_FORMAT_ID="#time-format";this.SETTINGS_TIME_FORMAT_EXAMPLE_ID="#time-format-example";this.SETTING_DEFAULT_CURRENCY_ID="#default-currency";this.SETTINGS_NUMBER_FORMAT_ID="#number-format";this.SETTINGS_NUMBER_FORMAT_EXAMPLE_ID="#number-format-example";this.EDIT_SETTINGS_BUTTON_ID="#edit-settings-button";this.EDIT_SETTINGS_REQUEST="edit_settings";this.SETTINGS_CHANGE_PASSWORD_TEMPLATE_ID="#change-password-window-template";this.SETTING_CHANGE_PASSWORD_REQUEST_BUTTON_ID="#change-password-request-button";this.SETTINGS_OLD_PASSWORD_ID="#old_password";this.SETTINGS_PASSWORD_ID="#password";this.SETTINGS_CONFIRMED_PASSWORD_ID="#confirmed_password";this.SETTINGS_CHANGE_PASSWORD_REQUEST="change_password";this.SETTINGS_DELETE_USER_ACCOUNT_REQUEST="delete_user_account";this.SETTINGS_DELETE_MY_ACCOUNT_TEMPLATE_ID="#delete-my-account-window-template";this.HEADING_USERNAME_ID="#username_heading";this.SETTINGS_DELETE_USER_ACCOUNT="#delete-user-account-button";this.HELP_TOOLTIP_ID="#help-tooltip-";this.HELP_TOOLTIP_TEMPLATE_ID="#help-template-";this.HELP_TOPIC_PAYEE="payee";this.HELP_TOPIC_ACCOUNT="account";this.HELP_TOPIC_TRANSACTION_ITEMS="transaction-items";this.HELP_TOPIC_INCOME_ACCOUNT="income-account";this.HELP_TOPIC_INCOME_SOURCE="income-source";this.HELP_TOPIC_TO_ACCOUNT="to-account";this.HELP_TOPIC_FROM_ACCOUNT="from-account";this.HELP_TOPIC_CATEGORY_TYPE="category-type";this.HELP_TOPIC_MONEY_TYPE="money-type";this.HELP_TOPIC_ACCOUNT_TYPE="account-type";this.HELP_TOPIC_INITIAL_BALANCE="initial-balance";this.HELP_TOPIC_BUDGET_START="budget-start";this.HELP_TOPIC_BUDGET_END="budget-end";this.HELP_TOPIC_TARGET_FREQUENCY="target-frequency";this.HELP_TOPIC_TARGET_ROLLOVER="target-rollover";this.ORIENTATION_BOX_ID="#orientation-box";this.ORIENTATION_TITLE_ID="#orientation-title";this.ORIENTATION_CLOSE_ID="#orientation-close";this.ORIENTATION_CONTENT_ID="#orientation-content";this.ORIENTATION_PHONE_CONTENT_ID="#orientation-phone-content";this.ORIENTATION_NEXT_BUTTON_ID="#orientation-next-button";this.ORIENTATION_PREV_BUTTON_ID="#orientation-previous-button";this.ORIENTATION_TOOLTIP_CLASS_NAME=".tutorial_tooltip";this.ORIENTATION_START_TRIP_TEXT="Start Trip";this.ORIENTATION_END_TRIP_TEXT="End Trip";this.ORIENTATION_NEXT_TEXT="Next";this.ORIENTATION_PHONE_WIDTH=500;}
$.fn.form=function(){var formData={};this.find('[name]').each(function(){formData[this.name]=this.value;})
return formData;};function htmlMaker(template){this.template=template;}
htmlMaker.prototype.getHTML=function(values){var html="";if($.isArray(values))
for(var i=0;i<values.length;++i){html+=this.get_html_unrepeated(values[i],i);}
else
html=this.get_html_unrepeated(values,0);return html;};htmlMaker.prototype.get_html_unrepeated=function(values,index){var html=this.template;for(var key in values){if(html.search(key)!=-1&&$.isArray(values[key]))
html=this.replace_Block(key,values[key],html);else{var re=new RegExp("{{"+key+"}}",'g');html=html.replace(re,values[key]);}}
var index_re=new RegExp("{{index}}",'g');html=html.replace(index_re,index);return html;};htmlMaker.prototype.replace_Block=function(block_name,values,template){var block_start_text="{{#block "+block_name+"}}";var block_end_text="{{#end block "+block_name+"}}";var start_index=template.search(block_start_text)+block_start_text.length;var end_index=template.search(block_end_text);var block=template.substring(start_index,end_index);template=template.substring(0,start_index)+template.substring(end_index,template.length-1);if(block.length>0){var blocks="";var html_maker=new htmlMaker(block);blocks=html_maker.getHTML(values);template=template.replace(block_start_text,blocks);template=template.replace(block_end_text,"");}
return template;};$(document).ready(function(){GENERAL.disable_main_button($(constants.SHOW_ADD_TRANSACTION_BUTTON_ID));GENERAL.disable_main_button($(constants.SHOW_ADD_BUDGET_BUTTON_ID));GENERAL.disable_main_button($(constants.SHOW_ADD_ACCOUNT_BUTTON_ID));$("body").on("click",function(){LOGIN.hide_main_menu();});LOGIN.bind_settings();GENERAL.init();$(constants.LOGOUT_MENU_ITEM).on("click",function(){LOGIN.logout();});$(constants.SETTING_MENU_ITEM).on("click",function(){GENERAL.show_settings_window();});$(constants.ORIENTATION_MENU_ITEM).on("click",function(){GENERAL.show_orientation();});$(constants.HELP_MENU_ITEM).on("click",function(){window.open(constants.HELP_CENTER_URL,constants.HELP_CENTER_TITLE);});var tabs=[constants.EXPENSE_TAB,constants.INCOME_TAB];GENERAL.bind_tab_events(tabs);TRANSACTION.init();TRANSACTION.get_transactions();CATEGORY.init();CATEGORY.get_all_categories();ACCOUNT.get_currencies();ACCOUNT.get_accounts();BUDGET.init();GENERAL.bind_main_tab_events();ANALYTICS.init();});var DATEPICKER=new DatePicker();function DatePicker(){}
DatePicker.prototype.get_days_of_week=function(){var default_days_of_week=["SU","MO","TU","WE","TH","FR","SA"];if(GENERAL.lang=="en"){return default_days_of_week;}
return default_days_of_week;};DatePicker.prototype.get_month_names=function(){var default_month_names=["January","February","March","April","May","June","July","August","September","October","November","December"];if(GENERAL.lang=="en"){return default_month_names;}
return default_month_names;};DatePicker.prototype.generate_calendar=function(date,calendar_container,calendar_id,textbox,selected_date){var today=new Date();var data={};var days_of_week=DATEPICKER.get_days_of_week();for(var j=1;j<=7;++j)
data["calendar_day_"+j]=days_of_week[j-1];var month=date.getMonth()+1;var year=date.getFullYear();data["calendar_id"]=calendar_id;var month_names=DATEPICKER.get_month_names();var month_string=month_names[month-1]+" "+year;data["calendar_month_string"]=month_string;data["calendar_month"]=month-1;data["calendar_year"]=year;var new_date=new Date(year,month-1,1);var new_date_2=new Date(year,month,0);var day_of_week=new_date.getDay();var num_days_month=new_date_2.getDate();var start_cell=day_of_week;var current_date=new Date(year,month-1,1);if(start_cell>0){current_date.setDate(current_date.getDate()-1);for(var m=start_cell-1;m>=0;--m){DATEPICKER.populate_cell(data,m+1,current_date,"calendar_cell_inactive",today,selected_date);current_date.setDate(current_date.getDate()-1);++cell_index;}}
var cell_index=start_cell+1;current_date=new Date(year,month-1,1);for(var i=0;i<num_days_month;++i){DATEPICKER.populate_cell(data,cell_index,current_date,"calendar_cell_active",today,selected_date);current_date.setDate(current_date.getDate()+1);++cell_index;}
for(var k=cell_index;k<=42;++k){DATEPICKER.populate_cell(data,cell_index,current_date,"calendar_cell_inactive",today,selected_date);current_date.setDate(current_date.getDate()+1);++cell_index;}
var calendar_template=$(constants.CALENDAR_TEMPLATE_ID).html();var html_maker=new htmlMaker(calendar_template);var calendar_html=html_maker.getHTML(data);calendar_container.html(calendar_html);textbox.on("focus",function(e){$("#"+calendar_id).show();});$("#"+calendar_id).on("click",function(e){});textbox.on("click",function(e){e.stopPropagation();});$(".window").on("click",function(){$("#"+calendar_id).hide();});$("#"+calendar_id+"  "+constants.CALENDAR_CELL).on("click",function(e){e.stopPropagation();var year=$(this).attr(constants.CALENDAR_YEAR_ATTR);var month=$(this).attr(constants.CALENDAR_MONTH_ATTR);var day=$(this).attr(constants.CALENDAR_DAY_ATTR);var date_object=new Date(year,month,day);var date=GENERAL.format_date(date_object);textbox.val(date);$("#"+calendar_id).hide();});$(constants.CALENDAR_LEFT_ARROW_ID+calendar_id).on("click",function(e){e.stopPropagation();var year=$(this).attr(constants.CALENDAR_YEAR_ATTR);var month=$(this).attr(constants.CALENDAR_MONTH_ATTR);var prev_month_date=new Date(year,month,1);prev_month_date.setMonth(prev_month_date.getMonth()-1);DATEPICKER.generate_calendar(prev_month_date,calendar_container,calendar_id,textbox,selected_date);$("#"+calendar_id).show();});$(constants.CALENDAR_RIGHT_ARROW_ID+calendar_id).on("click",function(e){e.stopPropagation();var year=$(this).attr(constants.CALENDAR_YEAR_ATTR);var month=$(this).attr(constants.CALENDAR_MONTH_ATTR);var next_month_date=new Date(year,month,1);next_month_date.setMonth(next_month_date.getMonth()+1);DATEPICKER.generate_calendar(next_month_date,calendar_container,calendar_id,textbox,selected_date);$("#"+calendar_id).show();});};DatePicker.prototype.populate_cell=function(data,cell_index,date,class_name,today,selected_date){data["calendar_cell_"+cell_index+"_day"]=date.getDate();data["calendar_cell_"+cell_index+"_month"]=date.getMonth();data["calendar_cell_"+cell_index+"_year"]=date.getFullYear();if(selected_date!=null&&selected_date.getFullYear()==date.getFullYear()&&selected_date.getMonth()==date.getMonth()&&selected_date.getDate()==date.getDate())
class_name="calendar_cell_selected_day";if(today.getFullYear()==date.getFullYear()&&today.getMonth()==date.getMonth()&&today.getDate()==date.getDate())
class_name="calendar_cell_today";data["calendar_cell_"+cell_index+"_class"]=class_name;data["calendar_cell_"+cell_index]=date.getDate();};